
<!DOCTYPE html>


<html lang="en" data-content_root="./" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>Reproducible Analysis &#8212; Coding for Economists</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="_static/styles/theme.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
<link href="_static/styles/bootstrap.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
<link href="_static/styles/pydata-sphinx-theme.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />

  
  <link href="_static/vendor/fontawesome/6.5.2/css/all.min.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="_static/vendor/fontawesome/6.5.2/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="_static/vendor/fontawesome/6.5.2/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="_static/vendor/fontawesome/6.5.2/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="_static/pygments.css?v=03e43079" />
    <link rel="stylesheet" type="text/css" href="_static/styles/sphinx-book-theme.css?v=eba8b062" />
    <link rel="stylesheet" type="text/css" href="_static/togglebutton.css?v=13237357" />
    <link rel="stylesheet" type="text/css" href="_static/copybutton.css?v=76b2166b" />
    <link rel="stylesheet" type="text/css" href="_static/mystnb.4510f1fc1dee50b3e5859aac5469c37c29e427902b24a333a5f9fcb2f0b3ac41.css" />
    <link rel="stylesheet" type="text/css" href="_static/sphinx-thebe.css?v=4fa983c6" />
    <link rel="stylesheet" type="text/css" href="_static/sphinx-design.min.css?v=95c83b7e" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="_static/scripts/bootstrap.js?digest=dfe6caa3a7d634c4db9b" />
<link rel="preload" as="script" href="_static/scripts/pydata-sphinx-theme.js?digest=dfe6caa3a7d634c4db9b" />
  <script src="_static/vendor/fontawesome/6.5.2/js/all.min.js?digest=dfe6caa3a7d634c4db9b"></script>

    <script src="_static/documentation_options.js?v=9eb32ce0"></script>
    <script src="_static/doctools.js?v=9a2dae69"></script>
    <script src="_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="_static/clipboard.min.js?v=a7894cd8"></script>
    <script src="_static/copybutton.js?v=f281be69"></script>
    <script src="_static/scripts/sphinx-book-theme.js?v=887ef09a"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="_static/togglebutton.js?v=4a39c7ea"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script src="_static/design-tabs.js?v=f930bc37"></script>
    <script async="async" src="https://www.googletagmanager.com/gtag/js?id=G-9FZQCPFXZJ"></script>
    <script>
                window.dataLayer = window.dataLayer || [];
                function gtag(){ dataLayer.push(arguments); }
                gtag('js', new Date());
                gtag('config', 'G-9FZQCPFXZJ');
            </script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"; const thebe_selector = ".thebe,.cell"; const thebe_selector_input = "pre"; const thebe_selector_output = ".output, .cell_output"</script>
    <script async="async" src="_static/sphinx-thebe.js?v=c100c467"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script>
                window.dataLayer = window.dataLayer || [];
                function gtag(){ dataLayer.push(arguments); }
                gtag('js', new Date());
                gtag('config', 'G-9FZQCPFXZJ');
            </script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"; const thebe_selector = ".thebe,.cell"; const thebe_selector_input = "pre"; const thebe_selector_output = ".output, .cell_output"</script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'wrkflow-rap';</script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <link rel="canonical" href="https://aeturrell.github.io/coding-for-economists/wrkflow-rap.html" />
    <link rel="icon" href="_static/favicon.ico"/>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Introduction to Time" href="time-intro.html" />
    <link rel="prev" title="Virtual Code Environments" href="wrkflow-environments.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <div id="pst-skip-link" class="skip-link d-print-none"><a href="#main-content">Skip to main content</a></div>
  
  <div id="pst-scroll-pixel-helper"></div>
  
  <button type="button" class="btn rounded-pill" id="pst-back-to-top">
    <i class="fa-solid fa-arrow-up"></i>Back to top</button>

  
  <input type="checkbox"
          class="sidebar-toggle"
          id="pst-primary-sidebar-checkbox"/>
  <label class="overlay overlay-primary" for="pst-primary-sidebar-checkbox"></label>
  
  <input type="checkbox"
          class="sidebar-toggle"
          id="pst-secondary-sidebar-checkbox"/>
  <label class="overlay overlay-secondary" for="pst-secondary-sidebar-checkbox"></label>
  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
<form class="bd-search d-flex align-items-center"
      action="search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search this book..."
         aria-label="Search this book..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
  </div>

  <div class="pst-async-banner-revealer d-none">
  <aside id="bd-header-version-warning" class="d-none d-print-none" aria-label="Version warning"></aside>
</div>

  
    <header class="bd-header navbar navbar-expand-lg bd-navbar d-print-none">
    </header>
  

  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      
      
      <div class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
    
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">

  
    
  

<a class="navbar-brand logo" href="intro.html">
  
  
  
  
  
    
    
      
    
    
    <img src="_static/smith_lovelace.png" class="logo__image only-light" alt="Coding for Economists - Home"/>
    <script>document.write(`<img src="_static/smith_lovelace.png" class="logo__image only-dark" alt="Coding for Economists - Home"/>`);</script>
  
  
</a></div>
        <div class="sidebar-primary-item">

 <script>
 document.write(`
   <button class="btn search-button-field search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass"></i>
    <span class="search-button__default-text">Search</span>
    <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
   </button>
 `);
 </script></div>
        <div class="sidebar-primary-item"><nav class="bd-links bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item navbar-nav active">
        
        <ul class="nav bd-sidenav bd-sidenav__home-link">
            <li class="toctree-l1">
                <a class="reference internal" href="intro.html">
                    Introduction
                </a>
            </li>
        </ul>
        <p aria-level="2" class="caption" role="heading"><span class="caption-text">Getting Started</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="code-preliminaries.html">Preliminaries</a></li>
<li class="toctree-l1"><a class="reference internal" href="code-basics.html">Coding Basics</a></li>
<li class="toctree-l1"><a class="reference internal" href="workflow-basics.html">Workflow Basics</a></li>
<li class="toctree-l1"><a class="reference internal" href="code-where.html">Writing Code</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Essential Data</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="data-analysis-quickstart.html">Data Analysis Quickstart</a></li>
<li class="toctree-l1"><a class="reference internal" href="data-intro.html">Working with Data</a></li>
<li class="toctree-l1"><a class="reference internal" href="data-transformation.html">Data Transformation</a></li>
<li class="toctree-l1"><a class="reference internal" href="data-read-and-write.html">Reading and Writing Files</a></li>
<li class="toctree-l1"><a class="reference internal" href="data-numbers.html">Numbers</a></li>
<li class="toctree-l1"><a class="reference internal" href="data-categorical.html">Categorical Data</a></li>
<li class="toctree-l1"><a class="reference internal" href="data-spreadsheets.html">Spreadsheets</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Essential Coding</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="code-best-practice.html">Code in Style</a></li>
<li class="toctree-l1"><a class="reference internal" href="code-advanced.html">Coding</a></li>
<li class="toctree-l1"><a class="reference internal" href="code-advcd-best-practice.html">Shortcuts to Better Coding</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Essential Data Visualisation</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="vis-intro.html">Intro to Data Visualisation</a></li>
<li class="toctree-l1"><a class="reference internal" href="vis-letsplot.html">Easy Data Visualisation for Tidy Data with <strong>Lets-Plot</strong></a></li>
<li class="toctree-l1"><a class="reference internal" href="vis-matplotlib.html">Powerful Data Visualisation with <strong>Matplotlib</strong></a></li>
<li class="toctree-l1"><a class="reference internal" href="vis-common-plots-one.html">Common Plots I</a></li>
<li class="toctree-l1"><a class="reference internal" href="vis-common-plots-two.html">Common Plots II</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Essential Workflow</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="auto-research-outputs.html">Automating Research Outputs</a></li>
<li class="toctree-l1"><a class="reference internal" href="wrkflow-markdown.html">Markdown</a></li>
<li class="toctree-l1"><a class="reference internal" href="wrkflow-command-line.html">The Command Line</a></li>
<li class="toctree-l1"><a class="reference internal" href="wrkflow-version-control.html">Version Control</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Econometrics</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="econmt-probability-random.html">Probability and Random Processes</a></li>
<li class="toctree-l1"><a class="reference internal" href="econmt-statistics.html">Statistics</a></li>
<li class="toctree-l1"><a class="reference internal" href="econmt-regression.html">Regression</a></li>
<li class="toctree-l1"><a class="reference internal" href="econmt-generalised-models.html">Generalised regression models</a></li>
<li class="toctree-l1"><a class="reference internal" href="econmt-diagnostics.html">Regression diagnostics and visualisations</a></li>
<li class="toctree-l1"><a class="reference internal" href="econmt-causal-inference.html">Causal Inference</a></li>
<li class="toctree-l1"><a class="reference internal" href="econmt-bayesian.html">Bayesian Inference</a></li>
<li class="toctree-l1"><a class="reference internal" href="econmt-bayes-bambi.html">Bayesian Inference Made Easier</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Data</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="data-boolean.html">Boolean Data</a></li>
<li class="toctree-l1"><a class="reference internal" href="data-joining-data.html">Joins</a></li>
<li class="toctree-l1"><a class="reference internal" href="data-missing-values.html">Missing Values</a></li>
<li class="toctree-l1"><a class="reference internal" href="data-exploratory-analysis.html">Exploratory Data Analysis</a></li>
<li class="toctree-l1"><a class="reference internal" href="data-extraction.html">Getting Data</a></li>
<li class="toctree-l1"><a class="reference internal" href="data-databases.html">Databases</a></li>
<li class="toctree-l1"><a class="reference internal" href="data-advanced.html"><strong>pandas</strong> alternatives, validation, and orchestration</a></li>
<li class="toctree-l1"><a class="reference internal" href="data-sharing.html">Sharing Data</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Coding</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="code-further-advanced.html">Advanced Coding</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Data Visualisation</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="vis-narrative.html">Narrative Data Visualisation</a></li>
<li class="toctree-l1"><a class="reference internal" href="vis-tables.html">Tables</a></li>
<li class="toctree-l1"><a class="reference internal" href="vis-dashboards.html">Dashboards</a></li>
<li class="toctree-l1"><a class="reference internal" href="vis-animation.html">Animation</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Workflow</span></p>
<ul class="current nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="wrkflow-quarto.html">Combining Code and Text in Quarto Markdown</a></li>
<li class="toctree-l1"><a class="reference internal" href="wrkflow-environments.html">Virtual Code Environments</a></li>
<li class="toctree-l1 current active"><a class="current reference internal" href="#">Reproducible Analysis</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Time</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="time-intro.html">Introduction to Time</a></li>
<li class="toctree-l1"><a class="reference internal" href="time-series.html">Time Series</a></li>
<li class="toctree-l1"><a class="reference internal" href="time-fcasts-env.html">Forecasting Exercises</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Text Analysis</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="text-intro.html">Introduction to Text</a></li>
<li class="toctree-l1"><a class="reference internal" href="text-regex.html">Regular Expressions, aka regex</a></li>
<li class="toctree-l1"><a class="reference internal" href="text-nlp.html">Natural Language Processing</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Machine Learning</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="ml-intro.html">Introduction to Machine Learning and AI</a></li>
<li class="toctree-l1"><a class="reference internal" href="ml-sup.html">Supervised Machine Learning</a></li>
<li class="toctree-l1"><a class="reference internal" href="ml-data.html">Data for Machine Learning</a></li>
<li class="toctree-l1"><a class="reference internal" href="ml-unsup.html">Unsupervised Machine Learning</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Geospatial</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="geo-intro.html">Intro to Geo-Spatial Analysis</a></li>
<li class="toctree-l1"><a class="reference internal" href="geo-vis.html">Geo-Spatial Visualisation</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Mathematics</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="maths-abstract.html">Abstract Mathematics</a></li>
<li class="toctree-l1"><a class="reference internal" href="maths-numerical.html">Numerical Mathematics</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Craft</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="craft-intro.html">Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="craft-search.html">Putting the Search in Research</a></li>
<li class="toctree-l1"><a class="reference internal" href="craft-generating-ideas.html">Generating and Accepting Research Ideas</a></li>
<li class="toctree-l1"><a class="reference internal" href="craft-writing-papers.html">Writing Papers</a></li>
<li class="toctree-l1"><a class="reference internal" href="craft-research-blogs.html">Research Blog Posts</a></li>
<li class="toctree-l1"><a class="reference internal" href="craft-referee.html">Writing Referee Reports</a></li>
<li class="toctree-l1"><a class="reference internal" href="craft-technical-reports.html">Writing Technical Reports</a></li>
<li class="toctree-l1"><a class="reference internal" href="craft-extended-abstracts.html">Extended Abstracts</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Further Data Visualisation</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="vis-plotnine.html">Data Visualisation using the Grammar of Graphics with <strong>Plotnine</strong></a></li>
<li class="toctree-l1"><a class="reference internal" href="vis-seaborn.html">Data Visualisation with <strong>Seaborn</strong></a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Coming from ...</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="coming-from-stata.html">Coming from Stata</a></li>
<li class="toctree-l1"><a class="reference internal" href="coming-from-matlab.html">Coming from Matlab</a></li>
<li class="toctree-l1"><a class="reference internal" href="coming-from-r.html">Coming from R</a></li>
<li class="toctree-l1"><a class="reference internal" href="coming-from-excel.html">Coming from Excel</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">End Matter</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="contributing.html">Contributing</a></li>
<li class="toctree-l1"><a class="reference internal" href="zreferences.html">Bibliography</a></li>
</ul>

    </div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main" role="main">
        
        

<div class="sbt-scroll-pixel-helper"></div>

          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article d-print-none">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item"><button class="sidebar-toggle primary-toggle btn btn-sm" title="Toggle primary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
  <span class="fa-solid fa-bars"></span>
</button></div>
      
    </div>
  
  
    <div class="header-article-items__end">
      
        <div class="header-article-item">

<div class="article-header-buttons">





<div class="dropdown dropdown-launch-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Launch interactive content">
    <i class="fas fa-rocket"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="https://colab.research.google.com/github/aeturrell/coding-for-economists/blob/main/wrkflow-rap.ipynb" target="_blank"
   class="btn btn-sm dropdown-item"
   title="Launch on Colab"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  
    <img alt="Colab logo" src="_static/images/logo_colab.png">
  </span>
<span class="btn__text-container">Colab</span>
</a>
</li>
      
  </ul>
</div>






<div class="dropdown dropdown-source-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Source repositories">
    <i class="fab fa-github"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="https://github.com/aeturrell/coding-for-economists" target="_blank"
   class="btn btn-sm btn-source-repository-button dropdown-item"
   title="Source repository"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fab fa-github"></i>
  </span>
<span class="btn__text-container">Repository</span>
</a>
</li>
      
      
      
      
      <li><a href="https://github.com/aeturrell/coding-for-economists/issues/new?title=Issue%20on%20page%20%2Fwrkflow-rap.html&body=Your%20issue%20content%20here." target="_blank"
   class="btn btn-sm btn-source-issues-button dropdown-item"
   title="Open an issue"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-lightbulb"></i>
  </span>
<span class="btn__text-container">Open issue</span>
</a>
</li>
      
  </ul>
</div>






<div class="dropdown dropdown-download-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Download this page">
    <i class="fas fa-download"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="_sources/wrkflow-rap.ipynb" target="_blank"
   class="btn btn-sm btn-download-source-button dropdown-item"
   title="Download source file"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="btn__text-container">.ipynb</span>
</a>
</li>
      
      
      
      
      <li>
<button onclick="window.print()"
  class="btn btn-sm btn-download-pdf-button dropdown-item"
  title="Print to PDF"
  data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="btn__text-container">.pdf</span>
</button>
</li>
      
  </ul>
</div>




<button onclick="toggleFullScreen()"
  class="btn btn-sm btn-fullscreen-button"
  title="Fullscreen mode"
  data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>



<script>
document.write(`
  <button class="btn btn-sm nav-link pst-navbar-icon theme-switch-button" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="theme-switch fa-solid fa-sun fa-lg" data-mode="light"></i>
    <i class="theme-switch fa-solid fa-moon fa-lg" data-mode="dark"></i>
    <i class="theme-switch fa-solid fa-circle-half-stroke fa-lg" data-mode="auto"></i>
  </button>
`);
</script>


<script>
document.write(`
  <button class="btn btn-sm pst-navbar-icon search-button search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass fa-lg"></i>
  </button>
`);
</script>
<button class="sidebar-toggle secondary-toggle btn btn-sm" title="Toggle secondary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="fa-solid fa-list"></span>
</button>
</div></div>
      
    </div>
  
</div>
</div>
              
              

<div id="jb-print-docs-body" class="onlyprint">
    <h1>Reproducible Analysis</h1>
    <!-- Table of contents -->
    <div id="print-main-content">
        <div id="jb-print-toc">
            
            <div>
                <h2> Contents </h2>
            </div>
            <nav aria-label="Page">
                <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#introduction">Introduction</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#using-modular-code">Using Modular Code</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#project-structure">Project Structure</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#reproducible-analytical-pipelines">Reproducible Analytical Pipelines</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#directed-acyclic-graphs">Directed Acyclic Graphs</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#scripting-reproducible-analytical-pipelines">Scripting Reproducible Analytical Pipelines</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#make-for-reproducible-analytical-pipelines">Make for Reproducible Analytical Pipelines</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#other-options-for-reproducible-analytical-pipelines">Other Options for Reproducible Analytical Pipelines</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#reproducible-python-environments">Reproducible Python Environments</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#reproducible-environments-with-uv">Reproducible Environments with uv</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#semi-reproducible-environments-with-miniconda">Semi-reproducible Environments with Miniconda</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#reproducible-computational-environments">Reproducible Computational Environments</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#saving-your-analysis-for-prosperity">Saving Your Analysis For Prosperity</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#bringing-it-all-together">Bringing It All Together</a></li>
</ul>
            </nav>
        </div>
    </div>
</div>

              
                
<div id="searchbox"></div>
                <article class="bd-article">
                  
  <section class="tex2jax_ignore mathjax_ignore" id="reproducible-analysis">
<span id="wrkflow-rap"></span><h1>Reproducible Analysis<a class="headerlink" href="#reproducible-analysis" title="Link to this heading">#</a></h1>
<section id="introduction">
<h2>Introduction<a class="headerlink" href="#introduction" title="Link to this heading">#</a></h2>
<p>This chapter will tell you about reproducible analysis and what are sometimes called ‚Äúreproducible analytical pipelines‚Äù, also known as RAPs. This chapter has benefitted from the ‚Äú<a class="reference external" href="https://best-practice-and-impact.github.io/qa-of-code-guidance">Quality Assurance of Code for Analysis and Research</a>‚Äù book produced by the Best Practice and Impact division of the Office for National Statistics and ‚ÄúThe Turing Way‚Äù, a <a class="reference external" href="https://the-turing-way.netlify.app">guide to reproducibility</a> produced by the Alan Turing Institute.</p>
<p>Reproducibility can mean a lot of things to a lot of different people in a lot of different contexts. Here, we‚Äôre going to think about the reproducibility of analysis performed by code. That excludes external validity and although it might include robust coding practices, it doesn‚Äôt include robustness checks.</p>
<p>It does include Reproducible Analytical Pipelines (RAPs), which are automated analytical processes. At their best, RAPs use elements of software engineering best practice to ensure that analysis is reproducible.</p>
<p>There are different levels and aspects of reproducibile analysis with code, which we will step through in the rest of this chapter, but they form a hierarchy:</p>
<ul class="simple">
<li><p>modular code</p></li>
<li><p>sensible, isolated project structure using relative filepaths</p></li>
<li><p>an unmodified version of the raw data is retained; outputs can be regenerated</p></li>
<li><p>operations should form a reproducible analytical pipeline</p></li>
<li><p>the reproducible analytical pipeline can be automatically executed (eg using Make or a ‚Äòmain‚Äô script)</p></li>
<li><p>code language is reproducible (eg <code class="docutils literal notranslate"><span class="pre">Python=3.10.6</span></code> in pyproject.toml file)</p></li>
<li><p>code language packages are reproducible (eg <code class="docutils literal notranslate"><span class="pre">pandas=2.2.3</span></code> in pyproject.toml file)</p></li>
<li><p>code language packages‚Äô dependencies are reproducible (eg that pandas depends on <code class="docutils literal notranslate"><span class="pre">numpy=1.26.4</span></code> in this installation is recorded somewhere)</p></li>
<li><p>operating system is reproducible (as specified in a Docker file or by using repo2docker)</p></li>
</ul>
<p><em>A lot of the value to be had in reproducible code can be achieved by just the first five</em>. Nailing all but the last one is a high standard and probably the right spot in the trade-off between effort and reproducibility for a lot of projects. If you get this far, you‚Äôre doing a really great job. Doing all of these is the gold standard.</p>
<p>Reproducibility isn‚Äôt just about ensuring your results reproduce, though that‚Äôs obviously the main reason to do it. It‚Äôs also about saving you time and effort. This image, from biological psychiatry researcher Daniel Quintana‚Äôs <a class="reference external" href="http://dx.doi.org/10.17605/OSF.IO/DZTVQ">talk</a> <em>Five things about open and reproducible science that every early career researcher should know</em>, sums it up nicely:</p>
<p><img alt="Time taken with and without reproducibility" src="https://github.com/aeturrell/coding-for-economists/raw/main/img/reproducibiity_relocates_time.png" /></p>
</section>
<section id="using-modular-code">
<h2>Using Modular Code<a class="headerlink" href="#using-modular-code" title="Link to this heading">#</a></h2>
<p>(You may have already met this idea before as the DRY, or ‚Äúdon‚Äôt repeat yourself‚Äù, concept).</p>
<p>How you structure your code can itself aid reproducibility. Let‚Äôs imagine you have a situation where you want to perform two similar analytical tasks in which the only thing that changes are the inputs and outputs. Let‚Äôs say, for example, that you want to perform a particular set of operations, perhaps the following:</p>
<blockquote>
<div><p>find the mean from the second entry in a list onwards, add 1, divide by the number of entries in the reduced length list and then print the answer as a score</p>
</div></blockquote>
<p>Here‚Äôs one example of that:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>

<span class="n">list1</span> <span class="o">=</span> <span class="p">[</span><span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">8</span><span class="p">]</span>
<span class="n">score1</span> <span class="o">=</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">list1</span><span class="p">[</span><span class="mi">1</span><span class="p">:])</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">/</span> <span class="mi">5</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;The score is </span><span class="si">{</span><span class="n">score1</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>The score is 1.40
</pre></div>
</div>
</div>
</div>
<p>But now we have imagine we have a second set of variables we‚Äôd like to run the same logic on. Naively, you might copy and paste the same code again but replace the list with the new one, like this:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">list2</span> <span class="o">=</span> <span class="p">[</span><span class="mi">16</span><span class="p">,</span> <span class="mi">12</span><span class="p">,</span> <span class="mi">88</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">9</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">32</span><span class="p">,</span> <span class="mi">5</span><span class="p">]</span>
<span class="n">score2</span> <span class="o">=</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">list2</span><span class="p">[</span><span class="mi">1</span><span class="p">:])</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">/</span> <span class="mi">5</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;The score is </span><span class="si">{</span><span class="n">score2</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>The score is 4.60
</pre></div>
</div>
</div>
</div>
<p>The problem with this is that we repeated the code even though we wanted to perform the same operation, which is not very efficient.</p>
<p>We also expect <code class="docutils literal notranslate"><span class="pre">score1</span></code> and <code class="docutils literal notranslate"><span class="pre">score2</span></code> to be using the same operations, but we can‚Äôt be sure now because <em>the code is different</em>. And indeed, in this case, the copy and paste philosophy has gone wrong. Did you spot the mistake? Instead of dividing by the number of entries in the reduced length list, our copy and paste job saw us dividing by the number of entries in the first case (creating <code class="docutils literal notranslate"><span class="pre">score1</span></code>).</p>
<p>What we should have done is create modular code, where the same logic is not repeated but <em>re-used</em>. In this case, that‚Äôs best done with a function like follows:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">compute_score</span><span class="p">(</span><span class="n">list_input</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;find the mean from the second entry in a list onwards,</span>
<span class="sd">    add 1, divide by the number of entries in the reduced</span>
<span class="sd">    length list and then print the answer as a score.</span>

<span class="sd">    Args:</span>
<span class="sd">        list_input (list[float]): A list of numbers</span>
<span class="sd">    Returns:</span>
<span class="sd">        score (float): A computed score</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">reduced_list</span> <span class="o">=</span> <span class="n">list_input</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span>
    <span class="n">score</span> <span class="o">=</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">reduced_list</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">/</span> <span class="nb">len</span><span class="p">(</span><span class="n">reduced_list</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;The score is </span><span class="si">{</span><span class="n">score</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>


<span class="c1"># Just to show it works:</span>
<span class="n">compute_score</span><span class="p">(</span><span class="n">list1</span><span class="p">)</span>
<span class="n">compute_score</span><span class="p">(</span><span class="n">list2</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>The score is 1.40
The score is 3.29
</pre></div>
</div>
</div>
</div>
<p>We can now be sure that we get <em>exactly</em> the same set of operations applied each time because we put the logic into one function that is called for both lists. And, to avoid any copy and paste errors, we switched from hard-coding the divisor to making it part of the logic of the function (by dividing by <code class="docutils literal notranslate"><span class="pre">len(reduced_list)</span></code>).</p>
<p>By putting our logic in a function, we‚Äôve also made what we are trying to do clearer to the reader‚Äîand remember, coders, that reader is most likely to be you in a few months time.</p>
<p>Functions help with reproducibile analytical pipelines because you can be sure that even if your inputs change slightly, the same logic or set of operations will be run.</p>
<p>Of course, functions do not have to be in the same script (the same <code class="docutils literal notranslate"><span class="pre">.py</span></code> file) as the one you are currently writing your code in. Python allows you to import functions from other scripts.</p>
<p>A classic example would be if you had a project that was structured like this:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>üìÅ<span class="w"> </span>project
‚îÇ‚îÄ‚îÄmain.py
‚îÇ‚îÄ‚îÄutilities.py
‚îÇ‚îÄ‚îÄfigures.py
‚îÇ‚îÄ‚îÄREADME.md
</pre></div>
</div>
<p>where ‚Äòproject‚Äô is a folder, and the files within it are three Python scripts and a markdown document. Your utilities script might have a really useful function in it that you‚Äôd like to use in <a class="reference external" href="http://main.py">main.py</a> and <a class="reference external" href="http://figures.py">figures.py</a> too. You can do this! It‚Äôs possible to do from ‚Äòwithin‚Äô your other scripts. It‚Äôs also surprisingly simple. Your utilities script might look like:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Contents of utilities.py file</span>
<span class="k">def</span><span class="w"> </span><span class="nf">really_useful_func</span><span class="p">(</span><span class="n">number</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Performs a really useful operation on input number</span>
<span class="sd">    and returns the result.&quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">number</span> <span class="o">*</span> <span class="mi">10</span>
</pre></div>
</div>
</div>
</div>
<p>While, to use this function in your <a class="reference external" href="http://main.py">main.py</a> script, you‚Äôd have:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Contents of main.py</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">utilities</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">util_mod</span>

<span class="nb">print</span><span class="p">(</span><span class="n">util_mod</span><span class="o">.</span><span class="n">really_useful_func</span><span class="p">(</span><span class="mi">20</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>200
</pre></div>
</div>
</div>
</div>
<p>And, just as valid, you could import the same function from utilities in a different way in <a class="reference external" href="http://figures.py">figures.py</a></p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">utilities</span><span class="w"> </span><span class="kn">import</span> <span class="n">really_useful_func</span>

<span class="nb">print</span><span class="p">(</span><span class="n">really_useful_func</span><span class="p">(</span><span class="mi">30</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>300
</pre></div>
</div>
</div>
</div>
<p>The technical jargon for what you‚Äôve just done is to use <code class="docutils literal notranslate"><span class="pre">utilities.py</span></code> as a <em>module</em> rather than as a script.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>If your script is in a different directory, you will need a relative import. Let‚Äôs say you‚Äôve set your project‚Äôs default directory to the folder ‚Äúproject‚Äù, and the module you‚Äôd like to import is in a directory useful, so that it‚Äôs path is <code class="docutils literal notranslate"><span class="pre">project/useful/utilities.py</span></code>. As before, you‚Äôre running code from the default directory, <code class="docutils literal notranslate"><span class="pre">project/main.py</span></code>. Then you‚Äôll need to import the script within <code class="docutils literal notranslate"><span class="pre">main.py</span></code> using the following: <code class="docutils literal notranslate"><span class="pre">from</span> <span class="pre">useful</span> <span class="pre">import</span> <span class="pre">utilities</span> <span class="pre">as</span> <span class="pre">utils</span></code>.</p>
</div>
<p>The reasons for wanting to be able to import functions (or other code) from other scripts are exactly the same as for functions within scripts: so that you only need write the function once to use it everywhere, and so that you can be sure you are running exactly the same set of operations each time.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>If you are in the middle of a coding session and you change the code in a module (external script), your Python kernel will not necessarily know that you have changed the external script. You can either restart the Python kernel, but you lose your variables, or use the built-in <code class="docutils literal notranslate"><span class="pre">importlib</span></code> Python package. For example, to reload an external module named <code class="docutils literal notranslate"><span class="pre">utilities.py</span></code> that had been imported via <code class="docutils literal notranslate"><span class="pre">import</span> <span class="pre">utilities</span> <span class="pre">as</span> <span class="pre">utils</span></code>, you would run <code class="docutils literal notranslate"><span class="pre">import</span> <span class="pre">importlib</span></code> and, when you wanted to refresh the module, <code class="docutils literal notranslate"><span class="pre">importlib.reload(utils)</span></code>.</p>
</div>
</section>
<section id="project-structure">
<h2>Project Structure<a class="headerlink" href="#project-structure" title="Link to this heading">#</a></h2>
<p>The first principle to guide you should be that <strong>each project lives in its own folder</strong>. Everything for that project will appear somewhere under the top level directory. Do not mix projects in the same folder directory.</p>
<p>A typical project structure might look like:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>üìÅ<span class="w"> </span>project
<span class="p">|</span>‚îÄ‚îÄ<span class="w"> </span>README.md
<span class="p">|</span>‚îÄ‚îÄ<span class="w"> </span>requirements.txt
<span class="p">|</span>‚îÄ‚îÄ<span class="w"> </span>data/
<span class="p">|</span><span class="w">   </span>‚îî‚îÄ‚îÄ<span class="w"> </span>raw_data.csv
<span class="p">|</span>‚îÄ‚îÄ<span class="w"> </span>src/
<span class="p">|</span><span class="w">   </span>‚îú‚îÄ‚îÄ<span class="w"> </span>utilities.py
<span class="p">|</span><span class="w">   </span>‚îú‚îÄ‚îÄ<span class="w"> </span>data_cleaning.py
<span class="p">|</span><span class="w">   </span>‚îú‚îÄ‚îÄ<span class="w"> </span>analysis.py
<span class="p">|</span><span class="w">   </span>‚îî‚îÄ‚îÄ<span class="w"> </span>generate_plots_and_tables.py
<span class="p">|</span>‚îÄ‚îÄ<span class="w"> </span>results/
<span class="p">|</span><span class="w">   </span>‚îú‚îÄ‚îÄ<span class="w"> </span>cleaned_data.csv
<span class="p">|</span><span class="w">   </span>‚îî‚îÄ‚îÄ<span class="w"> </span>derived_data.csv
<span class="p">|</span>‚îÄ‚îÄ<span class="w"> </span>outputs/
<span class="p">|</span><span class="w">   </span>‚îî‚îÄ‚îÄ<span class="w"> </span>latex/
<span class="p">|</span><span class="w">       </span>‚îú‚îÄ‚îÄ<span class="w"> </span>paper.tex
<span class="p">|</span><span class="w">       </span>‚îî‚îÄ‚îÄ<span class="w"> </span>slides.tex
<span class="p">|</span><span class="w">    </span>‚îÄ‚îÄ<span class="w"> </span>floats/
<span class="p">|</span><span class="w">       </span>‚îú‚îÄ‚îÄ<span class="w"> </span>table.tex
<span class="p">|</span><span class="w">       </span>‚îî‚îÄ‚îÄ<span class="w"> </span>time_series_plot.pdf
</pre></div>
</div>
<p>Let‚Äôs take a quick tour through this example project‚Äôs structure, all of which sits in the ‚Äúproject‚Äù directory.</p>
<p>First we have the <a class="reference external" href="http://README.md">README.md</a>, a file full of instructions in a simple text format called <em>markdown</em> (=‚Äù.md‚Äù). Markdown is kind of like a code language for text and is commonly used to write information in coding projects. It can be ‚Äúrendered‚Äù (that is, can be displayed not as code but in a form that is intended to be read) by Visual Studio Code using the markdown all in one extension (see the <a class="reference internal" href="code-where.html#code-where"><span class="std std-ref">Writing Code</span></a> chapter for more on markdown).</p>
<p>The next file, ‚Äúrequirements.txt‚Äù, is one we‚Äôll be seeing much more of later in this chapter. For now, all you need to do know is that it is a list of all of the Python packages needed to run the project. Sometimes it might be called ‚Äúenvironment.yml‚Äù instead, or sometimes ‚Äúpyproject.toml‚Äù.</p>
<p>Next we have the data, which is the data as you received it, no matter how poor the format (wishful thinking in this example that it might be a clean csv file and not 400 Excel files!). A really important principle here is that <strong>you should not alter raw data</strong> as it comes to you, but instead treat it as read-only. This is so that you can always trace a path from the raw data you began with to the finished product. Incoming data can and does change surprisingly often so if someone else were to do the ‚Äúsame‚Äù analysis as you and find a different answer, you want to be able to rule out starting with different input datasets as the cause. Or you may find that your data cleaning script needs adjusting, and you need to repeat all of the operations in your project. Or other good reasons. Always keep a copy of the raw data.</p>
<p>The next folder is ‚Äúsrc‚Äù, which is short for ‚Äúsource code‚Äù, and it‚Äôs where your code scripts (.py files) or possibly Jupyter Notebooks (.ipynb files) live. These are nicely separated into the functions they perform: cleaning the data, performing the analysis, and summarising the analysis into figures and tables (also known as floats). The other script, ‚Äú<a class="reference external" href="http://utilities.py">utilities.py</a>‚Äù, might be imported as module that all of the other scripts can use.</p>
<p>The results from running the first two scripts are in the ‚Äúresults‚Äù folder. First we have a file that saves the results from the intermediate step of the cleaning the data (courtesy of running ‚Äúdata_cleaning.py‚Äù), then we have the results from ‚Äú<a class="reference external" href="http://analysis.py">analysis.py</a>‚Äù, the derived data. Derived data might be, for example, the final tabular dataset that you use for a regression.</p>
<p>Next up is outputs, which is split into ‚Äúlatex‚Äù and ‚Äúfloats‚Äù.</p>
<p>Latex is a typesetting language that is used for writing reports, slides, journal articles, and more. Importantly for coding and replicability, it can be automated (in a way that, say, Word can‚Äôt be). Another option here would be markdown, which can also be exported to a wide variety of output formats. The text in a Latex report has to be written, we can‚Äôt automate that (yet), but the figures and tables that are generated by the ‚Äúgenerate_plots_and_tables.py‚Äù script can be automatically inserted. The same goes for slides written in a variant of Latex called Beamer. You can find more information on the process of automating research outputs in the chapter on <a class="reference internal" href="auto-research-outputs.html#auto-research-outputs"><span class="std std-ref">Automating Research Outputs</span></a>.</p>
<p>Floats means, here at least, tables and figures. These also live in the outputs directory, and are put there by the ‚Äúgenerate_plots_and_tables.py‚Äù script.</p>
<p>So that‚Äôs the structure. There is another important principle here, which follows on from the first: <strong>you should be able to dispose of the results, figures, and tables (ie delete them), without worrying</strong>. If you are working on a project and deleting any outputs that are generated by code scripts would scupper everything, then your project is not reproducible. (This is another reason why you should always keep an ‚Äúuntouched‚Äù version of the raw data.) If it‚Äôs feasible to do so time-wise, it is good practice to delete and regenerate your outputs regularly to test that your project is indeed reproducible.</p>
<p>There are, of course, many variations on this example project structure. You can find ‚Äúcookiecutter‚Äù templates out there that will help you structure your own project (some involve answering some questions about what you need, and what you‚Äôd like to call project, and so on), or just get inspiration. Some good templates to check out that can help you structure your project are the UK Government data science, <a class="reference external" href="https://github.com/ukgovdatascience/govcookiecutter">govcookiecutter</a> and this comprehensive Python data science project template known as <a class="reference external" href="http://drivendata.github.io/cookiecutter-data-science/">cookiecutter-data-science</a>. For advanced users looking to build Python packages that others can install, the <a class="reference external" href="https://cookiecutter-hypermodern-python.readthedocs.io/en/2021.7.15/">hypermodern Python cookiecutter</a> is packed full of amazing features and comes highly recommended.</p>
<p>Another important principle of good project structure is to use relative filepaths; you can read more about those in the Chapter on <a class="reference internal" href="code-best-practice.html#code-best-practice"><span class="std std-ref">Code in Style</span></a>.</p>
</section>
<section id="reproducible-analytical-pipelines">
<h2>Reproducible Analytical Pipelines<a class="headerlink" href="#reproducible-analytical-pipelines" title="Link to this heading">#</a></h2>
<p>We‚Äôve seen how functions and modules can aid the reproducibility of logic. We‚Äôve seen the kind of folder and file structure that can aid reproducibility of projects too. But the <em>order</em> of operations matters as well! Pipelines organise your analysis in a series of steps that, when executed, perform the same series of operations in the same order. If you arrange your code in a reproducible analytical pipelines, you will know that you can send your code to someone else and, when they run it, the same steps will be executed in the same order.</p>
<p>In this section, we‚Äôll look at the concept in general as well as some tools that can aid you in creating reproducible analytical pipelines.</p>
<p>The first principle of RAPs may be a surprise: you shouldn‚Äôt use the interactive console interactively (eg by jamming, re-running lines, etc, as you go). A RAP should be able to go from start to finish with zero human interaction during execution, and produce consistent results at the end. This is different to when you‚Äôre still developing a project, and the interactive console is super useful because you‚Äôre trying things out. But RAP is for prosperity and needs to work without your intervention!</p>
<section id="directed-acyclic-graphs">
<h3>Directed Acyclic Graphs<a class="headerlink" href="#directed-acyclic-graphs" title="Link to this heading">#</a></h3>
<p>Directed acyclic graphs pop up in lots of contexts. Here, in a RAP context, we‚Äôre talking about them because the execution order of your code and scripts should form a directed acyclic graph (DAG). The word ‚Äúgraph‚Äù here can be confusing: it‚Äôs referring to the formal notion of a graph from the branch of mathematics called graph theory, which is the study of pairwise relations between objects. A graph in this context is made up of vertices (also called nodes or points) that are connected by edges (also called links or lines). A DAG is a directed graph with no directed cycles (closed loops). It consists of vertices and edges with each edge directed from one vertex to another, such that following the directions will never form a closed loop. To summarise: ‚Äúdirected‚Äù means that edges between nodes have a direction and you can only traverse the graph in that direction (often shown by arrows in diagrams) and ‚Äúacyclic‚Äù: means there are no cycles so that, for example, a node A can‚Äôt depend on a node B when B depends on A.</p>
<p>The point is that the set of operations that are performed when following a DAG proceeds like water flowing through a series of rapids: one step after another, with no looping back.</p>
<p>This is all a bit abstract and so it‚Äôs a lot easier to just take a look at a visualisation of one. We‚Äôll use the example from the previous section boiled down to only the code scripts (.py files).</p>
<div class="cell tag_remove-input docutils container">
<div class="cell_output docutils container">
<img alt="_images/4c69ffc75e77af8411c0b4b50fc0ccdf1c7d4a77faf6ee88a6bf3346517462e9.svg" src="_images/4c69ffc75e77af8411c0b4b50fc0ccdf1c7d4a77faf6ee88a6bf3346517462e9.svg" />
</div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>If you are running this code yourself and want to run the code that creates the diagram above, you should be aware that the diagram above has a dependency on a non-Python library called graphviz that you will need to install separately (in <em>addition</em> to the Python library called graphviz, which can be installed using <code class="docutils literal notranslate"><span class="pre">pip</span> <span class="pre">install</span> <span class="pre">graphviz</span></code>). On Mac, you can use homebrew to run <code class="docutils literal notranslate"><span class="pre">brew</span> <span class="pre">install</span> <span class="pre">graphviz</span></code> on the command line. <code class="docutils literal notranslate"><span class="pre">sudo</span> <span class="pre">apt</span> <span class="pre">install</span> <span class="pre">graphviz</span></code> works on some flavours of Linux. You can download Windows installers and find more information about this <a class="reference external" href="https://www.graphviz.org/download/">here</a>.</p>
</div>
<p>Here we see the execution order. utilities is the antecedent of every step because it is imported by all three of the other scripts. The rest of the DAG is: data cleaning, analysis, and, finally, generate plots and tables. Fancier DAGs might also show the input data, processed data, results, and outputs on the diagram too.</p>
<p>Why is turning your project into a DAG important? Because, to be able to reproduce what you did, you must be able to clearly define what the steps were that took raw data at the start and output the finished product at the end.</p>
</section>
<section id="scripting-reproducible-analytical-pipelines">
<h3>Scripting Reproducible Analytical Pipelines<a class="headerlink" href="#scripting-reproducible-analytical-pipelines" title="Link to this heading">#</a></h3>
<p>There‚Äôs still a manual step in the above logic. Even with the raw data and the folder structure, someone needs to come along and remember to run the (right) three scripts in the right order. But there‚Äôs no need to leave running the scripts in the right order to chance.</p>
<p>There are a few options to automate the execution order of the scripts. One is to write all the scripts as modules with a main script, ‚Äú<a class="reference external" href="http://main.py">main.py</a>‚Äù, that runs everything else. The contents of <a class="reference external" href="http://main.py">main.py</a> might look like this:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="sd">&quot;&quot;&quot; main.py: Master script for project &quot;project&quot;.</span>
<span class="sd">&quot;&quot;&quot;</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">data_cleaning</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">dc</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">analysis</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">analysis</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">generate_plots_and_tables</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">gen_outputs</span>

<span class="n">dc</span><span class="o">.</span><span class="n">run</span><span class="p">()</span>
<span class="n">analysis</span><span class="o">.</span><span class="n">run</span><span class="p">()</span>
<span class="n">gen_outputs</span><span class="o">.</span><span class="n">run</span><span class="p">()</span>

</pre></div>
</div>
<p>With this arrangement, all the user has to know (perhaps from the <a class="reference external" href="http://README.md">README.md</a>) is that they need to run ‚Äú<a class="reference external" href="http://main.py">main.py</a>‚Äù and it will take care of the rest. The code writer (often the same person as the user, but not always) does need to take the extra step of creating the relevant ‚Äúrun‚Äù functions in each of the three script files too though. And they need to ensure that <em>they</em> use <a class="reference external" href="http://main.py">main.py</a> when generating their results (rather than running the scripts separately), because otherwise there may be differences.</p>
<p>You can see an example project that uses the script method <a class="reference external" href="https://github.com/aeturrell/cookie-cutter-research-project">here</a>.</p>
</section>
<section id="make-for-reproducible-analytical-pipelines">
<h3>Make for Reproducible Analytical Pipelines<a class="headerlink" href="#make-for-reproducible-analytical-pipelines" title="Link to this heading">#</a></h3>
<p>Make is a command line tool (to learn more about what the command line is, check out <a class="reference internal" href="wrkflow-command-line.html#wrkflow-command-line"><span class="std std-ref">The Command Line</span></a>) that helps with automating the execution of a series of processes‚Äîexactly what we need in a RAP. Make does its magic via a command line script. Honestly, it‚Äôs pretty fussy and complicated, which perhaps explains why it‚Äôs not more popular, but it‚Äôs well worth considering as one option for gold-plated reproducible analytical pipelines.</p>
<p>It‚Äôs worth saying up front that Make has little time for pipelines that produce more than one output per input dataset + script combination. This can be puzzling initially, but it‚Äôs actually probably good practice to have one output per unique combination of inputs. The place where it makes less sense, perhaps, is if you have one script that produces all of your figures and tables.</p>
<p>Make is not a Python library, so you‚Äôll need to download and install it separately. The installation instructions are different on different operating systems: you can find information on how to install Make <a class="reference external" href="https://www.gnu.org/software/make/">here</a>. On Mac, if you use homebrew, the command to install it is <code class="docutils literal notranslate"><span class="pre">brew</span> <span class="pre">install</span> <span class="pre">make</span></code>. Similar commands exist for Linux. In Windows, you can use the <a class="reference external" href="https://chocolatey.org/">chocolatey</a> package manager and then <code class="docutils literal notranslate"><span class="pre">choco</span> <span class="pre">install</span> <span class="pre">make</span></code> or work in the <a class="reference external" href="https://docs.microsoft.com/en-us/windows/wsl/install">Windows Subsystem for Linux</a>.</p>
<p>There really is no better tutorial for Make out there than the one that the Alan Turing Institute has put together <a class="reference external" href="https://the-turing-way.netlify.app/reproducible-research/make/make-examples.html">here</a>, so there‚Äôs little point giving another tutorial here. It does assume some knowledge of command line scripting and version control, but it‚Äôs pretty comprehensive and a good place to go to see how to use Make for RAP.</p>
<p>To give a flavour of how Make works, we‚Äôll look at just one step from the Turing example. The most common thing you‚Äôd do with a project that uses Make is navigate to the project directory and use the command line to enter <code class="docutils literal notranslate"><span class="pre">make</span></code> and, sometimes, <code class="docutils literal notranslate"><span class="pre">make</span> <span class="pre">clean</span></code>. The repository in this example looks like this:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>üìÅ<span class="w"> </span>project
‚îú‚îÄ‚îÄ<span class="w"> </span>data/
‚îÇ<span class="w">   </span>‚îú‚îÄ‚îÄ<span class="w"> </span>input_file_1.csv
‚îÇ<span class="w">   </span>‚îî‚îÄ‚îÄ<span class="w"> </span>input_file_2.csv
‚îú‚îÄ‚îÄ<span class="w"> </span>LICENSE
‚îú‚îÄ‚îÄ<span class="w"> </span>Makefile
‚îú‚îÄ‚îÄ<span class="w"> </span>output/
‚îú‚îÄ‚îÄ<span class="w"> </span>README.md
‚îú‚îÄ‚îÄ<span class="w"> </span>report/
‚îÇ<span class="w">   </span>‚îî‚îÄ‚îÄ<span class="w"> </span>report.tex
‚îî‚îÄ‚îÄ<span class="w"> </span>scripts/
<span class="w">    </span>‚îî‚îÄ‚îÄ<span class="w"> </span>generate_histogram.py
</pre></div>
</div>
<p>The recipe for Make is put into a file called ‚ÄúMakefile‚Äù within your project folder:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># Contents of &quot;Makefile&quot; for analysis report</span>

.PHONY:<span class="w"> </span>all<span class="w"> </span>clean

all:<span class="w"> </span>output/report.pdf

output/figure_1.png:<span class="w"> </span>data/input_file_1.csv<span class="w"> </span>scripts/generate_histogram.py
<span class="w">	</span>python<span class="w"> </span>scripts/generate_histogram.py<span class="w"> </span>-i<span class="w"> </span>$&lt;<span class="w"> </span>-o<span class="w"> </span><span class="nv">$@</span>

output/figure_2.png:<span class="w"> </span>data/input_file_2.csv<span class="w"> </span>scripts/generate_histogram.py
<span class="w">	</span>python<span class="w"> </span>scripts/generate_histogram.py<span class="w"> </span>-i<span class="w"> </span>$&lt;<span class="w"> </span>-o<span class="w"> </span><span class="nv">$@</span>

output/report.pdf:<span class="w"> </span>report/report.tex<span class="w"> </span>output/figure_1.png<span class="w"> </span>output/figure_2.png
<span class="w">	</span><span class="nb">cd</span><span class="w"> </span>report/<span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span>pdflatex<span class="w"> </span>report.tex<span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span>mv<span class="w"> </span>report.pdf<span class="w"> </span>../output/report.pdf

clean:
<span class="w">	</span>rm<span class="w"> </span>-f<span class="w"> </span>output/report.pdf
<span class="w">	</span>rm<span class="w"> </span>-f<span class="w"> </span>output/figure_*.png
</pre></div>
</div>
<p>Let‚Äôs walk through this and then we‚Äôll talk about what it does. (NB: Make uses tabs, not spaces, for continued lines.) Bear in mind, Make is going to execute a RAP for us, so various bits of what‚Äôs in the Makefile are going to relate to parts of the process.</p>
<p>First up, phony tells Make that ‚Äúall‚Äù and ‚Äúclean‚Äù are not the names of outputs from the project, but commands. ‚Äúall‚Äù is defined by <code class="docutils literal notranslate"><span class="pre">all:</span> <span class="pre">output/report.pdf</span></code> and is the first target‚Äîwhich means that when <code class="docutils literal notranslate"><span class="pre">Make</span></code> is run without any other information, it will be called. You can see further down the page what ‚Äúall‚Äù does: it uses the .tex file and two figures to run <code class="docutils literal notranslate"><span class="pre">pdflatex</span></code> on <code class="docutils literal notranslate"><span class="pre">report.tex</span></code>, thus compiling the latex to a pdf. (It also does some sensible moving things around in the file system.)</p>
<p>‚Äúall‚Äù depends on the figures being there. So, if they aren‚Äôt, it will run the previous two commands listed in the makefile to create them: <code class="docutils literal notranslate"><span class="pre">output/figure_1.png</span></code> and <code class="docutils literal notranslate"><span class="pre">output/figure_2.png</span></code>. These rely on the input csv data and generate_histogram.py script being present and then run the scripts (remember, telling the command line <code class="docutils literal notranslate"><span class="pre">python</span> <span class="pre">script.py</span></code> runs the <code class="docutils literal notranslate"><span class="pre">script.py</span></code> from top to bottom). <code class="docutils literal notranslate"><span class="pre">-i</span></code> is a flag that precedes the name of an input, but rather than type out the name of the csv again, a shorthand has been used: <code class="docutils literal notranslate"><span class="pre">$&lt;</span></code>, which just means ‚Äúlook at the first thing in the command‚Äù. <code class="docutils literal notranslate"><span class="pre">-o</span></code> is the flag that precedes the name of an output but again a shorthand is used; <code class="docutils literal notranslate"><span class="pre">$&#64;</span></code> means use the name of the target (here <code class="docutils literal notranslate"><span class="pre">output/figure_1.png</span></code> or <code class="docutils literal notranslate"><span class="pre">output/figure_2.png</span></code>).</p>
<p>Finally, we mentioned earlier that it‚Äôs good practice to delete your ouputs and check that your RAP can re-execute and produce everything again. ‚Äúclean‚Äù is the command that does this (via <code class="docutils literal notranslate"><span class="pre">make</span> <span class="pre">clean</span></code>). <code class="docutils literal notranslate"><span class="pre">rm</span></code> is command-line speak for remove, and <code class="docutils literal notranslate"><span class="pre">*</span></code> is a wildcard character that can mean anything so here it deletes <code class="docutils literal notranslate"><span class="pre">figure_1.png</span></code> and <code class="docutils literal notranslate"><span class="pre">figure_2.png</span></code> if they exist.</p>
<p>One of the nice features of Make is that it can auto-generate the DAG that is defined in the Makefile. Here‚Äôs the makefile for this example rendered as a DAG by the programme <a class="reference external" href="https://github.com/lindenb/makefile2graph">makefile2DAG</a>, which uses another tool, graphviz.</p>
<p><img alt="Directed acyclic graph of make example" src="https://github.com/aeturrell/coding-for-economists/raw/main/img/makefile_example.png" /></p>
<p>Another good feature is that Make doesn‚Äôt care <em>what</em> programme you‚Äôre using: pdflatex, python, R, whatever, <em>as long as you can call it from the command line</em>. Which is basically all programmes. So it‚Äôs very flexible too.</p>
<p>One of the less nice features of Make is that it‚Äôs quite complex, and it doesn‚Äôt play that nicely with Windows. There is a lot extra that you can do with it, and with the complexity of your makefile, that goes beyond what we saw in the simple example above‚Äîthough, as noted, the <a class="reference external" href="https://the-turing-way.netlify.app/reproducible-research/make/make-examples.html">Turing‚Äôs tutorial</a> is a great place to start.</p>
<p><a class="reference external" href="https://snakemake.readthedocs.io/">Snakemake</a> is another tool that shares a lot of similarities with Make but, instead of a Makefile, you write instructions in an arguably simpler format, yaml. Despite being very much geared around the Python ecosystem (and especially biological and genetic applications), it can be used to automate any command that you would issue in your terminal.</p>
</section>
<section id="other-options-for-reproducible-analytical-pipelines">
<h3>Other Options for Reproducible Analytical Pipelines<a class="headerlink" href="#other-options-for-reproducible-analytical-pipelines" title="Link to this heading">#</a></h3>
<p>Make can be quite unintuitive and doesn‚Äôt suit more complex tasks and dependencies in your DAG. Another option is to use ‚Äúdata orchestrators‚Äù. These still carry out a DAG, and do require a bit more configuration, but also have many more options. Some popular ones are <a class="reference external" href="https://docs.prefect.io/v3/get-started/index">Prefect</a>, <a class="reference external" href="https://airflow.apache.org/">Airflow</a> (older but more established), and <a class="reference external" href="https://docs.dagster.io/getting-started">Dagster</a>. The underlying technologies are all open source, but be warned that most orchestrators apart from Airflow will try and sell you their cloud services too. That could be helpful for you, but if you‚Äôre just trying it out, navigate to the docs to see how to use the open source code.</p>
</section>
</section>
<section id="reproducible-python-environments">
<h2>Reproducible Python Environments<a class="headerlink" href="#reproducible-python-environments" title="Link to this heading">#</a></h2>
<p>So, you‚Äôve created your project‚Äôs code in a modular way, you‚Äôve used a sensible structure for your files, <em>and</em> you‚Äôve set everything up as a reproducible analytical pipeline (or RAP). But now imagine a scenario where your computer breaks, and you need buy a new one, load it up, and try to run the code, or perhaps your colleague or co-author wants to run the code. What do you do!?</p>
<p>For code to be truly reproducible, you, your colleagues, and your co-authors (and possibly reviewers too) need to be able to do reproduce the exact set of packages and version of programming languages that you used to generate your results.</p>
<p>Here we hit upon another important principle of reproducible analysis: <em>you should use a clean, dedicated Python environment and set of packages for each project that you do.</em> This means that only packages that are necessary for your RAP need be installed and included, and makes it easier to isolate what others will need to re-run that project‚Äôs scripts.</p>
<p>Fortunately, Python makes this possible because it allows <em>virtual environments</em>: that is, you do not need to just have one, monolithic installation of Python on your computer but, instead, have many apparently different versions, each one dedicated to a particular project. And you can do it without the pain of actually installing many different versions of Python.</p>
<p>Actually, for many years, this was quite complicated, so much so that it inspired the XKCD comic below! But although there are still unfortunately many tools for reproducing Python environments, the tools and situation are much better than they once were.</p>
<p><img alt="" src="https://imgs.xkcd.com/comics/python_environment.png" /></p>
<p>It may be easier to illustrate creating Python environments with an example. Let‚Äôs say you‚Äôre using Python 3.8, statsmodels, and pandas for one project, project A. And, for project B, you‚Äôre using Python 3.8 with numpy and scikit-learn. Best practice would be to have two separate virtual Python environments: environment A, with everything needed for project A, and environment B, with everything needed for project B. This way, when you ‚Äúhand over‚Äù project A to a colleague, what they need is clear‚Äîand even specified as <em>part</em> of the documents contained within the project. Better still, you can specify the version of Python too.</p>
<p>There are two ways one could create reproducible Python environments that we‚Äôre going to look at in this section: <a class="reference external" href="https://docs.astral.sh/uv/">uv</a> and <a class="reference external" href="https://docs.anaconda.com/miniconda/">Miniconda</a>. <em>uv is recommended for full reproducibility but you may find Miniconda to be more convenient for some packages involving compiled code</em>. Miniconda can get you most, but not all, of the way to reproducible Python environments and are an excellent back-up option if you don‚Äôt want to use uv.</p>
<p>Before we get into the details though, a word of warning: even if you install the same packages and the same version of a programming language, you may still get differences on different operating systems (or other differences in computers, like hardware). uv is at the absolute forefront of making environments work across operating systems but it‚Äôs a hard problem. This will be explored later on in this chapter.</p>
<section id="reproducible-environments-with-uv">
<h3>Reproducible Environments with uv<a class="headerlink" href="#reproducible-environments-with-uv" title="Link to this heading">#</a></h3>
<p><a class="reference external" href="https://docs.astral.sh/uv/">uv</a> is a relatively new but really quite amazing command line tool that performs several important tasks:</p>
<ul class="simple">
<li><p>automatically creates virtual environments on a per project basis (these environments live in a <code class="docutils literal notranslate"><span class="pre">.venv</span></code> file in the root folder of your project)</p></li>
<li><p>manages and installs Python packages and their dependencies, and logs their versions automatically</p></li>
<li><p>manages and installs Python itself</p></li>
<li><p>can create cross-platform logs of all packages and their dependencies called a lock file</p></li>
<li><p>using the above, can do an install of a complete environment from a lock file</p></li>
<li><p>(advanced) builds Python packages</p></li>
<li><p>(advanced) uploads Python packages to PyPI where they can be installed by others</p></li>
</ul>
<p>To use uv, install it, and navigate to your project folder within the command line. Then run <code class="docutils literal notranslate"><span class="pre">uv</span> <span class="pre">init</span></code>. This will create a (human-readable) <code class="docutils literal notranslate"><span class="pre">pyproject.toml</span></code> file that lists the packages needed for your project. It will also create a virtual Python environment just for your project.</p>
<p>To add and install packages, the command is <code class="docutils literal notranslate"><span class="pre">uv</span> <span class="pre">add</span> <span class="pre">package-name</span></code>. As you add packages, you will see that <code class="docutils literal notranslate"><span class="pre">pyproject.toml</span></code> automatically becomes populated with what you installed. Here‚Äôs an excerpt of a typical <code class="docutils literal notranslate"><span class="pre">pyproject.toml</span></code> file designed for reproducibility:</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>requires-python = &quot;&gt;=3.9&quot;
dependencies = [
    &quot;click&gt;=8.1.7&quot;,
    &quot;ipykernel&gt;=6.29.5&quot;,
    &quot;numpy&gt;=2.0.2&quot;,
    &quot;pandas-stubs&gt;=2.2.2.240807&quot;,
    &quot;pandas&gt;=2.2.3&quot;,
    &quot;polars&gt;=1.17.1&quot;,
    &quot;pyarrow&gt;=18.1.0&quot;,
    &quot;pygments&gt;=2.18.0&quot;,
    &quot;rich&gt;=13.9.4&quot;,
    &quot;typeguard&gt;=4.4.1&quot;,
]
</pre></div>
</div>
<p>The first line here says that this runs on any Python version greater than 3.9. The rest sets out the main dependencies, or packages directly needed for the project, and their minimum versions.</p>
<p>A second file, <code class="docutils literal notranslate"><span class="pre">uv.lock</span></code>, is also created. This ‚Äúlocks‚Äù down the dependencies of your packages. It‚Äôs also human-readable, just not very compelling. Visual Studio Code will happily open both types of file. In that file is a list of every package directly used, the version that‚Äôs installed, and the dependencies of that package and what versions of <em>those</em> is installed.</p>
<p>So when you send someone else the project, they will get the automatically generated <code class="docutils literal notranslate"><span class="pre">pyproject.toml</span></code> and <code class="docutils literal notranslate"><span class="pre">uv.lock</span></code> files. Then, all they need is to navigate to the project folder in the command line, and enter <code class="docutils literal notranslate"><span class="pre">uv</span> <span class="pre">sync</span> <span class="pre">--frozen</span></code>. This will install all of the (same versions of) packages needed to run the code!</p>
<p>Note that, if you want to use the virtual environment to run scripts or tools installed using <code class="docutils literal notranslate"><span class="pre">uv</span> <span class="pre">add</span></code>, you will need to use <code class="docutils literal notranslate"><span class="pre">uv</span> <span class="pre">run</span> <span class="pre">command-name</span></code> rather than the usual <code class="docutils literal notranslate"><span class="pre">command-name</span></code>. For example, if you have a script <code class="docutils literal notranslate"><span class="pre">analysis.py</span></code>, you would call it with <code class="docutils literal notranslate"><span class="pre">uv</span> <span class="pre">run</span> <span class="pre">Python</span> <span class="pre">analysis.py</span></code>.</p>
<p>uv is fast becoming the best go-to option for reproducible Python environments.</p>
</section>
<section id="semi-reproducible-environments-with-miniconda">
<h3>Semi-reproducible Environments with Miniconda<a class="headerlink" href="#semi-reproducible-environments-with-miniconda" title="Link to this heading">#</a></h3>
<p>Miniconda is a package and environment manager that supports Python and R. It‚Äôs very much geared toward data science, and has been around for a while. (This book uses it for its reproducible environment.)</p>
<p>Note that Miniconda provides pre-built package binaries. This is especially useful on some systems where compiling packages is a nuisance (yes, it‚Äôs Windows being difficult again). For this reason, and some others to do with guarantees around package quality, Miniconda is a popular choice for corporate coding setups.</p>
<p>However, that doesn‚Äôt mean it‚Äôs a good choice. It has some serious failings when it comes to reproducibility, which we‚Äôll get to.</p>
<p>Before we talk about reproducibility, we‚Äôre going to look at creating conda environments from a file. While creating environments from a file isn‚Äôt sufficient alone for reproducibility, it is necessary, and it‚Äôs useful to know about in any case.</p>
<p><strong>Miniconda and Python environments</strong></p>
<p>This section outlines a really powerful and useful feature of Miniconda that doesn‚Äôt quite get us to full reproducibility.</p>
<p>Miniconda has an option for creating environments from a file. It uses an <code class="docutils literal notranslate"><span class="pre">environment.yml</span></code> file to do this. A yaml file is just a good old text file with the extension <code class="docutils literal notranslate"><span class="pre">.yml</span></code> instead of <code class="docutils literal notranslate"><span class="pre">.txt</span></code> and a certain layout of items (human-readable). You can open and edit yaml files in Visual Studio Code. Here‚Äôs the contents of a simple <code class="docutils literal notranslate"><span class="pre">environment.yml</span></code> file; the packages can be pinned down just as the version of Python is (for example <code class="docutils literal notranslate"><span class="pre">pandas=1.3.3</span></code> instead of <code class="docutils literal notranslate"><span class="pre">pandas</span></code>) but the code below just installs the latest compatible version:</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>name: codeforecon
channels:
  - conda-forge
dependencies:
  - python=3.8
  - pip
  - pandas
  - pip:
    - plotnine
</pre></div>
</div>
<p>There‚Äôs quite a bit going on here so let‚Äôs break it down. First, the version of Python. This is pinned to 3.8 by the line <code class="docutils literal notranslate"><span class="pre">python=3.8</span></code>. Second, the ‚Äúchannels‚Äù are where packages can be picked up from. ‚Äúconda-forge‚Äù is a community-led effort that holds a superset of other packages and, by including it, you‚Äôre saying you‚Äôre happy for packages to come via this route too. Then the ‚Äúdependencies‚Äù section lists the actual dependencies. These are what you‚Äôd get alternatively by running <code class="docutils literal notranslate"><span class="pre">conda</span> <span class="pre">install</span> <span class="pre">pandas</span></code>, etc., on the command line (assuming you had already installed Miniconda and put it on your computer‚Äôs PATH).</p>
<p>There are so many python packages out there that not all of them are available via conda or conda-forge, and sometimes the packages available on these channels are not the latest versions. So we also include <code class="docutils literal notranslate"><span class="pre">pip</span></code> as a dependency and then go on to say ‚Äúinstall some dependencies via <code class="docutils literal notranslate"><span class="pre">pip</span></code>‚Äù, that is install these as if a person had typed <code class="docutils literal notranslate"><span class="pre">pip</span> <span class="pre">install</span> <span class="pre">packagename</span></code> on the command line. Remember, pip installing a package pulls it down from PyPI, which is the biggest and most widely used Python package store.</p>
<p>Once you have your <code class="docutils literal notranslate"><span class="pre">environment.yml</span></code> file, you can install it on the command line with:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>conda<span class="w"> </span>env<span class="w"> </span>create<span class="w"> </span>-f<span class="w"> </span>environment.yml
</pre></div>
</div>
<p>It can take some time to create a new environment as Miniconda tries to resolve all possible clashes and dependencies in the packages you asked for; it takes longer the more packages you have. (As an example of an environment file that takes a really long time to solve, look no further than the one used to create this book! The book uses many packages, all with their own dependencies and constraints, to finding a set of versions that can work together is time-consuming.) To use your newly created environment, it‚Äôs</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>conda<span class="w"> </span>activate<span class="w"> </span>codeforecon
</pre></div>
</div>
<p>on the command line, where <code class="docutils literal notranslate"><span class="pre">codeforecon</span></code> what be whatever name you put at the start of your <code class="docutils literal notranslate"><span class="pre">environment.yml</span></code> file. If everything has worked you should see</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="o">(</span>codeforecon<span class="o">)</span><span class="w"> </span>your-computer:your-folder<span class="w"> </span>your-name$
</pre></div>
</div>
<p>on the command line, if you‚Äôre using the bash terminal, though this book recommends the zsh terminal. Now, every time you run a command, it will be in this Python environment. You can deactivate the environment with <code class="docutils literal notranslate"><span class="pre">conda</span> <span class="pre">deactivate</span></code> to go back to the base environment or <code class="docutils literal notranslate"><span class="pre">conda</span> <span class="pre">activate</span> <span class="pre">other-environment</span></code> (with the name of a different existing environment) to switch.</p>
<p><strong>Semi-reproducible Miniconda Python environments</strong></p>
<p>Now, having delved into how Miniconda environments work, let‚Äôs think about how to make them reproducible. What we did above, pinning the version of <em>Python</em> but not the packages is not going to cut the mustard. Conda environment.yml files are very useful for defining desired environments but there are times, as here, when we want to be able to <em>exactly</em> reproduce an environment‚Äîincluding the dependencies of the dependencies.</p>
<p>Unfortunately there‚Äôs just no good way to do this with Miniconda currently. Although it‚Äôs possible to completely and automatically lock down the versions of packages installed in the first part of the environment.yml file, ie those that can be conda installed, it is not currently possible to automatically lock down the packages that are installed by pip. There are some nuances to that story, but the important point is it‚Äôs just too painful and complicated to create perfectly reproducible environments using conda &amp; pip together right now (and, really, you want a solution that can cover both given conda doesn‚Äôt cover all Python packages).</p>
<p>So what do semi-reproducible Miniconda Python environments look like? They look just like what we saw above; manually creating a <code class="docutils literal notranslate"><span class="pre">environment.yml</span></code> with the version of Python pinned and the names of both conda and pip packages listed but without their versions. Then, to install this, it‚Äôs <code class="docutils literal notranslate"><span class="pre">conda</span> <span class="pre">env</span> <span class="pre">create</span> <span class="pre">-f</span> <span class="pre">environment.yml</span></code>.</p>
</section>
</section>
<section id="reproducible-computational-environments">
<h2>Reproducible Computational Environments<a class="headerlink" href="#reproducible-computational-environments" title="Link to this heading">#</a></h2>
<p>‚ÄúBut it works on my computer!‚Äù Ever heard that? The tools in the previous section are fantastic for reproducibility but only up to a point. The hard truth is that code packages prepared for different operating systems can have differences, most often if the package contains C or other compiled language code.</p>
<p><img alt="" src="https://external-preview.redd.it/aR6WdUcsrEgld5xUlglgKX_0sC_NlryCPTXIHk5qdu8.jpg?auto=webp&amp;s=5fe64dd318eec71711d87805d43def2765dd83cd" /></p>
<p>For example, because it‚Äôs hard to compile code on the fly in Windows, there are pre-compiled versions of popular packages available, either through Miniconda or just on the <a class="reference external" href="https://www.lfd.uci.edu/~gohlke/pythonlibs/">websites of enthusiasts</a>. The way Windows compiles code is different to Mac, which is different to Linux, and so on.</p>
<p>So to be <em>really</em> sure that your project will run exactly the same on another system, you must not only reproduce the packages and their dependencies but also the computational environment they were run in.</p>
<p>By far the most popular tool for creating virtual operating systems that you can then work in is called <a class="reference external" href="https://www.docker.com/">Docker</a>. Docker containers are a ‚Äústandard unit‚Äù of software that packages up code and all its dependencies so a project runs the same regardless of what your computing environment looks like. A Docker container image is a lightweight, standalone, executable package of software that includes everything needed to run an application: code, runtime, system tools, system libraries (eg the operating system) and settings. Docker essentially puts a mini standardised operating system on top of whichever one you‚Äôre using.</p>
<p>To run Docker, you will need to <a class="reference external" href="https://www.docker.com/products/docker-desktop">install it</a> but be warned‚Äîit‚Äôs quite demanding on your system when it‚Äôs running.</p>
<p>Docker images are defined by ‚Äúdockerfiles‚Äù and, as we‚Äôve seen in the rest of this chapter, this is going to mean a plain text file with some weird formatting! Once a dockerfile is written it can then be built into an image (a time-consuming process), and finally run on your computer.</p>
<p>You can find lots more information about Docker on the internet, including this <a class="reference external" href="https://testdriven.io/blog/docker-best-practices">popular article</a> on best practices with Docker for Python developers‚Äîalthough you should be aware that it is written with production-grade software in mind, not RAP.</p>
<p>How do you create a docker file (the text based version of your repo)? There are two main options; the former is easier but the latter comes with more guarantees about long-term reproducibility.</p>
<p><strong>repo2docker</strong></p>
<p>You can create a dockerfile automatically from a github repository using the <a class="reference external" href="https://github.com/jupyterhub/repo2docker">repo2docker</a> tool. repo2docker is used to create interactive repos in the supremely wonderful <a class="reference external" href="https://mybinder.org/">Binder</a> project, which you can use to run code from this book (it‚Äôs under the rocketship icon at the top of the page).</p>
<p>repo2docker will look at a repository (which could be GitHub, GitLab, Zenodo, Figshare, Dataverse installations, a Git repository or a local file directory) and build a Docker container image in which the code can be executed. The image build process is based on the configuration files found in the repository.</p>
<p>Lots of different configuration files are supported by repo2docker. Miniconda‚Äôs <code class="docutils literal notranslate"><span class="pre">environment.yml</span></code> are, and it‚Äôs recommended that you export your working environment using <code class="docutils literal notranslate"><span class="pre">conda</span> <span class="pre">env</span> <span class="pre">export</span> <span class="pre">--from-history</span> <span class="pre">-f</span> <span class="pre">environment.yml</span></code> to build an image using this technology (but note that this will not pick up any packages installed using other approaches). Another standard option is including a <code class="docutils literal notranslate"><span class="pre">requirements.txt</span></code> file, which you can create from pip via <code class="docutils literal notranslate"><span class="pre">pip</span> <span class="pre">freeze</span> <span class="pre">&gt;</span> <span class="pre">requirements.txt</span></code>.</p>
<p><strong>Create your own Dockerfile</strong></p>
<p>Another option is to create a Dockerfile specific to your project. You can find a simple Dockerfile for an example project over at [this repo].</p>
<p>Of course, there‚Äôs a Visual Studio Code extension for Dockerfiles.</p>
<p>Note that for each instruction or command from the Dockerfile, the Docker builder generates an image layer and stacks it upon the previous ones. To make any rebuilding of your dockerfile less painful, you can ensure that only the later lines change, insofar as is possible.</p>
<p>To build this docker image, the command line command to run in the relevant directory is</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>docker<span class="w"> </span>build<span class="w"> </span>-t<span class="w"> </span>pythonbasic<span class="w"> </span>.
</pre></div>
</div>
<p>which will tag the built docker image with the name ‚Äúpythonbasic‚Äù. To run the created image as a container, it‚Äôs</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>docker<span class="w"> </span>run<span class="w"> </span>-t<span class="w"> </span>-d<span class="w"> </span>--name<span class="w"> </span>pybasicrun<span class="w"> </span>pythonbasic
</pre></div>
</div>
<p>where <code class="docutils literal notranslate"><span class="pre">--name</span></code> gives the running instance a name <code class="docutils literal notranslate"><span class="pre">pybasicrun</span></code>. And then to enter the docker container and use commands within it, the command to launch the bash shell is</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>docker<span class="w"> </span><span class="nb">exec</span><span class="w"> </span>-i<span class="w"> </span>-t<span class="w"> </span>pybasicrun<span class="w"> </span>/bin/bash
</pre></div>
</div>
<p>If you run this, you should see something like:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>root@ec5c6d10ebc3:/app#
</pre></div>
</div>
<div class="admonition-exercise admonition">
<p class="admonition-title">Exercise</p>
<p>Create a Dockerfile from the above text, build it, run the container, and then jump into it. Now, inside the docker container, run <code class="docutils literal notranslate"><span class="pre">printf</span> <span class="pre">&quot;print('hello</span> <span class="pre">world')&quot;</span> <span class="pre">&gt;&gt;</span> <span class="pre">test.py</span></code> and then <code class="docutils literal notranslate"><span class="pre">python</span> <span class="pre">test.py</span></code>. Your ‚Äúhello world‚Äù message should appear on the command line.</p>
</div>
<p>If you can see this, congratulations! You‚Äôve just set up your first Python-enabled Docker container. To quit the Docker container use <kbd>ctrl</kbd> + <kbd>c</kbd>, <kbd>ctrl</kbd> + <kbd>d</kbd>.</p>
<p>To stop the container that‚Äôs running and remove it in one go, use <code class="docutils literal notranslate"><span class="pre">docker</span> <span class="pre">rm</span> <span class="pre">pybasicrun</span> <span class="pre">--force</span></code> once you‚Äôve quit the running instance.</p>
<p><strong>Developing using Visual Studio Code within a Docker container</strong></p>
<p>Now, developing on the command line like this is no fun, clearly. You want access to all of the power of an IDE. Fortunately, Visual Studio Code is designed to be able to connect from your desktop computer to the <em>inside</em> of your Docker container and provide a development experience as if you were running Visual Studio Code as normal.</p>
<p>You can find instructions and a LOT more detail <a class="reference external" href="https://code.visualstudio.com/docs/remote/attach-container#_attach-to-a-docker-container">here</a>, but the short version is that you:</p>
<ol class="arabic simple">
<li><p>Install the VS Code remote: containers extension (<a class="reference external" href="https://code.visualstudio.com/docs/remote/remote-overview">more info on that here</a>)</p></li>
<li><p>Click on the ‚Äòremote explorer‚Äô icon on the left-hand panel in Visual Studio Code.</p></li>
<li><p>Select ‚Äúcontainers‚Äù from the drop-down menu (not ‚ÄúSSH Targets‚Äù or ‚ÄúGithub Codespaces‚Äù)</p></li>
<li><p>Right-click on the image you‚Äôd like to connect to (perhaps ‚Äúpythonbasic‚Äù from the example above), and hit ‚ÄúAttach to container‚Äù</p></li>
</ol>
<p>You should see a new Visual Studio Code window pop up with a message, ‚ÄúStarting Dev Container‚Äù. This may take a while on the first run, as VS Code installs what it needs to connect remotely. But, once it‚Äôs done, you‚Äôll find that you can navigate your Docker container, open a terminal in it, and do a lot of what you would normally but <em>within</em> the Docker container.</p>
<p>As an aside, you can do much the same trick with other VS Code remote options‚ÄîSSH or GitHub Codespaces, but don‚Äôt worry if you don‚Äôt know what these are.</p>
<p>Also note that you could do your entire development in a Docker container from the start if you wished to truly ensure that everything was isolated and repeatable. For extremely advanced users creating software tools, this <a class="reference external" href="https://code.visualstudio.com/docs/remote/create-dev-container">article explains how you can create a ‚Äúdevelopment container‚Äù</a> for software development. For everyone else, a variation on what we‚Äôve seen would be fine.</p>
<div class="admonition-exercise admonition">
<p class="admonition-title">Exercise</p>
<p>Attach Visual Studio Code to a docker container and then use the VS Code window that is connected to your running image to create a new file called <a class="reference external" href="http://test.py">test.py</a>. Write <code class="docutils literal notranslate"><span class="pre">print('hello</span> <span class="pre">world')</span></code> in that file, save it, and use the VS Code integrated terminal to run it within the docker container.</p>
</div>
<p><strong>A docker image with uv and all packages specified</strong></p>
<p>This chapter is supposed to be about reproducibility, but we‚Äôve taken a real detour into Docker and operating systems, and remote development. But have no fear because our digressions have been equipping us to create a fully reproducible environment.</p>
<p>What we need for a fully reproducible environment is the code, the language, the packages, the dependencies of the packages, and the operating system to be specified. We are now in a position to do all that. We‚Äôll even create the DAG and pipeline using Make and graphviz!</p>
<p>Over at <a class="reference external" href="https://github.com/aeturrell/example-reproducible-research">example-reproducible-research</a> there‚Äôs a complete end-to-end example of putting all of this into practice. You can see the DAG that‚Äôs executed there, but it‚Äôs</p>
<p><img alt="DAG for the example repo" src="https://github.com/aeturrell/example-reproducible-research/raw/main/assets/out.png" /></p>
<p>There‚Äôs a lot going on here but mostly it‚Äôs about getting a fixed version of Python and the Debian flavour of Linux operating system, installing Latex, ensuring running <code class="docutils literal notranslate"><span class="pre">python</span></code> on the command line picks up the version of Python we want, installing uv (for reproducible Python package environments), using uv to add specific versions of packakes by installing what‚Äôs in the pyproject.toml file and uv.lock file (neither of these are shown, but are assumed to be in the directory that is copied into the Docker container, and should have versions pinned), copying all of the contents of the current directory into the Docker container, and finally executing the DAG via uv and make.</p>
<p>If you‚Äôd like to try is for yourself and execute the DAG, the instructions are in the <a class="reference external" href="https://github.com/aeturrell/example-reproducible-research">separate repo</a>.</p>
<p>The final output of the project, <code class="docutils literal notranslate"><span class="pre">report.pdf</span></code>, is saved in the outputs folder within the running docker instance.</p>
<p>To export the final report out of the docker container and to your current directory, use the following command on your computer (not in the container)</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>docker<span class="w"> </span>cp<span class="w"> </span>repro_run:app/output/report.pdf<span class="w"> </span>.
</pre></div>
</div>
<p>To exit a running Docker command line terminal, use ctrl + c, ctrl + d. To remove the image and stop it running, use <code class="docutils literal notranslate"><span class="pre">docker</span> <span class="pre">rm</span> <span class="pre">repro_run</span> <span class="pre">--force</span></code>.</p>
<div class="admonition-exercise admonition">
<p class="admonition-title">Exercise</p>
<p>Follow the instructions in this section and export the report.pdf that‚Äôs generated from the Dockerfile.</p>
</div>
</section>
<section id="saving-your-analysis-for-prosperity">
<h2>Saving Your Analysis For Prosperity<a class="headerlink" href="#saving-your-analysis-for-prosperity" title="Link to this heading">#</a></h2>
<p>True reproducible analysis should be findable and accessible, as well as interoperable and re-usable (these are the FAIR principles for data, but they pretty much work for analysis too). So how can you make what you‚Äôve done findable and accessible to others?</p>
<p>Before we try to answer that, it‚Äôs worth noting that, for an analysis that‚Äôs to be preserved in perpetuity, you really want to freeze it in time. So although github and gitlab are great to sharing dynamically changing content, they‚Äôre not as good for long-term preservation. Or, at the very least, you need clear version labels that are used to say what version of the code was used to produce a particular analysis.</p>
<p>There are some fantastic options out there for preserving your code base (and therefore your reproducible project) while also making it findable and accessible. <a class="reference external" href="https://zenodo.org/">Zenodo</a> accepts both code and data (up to 50GB at the time of writing), and gives each repo a DOI, or Digital Object Identifier, a ‚Äúperma-link‚Äù that will always take users to that repository regardless of other website changes. Importantly, different versions are supported and clearly labelled.</p>
<p>You can also now integrate a github repo and Zenodo; instructions are available in <a class="reference external" href="https://the-turing-way.netlify.app/communication/citable/citable-cite.html#cm-citable-cite-software">The Turing Way</a>.</p>
<p>You can also integrate Zenodo, a github repo, and Binder too: so that people coming to your analysis on Zenodo can, with a single click, create a fully interactive version of your analysis on Binder! See this <a class="reference external" href="https://blog.jupyter.org/binder-with-zenodo-af68ed6648a6">blog post</a> for details, and you may want to read the section above on repo2docker too.</p>
<p><a class="reference external" href="https://figshare.com/">Figshare</a> is a similar service to Zenodo.</p>
</section>
<section id="bringing-it-all-together">
<h2>Bringing It All Together<a class="headerlink" href="#bringing-it-all-together" title="Link to this heading">#</a></h2>
<p>Reproducible analysis is a bit more tricky than you thought, eh? But, as noted at the start, you can derive a lot the value by doing only some of the steps. Although it‚Äôs also worth thinking about reproducible analysis <em>right from the start of a project</em> so that it‚Äôs not really painful to lever it back in at the end. In research especially, because you‚Äôre exploring as you go, this can be hard work and you may have to ‚Äúrefactor‚Äù your code multiple times. Favouring simplicity over complexity can make it all go a lot more smoothly.</p>
<p>We‚Äôve looked at numerous tools throughout this chapter, especially for reproducibility for the steps at the start from automatic execution of your RAP onwards. It‚Äôs worth suggesting a default set of tools which this book recommends as:</p>
<p><strong>Recipe 1 for complete reproducible analytical pipelines</strong></p>
<ol class="arabic simple">
<li><p>modular code in scripts</p></li>
<li><p>Make for automatic execution of scripts and other tools according to a directed acyclic graph</p></li>
<li><p>uv for capturing the versions of Python, packages, and the dependencies of packages</p></li>
<li><p>manually creating a dedicated Dockerfile to reproduce an operating system</p></li>
</ol>
<p>Some of these tools are not very friendly to beginners, and sometimes uv can be less convenient for installing package dependencies that are not Python packages than <code class="docutils literal notranslate"><span class="pre">conda</span></code> (especially on Windows), so an alternative that goes a long way toward reproducibility is:</p>
<p><strong>Recipe 2 for reproducible analytical pipelines</strong></p>
<ol class="arabic simple">
<li><p>modular code in scripts</p></li>
<li><p>A ‚Äú<a class="reference external" href="http://main.py">main.py</a>‚Äù script for automatic execution of scripts and other tools according to a directed acyclic graph (Python scripts can execute terminal commands too)</p></li>
<li><p>A manually written <code class="docutils literal notranslate"><span class="pre">environment.yml</span></code> file for specifying the names (but not versions) of packages and the version of Python (for an example, see <a class="reference external" href="https://github.com/aeturrell/coding-for-economists/blob/b4ad9ad978bcc2b0718155b42296088c8d90c548/codeforecon.yml">here</a>)</p></li>
<li><p>creating a dedicated Dockerfile to reproduce an operating system, either manually or using repo2docker</p></li>
</ol>
<p>In both cases, using a service like Zenodo to freeze your project in time, create a citation, create a DOI, and make your project findable is recommended.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Use the two ‚Äúrecipes‚Äù above to help you decide what tools to use in your reproducible analytical pipeline.</p>
</div>
<p>Finally, there are a few other good programming practices that you can follow to enhance the long-term sustainability and reproducibility of your code, especially as your code base gets bigger or more complex. You may not have heard of these yet, and they will or do appear in other chapters (especially <a class="reference internal" href="code-advanced.html#code-advanced"><span class="std std-ref">Coding</span></a> and <a class="reference internal" href="code-advcd-best-practice.html#code-advcd-best-practice"><span class="std std-ref">Shortcuts to Better Coding</span></a>), but they are listed here for completeness.</p>
<ul class="simple">
<li><p>unit testing</p></li>
<li><p>error handling</p></li>
<li><p>documentation of functions via docstrings</p></li>
<li><p>using a code style such as <a class="reference external" href="https://black.readthedocs.io/">black</a></p></li>
<li><p>consider using <a class="reference external" href="http://mypy-lang.org/">typing</a> and <a class="reference external" href="https://typeguard.readthedocs.io/">typeguarding</a>, at least for some code</p></li>
<li><p>input data validation</p></li>
<li><p>logging</p></li>
<li><p>pre-commit hooks</p></li>
<li><p>continuous integration</p></li>
</ul>
</section>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            name: "python3",
            path: "./."
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

                </article>
              

              
              
              
              
                <footer class="prev-next-footer d-print-none">
                  
<div class="prev-next-area">
    <a class="left-prev"
       href="wrkflow-environments.html"
       title="previous page">
      <i class="fa-solid fa-angle-left"></i>
      <div class="prev-next-info">
        <p class="prev-next-subtitle">previous</p>
        <p class="prev-next-title">Virtual Code Environments</p>
      </div>
    </a>
    <a class="right-next"
       href="time-intro.html"
       title="next page">
      <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">Introduction to Time</p>
      </div>
      <i class="fa-solid fa-angle-right"></i>
    </a>
</div>
                </footer>
              
            </div>
            
            
              
                <div class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">


  <div class="sidebar-secondary-item">
  <div class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> Contents
  </div>
  <nav class="bd-toc-nav page-toc">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#introduction">Introduction</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#using-modular-code">Using Modular Code</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#project-structure">Project Structure</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#reproducible-analytical-pipelines">Reproducible Analytical Pipelines</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#directed-acyclic-graphs">Directed Acyclic Graphs</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#scripting-reproducible-analytical-pipelines">Scripting Reproducible Analytical Pipelines</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#make-for-reproducible-analytical-pipelines">Make for Reproducible Analytical Pipelines</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#other-options-for-reproducible-analytical-pipelines">Other Options for Reproducible Analytical Pipelines</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#reproducible-python-environments">Reproducible Python Environments</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#reproducible-environments-with-uv">Reproducible Environments with uv</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#semi-reproducible-environments-with-miniconda">Semi-reproducible Environments with Miniconda</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#reproducible-computational-environments">Reproducible Computational Environments</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#saving-your-analysis-for-prosperity">Saving Your Analysis For Prosperity</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#bringing-it-all-together">Bringing It All Together</a></li>
</ul>
  </nav></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
<div class="bd-footer-content__inner container">
  
  <div class="footer-item">
    
<p class="component-author">
By Arthur Turrell
</p>

  </div>
  
  <div class="footer-item">
    

  <p class="copyright">
    
      ¬© Copyright 2023.
      <br/>
    
  </p>

  </div>
  
  <div class="footer-item">
    
  </div>
  
  <div class="footer-item">
    
<div class="extra_footer">
  This book is available under an MIT license.
</div>
  </div>
  
</div>
          </footer>
        

      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="_static/scripts/bootstrap.js?digest=dfe6caa3a7d634c4db9b"></script>
<script src="_static/scripts/pydata-sphinx-theme.js?digest=dfe6caa3a7d634c4db9b"></script>

  <footer class="bd-footer">
  </footer>
  </body>
</html>