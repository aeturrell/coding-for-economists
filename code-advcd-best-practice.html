
<!DOCTYPE html>


<html lang="en" data-content_root="./" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>Shortcuts to Better Coding &#8212; Coding for Economists</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="_static/styles/theme.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
<link href="_static/styles/bootstrap.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
<link href="_static/styles/pydata-sphinx-theme.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />

  
  <link href="_static/vendor/fontawesome/6.5.2/css/all.min.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="_static/vendor/fontawesome/6.5.2/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="_static/vendor/fontawesome/6.5.2/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="_static/vendor/fontawesome/6.5.2/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="_static/pygments.css?v=03e43079" />
    <link rel="stylesheet" type="text/css" href="_static/styles/sphinx-book-theme.css?v=eba8b062" />
    <link rel="stylesheet" type="text/css" href="_static/togglebutton.css?v=13237357" />
    <link rel="stylesheet" type="text/css" href="_static/copybutton.css?v=76b2166b" />
    <link rel="stylesheet" type="text/css" href="_static/mystnb.4510f1fc1dee50b3e5859aac5469c37c29e427902b24a333a5f9fcb2f0b3ac41.css" />
    <link rel="stylesheet" type="text/css" href="_static/sphinx-thebe.css?v=4fa983c6" />
    <link rel="stylesheet" type="text/css" href="_static/sphinx-design.min.css?v=95c83b7e" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="_static/scripts/bootstrap.js?digest=dfe6caa3a7d634c4db9b" />
<link rel="preload" as="script" href="_static/scripts/pydata-sphinx-theme.js?digest=dfe6caa3a7d634c4db9b" />
  <script src="_static/vendor/fontawesome/6.5.2/js/all.min.js?digest=dfe6caa3a7d634c4db9b"></script>

    <script src="_static/documentation_options.js?v=9eb32ce0"></script>
    <script src="_static/doctools.js?v=9a2dae69"></script>
    <script src="_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="_static/clipboard.min.js?v=a7894cd8"></script>
    <script src="_static/copybutton.js?v=f281be69"></script>
    <script src="_static/scripts/sphinx-book-theme.js?v=887ef09a"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="_static/togglebutton.js?v=4a39c7ea"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script src="_static/design-tabs.js?v=f930bc37"></script>
    <script async="async" src="https://www.googletagmanager.com/gtag/js?id=G-9FZQCPFXZJ"></script>
    <script>
                window.dataLayer = window.dataLayer || [];
                function gtag(){ dataLayer.push(arguments); }
                gtag('js', new Date());
                gtag('config', 'G-9FZQCPFXZJ');
            </script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"; const thebe_selector = ".thebe,.cell"; const thebe_selector_input = "pre"; const thebe_selector_output = ".output, .cell_output"</script>
    <script async="async" src="_static/sphinx-thebe.js?v=c100c467"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script>
                window.dataLayer = window.dataLayer || [];
                function gtag(){ dataLayer.push(arguments); }
                gtag('js', new Date());
                gtag('config', 'G-9FZQCPFXZJ');
            </script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"; const thebe_selector = ".thebe,.cell"; const thebe_selector_input = "pre"; const thebe_selector_output = ".output, .cell_output"</script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'code-advcd-best-practice';</script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <link rel="canonical" href="https://aeturrell.github.io/coding-for-economists/code-advcd-best-practice.html" />
    <link rel="icon" href="_static/favicon.ico"/>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Intro to Data Visualisation" href="vis-intro.html" />
    <link rel="prev" title="Coding" href="code-advanced.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <div id="pst-skip-link" class="skip-link d-print-none"><a href="#main-content">Skip to main content</a></div>
  
  <div id="pst-scroll-pixel-helper"></div>
  
  <button type="button" class="btn rounded-pill" id="pst-back-to-top">
    <i class="fa-solid fa-arrow-up"></i>Back to top</button>

  
  <input type="checkbox"
          class="sidebar-toggle"
          id="pst-primary-sidebar-checkbox"/>
  <label class="overlay overlay-primary" for="pst-primary-sidebar-checkbox"></label>
  
  <input type="checkbox"
          class="sidebar-toggle"
          id="pst-secondary-sidebar-checkbox"/>
  <label class="overlay overlay-secondary" for="pst-secondary-sidebar-checkbox"></label>
  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
<form class="bd-search d-flex align-items-center"
      action="search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search this book..."
         aria-label="Search this book..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
  </div>

  <div class="pst-async-banner-revealer d-none">
  <aside id="bd-header-version-warning" class="d-none d-print-none" aria-label="Version warning"></aside>
</div>

  
    <header class="bd-header navbar navbar-expand-lg bd-navbar d-print-none">
    </header>
  

  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      
      
      <div class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
    
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">

  
    
  

<a class="navbar-brand logo" href="intro.html">
  
  
  
  
  
    
    
      
    
    
    <img src="_static/smith_lovelace.png" class="logo__image only-light" alt="Coding for Economists - Home"/>
    <script>document.write(`<img src="_static/smith_lovelace.png" class="logo__image only-dark" alt="Coding for Economists - Home"/>`);</script>
  
  
</a></div>
        <div class="sidebar-primary-item">

 <script>
 document.write(`
   <button class="btn search-button-field search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass"></i>
    <span class="search-button__default-text">Search</span>
    <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
   </button>
 `);
 </script></div>
        <div class="sidebar-primary-item"><nav class="bd-links bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item navbar-nav active">
        
        <ul class="nav bd-sidenav bd-sidenav__home-link">
            <li class="toctree-l1">
                <a class="reference internal" href="intro.html">
                    Introduction
                </a>
            </li>
        </ul>
        <p aria-level="2" class="caption" role="heading"><span class="caption-text">Getting Started</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="code-preliminaries.html">Preliminaries</a></li>
<li class="toctree-l1"><a class="reference internal" href="code-basics.html">Coding Basics</a></li>
<li class="toctree-l1"><a class="reference internal" href="workflow-basics.html">Workflow Basics</a></li>
<li class="toctree-l1"><a class="reference internal" href="code-where.html">Writing Code</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Essential Data</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="data-analysis-quickstart.html">Data Analysis Quickstart</a></li>
<li class="toctree-l1"><a class="reference internal" href="data-intro.html">Working with Data</a></li>
<li class="toctree-l1"><a class="reference internal" href="data-transformation.html">Data Transformation</a></li>
<li class="toctree-l1"><a class="reference internal" href="data-read-and-write.html">Reading and Writing Files</a></li>
<li class="toctree-l1"><a class="reference internal" href="data-numbers.html">Numbers</a></li>
<li class="toctree-l1"><a class="reference internal" href="data-categorical.html">Categorical Data</a></li>
<li class="toctree-l1"><a class="reference internal" href="data-spreadsheets.html">Spreadsheets</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Essential Coding</span></p>
<ul class="current nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="code-best-practice.html">Code in Style</a></li>
<li class="toctree-l1"><a class="reference internal" href="code-advanced.html">Coding</a></li>
<li class="toctree-l1 current active"><a class="current reference internal" href="#">Shortcuts to Better Coding</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Essential Data Visualisation</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="vis-intro.html">Intro to Data Visualisation</a></li>
<li class="toctree-l1"><a class="reference internal" href="vis-letsplot.html">Easy Data Visualisation for Tidy Data with <strong>Lets-Plot</strong></a></li>
<li class="toctree-l1"><a class="reference internal" href="vis-matplotlib.html">Powerful Data Visualisation with <strong>Matplotlib</strong></a></li>
<li class="toctree-l1"><a class="reference internal" href="vis-common-plots-one.html">Common Plots I</a></li>
<li class="toctree-l1"><a class="reference internal" href="vis-common-plots-two.html">Common Plots II</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Essential Workflow</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="auto-research-outputs.html">Automating Research Outputs</a></li>
<li class="toctree-l1"><a class="reference internal" href="wrkflow-markdown.html">Markdown</a></li>
<li class="toctree-l1"><a class="reference internal" href="wrkflow-command-line.html">The Command Line</a></li>
<li class="toctree-l1"><a class="reference internal" href="wrkflow-version-control.html">Version Control</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Econometrics</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="econmt-probability-random.html">Probability and Random Processes</a></li>
<li class="toctree-l1"><a class="reference internal" href="econmt-statistics.html">Statistics</a></li>
<li class="toctree-l1"><a class="reference internal" href="econmt-regression.html">Regression</a></li>
<li class="toctree-l1"><a class="reference internal" href="econmt-generalised-models.html">Generalised regression models</a></li>
<li class="toctree-l1"><a class="reference internal" href="econmt-diagnostics.html">Regression diagnostics and visualisations</a></li>
<li class="toctree-l1"><a class="reference internal" href="econmt-causal-inference.html">Causal Inference</a></li>
<li class="toctree-l1"><a class="reference internal" href="econmt-bayesian.html">Bayesian Inference</a></li>
<li class="toctree-l1"><a class="reference internal" href="econmt-bayes-bambi.html">Bayesian Inference Made Easier</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Data</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="data-boolean.html">Boolean Data</a></li>
<li class="toctree-l1"><a class="reference internal" href="data-joining-data.html">Joins</a></li>
<li class="toctree-l1"><a class="reference internal" href="data-missing-values.html">Missing Values</a></li>
<li class="toctree-l1"><a class="reference internal" href="data-exploratory-analysis.html">Exploratory Data Analysis</a></li>
<li class="toctree-l1"><a class="reference internal" href="data-extraction.html">Getting Data</a></li>
<li class="toctree-l1"><a class="reference internal" href="data-databases.html">Databases</a></li>
<li class="toctree-l1"><a class="reference internal" href="data-advanced.html"><strong>pandas</strong> alternatives, validation, and orchestration</a></li>
<li class="toctree-l1"><a class="reference internal" href="data-sharing.html">Sharing Data</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Coding</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="code-further-advanced.html">Advanced Coding</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Data Visualisation</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="vis-narrative.html">Narrative Data Visualisation</a></li>
<li class="toctree-l1"><a class="reference internal" href="vis-tables.html">Tables</a></li>
<li class="toctree-l1"><a class="reference internal" href="vis-dashboards.html">Dashboards</a></li>
<li class="toctree-l1"><a class="reference internal" href="vis-animation.html">Animation</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Workflow</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="wrkflow-quarto.html">Combining Code and Text in Quarto Markdown</a></li>
<li class="toctree-l1"><a class="reference internal" href="wrkflow-environments.html">Virtual Code Environments</a></li>
<li class="toctree-l1"><a class="reference internal" href="wrkflow-rap.html">Reproducible Analysis</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Time</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="time-intro.html">Introduction to Time</a></li>
<li class="toctree-l1"><a class="reference internal" href="time-series.html">Time Series</a></li>
<li class="toctree-l1"><a class="reference internal" href="time-fcasts-env.html">Forecasting Exercises</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Text Analysis</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="text-intro.html">Introduction to Text</a></li>
<li class="toctree-l1"><a class="reference internal" href="text-regex.html">Regular Expressions, aka regex</a></li>
<li class="toctree-l1"><a class="reference internal" href="text-nlp.html">Natural Language Processing</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Machine Learning</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="ml-intro.html">Introduction to Machine Learning and AI</a></li>
<li class="toctree-l1"><a class="reference internal" href="ml-sup.html">Supervised Machine Learning</a></li>
<li class="toctree-l1"><a class="reference internal" href="ml-data.html">Data for Machine Learning</a></li>
<li class="toctree-l1"><a class="reference internal" href="ml-unsup.html">Unsupervised Machine Learning</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Geospatial</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="geo-intro.html">Intro to Geo-Spatial Analysis</a></li>
<li class="toctree-l1"><a class="reference internal" href="geo-vis.html">Geo-Spatial Visualisation</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Mathematics</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="maths-abstract.html">Abstract Mathematics</a></li>
<li class="toctree-l1"><a class="reference internal" href="maths-numerical.html">Numerical Mathematics</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Craft</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="craft-intro.html">Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="craft-search.html">Putting the Search in Research</a></li>
<li class="toctree-l1"><a class="reference internal" href="craft-generating-ideas.html">Generating and Accepting Research Ideas</a></li>
<li class="toctree-l1"><a class="reference internal" href="craft-writing-papers.html">Writing Papers</a></li>
<li class="toctree-l1"><a class="reference internal" href="craft-research-blogs.html">Research Blog Posts</a></li>
<li class="toctree-l1"><a class="reference internal" href="craft-referee.html">Writing Referee Reports</a></li>
<li class="toctree-l1"><a class="reference internal" href="craft-technical-reports.html">Writing Technical Reports</a></li>
<li class="toctree-l1"><a class="reference internal" href="craft-extended-abstracts.html">Extended Abstracts</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Further Data Visualisation</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="vis-plotnine.html">Data Visualisation using the Grammar of Graphics with <strong>Plotnine</strong></a></li>
<li class="toctree-l1"><a class="reference internal" href="vis-seaborn.html">Data Visualisation with <strong>Seaborn</strong></a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Coming from ...</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="coming-from-stata.html">Coming from Stata</a></li>
<li class="toctree-l1"><a class="reference internal" href="coming-from-matlab.html">Coming from Matlab</a></li>
<li class="toctree-l1"><a class="reference internal" href="coming-from-r.html">Coming from R</a></li>
<li class="toctree-l1"><a class="reference internal" href="coming-from-excel.html">Coming from Excel</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">End Matter</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="contributing.html">Contributing</a></li>
<li class="toctree-l1"><a class="reference internal" href="zreferences.html">Bibliography</a></li>
</ul>

    </div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main" role="main">
        
        

<div class="sbt-scroll-pixel-helper"></div>

          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article d-print-none">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item"><button class="sidebar-toggle primary-toggle btn btn-sm" title="Toggle primary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
  <span class="fa-solid fa-bars"></span>
</button></div>
      
    </div>
  
  
    <div class="header-article-items__end">
      
        <div class="header-article-item">

<div class="article-header-buttons">





<div class="dropdown dropdown-launch-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Launch interactive content">
    <i class="fas fa-rocket"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="https://colab.research.google.com/github/aeturrell/coding-for-economists/blob/main/code-advcd-best-practice.ipynb" target="_blank"
   class="btn btn-sm dropdown-item"
   title="Launch on Colab"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  
    <img alt="Colab logo" src="_static/images/logo_colab.png">
  </span>
<span class="btn__text-container">Colab</span>
</a>
</li>
      
  </ul>
</div>






<div class="dropdown dropdown-source-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Source repositories">
    <i class="fab fa-github"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="https://github.com/aeturrell/coding-for-economists" target="_blank"
   class="btn btn-sm btn-source-repository-button dropdown-item"
   title="Source repository"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fab fa-github"></i>
  </span>
<span class="btn__text-container">Repository</span>
</a>
</li>
      
      
      
      
      <li><a href="https://github.com/aeturrell/coding-for-economists/issues/new?title=Issue%20on%20page%20%2Fcode-advcd-best-practice.html&body=Your%20issue%20content%20here." target="_blank"
   class="btn btn-sm btn-source-issues-button dropdown-item"
   title="Open an issue"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-lightbulb"></i>
  </span>
<span class="btn__text-container">Open issue</span>
</a>
</li>
      
  </ul>
</div>






<div class="dropdown dropdown-download-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Download this page">
    <i class="fas fa-download"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="_sources/code-advcd-best-practice.ipynb" target="_blank"
   class="btn btn-sm btn-download-source-button dropdown-item"
   title="Download source file"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="btn__text-container">.ipynb</span>
</a>
</li>
      
      
      
      
      <li>
<button onclick="window.print()"
  class="btn btn-sm btn-download-pdf-button dropdown-item"
  title="Print to PDF"
  data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="btn__text-container">.pdf</span>
</button>
</li>
      
  </ul>
</div>




<button onclick="toggleFullScreen()"
  class="btn btn-sm btn-fullscreen-button"
  title="Fullscreen mode"
  data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>



<script>
document.write(`
  <button class="btn btn-sm nav-link pst-navbar-icon theme-switch-button" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="theme-switch fa-solid fa-sun fa-lg" data-mode="light"></i>
    <i class="theme-switch fa-solid fa-moon fa-lg" data-mode="dark"></i>
    <i class="theme-switch fa-solid fa-circle-half-stroke fa-lg" data-mode="auto"></i>
  </button>
`);
</script>


<script>
document.write(`
  <button class="btn btn-sm pst-navbar-icon search-button search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass fa-lg"></i>
  </button>
`);
</script>
<button class="sidebar-toggle secondary-toggle btn btn-sm" title="Toggle secondary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="fa-solid fa-list"></span>
</button>
</div></div>
      
    </div>
  
</div>
</div>
              
              

<div id="jb-print-docs-body" class="onlyprint">
    <h1>Shortcuts to Better Coding</h1>
    <!-- Table of contents -->
    <div id="print-main-content">
        <div id="jb-print-toc">
            
            <div>
                <h2> Contents </h2>
            </div>
            <nav aria-label="Page">
                <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#introduction">Introduction</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#auto-magically-improving-your-code">Auto-magically improving your code</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#linting">Linting</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#formatting">Formatting</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#inspecting-variables">Inspecting Variables</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#rich-for-beautiful-inspection"><strong>rich</strong> for beautiful inspection</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#errors-and-exceptions">Errors and Exceptions</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#debugging-code">Debugging Code</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#print-statements">Print statements</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#debugging-with-the-ide">Debugging with the IDE</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#logging">Logging</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#tests">Tests</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#testing-continuous-variables">Testing continuous variables</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#test-coverage">Test coverage</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#timing-and-profiling">Timing and profiling</a></li>
</ul>
            </nav>
        </div>
    </div>
</div>

              
                
<div id="searchbox"></div>
                <article class="bd-article">
                  
  <section class="tex2jax_ignore mathjax_ignore" id="shortcuts-to-better-coding">
<span id="code-advcd-best-practice"></span><h1>Shortcuts to Better Coding<a class="headerlink" href="#shortcuts-to-better-coding" title="Link to this heading">#</a></h1>
<section id="introduction">
<h2>Introduction<a class="headerlink" href="#introduction" title="Link to this heading">#</a></h2>
<p>This chapter covers the tools and knowledge that will help you to write better code faster and to understand what’s going on when your code goes wrong! This includes practical topics such as debugging code, logging, linting, and the magic of auto-formatting. Some of the topics are a bit more advanced and come with a warning to tell you so.</p>
<p>As ever, you may need to <code class="docutils literal notranslate"><span class="pre">conda</span> <span class="pre">install</span> <span class="pre">packagename</span></code> or <code class="docutils literal notranslate"><span class="pre">pip</span> <span class="pre">install</span> <span class="pre">packagename</span></code> on the terminal before being able to use some of the packages that are featured.</p>
</section>
<section id="auto-magically-improving-your-code">
<h2>Auto-magically improving your code<a class="headerlink" href="#auto-magically-improving-your-code" title="Link to this heading">#</a></h2>
<p>In the previous chapter, we met the idea of <em>code style</em>: even for code that runs, <em>how</em> you write it matters for readability. (And it goes without saying that you don’t want bugs in your code that stop it running at all.) It is possible to catch some errors, to flag style issues, and even to re-format code to comply with a code style automatically. In this section, we’ll see how to use tools to perform these functions automatically.</p>
<section id="linting">
<h3>Linting<a class="headerlink" href="#linting" title="Link to this heading">#</a></h3>
<p>Linters are tools that analyse code for programmatic and stylistic errors, assuming you have declared a style. A linting tool flags any potential errors and deviations from style before you even run it. When you run a linter, you get a report of what line the issue is on and why it has been raised. They are supposedly named after the lint trap in a clothes dryer because of the way they catch small errors that could have big effects.</p>
<p>One of the most popular linters in Python is the blazingly-fast <a class="reference external" href="https://docs.astral.sh/ruff/"><strong>Ruff</strong></a> but you might also come across <a class="reference external" href="https://flake8.pycqa.org/en/latest/"><strong>flake8</strong></a>, <a class="reference external" href="https://pycodestyle.pycqa.org/en/latest/intro.html"><strong>pycodestyle</strong></a>, and <a class="reference external" href="https://pypi.org/project/pylint/"><strong>pylint</strong></a>.</p>
<p>Let’s see an example of running a linter. VS Code has direct integration with a range of linters. To get going, use <code class="docutils literal notranslate"><span class="pre">⇧⌘P</span></code> (Mac) and then type ‘Python Select Linter’. In the example below, we’ll use <strong>flake8</strong> (and <strong>pylance</strong>, another VS Code extension that you will likely have already). Let’s pretend we have a script, <code class="docutils literal notranslate"><span class="pre">test.py</span></code>, containing</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">list_defn</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">5</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span>
<span class="mi">7</span><span class="p">]</span>

<span class="k">def</span><span class="w"> </span><span class="nf">this_is_a_func</span><span class="p">():</span>
   <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;hello&#39;</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="n">X</span><span class="p">)</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>
</pre></div>
</div>
<p>To see the linting report, press <kbd>^</kbd> + <kbd>`</kbd> (Mac) or <kbd>ctrl</kbd> + <kbd>`</kbd> (otherwise) and navigate to the ‘Problems’ tab. We get a whole load of error messages about this script, here are a few:</p>
<ul class="simple">
<li><p>ⓧ missing whitespace after ‘,’ flake8(E231) 1, 15</p></li>
<li><p>ⓧ continuation line under-indented for visual indent flake8(E128) 2, 1</p></li>
<li><p>ⓧ expected 2 blank lines, found 1 flake8(E302) 4, 1</p></li>
<li><p>ⓧ indentation is not a multiple of 4 flake8(E111) 5, 4</p></li>
<li><p>ⓧ undefined name ‘X’ flake8(F821) 7, 7</p></li>
<li><p>ⓧ module level import not at top of file flake8(E402) 9, 1</p></li>
<li><p>ⓧ ‘numpy as np’ imported but unused flake8(F3401) 9, 1</p></li>
<li><p>⚠ “X” is not defined Pylance(reportUndefinedVariable) 7, 7</p></li>
<li><p>⚠ no newline at end of file flake8(W292) 78, 338</p></li>
</ul>
<p>each message is a warning or error that says what the problem is (for example, missing whitespace after ‘,’), what library is reporting it (mostly <strong>flake8</strong> here), the name of the rule that has been broken (E231), and the line, row position (1, 15). Very helpfully, we get an undefined name message for variable <code class="docutils literal notranslate"><span class="pre">X</span></code>, this is especially handy because it would cause an error on execution otherwise. The same goes for the indentation message (indentation matters!). You can customise your <a class="reference external" href="https://code.visualstudio.com/docs/python/linting">linting settings</a> in VS Code too.</p>
<p>Although the automatic linting offered by an IDE is very convenient, it’s not the only way to use linting tools. You can also run them from the command line. For example, for <strong>flake8</strong>, the command is <code class="docutils literal notranslate"><span class="pre">flake8</span> <span class="pre">test.py</span></code>.</p>
</section>
<section id="formatting">
<h3>Formatting<a class="headerlink" href="#formatting" title="Link to this heading">#</a></h3>
<p>It’s great to find out all the ways in which you are failing with respect to code style from a linter but wouldn’t it be <em>even</em> better if you could fix those style issues automatically? The answer is clearly yes! This is where formatters come in; they can take valid code and forcibly apply a code style to them. This is really handy in practice for all kinds of reasons.</p>
<p>The most popular code formatters in Python are probably: <a class="reference external" href="https://github.com/google/yapf"><strong>yapf</strong></a>, ‘yet another Python formatter’, from Google; <a class="reference external" href="https://github.com/hhatto/autopep8"><strong>autopep8</strong></a>, which applies PEP8 to your code; <a class="reference external" href="https://black.readthedocs.io/en/stable/"><strong>black</strong></a>, the ‘uncompromising formatter’ that is very opinionated (“any colour, as long as it’s black”); and <a class="reference external" href="https://docs.astral.sh/ruff/formatter/"><strong>Ruff</strong></a>.</p>
<p>There are two ways to use formatters, line-by-line (though <strong>black</strong> doesn’t work in this mode) or on an entire script at once. VS Code offers an integration with formatters. To select a formatter in VS Code, bring up the settings using <kbd>⌘</kbd> + <kbd>,</kbd> (Mac) or <kbd>ctrl</kbd> + <kbd>,</kbd> (otherwise) and type ‘python formatting provider’ and you can choose from autopep8, black, and yapf.</p>
<p>If you choose <strong>autopep8</strong> and then open a script you can format a <em>selection</em> of code by pressing <kbd>⌘</kbd> + <kbd>k</kbd>, <kbd>⌘</kbd> + <kbd>f</kbd> (Mac) or <kbd>ctrl</kbd> + <kbd>k</kbd>, <kbd>ctrl</kbd> + <kbd>f</kbd> (otherwise). They can also (and only, in the case of <strong>black</strong>) be used from the command line. For instance, to use <strong>black</strong>, the command is <code class="docutils literal notranslate"><span class="pre">black</span> <span class="pre">test.py</span></code>, assuming you have it installed.</p>
<p>Let’s see an example of a poorly styled script and see what happens when we select all lines and use <kbd>ctrl</kbd> + <kbd>k</kbd>, <kbd>ctrl</kbd> + <kbd>f</kbd> to auto format with <strong>autopep8</strong>. The contents of <code class="docutils literal notranslate"><span class="pre">test.py</span></code> before formatting are:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">very_important_function</span><span class="p">(</span><span class="n">y_val</span><span class="p">,</span><span class="n">debug</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">keyword_arg</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">another_arg</span>  <span class="o">=</span><span class="mi">2</span><span class="p">):</span>
    <span class="n">X</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">10</span><span class="p">,</span><span class="mi">5</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">X</span><span class="o">+</span>  <span class="n">y_val</span> <span class="o">+</span><span class="n">keyword_arg</span>
<span class="n">very_important_function</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>

<span class="n">list_defn</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span>
<span class="mi">2</span><span class="p">,</span>
<span class="mi">3</span><span class="p">,</span>
<span class="mi">5</span><span class="p">,</span>
<span class="mi">6</span><span class="p">,</span>
<span class="mi">7</span><span class="p">]</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>
</pre></div>
</div>
<p>and, after running the auto-formatting command,</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>


<span class="k">def</span><span class="w"> </span><span class="nf">very_important_function</span><span class="p">(</span><span class="n">y_val</span><span class="p">,</span> <span class="n">debug</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">keyword_arg</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">another_arg</span><span class="o">=</span><span class="mi">2</span><span class="p">):</span>
    <span class="n">X</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">X</span> <span class="o">+</span> <span class="n">y_val</span> <span class="o">+</span> <span class="n">keyword_arg</span>


<span class="n">very_important_function</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>

<span class="n">list_defn</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span>
             <span class="mi">2</span><span class="p">,</span>
             <span class="mi">3</span><span class="p">,</span>
             <span class="mi">5</span><span class="p">,</span>
             <span class="mi">6</span><span class="p">,</span>
             <span class="mi">7</span><span class="p">]</span>
</pre></div>
</div>
<p>So what did the formatter do? Many things. It moved the import to the top, put two blank lines after the function definition, removed whitespace around keyword arguments, added a new line at the end, and fixed some of the indentation. The different formatters have different strengths and weaknesses; for example, <strong>black</strong> is not so good at putting imports in the right place but excels at splitting up troublesome wide lines. If you need a formatter that deals specifically with module imports, check out <a class="reference external" href="https://pycqa.github.io/isort/"><strong>isort</strong></a> or <a class="reference external" href="https://docs.astral.sh/ruff/"><strong>Ruff</strong></a>.</p>
<p>Apart from taking the pressure off you to always be thinking about code style, formatters can be useful when working collaboratively too. For some open source packages, maintainers ask that new code or changed code be run through a particular formatter if it is to be incorporated into the main branch. This helps ensure the code style is consistent regardless of who is writing it. Running the code formatter can even be automated to happen every time someone <em>commits</em> some code to a shared code repository too, using something called a <em>pre-commit hook</em>.</p>
<p>NB: <strong>Black</strong> can run on Jupyter Notebooks too: just install it with <code class="docutils literal notranslate"><span class="pre">pip</span> <span class="pre">install</span> <span class="pre">&quot;black[jupyter]&quot;</span></code> instead of <code class="docutils literal notranslate"><span class="pre">pip</span> <span class="pre">install</span> <span class="pre">black</span></code>.</p>
</section>
</section>
<section id="inspecting-variables">
<h2>Inspecting Variables<a class="headerlink" href="#inspecting-variables" title="Link to this heading">#</a></h2>
<section id="rich-for-beautiful-inspection">
<h3><strong>rich</strong> for beautiful inspection<a class="headerlink" href="#rich-for-beautiful-inspection" title="Link to this heading">#</a></h3>
<p><a class="reference external" href="https://github.com/willmcgugan/rich"><strong>rich</strong></a> is much more than just a tool for inspecting variables, it’s a way to create beautiful renderings of all objects both in the terminal and in interactive Python windows. You can use it to build fantastic looking command line interfaces. Here, we’ll see how it can help us find what value a variable takes <em>and</em> what methods can be used on a variable via its <code class="docutils literal notranslate"><span class="pre">inspect()</span></code> function.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">rich</span><span class="w"> </span><span class="kn">import</span> <span class="n">inspect</span>

<span class="n">my_list</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;foo&quot;</span><span class="p">,</span> <span class="s2">&quot;bar&quot;</span><span class="p">]</span>
<span class="n">inspect</span><span class="p">(</span><span class="n">my_list</span><span class="p">,</span> <span class="n">methods</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><pre style="white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace"><span style="color: #000080; text-decoration-color: #000080">╭───────────────────────────────────────── </span><span style="color: #000080; text-decoration-color: #000080; font-weight: bold">&lt;</span><span style="color: #ff00ff; text-decoration-color: #ff00ff; font-weight: bold">class</span><span style="color: #000000; text-decoration-color: #000000"> </span><span style="color: #008000; text-decoration-color: #008000">'list'</span><span style="color: #000080; text-decoration-color: #000080; font-weight: bold">&gt;</span><span style="color: #000080; text-decoration-color: #000080"> ──────────────────────────────────────────╮</span>
<span style="color: #000080; text-decoration-color: #000080">│</span> <span style="color: #008080; text-decoration-color: #008080">Built-in mutable sequence.</span>                                                                        <span style="color: #000080; text-decoration-color: #000080">│</span>
<span style="color: #000080; text-decoration-color: #000080">│</span>                                                                                                   <span style="color: #000080; text-decoration-color: #000080">│</span>
<span style="color: #000080; text-decoration-color: #000080">│</span> <span style="color: #008000; text-decoration-color: #008000">╭───────────────────────────────────────────────────────────────────────────────────────────────╮</span> <span style="color: #000080; text-decoration-color: #000080">│</span>
<span style="color: #000080; text-decoration-color: #000080">│</span> <span style="color: #008000; text-decoration-color: #008000">│</span> <span style="font-weight: bold">[</span><span style="color: #008000; text-decoration-color: #008000">'foo'</span>, <span style="color: #008000; text-decoration-color: #008000">'bar'</span><span style="font-weight: bold">]</span>                                                                                <span style="color: #008000; text-decoration-color: #008000">│</span> <span style="color: #000080; text-decoration-color: #000080">│</span>
<span style="color: #000080; text-decoration-color: #000080">│</span> <span style="color: #008000; text-decoration-color: #008000">╰───────────────────────────────────────────────────────────────────────────────────────────────╯</span> <span style="color: #000080; text-decoration-color: #000080">│</span>
<span style="color: #000080; text-decoration-color: #000080">│</span>                                                                                                   <span style="color: #000080; text-decoration-color: #000080">│</span>
<span style="color: #000080; text-decoration-color: #000080">│</span>  <span style="color: #808000; text-decoration-color: #808000; font-style: italic">append</span> = <span style="color: #00ffff; text-decoration-color: #00ffff; font-style: italic">def </span><span style="color: #800000; text-decoration-color: #800000; font-weight: bold">append</span><span style="font-weight: bold">(</span>object, <span style="color: #800080; text-decoration-color: #800080">/</span><span style="font-weight: bold">)</span>: <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">Append object to the end of the list.</span>                            <span style="color: #000080; text-decoration-color: #000080">│</span>
<span style="color: #000080; text-decoration-color: #000080">│</span>   <span style="color: #808000; text-decoration-color: #808000; font-style: italic">clear</span> = <span style="color: #00ffff; text-decoration-color: #00ffff; font-style: italic">def </span><span style="color: #800000; text-decoration-color: #800000; font-weight: bold">clear</span><span style="font-weight: bold">()</span>: <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">Remove all items from list.</span>                                                <span style="color: #000080; text-decoration-color: #000080">│</span>
<span style="color: #000080; text-decoration-color: #000080">│</span>    <span style="color: #808000; text-decoration-color: #808000; font-style: italic">copy</span> = <span style="color: #00ffff; text-decoration-color: #00ffff; font-style: italic">def </span><span style="color: #800000; text-decoration-color: #800000; font-weight: bold">copy</span><span style="font-weight: bold">()</span>: <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">Return a shallow copy of the list.</span>                                          <span style="color: #000080; text-decoration-color: #000080">│</span>
<span style="color: #000080; text-decoration-color: #000080">│</span>   <span style="color: #808000; text-decoration-color: #808000; font-style: italic">count</span> = <span style="color: #00ffff; text-decoration-color: #00ffff; font-style: italic">def </span><span style="color: #800000; text-decoration-color: #800000; font-weight: bold">count</span><span style="font-weight: bold">(</span>value, <span style="color: #800080; text-decoration-color: #800080">/</span><span style="font-weight: bold">)</span>: <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">Return number of occurrences of value.</span>                             <span style="color: #000080; text-decoration-color: #000080">│</span>
<span style="color: #000080; text-decoration-color: #000080">│</span>  <span style="color: #808000; text-decoration-color: #808000; font-style: italic">extend</span> = <span style="color: #00ffff; text-decoration-color: #00ffff; font-style: italic">def </span><span style="color: #800000; text-decoration-color: #800000; font-weight: bold">extend</span><span style="font-weight: bold">(</span>iterable, <span style="color: #800080; text-decoration-color: #800080">/</span><span style="font-weight: bold">)</span>: <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">Extend list by appending elements from the iterable.</span>           <span style="color: #000080; text-decoration-color: #000080">│</span>
<span style="color: #000080; text-decoration-color: #000080">│</span>   <span style="color: #808000; text-decoration-color: #808000; font-style: italic">index</span> = <span style="color: #00ffff; text-decoration-color: #00ffff; font-style: italic">def </span><span style="color: #800000; text-decoration-color: #800000; font-weight: bold">index</span><span style="font-weight: bold">(</span>value, <span style="color: #808000; text-decoration-color: #808000">start</span>=<span style="color: #008080; text-decoration-color: #008080; font-weight: bold">0</span>, <span style="color: #808000; text-decoration-color: #808000">stop</span>=<span style="color: #008080; text-decoration-color: #008080; font-weight: bold">9223372036854775807</span>, <span style="color: #800080; text-decoration-color: #800080">/</span><span style="font-weight: bold">)</span>: <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">Return first index of value.</span>    <span style="color: #000080; text-decoration-color: #000080">│</span>
<span style="color: #000080; text-decoration-color: #000080">│</span>  <span style="color: #808000; text-decoration-color: #808000; font-style: italic">insert</span> = <span style="color: #00ffff; text-decoration-color: #00ffff; font-style: italic">def </span><span style="color: #800000; text-decoration-color: #800000; font-weight: bold">insert</span><span style="font-weight: bold">(</span>index, object, <span style="color: #800080; text-decoration-color: #800080">/</span><span style="font-weight: bold">)</span>: <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">Insert object before index.</span>                               <span style="color: #000080; text-decoration-color: #000080">│</span>
<span style="color: #000080; text-decoration-color: #000080">│</span>     <span style="color: #808000; text-decoration-color: #808000; font-style: italic">pop</span> = <span style="color: #00ffff; text-decoration-color: #00ffff; font-style: italic">def </span><span style="color: #800000; text-decoration-color: #800000; font-weight: bold">pop</span><span style="font-weight: bold">(</span><span style="color: #808000; text-decoration-color: #808000">index</span>=<span style="color: #008080; text-decoration-color: #008080; font-weight: bold">-1</span>, <span style="color: #800080; text-decoration-color: #800080">/</span><span style="font-weight: bold">)</span>: <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">Remove and return item at index </span><span style="color: #7f7f7f; text-decoration-color: #7f7f7f; font-weight: bold">(</span><span style="color: #7f7f7f; text-decoration-color: #7f7f7f">default last</span><span style="color: #7f7f7f; text-decoration-color: #7f7f7f; font-weight: bold">)</span><span style="color: #7f7f7f; text-decoration-color: #7f7f7f">.</span>                   <span style="color: #000080; text-decoration-color: #000080">│</span>
<span style="color: #000080; text-decoration-color: #000080">│</span>  <span style="color: #808000; text-decoration-color: #808000; font-style: italic">remove</span> = <span style="color: #00ffff; text-decoration-color: #00ffff; font-style: italic">def </span><span style="color: #800000; text-decoration-color: #800000; font-weight: bold">remove</span><span style="font-weight: bold">(</span>value, <span style="color: #800080; text-decoration-color: #800080">/</span><span style="font-weight: bold">)</span>: <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">Remove first occurrence of value.</span>                                 <span style="color: #000080; text-decoration-color: #000080">│</span>
<span style="color: #000080; text-decoration-color: #000080">│</span> <span style="color: #808000; text-decoration-color: #808000; font-style: italic">reverse</span> = <span style="color: #00ffff; text-decoration-color: #00ffff; font-style: italic">def </span><span style="color: #800000; text-decoration-color: #800000; font-weight: bold">reverse</span><span style="font-weight: bold">()</span>: <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">Reverse *IN PLACE*.</span>                                                      <span style="color: #000080; text-decoration-color: #000080">│</span>
<span style="color: #000080; text-decoration-color: #000080">│</span>    <span style="color: #808000; text-decoration-color: #808000; font-style: italic">sort</span> = <span style="color: #00ffff; text-decoration-color: #00ffff; font-style: italic">def </span><span style="color: #800000; text-decoration-color: #800000; font-weight: bold">sort</span><span style="font-weight: bold">(</span>*, <span style="color: #808000; text-decoration-color: #808000">key</span>=<span style="color: #800080; text-decoration-color: #800080; font-style: italic">None</span>, <span style="color: #808000; text-decoration-color: #808000">reverse</span>=<span style="color: #ff0000; text-decoration-color: #ff0000; font-style: italic">False</span><span style="font-weight: bold">)</span>: <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">Sort the list in ascending order and return </span><span style="color: #bf7fbf; text-decoration-color: #bf7fbf; font-style: italic">None</span><span style="color: #7f7f7f; text-decoration-color: #7f7f7f">.</span> <span style="color: #000080; text-decoration-color: #000080">│</span>
<span style="color: #000080; text-decoration-color: #000080">╰───────────────────────────────────────────────────────────────────────────────────────────────────╯</span>
</pre>
</div></div>
</div>
<p>Check out all of the many options for <code class="docutils literal notranslate"><span class="pre">inspect()</span></code> using <code class="docutils literal notranslate"><span class="pre">help(inspect)</span></code>. We ran it here with <code class="docutils literal notranslate"><span class="pre">methods=True</span></code>, but there are plenty of other options.</p>
<div class="admonition-exercise admonition">
<p class="admonition-title">Exercise</p>
<p>Create a dictionary (it doesn’t matter what’s in it, but you could map the integer 1 to the letter “a”). Then use <code class="docutils literal notranslate"><span class="pre">inspect()</span></code> with <code class="docutils literal notranslate"><span class="pre">methods=True</span></code> to find out about all the methods you can call on an object of type dict.</p>
</div>
</section>
</section>
<section id="errors-and-exceptions">
<h2>Errors and Exceptions<a class="headerlink" href="#errors-and-exceptions" title="Link to this heading">#</a></h2>
<p>When a programme goes wrong, it throws up an error and halts. You won’t be coding for long before you hit one of these errors, which have special names depending on what triggered them.</p>
<p>Let’s see a real-life error in action:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">denom</span> <span class="o">=</span> <span class="mi">0</span>

<span class="nb">print</span><span class="p">(</span><span class="mi">1</span><span class="o">/</span><span class="n">denom</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="o">---------------------------------------------------------------------------</span>
<span class="ne">ZeroDivisionError</span>                         <span class="n">Traceback</span> <span class="p">(</span><span class="n">most</span> <span class="n">recent</span> <span class="n">call</span> <span class="n">last</span><span class="p">)</span>
<span class="o">&lt;</span><span class="n">ipython</span><span class="o">-</span><span class="nb">input</span><span class="o">-</span><span class="mi">39</span><span class="o">-</span><span class="n">e45c0e0a3e37</span><span class="o">&gt;</span> <span class="ow">in</span> <span class="o">&lt;</span><span class="n">module</span><span class="o">&gt;</span>
      <span class="mi">1</span> <span class="n">denom</span> <span class="o">=</span> <span class="mi">0</span>
      <span class="mi">2</span> 
<span class="o">----&gt;</span> <span class="mi">3</span> <span class="nb">print</span><span class="p">(</span><span class="mi">1</span><span class="o">/</span><span class="n">denom</span><span class="p">)</span>

<span class="ne">ZeroDivisionError</span><span class="p">:</span> <span class="n">division</span> <span class="n">by</span> <span class="n">zero</span>
</pre></div>
</div>
<p>Oh no! We got a <code class="docutils literal notranslate"><span class="pre">ZeroDivisionError</span></code> and our programme crashed. Note that the error includes a ‘Traceback’ to show which line went wrong, which is helpful for debugging.</p>
<p>In practice, there are often times when we know that an error <em>could</em> arise, and we would like to specify what should happen when it does (rather than having the programme crash).</p>
<p>We can use <em>exceptions</em> to do this. These come in a <code class="docutils literal notranslate"><span class="pre">try</span></code> … <code class="docutils literal notranslate"><span class="pre">except</span></code> pattern, which looks like an <code class="docutils literal notranslate"><span class="pre">if</span></code> … <code class="docutils literal notranslate"><span class="pre">else</span></code> pattern but applies to errors. If no errors occur inside the <code class="docutils literal notranslate"><span class="pre">try</span></code> block, the <code class="docutils literal notranslate"><span class="pre">except</span></code> block isn’t run but <em>if</em> something goes wrong inside the <code class="docutils literal notranslate"><span class="pre">try</span></code> then the <code class="docutils literal notranslate"><span class="pre">except</span></code> block is executed. Let’s see an example:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">for</span> <span class="n">denom</span> <span class="ow">in</span> <span class="p">[</span><span class="o">-</span><span class="mi">5</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">5</span><span class="p">]:</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">result</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">/</span> <span class="n">denom</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;1/</span><span class="si">{</span><span class="n">denom</span><span class="si">}</span><span class="s2"> == </span><span class="si">{</span><span class="n">result</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">ZeroDivisionError</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Cannot divide by </span><span class="si">{</span><span class="n">denom</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>1/-5 == -0.2
Cannot divide by 0
1/5 == 0.2
</pre></div>
</div>
</div>
</div>
<p>Now we can see two differences. First: the code executed just fine <em>without</em> halting. Second: when we hit the error, the <code class="docutils literal notranslate"><span class="pre">except</span></code> block was executed and told us what was going on. Note that we could have just used <code class="docutils literal notranslate"><span class="pre">except</span></code> in the above but it’s best practice, where you can, to use one of the built-in error keywords that Python comes with.</p>
<p>For error messages, it’s convenient to use Python’s built in messages whenever you can—the more specific, the better. You can see that in the case above we used <code class="docutils literal notranslate"><span class="pre">ZeroDivisionError</span></code>, which is pretty specific.</p>
<p>If you do need to use a generic error, use an informative message to help the user understand what’s going on:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">for</span> <span class="n">denom</span> <span class="ow">in</span> <span class="p">[</span><span class="o">-</span><span class="mi">5</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">5</span><span class="p">]:</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">result</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">/</span> <span class="n">denom</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;1/</span><span class="si">{</span><span class="n">denom</span><span class="si">}</span><span class="s2"> == </span><span class="si">{</span><span class="n">result</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">error</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">denom</span><span class="si">}</span><span class="s2"> has no reciprocal; error is: </span><span class="si">{</span><span class="n">error</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>1/-5 == -0.2
0 has no reciprocal; error is: division by zero
1/5 == 0.2
</pre></div>
</div>
</div>
</div>
<p>Sadly, division by zero is just one of the many errors you might encounter. What if a function is likely to end up running into several different errors? We can have multiple <code class="docutils literal notranslate"><span class="pre">except</span></code> clauses to catch these:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">numbers</span> <span class="o">=</span> <span class="p">[</span><span class="o">-</span><span class="mi">5</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">5</span><span class="p">]</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">]:</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">denom</span> <span class="o">=</span> <span class="n">numbers</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
        <span class="n">result</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">/</span> <span class="n">denom</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;1/</span><span class="si">{</span><span class="n">denom</span><span class="si">}</span><span class="s2"> == </span><span class="si">{</span><span class="n">result</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">IndexError</span> <span class="k">as</span> <span class="n">error</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;index </span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2"> out of range; error is </span><span class="si">{</span><span class="n">error</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">ZeroDivisionError</span> <span class="k">as</span> <span class="n">error</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">denom</span><span class="si">}</span><span class="s2"> has no reciprocal; error is: </span><span class="si">{</span><span class="n">error</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>1/-5 == -0.2
0 has no reciprocal; error is: division by zero
1/5 == 0.2
index 3 out of range; error is list index out of range
</pre></div>
</div>
</div>
</div>
<p>A full list of built-in errors may be <a class="reference external" href="https://docs.python.org/3/library/exceptions.html#exception-hierarchy">found here</a> and they are nested in classes (eg <code class="docutils literal notranslate"><span class="pre">ZeroDivisionError</span></code> is a special case of a <code class="docutils literal notranslate"><span class="pre">ArithmeticError</span></code>).</p>
<p>Where do these errors come from anyway? What tells the programming language to throw a tantrum when it encounters certain combinations of values and operations.</p>
<p>The answer is that the person or people who wrote the code that’s ‘under the hood’ can specify when such errors should be raised. Remember, the philosophy of Python is that things should fail loudly (so that they do not cause issues downstream). Here’s an example of some code that raises its own errors using the <code class="docutils literal notranslate"><span class="pre">raise</span></code> keyword:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">for</span> <span class="n">number</span> <span class="ow">in</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">]:</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">number</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;no negatives: </span><span class="si">{</span><span class="n">number</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">number</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">ValueError</span> <span class="k">as</span> <span class="n">error</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;exception: </span><span class="si">{</span><span class="n">error</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>1
0
exception: no negatives: -1
</pre></div>
</div>
</div>
</div>
<p>A <code class="docutils literal notranslate"><span class="pre">ValueError</span></code> is a built-in type of error and there are plenty of ones to choose from for your case. Some big or specialised libraries define their own types of error too.</p>
<p>One very clever feature of Python’s exception handling is “throw low, catch high”, which means that even if an error gets thrown way deep down in the middle of a code block, the catching exception can be used some way away. Here’s an example: the error arises <em>within</em> the <code class="docutils literal notranslate"><span class="pre">sum_reciprocals()</span></code> function, but is caught elsewhere.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">sum_reciprocals</span><span class="p">(</span><span class="n">values</span><span class="p">):</span>
    <span class="n">result</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">values</span><span class="p">:</span>
        <span class="n">result</span> <span class="o">+=</span> <span class="mi">1</span> <span class="o">/</span> <span class="n">v</span>
    <span class="k">return</span> <span class="n">result</span>


<span class="n">numbers</span> <span class="o">=</span> <span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span>
<span class="k">try</span><span class="p">:</span>
    <span class="n">one_over</span> <span class="o">=</span> <span class="n">sum_reciprocals</span><span class="p">(</span><span class="n">numbers</span><span class="p">)</span>
<span class="k">except</span> <span class="ne">ArithmeticError</span> <span class="k">as</span> <span class="n">error</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error trying to sum reciprocals: </span><span class="si">{</span><span class="n">error</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Error trying to sum reciprocals: division by zero
</pre></div>
</div>
</div>
</div>
<p>Here’s an example of combining a <code class="docutils literal notranslate"><span class="pre">try</span></code>, several <code class="docutils literal notranslate"><span class="pre">except</span></code> statements, an <code class="docutils literal notranslate"><span class="pre">else</span></code> that gets executed if <code class="docutils literal notranslate"><span class="pre">try</span></code> is, and a <code class="docutils literal notranslate"><span class="pre">finally</span></code> that always get executed.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">datetime</span>

<span class="n">b_year</span> <span class="o">=</span> <span class="mi">1852</span>
<span class="n">name_input</span> <span class="o">=</span> <span class="s2">&quot;Ada&quot;</span>


<span class="k">def</span><span class="w"> </span><span class="nf">process_input</span><span class="p">(</span><span class="n">name_input</span><span class="p">,</span> <span class="n">b_year</span><span class="p">):</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">name</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">name_input</span><span class="p">)</span>
        <span class="n">year_born</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">b_year</span><span class="p">)</span>
        <span class="n">age</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span><span class="o">.</span><span class="n">year</span> <span class="o">-</span> <span class="nb">int</span><span class="p">(</span><span class="n">year_born</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;You are </span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2">. And your age is </span><span class="si">{</span><span class="n">age</span><span class="si">}</span><span class="s2">.&quot;</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">TypeError</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Type error occur&quot;</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Value error occur&quot;</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">ZeroDivisionError</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;zero division error occur&quot;</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;I usually run with the try block&quot;</span><span class="p">)</span>
    <span class="k">finally</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;I always run.&quot;</span><span class="p">)</span>


<span class="n">process_input</span><span class="p">(</span><span class="n">name_input</span><span class="p">,</span> <span class="n">b_year</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>You are Ada. And your age is 173.
I usually run with the try block
I always run.
</pre></div>
</div>
</div>
</div>
</section>
<section id="debugging-code">
<h2>Debugging Code<a class="headerlink" href="#debugging-code" title="Link to this heading">#</a></h2>
<p>Computers are <em>very</em> literal, so literal that unless you’re perfectly precise about what you want, they will end up doing something different. When that happens, one of the most difficult issues in programming is to understand <em>why</em> the code isn’t doing what you expected. When the code doesn’t do what we expect, it’s called a bug.</p>
<p>Bugs could be fundamental issues with the code you’re using (in fact, the term originated because a moth causing a problem in an early computer) and, if you find one of these, you should file an issue with the maintainers of the code. However, what’s much more likely is that the instructions you gave aren’t quite what is needed to produce the outcome that you want. And, in this case, you might need to <em>debug</em> the code: to find out which part of it isn’t doing what you expect.</p>
<p>Even with a small code base, it can be tricky to track down where the bug is: but don’t fear, there are tools on hand to help you find where the bug is.</p>
<section id="print-statements">
<h3>Print statements<a class="headerlink" href="#print-statements" title="Link to this heading">#</a></h3>
<p>The simplest, and I’m afraid to say the most common, way to debug code is to plonk <code class="docutils literal notranslate"><span class="pre">print</span></code> statements in the code. Let’s take a common example in which we perform some simple array operations, here multiplying an array and then summing it with another array:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>


<span class="k">def</span><span class="w"> </span><span class="nf">array_operations</span><span class="p">(</span><span class="n">in_arr_one</span><span class="p">,</span> <span class="n">in_arr_two</span><span class="p">):</span>
    <span class="n">out_arr</span> <span class="o">=</span> <span class="n">in_arr_one</span><span class="o">*</span><span class="mf">1.5</span>
    <span class="n">out_arr</span> <span class="o">=</span> <span class="n">out_arr</span> <span class="o">+</span> <span class="n">in_arr_two</span>
    <span class="k">return</span> <span class="n">out_arr</span>


<span class="n">in_vals_one</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">3</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">16</span><span class="p">,</span> <span class="s1">&#39;7&#39;</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">9</span><span class="p">,</span> <span class="mi">22</span><span class="p">])</span>
<span class="n">in_vals_two</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">4</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">23</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">0</span><span class="p">])</span>

<span class="n">result</span> <span class="o">=</span> <span class="n">array_operations</span><span class="p">(</span><span class="n">in_vals_one</span><span class="p">,</span> <span class="n">in_vals_two</span><span class="p">)</span>
<span class="n">result</span>
</pre></div>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="o">---------------------------------------------------------------------------</span>
<span class="n">UFuncTypeError</span>                            <span class="n">Traceback</span> <span class="p">(</span><span class="n">most</span> <span class="n">recent</span> <span class="n">call</span> <span class="n">last</span><span class="p">)</span>
<span class="o">&lt;</span><span class="n">ipython</span><span class="o">-</span><span class="nb">input</span><span class="o">-</span><span class="mi">1</span><span class="o">-</span><span class="mi">166160824</span><span class="n">d19</span><span class="o">&gt;</span> <span class="ow">in</span> <span class="o">&lt;</span><span class="n">module</span><span class="o">&gt;</span>
     <span class="mi">11</span> <span class="n">in_vals_two</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">4</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">23</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">0</span><span class="p">])</span>
     <span class="mi">12</span> 
<span class="o">---&gt;</span> <span class="mi">13</span> <span class="n">result</span> <span class="o">=</span> <span class="n">array_operations</span><span class="p">(</span><span class="n">in_vals_one</span><span class="p">,</span> <span class="n">in_vals_two</span><span class="p">)</span>
     <span class="mi">14</span> <span class="n">result</span>

<span class="o">&lt;</span><span class="n">ipython</span><span class="o">-</span><span class="nb">input</span><span class="o">-</span><span class="mi">1</span><span class="o">-</span><span class="mi">166160824</span><span class="n">d19</span><span class="o">&gt;</span> <span class="ow">in</span> <span class="n">array_operations</span><span class="p">(</span><span class="n">in_arr_one</span><span class="p">,</span> <span class="n">in_arr_two</span><span class="p">)</span>
      <span class="mi">3</span> 
      <span class="mi">4</span> <span class="k">def</span><span class="w"> </span><span class="nf">array_operations</span><span class="p">(</span><span class="n">in_arr_one</span><span class="p">,</span> <span class="n">in_arr_two</span><span class="p">):</span>
<span class="o">----&gt;</span> <span class="mi">5</span>     <span class="n">out_arr</span> <span class="o">=</span> <span class="n">in_arr_one</span><span class="o">*</span><span class="mf">1.5</span>
      <span class="mi">6</span>     <span class="n">out_arr</span> <span class="o">=</span> <span class="n">out_arr</span> <span class="o">+</span> <span class="n">in_arr_two</span>
      <span class="mi">7</span>     <span class="k">return</span> <span class="n">out_arr</span>

<span class="n">UFuncTypeError</span><span class="p">:</span> <span class="n">ufunc</span> <span class="s1">&#39;multiply&#39;</span> <span class="n">did</span> <span class="ow">not</span> <span class="n">contain</span> <span class="n">a</span> <span class="n">loop</span> <span class="k">with</span> <span class="n">signature</span> <span class="n">matching</span> <span class="n">types</span> <span class="p">(</span><span class="n">dtype</span><span class="p">(</span><span class="s1">&#39;&lt;U32&#39;</span><span class="p">),</span> <span class="n">dtype</span><span class="p">(</span><span class="s1">&#39;&lt;U32&#39;</span><span class="p">))</span> <span class="o">-&gt;</span> <span class="n">dtype</span><span class="p">(</span><span class="s1">&#39;&lt;U32&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>Oh no! We’ve got a <code class="docutils literal notranslate"><span class="pre">UFuncTypeError</span></code> here, perhaps not the most illuminating error message we’ve ever seen. We’d like to know what’s going wrong here. The <code class="docutils literal notranslate"><span class="pre">Traceback</span></code> did give us a hint about where the issue occurred though; it happens in the multiplication line of the function we wrote.</p>
<p>To debug the error with print statements, we might re-run the code like this:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">array_operations</span><span class="p">(</span><span class="n">in_arr_one</span><span class="p">,</span> <span class="n">in_arr_two</span><span class="p">):</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;in_arr_one is </span><span class="si">{</span><span class="n">in_arr_one</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
    <span class="n">out_arr</span> <span class="o">=</span> <span class="n">in_arr_one</span><span class="o">*</span><span class="mf">1.5</span>
    <span class="n">out_arr</span> <span class="o">=</span> <span class="n">out_arr</span> <span class="o">+</span> <span class="n">in_arr_two</span>
    <span class="k">return</span> <span class="n">out_arr</span>


<span class="n">in_vals_one</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">3</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">16</span><span class="p">,</span> <span class="s1">&#39;7&#39;</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">9</span><span class="p">,</span> <span class="mi">22</span><span class="p">])</span>
<span class="n">in_vals_two</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">4</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">23</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">0</span><span class="p">])</span>

<span class="n">result</span> <span class="o">=</span> <span class="n">array_operations</span><span class="p">(</span><span class="n">in_vals_one</span><span class="p">,</span> <span class="n">in_vals_two</span><span class="p">)</span>
<span class="n">result</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">in_arr_one</span> <span class="ow">is</span> <span class="p">[</span><span class="s1">&#39;3&#39;</span> <span class="s1">&#39;2&#39;</span> <span class="s1">&#39;5&#39;</span> <span class="s1">&#39;16&#39;</span> <span class="s1">&#39;7&#39;</span> <span class="s1">&#39;8&#39;</span> <span class="s1">&#39;9&#39;</span> <span class="s1">&#39;22&#39;</span><span class="p">]</span>
</pre></div>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="o">---------------------------------------------------------------------------</span>
<span class="n">UFuncTypeError</span>                            <span class="n">Traceback</span> <span class="p">(</span><span class="n">most</span> <span class="n">recent</span> <span class="n">call</span> <span class="n">last</span><span class="p">)</span>
<span class="o">&lt;</span><span class="n">ipython</span><span class="o">-</span><span class="nb">input</span><span class="o">-</span><span class="mi">2</span><span class="o">-</span><span class="mi">6</span><span class="n">a04719bc0ff</span><span class="o">&gt;</span> <span class="ow">in</span> <span class="o">&lt;</span><span class="n">module</span><span class="o">&gt;</span>
      <span class="mi">9</span> <span class="n">in_vals_two</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">4</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">23</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">0</span><span class="p">])</span>
     <span class="mi">10</span> 
<span class="o">---&gt;</span> <span class="mi">11</span> <span class="n">result</span> <span class="o">=</span> <span class="n">array_operations</span><span class="p">(</span><span class="n">in_vals_one</span><span class="p">,</span> <span class="n">in_vals_two</span><span class="p">)</span>
     <span class="mi">12</span> <span class="n">result</span>

<span class="o">&lt;</span><span class="n">ipython</span><span class="o">-</span><span class="nb">input</span><span class="o">-</span><span class="mi">2</span><span class="o">-</span><span class="mi">6</span><span class="n">a04719bc0ff</span><span class="o">&gt;</span> <span class="ow">in</span> <span class="n">array_operations</span><span class="p">(</span><span class="n">in_arr_one</span><span class="p">,</span> <span class="n">in_arr_two</span><span class="p">)</span>
      <span class="mi">1</span> <span class="k">def</span><span class="w"> </span><span class="nf">array_operations</span><span class="p">(</span><span class="n">in_arr_one</span><span class="p">,</span> <span class="n">in_arr_two</span><span class="p">):</span>
      <span class="mi">2</span>     <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;in_arr_one is </span><span class="si">{</span><span class="n">in_arr_one</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
<span class="o">----&gt;</span> <span class="mi">3</span>     <span class="n">out_arr</span> <span class="o">=</span> <span class="n">in_arr_one</span><span class="o">*</span><span class="mf">1.5</span>
      <span class="mi">4</span>     <span class="n">out_arr</span> <span class="o">=</span> <span class="n">out_arr</span> <span class="o">+</span> <span class="n">in_arr_two</span>
      <span class="mi">5</span>     <span class="k">return</span> <span class="n">out_arr</span>

<span class="n">UFuncTypeError</span><span class="p">:</span> <span class="n">ufunc</span> <span class="s1">&#39;multiply&#39;</span> <span class="n">did</span> <span class="ow">not</span> <span class="n">contain</span> <span class="n">a</span> <span class="n">loop</span> <span class="k">with</span> <span class="n">signature</span> <span class="n">matching</span> <span class="n">types</span> <span class="p">(</span><span class="n">dtype</span><span class="p">(</span><span class="s1">&#39;&lt;U32&#39;</span><span class="p">),</span> <span class="n">dtype</span><span class="p">(</span><span class="s1">&#39;&lt;U32&#39;</span><span class="p">))</span> <span class="o">-&gt;</span> <span class="n">dtype</span><span class="p">(</span><span class="s1">&#39;&lt;U32&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>What can we tell from the values of <code class="docutils literal notranslate"><span class="pre">in_arr_one</span></code> that are now being printed? Well, they seem to have quote marks around them and what that means is that they’re strings, <em>not</em> floating point numbers or integers! Multiplying a string by 1.5 doesn’t make sense here, so that’s our error. If we did this, we might then trace the origin of that array back to find out where it was defined and see that instead of <code class="docutils literal notranslate"><span class="pre">np.array([3,</span> <span class="pre">2,</span> <span class="pre">5,</span> <span class="pre">16,</span> <span class="pre">7,</span> <span class="pre">8,</span> <span class="pre">9,</span> <span class="pre">22])</span></code> being declared, we have <code class="docutils literal notranslate"><span class="pre">np.array([3,</span> <span class="pre">2,</span> <span class="pre">5,</span> <span class="pre">16,</span> <span class="pre">'7',</span> <span class="pre">8,</span> <span class="pre">9,</span> <span class="pre">22])</span></code> instead and <code class="docutils literal notranslate"><span class="pre">numpy</span></code> decides to cast the whole array as a string to ensure consistency.</p>
<p>Let’s fix that problem by turning <code class="docutils literal notranslate"><span class="pre">'7'</span></code> into <code class="docutils literal notranslate"><span class="pre">7</span></code> and run it again:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">array_operations</span><span class="p">(</span><span class="n">in_arr_one</span><span class="p">,</span> <span class="n">in_arr_two</span><span class="p">):</span>
    <span class="n">out_arr</span> <span class="o">=</span> <span class="n">in_arr_one</span><span class="o">*</span><span class="mf">1.5</span>
    <span class="n">out_arr</span> <span class="o">=</span> <span class="n">out_arr</span> <span class="o">+</span> <span class="n">in_arr_two</span>
    <span class="k">return</span> <span class="n">out_arr</span>


<span class="n">in_vals_one</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">3</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">16</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">9</span><span class="p">,</span> <span class="mi">22</span><span class="p">])</span>
<span class="n">in_vals_two</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">4</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">23</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">0</span><span class="p">])</span>

<span class="n">result</span> <span class="o">=</span> <span class="n">array_operations</span><span class="p">(</span><span class="n">in_vals_one</span><span class="p">,</span> <span class="n">in_vals_two</span><span class="p">)</span>
<span class="n">result</span>
</pre></div>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="o">---------------------------------------------------------------------------</span>
<span class="ne">ValueError</span>                                <span class="n">Traceback</span> <span class="p">(</span><span class="n">most</span> <span class="n">recent</span> <span class="n">call</span> <span class="n">last</span><span class="p">)</span>
<span class="o">&lt;</span><span class="n">ipython</span><span class="o">-</span><span class="nb">input</span><span class="o">-</span><span class="mi">3</span><span class="o">-</span><span class="n">ebd3efde9b3e</span><span class="o">&gt;</span> <span class="ow">in</span> <span class="o">&lt;</span><span class="n">module</span><span class="o">&gt;</span>
      <span class="mi">8</span> <span class="n">in_vals_two</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">4</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">23</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">0</span><span class="p">])</span>
      <span class="mi">9</span> 
<span class="o">---&gt;</span> <span class="mi">10</span> <span class="n">result</span> <span class="o">=</span> <span class="n">array_operations</span><span class="p">(</span><span class="n">in_vals_one</span><span class="p">,</span> <span class="n">in_vals_two</span><span class="p">)</span>
     <span class="mi">11</span> <span class="n">result</span>

<span class="o">&lt;</span><span class="n">ipython</span><span class="o">-</span><span class="nb">input</span><span class="o">-</span><span class="mi">3</span><span class="o">-</span><span class="n">ebd3efde9b3e</span><span class="o">&gt;</span> <span class="ow">in</span> <span class="n">array_operations</span><span class="p">(</span><span class="n">in_arr_one</span><span class="p">,</span> <span class="n">in_arr_two</span><span class="p">)</span>
      <span class="mi">1</span> <span class="k">def</span><span class="w"> </span><span class="nf">array_operations</span><span class="p">(</span><span class="n">in_arr_one</span><span class="p">,</span> <span class="n">in_arr_two</span><span class="p">):</span>
      <span class="mi">2</span>     <span class="n">out_arr</span> <span class="o">=</span> <span class="n">in_arr_one</span><span class="o">*</span><span class="mf">1.5</span>
<span class="o">----&gt;</span> <span class="mi">3</span>     <span class="n">out_arr</span> <span class="o">=</span> <span class="n">out_arr</span> <span class="o">+</span> <span class="n">in_arr_two</span>
      <span class="mi">4</span>     <span class="k">return</span> <span class="n">out_arr</span>
      <span class="mi">5</span> 

<span class="ne">ValueError</span><span class="p">:</span> <span class="n">operands</span> <span class="n">could</span> <span class="ow">not</span> <span class="n">be</span> <span class="n">broadcast</span> <span class="n">together</span> <span class="k">with</span> <span class="n">shapes</span> <span class="p">(</span><span class="mi">8</span><span class="p">,)</span> <span class="p">(</span><span class="mi">7</span><span class="p">,)</span> 
</pre></div>
</div>
<p>Still not working! But we’ve moved on to a different error now. We can still use a print statement to debug this one, which seems to be related to the shapes of variables passed into the function:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">array_operations</span><span class="p">(</span><span class="n">in_arr_one</span><span class="p">,</span> <span class="n">in_arr_two</span><span class="p">):</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;in_arr_one shape is </span><span class="si">{</span><span class="n">in_arr_one</span><span class="o">.</span><span class="n">shape</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
    <span class="n">out_arr</span> <span class="o">=</span> <span class="n">in_arr_one</span><span class="o">*</span><span class="mf">1.5</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;intermediate out_arr shape is </span><span class="si">{</span><span class="n">out_arr</span><span class="o">.</span><span class="n">shape</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;in_arr_two shape is </span><span class="si">{</span><span class="n">in_arr_two</span><span class="o">.</span><span class="n">shape</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
    <span class="n">out_arr</span> <span class="o">=</span> <span class="n">out_arr</span> <span class="o">+</span> <span class="n">in_arr_two</span>
    <span class="k">return</span> <span class="n">out_arr</span>


<span class="n">in_vals_one</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">3</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">16</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">9</span><span class="p">,</span> <span class="mi">22</span><span class="p">])</span>
<span class="n">in_vals_two</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">4</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">23</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">0</span><span class="p">])</span>

<span class="n">result</span> <span class="o">=</span> <span class="n">array_operations</span><span class="p">(</span><span class="n">in_vals_one</span><span class="p">,</span> <span class="n">in_vals_two</span><span class="p">)</span>
<span class="n">result</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">in_arr_one</span> <span class="n">shape</span> <span class="ow">is</span> <span class="p">(</span><span class="mi">8</span><span class="p">,)</span>
<span class="n">intermediate</span> <span class="n">out_arr</span> <span class="n">shape</span> <span class="ow">is</span> <span class="p">(</span><span class="mi">8</span><span class="p">,)</span>
<span class="n">in_arr_two</span> <span class="n">shape</span> <span class="ow">is</span> <span class="p">(</span><span class="mi">7</span><span class="p">,)</span>
</pre></div>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="o">---------------------------------------------------------------------------</span>
<span class="ne">ValueError</span>                                <span class="n">Traceback</span> <span class="p">(</span><span class="n">most</span> <span class="n">recent</span> <span class="n">call</span> <span class="n">last</span><span class="p">)</span>
<span class="o">&lt;</span><span class="n">ipython</span><span class="o">-</span><span class="nb">input</span><span class="o">-</span><span class="mi">4</span><span class="o">-</span><span class="mi">4961</span><span class="n">f476c7eb</span><span class="o">&gt;</span> <span class="ow">in</span> <span class="o">&lt;</span><span class="n">module</span><span class="o">&gt;</span>
     <span class="mi">11</span> <span class="n">in_vals_two</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">4</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">23</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">0</span><span class="p">])</span>
     <span class="mi">12</span> 
<span class="o">---&gt;</span> <span class="mi">13</span> <span class="n">result</span> <span class="o">=</span> <span class="n">array_operations</span><span class="p">(</span><span class="n">in_vals_one</span><span class="p">,</span> <span class="n">in_vals_two</span><span class="p">)</span>
     <span class="mi">14</span> <span class="n">result</span>

<span class="o">&lt;</span><span class="n">ipython</span><span class="o">-</span><span class="nb">input</span><span class="o">-</span><span class="mi">4</span><span class="o">-</span><span class="mi">4961</span><span class="n">f476c7eb</span><span class="o">&gt;</span> <span class="ow">in</span> <span class="n">array_operations</span><span class="p">(</span><span class="n">in_arr_one</span><span class="p">,</span> <span class="n">in_arr_two</span><span class="p">)</span>
      <span class="mi">4</span>     <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;intermediate out_arr shape is </span><span class="si">{</span><span class="n">out_arr</span><span class="o">.</span><span class="n">shape</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
      <span class="mi">5</span>     <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;in_arr_two shape is </span><span class="si">{</span><span class="n">in_arr_two</span><span class="o">.</span><span class="n">shape</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
<span class="o">----&gt;</span> <span class="mi">6</span>     <span class="n">out_arr</span> <span class="o">=</span> <span class="n">out_arr</span> <span class="o">+</span> <span class="n">in_arr_two</span>
      <span class="mi">7</span>     <span class="k">return</span> <span class="n">out_arr</span>
      <span class="mi">8</span> 

<span class="ne">ValueError</span><span class="p">:</span> <span class="n">operands</span> <span class="n">could</span> <span class="ow">not</span> <span class="n">be</span> <span class="n">broadcast</span> <span class="n">together</span> <span class="k">with</span> <span class="n">shapes</span> <span class="p">(</span><span class="mi">8</span><span class="p">,)</span> <span class="p">(</span><span class="mi">7</span><span class="p">,)</span> 
</pre></div>
</div>
<p>The print statement now tells us the shapes of the arrays as we go through the function. We can see that in the line before the <code class="docutils literal notranslate"><span class="pre">return</span></code> statement the two arrays that are being combined using the <code class="docutils literal notranslate"><span class="pre">+</span></code> operator don’t have the same shape, so we’re effectively adding two vectors from two differently dimensioned vector spaces and, understandably, we are being called out on our nonsense. To fix this problem, we would have to ensure that the input arrays are the same shape (it looks like we may have just missed a value from <code class="docutils literal notranslate"><span class="pre">in_vals_two</span></code>).</p>
<p><code class="docutils literal notranslate"><span class="pre">print</span></code> statements are great for a quick bit of debugging and you are likely to want to use them more frequently than any other debugging tool. However, for complex, nested code debugging, they aren’t always very efficient and you will sometimes feel like you are playing battleships in continually refining where they should go until you have pinpointed the actual problem, so they’re far from perfect. Fortunately, there are other tools in the debugging toolbox…</p>
</section>
<section id="debugging-with-the-ide">
<h3>Debugging with the IDE<a class="headerlink" href="#debugging-with-the-ide" title="Link to this heading">#</a></h3>
<p>In this section, we’ll learn about how your Integrated Development Environment, or IDE, can aid you with debugging. While we’ll talk through the use of Visual Studio Code, which is free, directly supports Python, R, and other languages, and is especially rich, many of the features will be present in other IDEs too and the ideas are somewhat general.</p>
<p>To begin debugging using Visual Studio Code, get a script ready, for example <code class="docutils literal notranslate"><span class="pre">script.py</span></code>, that you’d like to debug. If your script has an error in, a debug run will automatically run into it and stop on the error; alternatively you can click to the left of the line number in your script to create a <em>breakpoint</em> that your code will stop at anyway when in debug mode.</p>
<p>To begin a debug session, click on the play button partially covered by a bug that’s on the left hand ribbon of the VS Code window. It will bring up a menu. Click ‘Run and debug’ and select ‘Python file’. The debugger will now start running the script you had open. When it reaches and error or a breakpoint it will stop.</p>
<p>Why is this useful? Once the code stops, you can hover over any variables and see what’s ‘inside’ them, which is useful for working out what’s going on. Remember, in the examples above, we only saw variables that we asked for. Using the debugger, we can hover over any variable we’re interested in without having to decide ahead of time! We can also see other useful bits of info such as the <em>call stack</em> of functions that have been called, what local (within the current scope) and global (available everywhere) variables have been defined, and we can nominate variables to watch too.</p>
<p>Perhaps you now want to progress the code on from a breakpoint; you can do this too. You’ll see that a menu has appeared with stop, restart, play, and other buttons on it. To skip over the next line of code, use the curved arrow over the dot. To dig in to the next line of code, for example if it’s a function, use the arrow pointing toward a dot. To carry on running the code, use the play button.</p>
<p>This is only really scratching the surface of what you can do with IDE based debugging, but even that surface layer provides lots of really useful tools for finding out what’s going on when your code executes.</p>
<p>You can find a short ‘hello world!’ debugging tutorial in the <a class="reference external" href="https://code.visualstudio.com/docs/python/python-tutorial#_configure-and-run-the-debugger">official VS Code documentation</a>.</p>
</section>
<section id="logging">
<h3>Logging<a class="headerlink" href="#logging" title="Link to this heading">#</a></h3>
<p>Logging is a means of tracking events that happen when software runs. It’s really the best way to debug code. An event is described by a descriptive message that can optionally contain data about variables that are defined as the code is executing.</p>
<p>Logging has two main purposes: to record events of interest, such as an error, and to act as an auditable account of what happened after the fact.</p>
<p>Although Python has a built-in logger, we will see an example of logging using <a class="reference external" href="https://github.com/Delgan/loguru"><strong>loguru</strong></a>, a package that makes logging a little easier and has some nice settings.</p>
<p>Let’s see how to log a debug message:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">loguru</span><span class="w"> </span><span class="kn">import</span> <span class="n">logger</span>

<span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Simple logging!&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span><span class=" -Color -Color-Green">2025-03-26 15:57:23.810</span> | <span class=" -Color -Color-Bold -Color-Bold-Blue">DEBUG   </span> | <span class=" -Color -Color-Cyan">__main__</span>:<span class=" -Color -Color-Cyan">&lt;module&gt;</span>:<span class=" -Color -Color-Cyan">3</span> - <span class=" -Color -Color-Bold -Color-Bold-Blue">Simple logging!</span>
</pre></div>
</div>
</div>
</div>
<p>The default message includes the time, the type of log entry message it is, what bit of code it happened in (including a line number), and the message itself (basically all the info we need). There are different levels of code messages. They are:</p>
<ul class="simple">
<li><p>CRITICAL</p></li>
<li><p>ERROR</p></li>
<li><p>WARNING</p></li>
<li><p>SUCCESS</p></li>
<li><p>INFO</p></li>
<li><p>DEBUG</p></li>
<li><p>TRACE</p></li>
</ul>
<p>You can find advice on what level to use for what message <a class="reference external" href="https://reflectoring.io/logging-levels/">here</a>, but it will depend a bit on what you’re using your logs for.</p>
<p>What we’ve just seen are logging messages written out to the console, which doesn’t persist. This is clearly no good for auditing what happened long after the fact (and it may not be that good for debugging either) so we also need a way to write a log to a file. This snippet of code</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">logger</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="s2">&quot;file_</span><span class="si">{time}</span><span class="s2">.log&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>tells <strong>loguru</strong> to send your logging messages to a <em>log file</em> instead of to the console. This is really handy for auditing what happened when your code executed long after it ran. You can choose any name for your log file, using “{time}” as part of the string is a shorthand that tells <strong>loguru</strong> to use the current datetime to name the file.</p>
<p>Log files can become quite numerous and quite large, which you might not want. Those logs from 6 months ago may just be taking up space and not be all that useful, for example. So, what you can also do, is tell <strong>loguru</strong> to use a new log file. Some examples of this would be <code class="docutils literal notranslate"><span class="pre">logger.add(&quot;file_1.log&quot;,</span> <span class="pre">rotation=&quot;500</span> <span class="pre">MB&quot;)</span></code> to clean up a file after it reaches 500 MB in size, <code class="docutils literal notranslate"><span class="pre">rotation=&quot;12:00&quot;</span></code> to refresh the log file at lunch time, and <code class="docutils literal notranslate"><span class="pre">retention=&quot;10</span> <span class="pre">days&quot;</span></code> to keep the file for 10 days.</p>
<p>One further feature that is worth being aware of is the capability to trace what caused errors, including the trace back through functions and modules, and report them in the log. Of course, you can debug these using the console, but sometimes having such complex errors written to a file (in full) can be handy. This example of a full traceback comes from the <strong>loguru</strong> documentation. The script would have:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">logger</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="s2">&quot;out.log&quot;</span><span class="p">,</span> <span class="n">backtrace</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">diagnose</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>  <span class="c1"># Caution, may leak sensitive data if used in production</span>

<span class="k">def</span><span class="w"> </span><span class="nf">func</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">a</span> <span class="o">/</span> <span class="n">b</span>

<span class="k">def</span><span class="w"> </span><span class="nf">nested</span><span class="p">(</span><span class="n">c</span><span class="p">):</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">func</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="n">c</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">ZeroDivisionError</span><span class="p">:</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">exception</span><span class="p">(</span><span class="s2">&quot;What?!&quot;</span><span class="p">)</span>

<span class="n">nested</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
</pre></div>
</div>
<p>while the log file would record:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>2018-07-17 01:38:43.975 | ERROR    | __main__:nested:10 - What?!
Traceback (most recent call last):

  File &quot;test.py&quot;, line 12, in &lt;module&gt;
    nested(0)
    └ &lt;function nested at 0x7f5c755322f0&gt;

&gt; File &quot;test.py&quot;, line 8, in nested
    func(5, c)
    │       └ 0
    └ &lt;function func at 0x7f5c79fc2e18&gt;

  File &quot;test.py&quot;, line 4, in func
    return a / b
           │   └ 0
           └ 5

ZeroDivisionError: division by zero
</pre></div>
</div>
</section>
</section>
<section id="tests">
<h2>Tests<a class="headerlink" href="#tests" title="Link to this heading">#</a></h2>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>While this is a slightly more advanced topic, the quality and robustness improvements you will get from writing tests mean it’s still really useful to use the tricks from it.</p>
</div>
<p>Tests check that your code is behaving as you expect, even as parts of it change or are updated. They most commonly compare an expected input and output with what actually comes out of your code for a given input.</p>
<p>Writing tests for code is often an after thought for research code, if it’s a thought at all. That’s understandable. But it can really boost reliability and robustness. This excerpt from <a class="reference external" href="https://merely-useful.github.io/py-rse/testing.html">Research Software Engineering with Python</a> explains why testing even research code is extremely useful:</p>
<blockquote>
<div><p>Why is testing research software important? A successful early career researcher in protein crystallography, Geoffrey Chang, had to retract five published papers—three from the journal Science—because his code had inadvertently flipped two columns of data (Miller 2006). More recently, a simple calculation mistake in a paper by Reinhart and Rogoff contributed to making the financial crash of 2008 even worse for millions of people (Borwein and Bailey 2013). Testing helps to catch errors like these.</p>
</div></blockquote>
<p>The Reinhart and Rogoff paper used Excel for its analysis; while Excel has some pros and does some good in the world, my strong recommendation is that it should <em>not</em> be used for any important analysis.</p>
<p>Back to testing: if you’re writing a <em>package</em> of code for others to use, one that will change and grow over time, tests are essential. These are some general guidelines for good testing, such as:</p>
<ul class="simple">
<li><p>A testing ‘unit’ should focus on a single bit of functionality;</p></li>
<li><p>Each test unit must be fully independent (in practice, this means that <code class="docutils literal notranslate"><span class="pre">setUp()</span></code> and <code class="docutils literal notranslate"><span class="pre">tearDown()</span></code> methods need to be defined to prep data or objects to the point where they can be used by the testing unit);</p></li>
<li><p>Tests should run fast if possible;</p></li>
<li><p>If you know how, it’s a good idea to use something like a ‘Git hook’ that runs tests before code is saved in a shared repository;</p></li>
<li><p>If you find a bug in your code, it’s good practice to write a new test that targets it; and</p></li>
<li><p>Although long, extremely descriptive names are not very helpful in regular code, they <em>should</em> be used for functions that test code because this is the name you will see when the test fails (and you want to know what it refers to).</p></li>
</ul>
<p>The most common way to run tests is to add assertions to code. An assertion is a statement that something must be true at a certain point in a program. When an assertion evaluates to true, nothing happens; if it’s false, the programme stops and prints a user-defined error message. Here’s an example of an assertion:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">positive_num</span> <span class="o">=</span> <span class="mi">5</span>

<span class="k">assert</span> <span class="n">positive_num</span> <span class="o">&gt;</span> <span class="mi">0</span>
</pre></div>
</div>
</div>
</div>
<p>If we had run</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">positive_num</span> <span class="o">=</span> <span class="mi">5</span>

<span class="k">assert</span> <span class="n">positive_num</span> <span class="o">&lt;</span> <span class="mi">0</span>
</pre></div>
</div>
<p>it would have resulted in</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="o">---------------------------------------------------------------------------</span>
<span class="ne">AssertionError</span>                            <span class="n">Traceback</span> <span class="p">(</span><span class="n">most</span> <span class="n">recent</span> <span class="n">call</span> <span class="n">last</span><span class="p">)</span>
<span class="o">&lt;</span><span class="n">ipython</span><span class="o">-</span><span class="nb">input</span><span class="o">-</span><span class="mi">55</span><span class="o">-</span><span class="n">db0e55fa5cb7</span><span class="o">&gt;</span> <span class="ow">in</span> <span class="o">&lt;</span><span class="n">module</span><span class="o">&gt;</span>
      <span class="mi">1</span> <span class="n">positive_num</span> <span class="o">=</span> <span class="mi">5</span>
      <span class="mi">2</span> 
<span class="o">----&gt;</span> <span class="mi">3</span> <span class="k">assert</span> <span class="n">positive_num</span> <span class="o">&lt;</span> <span class="mi">0</span>

<span class="ne">AssertionError</span><span class="p">:</span>
</pre></div>
</div>
<p>Putting assertions into code here and there is one way to check that everything is working as you anticipate, but you won’t find out about it until you actually run the code! A testing framework allows you to separate checking the code behaves as you’d expect from running the code, so that you can ensure everything works before putting that big run on.</p>
<p>To run lots of tests, we can use a test framework (also called a test runner). A commonly used test framework is <a class="reference external" href="https://docs.pytest.org/en/latest/"><strong>pytest</strong></a>. Essentially it will run anything that you’ve flagged as a test in your code and report back to you on whether it passed or not. Here’s how it works: tests are put in files whose names begin with <code class="docutils literal notranslate"><span class="pre">test_</span></code>, each test is a function whose name also begins with <code class="docutils literal notranslate"><span class="pre">test_</span></code>, and these functions use <code class="docutils literal notranslate"><span class="pre">assert</span></code> statements to check results.</p>
<p>Normally, your functions would be in a different script but here’s an example of a code function and a testing function (that tests it) that you might put in a file called <code class="docutils literal notranslate"><span class="pre">test.py</span></code>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># content of test.py</span>
<span class="k">def</span><span class="w"> </span><span class="nf">inc</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">x</span> <span class="o">+</span> <span class="mi">1</span>


<span class="k">def</span><span class="w"> </span><span class="nf">test_answer</span><span class="p">():</span>
    <span class="k">assert</span> <span class="n">inc</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span> <span class="o">==</span> <span class="mi">5</span>
</pre></div>
</div>
</div>
</div>
<p>To run this, we would enter</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>pytest
</pre></div>
</div>
<p>on the command line. This would yield</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="o">===========================</span><span class="w"> </span><span class="nb">test</span><span class="w"> </span>session<span class="w"> </span><span class="nv">starts</span><span class="w"> </span><span class="o">============================</span>
platform<span class="w"> </span>linux<span class="w"> </span>--<span class="w"> </span>Python<span class="w"> </span><span class="m">3</span>.x.y,<span class="w"> </span>pytest-6.x.y,<span class="w"> </span>py-1.x.y,<span class="w"> </span>pluggy-0.x.y
cachedir:<span class="w"> </span><span class="nv">$PYTHON_PREFIX</span>/.pytest_cache
rootdir:<span class="w"> </span><span class="nv">$REGENDOC_TMPDIR</span>
collected<span class="w"> </span><span class="m">1</span><span class="w"> </span>item

test.py<span class="w"> </span>F<span class="w">                                                     </span><span class="o">[</span><span class="m">100</span>%<span class="o">]</span>

<span class="o">=================================</span><span class="w"> </span><span class="nv">FAILURES</span><span class="w"> </span><span class="o">=================================</span>
_______________________________<span class="w"> </span>test_answer<span class="w"> </span>________________________________

<span class="w">    </span>def<span class="w"> </span>test_answer<span class="o">()</span>:
&gt;<span class="w">       </span>assert<span class="w"> </span>inc<span class="o">(</span><span class="m">3</span><span class="o">)</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="m">5</span>
E<span class="w">       </span>assert<span class="w"> </span><span class="nv">4</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="m">5</span>
E<span class="w">        </span>+<span class="w">  </span>where<span class="w"> </span><span class="nv">4</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>inc<span class="o">(</span><span class="m">3</span><span class="o">)</span>

test_sample.py:6:<span class="w"> </span><span class="nv">AssertionError</span>
<span class="o">=========================</span><span class="w"> </span>short<span class="w"> </span><span class="nb">test</span><span class="w"> </span>summary<span class="w"> </span><span class="nv">info</span><span class="w"> </span><span class="o">==========================</span>
FAILED<span class="w"> </span>test.py::test_answer<span class="w"> </span>-<span class="w"> </span>assert<span class="w"> </span><span class="nv">4</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="nv">5</span>
<span class="o">============================</span><span class="w"> </span><span class="m">1</span><span class="w"> </span>failed<span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="m">0</span>.12s<span class="w"> </span><span class="o">=============================</span>
</pre></div>
</div>
<p>As you add more tests, they will be automatically picked up and run by <code class="docutils literal notranslate"><span class="pre">pytest</span></code>.</p>
<p>When writing tests, think about whether you have tested realistic combinations of input parameters, tested all discrete outputs at least once, tested the boundaries of continuous outputs, and ensured that informative errors are raised when things go wrong.</p>
<p>If you’re using Visual Studio Code, support for <strong>pytest</strong> comes built-in.</p>
<section id="testing-continuous-variables">
<h3>Testing continuous variables<a class="headerlink" href="#testing-continuous-variables" title="Link to this heading">#</a></h3>
<p>Imagine we are not testing for an integer, such as 4, but instead for a real number, such as 4.32838. Computers are nothing if not punishingly literal, however, so if evaluation of the code produces 4.32837 instead of 4.32838 the <code class="docutils literal notranslate"><span class="pre">assert</span></code> statement will fail and the test won’t pass even if the two numbers are close enough for our purposes. It’s even worse than that because computers <em>cannot</em> accurately represent real numbers to arbitrary levels of precision.</p>
<p>To avoid tests that fail even though nothing’s really wrong, most testing packages come with tools for real numbers. Here’s an example where we have a parameter alpha that we’d like to test against an expected value of 1 but with a tolerance of 0.01.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">pytest</span>


<span class="k">def</span><span class="w"> </span><span class="nf">complicated_func</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;A really complicated func&quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="mf">0.998</span>


<span class="n">alpha</span> <span class="o">=</span> <span class="n">complicated_func</span><span class="p">()</span>
<span class="n">expected_alpha</span> <span class="o">=</span> <span class="n">pytest</span><span class="o">.</span><span class="n">approx</span><span class="p">(</span><span class="mf">1.0</span><span class="p">,</span> <span class="nb">abs</span><span class="o">=</span><span class="mf">0.01</span><span class="p">)</span>
<span class="k">assert</span> <span class="n">alpha</span> <span class="o">==</span> <span class="n">expected_alpha</span>
<span class="nb">print</span><span class="p">(</span><span class="n">expected_alpha</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>1.0 ± 1.0e-02
</pre></div>
</div>
</div>
</div>
</section>
<section id="test-coverage">
<h3>Test coverage<a class="headerlink" href="#test-coverage" title="Link to this heading">#</a></h3>
<p>A production-ready code should be heavily tested. Coverage tests ask how much of your code is actually covered by tests and where the code is that isn’t tested. One package to do this is called <a class="reference external" href="https://coverage.readthedocs.io/en/coverage-5.5/"><strong>coverage</strong></a>. If you already have code tests written, you can run:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>coverage<span class="w"> </span>run<span class="w"> </span>-m<span class="w"> </span>pytest
</pre></div>
</div>
<p>on the command line instead of just running <code class="docutils literal notranslate"><span class="pre">pytest</span></code>. To get a report on the success use</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$<span class="w"> </span>coverage<span class="w"> </span>report<span class="w"> </span>-m
Name<span class="w">                      </span>Stmts<span class="w">   </span>Miss<span class="w">  </span>Cover<span class="w">   </span>Missing
-------------------------------------------------------
my_program.py<span class="w">                </span><span class="m">20</span><span class="w">      </span><span class="m">4</span><span class="w">    </span><span class="m">80</span>%<span class="w">   </span><span class="m">33</span>-35,<span class="w"> </span><span class="m">39</span>
my_other_module.py<span class="w">           </span><span class="m">56</span><span class="w">      </span><span class="m">6</span><span class="w">    </span><span class="m">89</span>%<span class="w">   </span><span class="m">17</span>-23
-------------------------------------------------------
TOTAL<span class="w">                        </span><span class="m">76</span><span class="w">     </span><span class="m">10</span><span class="w">    </span><span class="m">87</span>%
</pre></div>
</div>
<p>If you would prefer a html report over one in the terminal, use <code class="docutils literal notranslate"><span class="pre">$</span> <span class="pre">coverage</span> <span class="pre">html</span></code> to create a report at <code class="docutils literal notranslate"><span class="pre">htmlcov/index.html</span></code>.</p>
</section>
</section>
<section id="timing-and-profiling">
<h2>Timing and profiling<a class="headerlink" href="#timing-and-profiling" title="Link to this heading">#</a></h2>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>This is a more advanced topic.</p>
</div>
<p>Timing and profiling your code are useful to understand where bottlenecks might be. One of the principles of programming is don’t optimise too soon, so, if you are reaching for timing and profiling, you’ve probably already hit that bottleneck.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>This section just deals with diagnosing slow code: how to speed code up will be covered elsewhere.</p>
</div>
<p>There are different levels of sophistication for timing and profiling. The simplest way to time is to use the built-in library.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">time</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">timeit</span>


<span class="k">def</span><span class="w"> </span><span class="nf">f</span><span class="p">(</span><span class="n">nsec</span><span class="o">=</span><span class="mf">1.0</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Function sleeps for nsec seconds.&quot;&quot;&quot;</span>
    <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="n">nsec</span><span class="p">)</span>


<span class="n">start</span> <span class="o">=</span> <span class="n">timeit</span><span class="o">.</span><span class="n">default_timer</span><span class="p">()</span>
<span class="n">f</span><span class="p">()</span>
<span class="n">elapsed</span> <span class="o">=</span> <span class="n">timeit</span><span class="o">.</span><span class="n">default_timer</span><span class="p">()</span> <span class="o">-</span> <span class="n">start</span>
<span class="n">elapsed</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>1.0011870050000198
</pre></div>
</div>
</div>
</div>
<p>If you’re working jupyter notebooks (which is what this book is written in), you can use the <code class="docutils literal notranslate"><span class="pre">timeit</span></code> magic, a convenient shortcut for timing a line or chunk of code (more on magics, and timeit, <a class="reference external" href="https://ipython.readthedocs.io/en/stable/interactive/magics.html#magic-time">here</a>):</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%</span><span class="k">timeit</span> f(0.01)
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>10.1 ms ± 5.07 μs per loop (mean ± std. dev. of 7 runs, 100 loops each)
</pre></div>
</div>
</div>
</div>
<p>timeit will adjust the number of repeats according to how slow the code is to run. Several other magics are available:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">%time</span></code>: Time the execution of a single statement</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">%timeit</span></code>: Time repeated execution of a single statement for more accuracy</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">%prun</span></code>: Run code with the profiler</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">%lprun</span></code>: Run code with the line-by-line profiler</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">%memit</span></code>: Measure the memory use of a single statement</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">%mprun</span></code>: Run code with the line-by-line memory profiler</p></li>
</ul>
<p>Another way to time functions is via decorators:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">process_time</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">func</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="kn">import</span><span class="w"> </span><span class="nn">timeit</span>

        <span class="n">start</span> <span class="o">=</span> <span class="n">timeit</span><span class="o">.</span><span class="n">default_timer</span><span class="p">()</span>
        <span class="n">f</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">timeit</span><span class="o">.</span><span class="n">default_timer</span><span class="p">()</span> <span class="o">-</span> <span class="n">start</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">func</span>


<span class="nd">@process_time</span>
<span class="k">def</span><span class="w"> </span><span class="nf">f1</span><span class="p">(</span><span class="n">nsec</span><span class="o">=</span><span class="mf">1.0</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Function sleeps for nsec seconds.&quot;&quot;&quot;</span>
    <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="n">nsec</span><span class="p">)</span>


<span class="n">f1</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>1.0003629379999666
</pre></div>
</div>
</div>
</div>
<p>Timing is very simple and just tells you the total time of what’s inbetween the start and end points. Often, you would want a bit more detail about what’s being slow, or you may wish to profile an entire script. For that, there’s <code class="docutils literal notranslate"><span class="pre">cProfile</span></code>, which is a built-in package. You can use it on the command line or within scripts, like this:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">cProfile</span>


<span class="k">def</span><span class="w"> </span><span class="nf">foo</span><span class="p">():</span>
    <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mf">1.0</span><span class="p">)</span>
    <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mf">2.5</span><span class="p">)</span>


<span class="n">cProfile</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="s2">&quot;foo()&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>         6 function calls in 3.504 seconds

   Ordered by: standard name

   ncalls  tottime  percall  cumtime  percall filename:lineno(function)
        1    0.000    0.000    3.504    3.504 1072224404.py:4(foo)
        1    0.000    0.000    3.504    3.504 &lt;string&gt;:1(&lt;module&gt;)
        1    0.000    0.000    3.504    3.504 {built-in method builtins.exec}
        2    3.504    1.752    3.504    1.752 {built-in method time.sleep}
        1    0.000    0.000    0.000    0.000 {method &#39;disable&#39; of &#39;_lsprof.Profiler&#39; objects}
</pre></div>
</div>
</div>
</div>
<p>What do we get here? The <code class="docutils literal notranslate"><span class="pre">percall</span></code> columns are <code class="docutils literal notranslate"><span class="pre">tottime</span></code> and <code class="docutils literal notranslate"><span class="pre">cumtime</span></code> (respectively) divided by <code class="docutils literal notranslate"><span class="pre">ncalls</span></code>. <code class="docutils literal notranslate"><span class="pre">tottime</span></code> is the time spent in the function excluding any sub-functions, while <code class="docutils literal notranslate"><span class="pre">cumtime</span></code> is the cumulative time spent.</p>
<p>There are various profilers out there that extend the basics provided by <strong>cProfile</strong>. Let’s look at a few others to get a sense of what extra they offer.</p>
<p><a class="reference external" href="https://github.com/joerick/pyinstrument"><strong>pyinstrument</strong></a> attempts to improve on the standard profilers by recording the ‘entire stack’ of methods so that identifying expensive sub-calls to methods is easier. There are two ways to run it: on the command line, using <code class="docutils literal notranslate"><span class="pre">pyinstrument</span> <span class="pre">script.py</span></code> instead of <code class="docutils literal notranslate"><span class="pre">python</span> <span class="pre">script.py</span></code>, or by wedging the code you’re interested in <em>within</em> a script between a <code class="docutils literal notranslate"><span class="pre">.start()</span></code> and <code class="docutils literal notranslate"><span class="pre">.stop()</span></code> method like this:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">pyinstrument</span><span class="w"> </span><span class="kn">import</span> <span class="n">Profiler</span>

<span class="n">profiler</span> <span class="o">=</span> <span class="n">Profiler</span><span class="p">()</span>
<span class="n">profiler</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>


<span class="k">def</span><span class="w"> </span><span class="nf">fibonacci</span><span class="p">(</span><span class="n">n</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">n</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;n must be a positive integer&quot;</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">n</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
        <span class="k">return</span> <span class="mi">0</span>
    <span class="k">elif</span> <span class="n">n</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
        <span class="k">return</span> <span class="mi">1</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">fibonacci</span><span class="p">(</span><span class="n">n</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">+</span> <span class="n">fibonacci</span><span class="p">(</span><span class="n">n</span> <span class="o">-</span> <span class="mi">2</span><span class="p">)</span>


<span class="n">fibonacci</span><span class="p">(</span><span class="mi">20</span><span class="p">)</span>

<span class="n">profiler</span><span class="o">.</span><span class="n">stop</span><span class="p">()</span>

<span class="c1"># Print the results of the profiling to screen</span>
<span class="nb">print</span><span class="p">(</span><span class="n">profiler</span><span class="o">.</span><span class="n">output_text</span><span class="p">(</span><span class="n">unicode</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="kc">True</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>  _     ._   __/__   _ _  _  _ _/_   Recorded: 15:57:37  Samples:  3
 /_//_/// /_\ / //_// / //_&#39;/ //     Duration: 0.003     CPU time: 0.003
/   _/                      v5.0.1

Profile at /tmp/ipykernel_5934/1045853210.py:4

<span class=" -Color -Color-Red">0.003</span> <span class=" -Color -Color-C15 -Color-C15-BGC24">&lt;module&gt;</span>  <span class=" -Color -Color-Faint">/tmp/ipykernel_5934/1045853210.py:1</span>
└─ <span class=" -Color -Color-Red">0.003</span> <span class=" -Color -Color-C15 -Color-C15-BGC24">fibonacci</span>  <span class=" -Color -Color-Faint">/tmp/ipykernel_5934/1045853210.py:7</span>
   └─ <span class=" -Color -Color-Red">0.003</span> <span class=" -Color -Color-C15 -Color-C15-BGC24">fibonacci</span>  <span class=" -Color -Color-Faint">/tmp/ipykernel_5934/1045853210.py:7</span>
      └─ <span class=" -Color -Color-Red">0.003</span> <span class=" -Color -Color-C15 -Color-C15-BGC24">fibonacci</span>  <span class=" -Color -Color-Faint">/tmp/ipykernel_5934/1045853210.py:7</span>
         └─ <span class=" -Color -Color-Red">0.003</span> <span class=" -Color -Color-C15 -Color-C15-BGC24">fibonacci</span>  <span class=" -Color -Color-Faint">/tmp/ipykernel_5934/1045853210.py:7</span>
            └─ <span class=" -Color -Color-Red">0.003</span> <span class=" -Color -Color-C15 -Color-C15-BGC24">fibonacci</span>  <span class=" -Color -Color-Faint">/tmp/ipykernel_5934/1045853210.py:7</span>
               └─ <span class=" -Color -Color-Red">0.003</span> <span class=" -Color -Color-C15 -Color-C15-BGC24">fibonacci</span>  <span class=" -Color -Color-Faint">/tmp/ipykernel_5934/1045853210.py:7</span>
                  └─ <span class=" -Color -Color-Red">0.003</span> <span class=" -Color -Color-C15 -Color-C15-BGC24">fibonacci</span>  <span class=" -Color -Color-Faint">/tmp/ipykernel_5934/1045853210.py:7</span>
                     └─ <span class=" -Color -Color-Red">0.003</span> <span class=" -Color -Color-C15 -Color-C15-BGC24">fibonacci</span>  <span class=" -Color -Color-Faint">/tmp/ipykernel_5934/1045853210.py:7</span>
                        └─ <span class=" -Color -Color-Red">0.003</span> <span class=" -Color -Color-C15 -Color-C15-BGC24">fibonacci</span>  <span class=" -Color -Color-Faint">/tmp/ipykernel_5934/1045853210.py:7</span>
                           └─ <span class=" -Color -Color-Red">0.003</span> <span class=" -Color -Color-C15 -Color-C15-BGC24">fibonacci</span>  <span class=" -Color -Color-Faint">/tmp/ipykernel_5934/1045853210.py:7</span>
                              ├─ <span class=" -Color -Color-Red">0.002</span> <span class=" -Color -Color-C15 -Color-C15-BGC24">fibonacci</span>  <span class=" -Color -Color-Faint">/tmp/ipykernel_5934/1045853210.py:7</span>
                              │  └─ <span class=" -Color -Color-Red">0.002</span> <span class=" -Color -Color-C15 -Color-C15-BGC24">fibonacci</span>  <span class=" -Color -Color-Faint">/tmp/ipykernel_5934/1045853210.py:7</span>
                              │     └─ <span class=" -Color -Color-Red">0.002</span> <span class=" -Color -Color-C15 -Color-C15-BGC24">fibonacci</span>  <span class=" -Color -Color-Faint">/tmp/ipykernel_5934/1045853210.py:7</span>
                              │        └─ <span class=" -Color -Color-Red">0.002</span> <span class=" -Color -Color-C15 -Color-C15-BGC24">fibonacci</span>  <span class=" -Color -Color-Faint">/tmp/ipykernel_5934/1045853210.py:7</span>
                              └─ <span class=" -Color -Color-Yellow">0.001</span> [self]  <span class=" -Color -Color-Faint">/tmp/ipykernel_5934/1045853210.py</span>
</pre></div>
</div>
</div>
</div>
<p>Because our function, <code class="docutils literal notranslate"><span class="pre">fibonacci</span></code>, is nested, the function call breakdown that <strong>pyinstrument</strong> produces is likewise nested so that you can see how the code calls progresses.</p>
<p>The output analysis can be written to an interactive HTML file too: just use <code class="docutils literal notranslate"><span class="pre">profiler.output_html()</span></code></p>
<p>Time to execute code is not the only thing we care about. In fact, for economics applications, it’s much more likely to be a memory bottleneck than a speed one. Operations that involve lots of data, large matrices, or both, might be memory hogs. If you hit the memory (RAM) limit on your machine, it will slow right down and the process that’s running might just crash completely. So wouldn’t it be great it we had a way to profile both code and memory!? Well, we do.</p>
<p><a class="reference external" href="https://github.com/plasma-umass/scalene"><strong>scalene</strong></a> is a command-line utility for profiling code execution time <em>and</em> memory. It profiles whole scripts, run <code class="docutils literal notranslate"><span class="pre">scalene</span> <span class="pre">script.py</span></code> on the command line, and produces HTML reports. Here’s an example of some output:</p>
<p><img alt="Screenshot from scalene running on a problem" src="https://raw.githubusercontent.com/plasma-umass/scalene/master/docs/images/sample-profile-pystone.png" /></p>
<p>What’s particularly useful is having the part of the code where the bottleneck is displayed on the right. Memory usage over time tells you where the memory-hogging lines are, while the two CPU % columns tell you how much of the total time (shown at the top) was spent in Python code and in non-Python (‘native’) code, which Python often calls under the hood.</p>
</section>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            name: "python3",
            path: "./."
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

                </article>
              

              
              
              
              
                <footer class="prev-next-footer d-print-none">
                  
<div class="prev-next-area">
    <a class="left-prev"
       href="code-advanced.html"
       title="previous page">
      <i class="fa-solid fa-angle-left"></i>
      <div class="prev-next-info">
        <p class="prev-next-subtitle">previous</p>
        <p class="prev-next-title">Coding</p>
      </div>
    </a>
    <a class="right-next"
       href="vis-intro.html"
       title="next page">
      <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">Intro to Data Visualisation</p>
      </div>
      <i class="fa-solid fa-angle-right"></i>
    </a>
</div>
                </footer>
              
            </div>
            
            
              
                <div class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">


  <div class="sidebar-secondary-item">
  <div class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> Contents
  </div>
  <nav class="bd-toc-nav page-toc">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#introduction">Introduction</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#auto-magically-improving-your-code">Auto-magically improving your code</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#linting">Linting</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#formatting">Formatting</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#inspecting-variables">Inspecting Variables</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#rich-for-beautiful-inspection"><strong>rich</strong> for beautiful inspection</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#errors-and-exceptions">Errors and Exceptions</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#debugging-code">Debugging Code</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#print-statements">Print statements</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#debugging-with-the-ide">Debugging with the IDE</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#logging">Logging</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#tests">Tests</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#testing-continuous-variables">Testing continuous variables</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#test-coverage">Test coverage</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#timing-and-profiling">Timing and profiling</a></li>
</ul>
  </nav></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
<div class="bd-footer-content__inner container">
  
  <div class="footer-item">
    
<p class="component-author">
By Arthur Turrell
</p>

  </div>
  
  <div class="footer-item">
    

  <p class="copyright">
    
      © Copyright 2023.
      <br/>
    
  </p>

  </div>
  
  <div class="footer-item">
    
  </div>
  
  <div class="footer-item">
    
<div class="extra_footer">
  This book is available under an MIT license.
</div>
  </div>
  
</div>
          </footer>
        

      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="_static/scripts/bootstrap.js?digest=dfe6caa3a7d634c4db9b"></script>
<script src="_static/scripts/pydata-sphinx-theme.js?digest=dfe6caa3a7d634c4db9b"></script>

  <footer class="bd-footer">
  </footer>
  </body>
</html>