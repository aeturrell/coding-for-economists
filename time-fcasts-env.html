
<!DOCTYPE html>


<html lang="en" data-content_root="./" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>Forecasting Exercises &#8212; Coding for Economists</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="_static/styles/theme.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
<link href="_static/styles/bootstrap.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
<link href="_static/styles/pydata-sphinx-theme.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />

  
  <link href="_static/vendor/fontawesome/6.5.2/css/all.min.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="_static/vendor/fontawesome/6.5.2/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="_static/vendor/fontawesome/6.5.2/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="_static/vendor/fontawesome/6.5.2/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="_static/pygments.css?v=03e43079" />
    <link rel="stylesheet" type="text/css" href="_static/styles/sphinx-book-theme.css?v=eba8b062" />
    <link rel="stylesheet" type="text/css" href="_static/togglebutton.css?v=13237357" />
    <link rel="stylesheet" type="text/css" href="_static/copybutton.css?v=76b2166b" />
    <link rel="stylesheet" type="text/css" href="_static/mystnb.4510f1fc1dee50b3e5859aac5469c37c29e427902b24a333a5f9fcb2f0b3ac41.css" />
    <link rel="stylesheet" type="text/css" href="_static/sphinx-thebe.css?v=4fa983c6" />
    <link rel="stylesheet" type="text/css" href="_static/sphinx-design.min.css?v=95c83b7e" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="_static/scripts/bootstrap.js?digest=dfe6caa3a7d634c4db9b" />
<link rel="preload" as="script" href="_static/scripts/pydata-sphinx-theme.js?digest=dfe6caa3a7d634c4db9b" />
  <script src="_static/vendor/fontawesome/6.5.2/js/all.min.js?digest=dfe6caa3a7d634c4db9b"></script>

    <script src="_static/documentation_options.js?v=9eb32ce0"></script>
    <script src="_static/doctools.js?v=9a2dae69"></script>
    <script src="_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="_static/clipboard.min.js?v=a7894cd8"></script>
    <script src="_static/copybutton.js?v=f281be69"></script>
    <script src="_static/scripts/sphinx-book-theme.js?v=887ef09a"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="_static/togglebutton.js?v=4a39c7ea"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script src="_static/design-tabs.js?v=f930bc37"></script>
    <script async="async" src="https://www.googletagmanager.com/gtag/js?id=G-9FZQCPFXZJ"></script>
    <script>
                window.dataLayer = window.dataLayer || [];
                function gtag(){ dataLayer.push(arguments); }
                gtag('js', new Date());
                gtag('config', 'G-9FZQCPFXZJ');
            </script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"; const thebe_selector = ".thebe,.cell"; const thebe_selector_input = "pre"; const thebe_selector_output = ".output, .cell_output"</script>
    <script async="async" src="_static/sphinx-thebe.js?v=c100c467"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script>
                window.dataLayer = window.dataLayer || [];
                function gtag(){ dataLayer.push(arguments); }
                gtag('js', new Date());
                gtag('config', 'G-9FZQCPFXZJ');
            </script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"; const thebe_selector = ".thebe,.cell"; const thebe_selector_input = "pre"; const thebe_selector_output = ".output, .cell_output"</script>
    <script>window.MathJax = {"options": {"processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
    <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'time-fcasts-env';</script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <link rel="canonical" href="https://aeturrell.github.io/coding-for-economists/time-fcasts-env.html" />
    <link rel="icon" href="_static/favicon.ico"/>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Introduction to Text" href="text-intro.html" />
    <link rel="prev" title="Time Series" href="time-series.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <div id="pst-skip-link" class="skip-link d-print-none"><a href="#main-content">Skip to main content</a></div>
  
  <div id="pst-scroll-pixel-helper"></div>
  
  <button type="button" class="btn rounded-pill" id="pst-back-to-top">
    <i class="fa-solid fa-arrow-up"></i>Back to top</button>

  
  <input type="checkbox"
          class="sidebar-toggle"
          id="pst-primary-sidebar-checkbox"/>
  <label class="overlay overlay-primary" for="pst-primary-sidebar-checkbox"></label>
  
  <input type="checkbox"
          class="sidebar-toggle"
          id="pst-secondary-sidebar-checkbox"/>
  <label class="overlay overlay-secondary" for="pst-secondary-sidebar-checkbox"></label>
  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
<form class="bd-search d-flex align-items-center"
      action="search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search this book..."
         aria-label="Search this book..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
  </div>

  <div class="pst-async-banner-revealer d-none">
  <aside id="bd-header-version-warning" class="d-none d-print-none" aria-label="Version warning"></aside>
</div>

  
    <header class="bd-header navbar navbar-expand-lg bd-navbar d-print-none">
    </header>
  

  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      
      
      <div class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
    
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">

  
    
  

<a class="navbar-brand logo" href="intro.html">
  
  
  
  
  
    
    
      
    
    
    <img src="_static/smith_lovelace.png" class="logo__image only-light" alt="Coding for Economists - Home"/>
    <script>document.write(`<img src="_static/smith_lovelace.png" class="logo__image only-dark" alt="Coding for Economists - Home"/>`);</script>
  
  
</a></div>
        <div class="sidebar-primary-item">

 <script>
 document.write(`
   <button class="btn search-button-field search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass"></i>
    <span class="search-button__default-text">Search</span>
    <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
   </button>
 `);
 </script></div>
        <div class="sidebar-primary-item"><nav class="bd-links bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item navbar-nav active">
        
        <ul class="nav bd-sidenav bd-sidenav__home-link">
            <li class="toctree-l1">
                <a class="reference internal" href="intro.html">
                    Introduction
                </a>
            </li>
        </ul>
        <p aria-level="2" class="caption" role="heading"><span class="caption-text">Getting Started</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="code-preliminaries.html">Preliminaries</a></li>
<li class="toctree-l1"><a class="reference internal" href="code-basics.html">Coding Basics</a></li>
<li class="toctree-l1"><a class="reference internal" href="workflow-basics.html">Workflow Basics</a></li>
<li class="toctree-l1"><a class="reference internal" href="code-where.html">Writing Code</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Essential Data</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="data-analysis-quickstart.html">Data Analysis Quickstart</a></li>
<li class="toctree-l1"><a class="reference internal" href="data-intro.html">Working with Data</a></li>
<li class="toctree-l1"><a class="reference internal" href="data-transformation.html">Data Transformation</a></li>
<li class="toctree-l1"><a class="reference internal" href="data-read-and-write.html">Reading and Writing Files</a></li>
<li class="toctree-l1"><a class="reference internal" href="data-numbers.html">Numbers</a></li>
<li class="toctree-l1"><a class="reference internal" href="data-categorical.html">Categorical Data</a></li>
<li class="toctree-l1"><a class="reference internal" href="data-spreadsheets.html">Spreadsheets</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Essential Coding</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="code-best-practice.html">Code in Style</a></li>
<li class="toctree-l1"><a class="reference internal" href="code-advanced.html">Coding</a></li>
<li class="toctree-l1"><a class="reference internal" href="code-advcd-best-practice.html">Shortcuts to Better Coding</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Essential Data Visualisation</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="vis-intro.html">Intro to Data Visualisation</a></li>
<li class="toctree-l1"><a class="reference internal" href="vis-letsplot.html">Easy Data Visualisation for Tidy Data with <strong>Lets-Plot</strong></a></li>
<li class="toctree-l1"><a class="reference internal" href="vis-matplotlib.html">Powerful Data Visualisation with <strong>Matplotlib</strong></a></li>
<li class="toctree-l1"><a class="reference internal" href="vis-common-plots-one.html">Common Plots I</a></li>
<li class="toctree-l1"><a class="reference internal" href="vis-common-plots-two.html">Common Plots II</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Essential Workflow</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="auto-research-outputs.html">Automating Research Outputs</a></li>
<li class="toctree-l1"><a class="reference internal" href="wrkflow-markdown.html">Markdown</a></li>
<li class="toctree-l1"><a class="reference internal" href="wrkflow-command-line.html">The Command Line</a></li>
<li class="toctree-l1"><a class="reference internal" href="wrkflow-version-control.html">Version Control</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Econometrics</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="econmt-probability-random.html">Probability and Random Processes</a></li>
<li class="toctree-l1"><a class="reference internal" href="econmt-statistics.html">Statistics</a></li>
<li class="toctree-l1"><a class="reference internal" href="econmt-regression.html">Regression</a></li>
<li class="toctree-l1"><a class="reference internal" href="econmt-generalised-models.html">Generalised regression models</a></li>
<li class="toctree-l1"><a class="reference internal" href="econmt-diagnostics.html">Regression diagnostics and visualisations</a></li>
<li class="toctree-l1"><a class="reference internal" href="econmt-causal-inference.html">Causal Inference</a></li>
<li class="toctree-l1"><a class="reference internal" href="econmt-bayesian.html">Bayesian Inference</a></li>
<li class="toctree-l1"><a class="reference internal" href="econmt-bayes-bambi.html">Bayesian Inference Made Easier</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Data</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="data-boolean.html">Boolean Data</a></li>
<li class="toctree-l1"><a class="reference internal" href="data-joining-data.html">Joins</a></li>
<li class="toctree-l1"><a class="reference internal" href="data-missing-values.html">Missing Values</a></li>
<li class="toctree-l1"><a class="reference internal" href="data-exploratory-analysis.html">Exploratory Data Analysis</a></li>
<li class="toctree-l1"><a class="reference internal" href="data-extraction.html">Getting Data</a></li>
<li class="toctree-l1"><a class="reference internal" href="data-databases.html">Databases</a></li>
<li class="toctree-l1"><a class="reference internal" href="data-advanced.html"><strong>pandas</strong> alternatives, validation, and orchestration</a></li>
<li class="toctree-l1"><a class="reference internal" href="data-sharing.html">Sharing Data</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Coding</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="code-further-advanced.html">Advanced Coding</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Data Visualisation</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="vis-narrative.html">Narrative Data Visualisation</a></li>
<li class="toctree-l1"><a class="reference internal" href="vis-tables.html">Tables</a></li>
<li class="toctree-l1"><a class="reference internal" href="vis-dashboards.html">Dashboards</a></li>
<li class="toctree-l1"><a class="reference internal" href="vis-animation.html">Animation</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Workflow</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="wrkflow-quarto.html">Combining Code and Text in Quarto Markdown</a></li>
<li class="toctree-l1"><a class="reference internal" href="wrkflow-environments.html">Virtual Code Environments</a></li>
<li class="toctree-l1"><a class="reference internal" href="wrkflow-rap.html">Reproducible Analysis</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Time</span></p>
<ul class="current nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="time-intro.html">Introduction to Time</a></li>
<li class="toctree-l1"><a class="reference internal" href="time-series.html">Time Series</a></li>
<li class="toctree-l1 current active"><a class="current reference internal" href="#">Forecasting Exercises</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Text Analysis</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="text-intro.html">Introduction to Text</a></li>
<li class="toctree-l1"><a class="reference internal" href="text-regex.html">Regular Expressions, aka regex</a></li>
<li class="toctree-l1"><a class="reference internal" href="text-nlp.html">Natural Language Processing</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Machine Learning</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="ml-intro.html">Introduction to Machine Learning and AI</a></li>
<li class="toctree-l1"><a class="reference internal" href="ml-sup.html">Supervised Machine Learning</a></li>
<li class="toctree-l1"><a class="reference internal" href="ml-data.html">Data for Machine Learning</a></li>
<li class="toctree-l1"><a class="reference internal" href="ml-unsup.html">Unsupervised Machine Learning</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Geospatial</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="geo-intro.html">Intro to Geo-Spatial Analysis</a></li>
<li class="toctree-l1"><a class="reference internal" href="geo-vis.html">Geo-Spatial Visualisation</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Mathematics</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="maths-abstract.html">Abstract Mathematics</a></li>
<li class="toctree-l1"><a class="reference internal" href="maths-numerical.html">Numerical Mathematics</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Craft</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="craft-intro.html">Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="craft-search.html">Putting the Search in Research</a></li>
<li class="toctree-l1"><a class="reference internal" href="craft-generating-ideas.html">Generating and Accepting Research Ideas</a></li>
<li class="toctree-l1"><a class="reference internal" href="craft-writing-papers.html">Writing Papers</a></li>
<li class="toctree-l1"><a class="reference internal" href="craft-research-blogs.html">Research Blog Posts</a></li>
<li class="toctree-l1"><a class="reference internal" href="craft-referee.html">Writing Referee Reports</a></li>
<li class="toctree-l1"><a class="reference internal" href="craft-technical-reports.html">Writing Technical Reports</a></li>
<li class="toctree-l1"><a class="reference internal" href="craft-extended-abstracts.html">Extended Abstracts</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Further Data Visualisation</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="vis-plotnine.html">Data Visualisation using the Grammar of Graphics with <strong>Plotnine</strong></a></li>
<li class="toctree-l1"><a class="reference internal" href="vis-seaborn.html">Data Visualisation with <strong>Seaborn</strong></a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Coming from ...</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="coming-from-stata.html">Coming from Stata</a></li>
<li class="toctree-l1"><a class="reference internal" href="coming-from-matlab.html">Coming from Matlab</a></li>
<li class="toctree-l1"><a class="reference internal" href="coming-from-r.html">Coming from R</a></li>
<li class="toctree-l1"><a class="reference internal" href="coming-from-excel.html">Coming from Excel</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">End Matter</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="contributing.html">Contributing</a></li>
<li class="toctree-l1"><a class="reference internal" href="zreferences.html">Bibliography</a></li>
</ul>

    </div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main" role="main">
        
        

<div class="sbt-scroll-pixel-helper"></div>

          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article d-print-none">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item"><button class="sidebar-toggle primary-toggle btn btn-sm" title="Toggle primary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
  <span class="fa-solid fa-bars"></span>
</button></div>
      
    </div>
  
  
    <div class="header-article-items__end">
      
        <div class="header-article-item">

<div class="article-header-buttons">





<div class="dropdown dropdown-launch-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Launch interactive content">
    <i class="fas fa-rocket"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="https://colab.research.google.com/github/aeturrell/coding-for-economists/blob/main/time-fcasts-env.ipynb" target="_blank"
   class="btn btn-sm dropdown-item"
   title="Launch on Colab"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  
    <img alt="Colab logo" src="_static/images/logo_colab.png">
  </span>
<span class="btn__text-container">Colab</span>
</a>
</li>
      
  </ul>
</div>






<div class="dropdown dropdown-source-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Source repositories">
    <i class="fab fa-github"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="https://github.com/aeturrell/coding-for-economists" target="_blank"
   class="btn btn-sm btn-source-repository-button dropdown-item"
   title="Source repository"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fab fa-github"></i>
  </span>
<span class="btn__text-container">Repository</span>
</a>
</li>
      
      
      
      
      <li><a href="https://github.com/aeturrell/coding-for-economists/issues/new?title=Issue%20on%20page%20%2Ftime-fcasts-env.html&body=Your%20issue%20content%20here." target="_blank"
   class="btn btn-sm btn-source-issues-button dropdown-item"
   title="Open an issue"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-lightbulb"></i>
  </span>
<span class="btn__text-container">Open issue</span>
</a>
</li>
      
  </ul>
</div>






<div class="dropdown dropdown-download-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Download this page">
    <i class="fas fa-download"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="_sources/time-fcasts-env.ipynb" target="_blank"
   class="btn btn-sm btn-download-source-button dropdown-item"
   title="Download source file"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="btn__text-container">.ipynb</span>
</a>
</li>
      
      
      
      
      <li>
<button onclick="window.print()"
  class="btn btn-sm btn-download-pdf-button dropdown-item"
  title="Print to PDF"
  data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="btn__text-container">.pdf</span>
</button>
</li>
      
  </ul>
</div>




<button onclick="toggleFullScreen()"
  class="btn btn-sm btn-fullscreen-button"
  title="Fullscreen mode"
  data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>



<script>
document.write(`
  <button class="btn btn-sm nav-link pst-navbar-icon theme-switch-button" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="theme-switch fa-solid fa-sun fa-lg" data-mode="light"></i>
    <i class="theme-switch fa-solid fa-moon fa-lg" data-mode="dark"></i>
    <i class="theme-switch fa-solid fa-circle-half-stroke fa-lg" data-mode="auto"></i>
  </button>
`);
</script>


<script>
document.write(`
  <button class="btn btn-sm pst-navbar-icon search-button search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass fa-lg"></i>
  </button>
`);
</script>
<button class="sidebar-toggle secondary-toggle btn btn-sm" title="Toggle secondary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="fa-solid fa-list"></span>
</button>
</div></div>
      
    </div>
  
</div>
</div>
              
              

<div id="jb-print-docs-body" class="onlyprint">
    <h1>Forecasting Exercises</h1>
    <!-- Table of contents -->
    <div id="print-main-content">
        <div id="jb-print-toc">
            
            <div>
                <h2> Contents </h2>
            </div>
            <nav aria-label="Page">
                <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#two-period-forecast">Two Period Forecast</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#an-example-two-period-forecast">An Example Two Period Forecast</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#adding-a-lag">Adding a Lag</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#expanding-window">Expanding Window</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#the-likely-best-possible-expanding-window-forecast">The Likely Best Possible Expanding Window Forecast</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#rolling-window">Rolling Window</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#the-likely-best-possible-rolling-window-forecast">The Likely Best Possible Rolling Window Forecast</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#transforms-of-series-in-forecasting-exercises">Transforms of Series in Forecasting Exercises</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#data-vintage-and-the-real-time-information-flow">Data Vintage and the Real-Time Information Flow</a></li>
</ul>
            </nav>
        </div>
    </div>
</div>

              
                
<div id="searchbox"></div>
                <article class="bd-article">
                  
  <section class="tex2jax_ignore mathjax_ignore" id="forecasting-exercises">
<h1>Forecasting Exercises<a class="headerlink" href="#forecasting-exercises" title="Link to this heading">#</a></h1>
<p>In this chapter, we’re going to do a tour of forecasting exercises: that is, the set of operations, like slicing up time, that you might need to do when performing a forecast. Although there will be some code in this chapter, we’re mostly laying the theoretical groundwork.</p>
<p>Let’s start with some definitions. Features, or regressors, are labelled by <span class="math notranslate nohighlight">\(k = 0, \dots, K-1\)</span> and time by <span class="math notranslate nohighlight">\(t = 0, \dots, T-1\)</span>. Note that this means there are <span class="math notranslate nohighlight">\(T\)</span> time periods and <span class="math notranslate nohighlight">\(K\)</span> features. We’ll label different slices of time (or equivalently models trained on different data) by an index <span class="math notranslate nohighlight">\(\mu\)</span> beginning from <span class="math notranslate nohighlight">\(\mu=1\)</span>, and we’ll give these slices of time different labels: IS for in-sample and OS for out-of-sample. <span class="math notranslate nohighlight">\(f_\mu\)</span> is the model trained on the <span class="math notranslate nohighlight">\(\mu\)</span>th set of in-sample data. The target variable (the number we are trying to forecast) is <span class="math notranslate nohighlight">\(\left\{y_{t+h}\right\}_{t=0}^{t=T-1}\)</span>, where <span class="math notranslate nohighlight">\(h\)</span> is the number of time steps ahead we wish to forecast. Let <span class="math notranslate nohighlight">\(\left\{x_{tk}\right\}_{t=0}^{t=T-1}\)</span> represent feature (or regressor) <span class="math notranslate nohighlight">\(k\)</span>. In general, a forecast implies <span class="math notranslate nohighlight">\(h&gt;0\)</span> (otherwise we’re doing a nowcast).</p>
<p>Let’s first do some setup for the rest of the chapter. We’ll be using the <strong>numpy</strong>, <strong>pandas</strong>, <strong>matplotlib</strong>, and <strong>lets-plot</strong> packages.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">matplotlib.pyplot</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">plt</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">pandas</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">pd</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">lets_plot</span><span class="w"> </span><span class="kn">import</span> <span class="o">*</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">lets_plot.mapping</span><span class="w"> </span><span class="kn">import</span> <span class="n">as_discrete</span>

<span class="n">LetsPlot</span><span class="o">.</span><span class="n">setup_html</span><span class="p">(</span><span class="n">no_js</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">width_height_tiles</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;width&quot;</span><span class="p">:</span> <span class="mf">0.9</span><span class="p">,</span> <span class="s2">&quot;height&quot;</span><span class="p">:</span> <span class="mf">0.5</span><span class="p">}</span>
</pre></div>
</div>
</div>
</div>
<section id="two-period-forecast">
<h2>Two Period Forecast<a class="headerlink" href="#two-period-forecast" title="Link to this heading">#</a></h2>
<p>The most simple forecast you can imagine is if we have two periods (each of which may be made up of more than one value of <span class="math notranslate nohighlight">\(t\)</span>). The important thing is that the <span class="math notranslate nohighlight">\(t\)</span> in the first, “in-sample” period do not overlap with the <span class="math notranslate nohighlight">\(t\)</span> in the second, “out-of-sample” period. That’s because we <em>only want to use information in the in-sample period to forecast the out-of-sample period</em>. There are some cases where you may want to “forecast” the in-sample period, but if you’re interested in the real-world performance of your forecast, this is the setup you need.</p>
<p>In this world of a single in-sample period and a single out-of-sample period, <span class="math notranslate nohighlight">\(\mu=1\)</span>, and we could get drop that notation and just use IS and OS. But we’ll leave it in to make the contrast with what’s to come clearer.</p>
<p>The exercise is to use a model, <span class="math notranslate nohighlight">\(f = f_{\mu=1}\)</span>, that is trained to predict <span class="math notranslate nohighlight">\(\{y_{t+h}, t:\mu_{\text{IS}}=1\}\)</span> using <span class="math notranslate nohighlight">\(\{x_{tk}, t:\mu_{\text{IS}}=1\}\)</span> so that it can do an out-of-sample forecast of <span class="math notranslate nohighlight">\(\{y_{t+h}, t:\mu_\text{OS}=1\}\)</span> using <span class="math notranslate nohighlight">\(\{x_{tk}, t:\mu_{\text{OS}}=1\}\)</span>. It’s actually easier to see it with a picture:</p>
<div class="cell tag_remove-input docutils container">
</div>
<div class="cell tag_remove-input docutils container">
<div class="cell_output docutils container">
<div class="output text_html"><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" display="block" class="plt-container" width="600.0" height="200.0">
  <style type="text/css">
  .plt-container {
   font-family: Lucida Grande, sans-serif;
   user-select: none;
   -webkit-user-select: none;
   -moz-user-select: none;
   -ms-user-select: none;
}
text {
   text-rendering: optimizeLegibility;
}
#plaaYP1 .plot-title {
fill: #474747;
font-weight: normal;
   font-style: normal;font-family: Lucida Grande, sans-serif;
font-size: 16.0px;

}
#plaaYP1 .plot-subtitle {
fill: #474747;
font-weight: normal;
   font-style: normal;font-family: Lucida Grande, sans-serif;
font-size: 15.0px;

}
#plaaYP1 .plot-caption {
fill: #474747;
font-weight: normal;
   font-style: normal;font-family: Lucida Grande, sans-serif;
font-size: 13.0px;

}
#plaaYP1 .hyperlink-element {
fill: #118ed8;
font-weight: normal;
   font-style: normal;
}
#plaaYP1 .legend-title {
fill: #474747;
font-weight: normal;
   font-style: normal;font-family: Lucida Grande, sans-serif;
font-size: 15.0px;

}
#plaaYP1 .legend-item {
fill: #474747;
font-weight: normal;
   font-style: normal;font-family: Lucida Grande, sans-serif;
font-size: 13.0px;

}
#plaaYP1 .axis-title-x {
fill: #474747;
font-weight: normal;
   font-style: normal;font-family: Lucida Grande, sans-serif;
font-size: 15.0px;

}
#plaaYP1 .axis-text-x {
fill: #474747;
font-weight: normal;
   font-style: normal;font-family: Lucida Grande, sans-serif;
font-size: 13.0px;

}
#dKPA701 .axis-tooltip-text-x {
fill: #ffffff;
font-weight: normal;
   font-style: normal;font-family: Lucida Grande, sans-serif;
font-size: 13.0px;

}
#plaaYP1 .axis-title-y {
fill: #474747;
font-weight: normal;
   font-style: normal;font-family: Lucida Grande, sans-serif;
font-size: 15.0px;

}
#plaaYP1 .axis-text-y {
fill: #474747;
font-weight: normal;
   font-style: normal;font-family: Lucida Grande, sans-serif;
font-size: 13.0px;

}
#dKPA701 .axis-tooltip-text-y {
fill: #ffffff;
font-weight: normal;
   font-style: normal;font-family: Lucida Grande, sans-serif;
font-size: 13.0px;

}
#plaaYP1 .facet-strip-text-x {
fill: #474747;
font-weight: normal;
   font-style: normal;font-family: Lucida Grande, sans-serif;
font-size: 13.0px;

}
#plaaYP1 .facet-strip-text-y {
fill: #474747;
font-weight: normal;
   font-style: normal;font-family: Lucida Grande, sans-serif;
font-size: 13.0px;

}
#dKPA701 .tooltip-text {
fill: #474747;
font-weight: normal;
   font-style: normal;font-family: Lucida Grande, sans-serif;
font-size: 13.0px;

}
#dKPA701 .tooltip-title {
fill: #474747;
font-weight: bold;
   font-style: normal;font-family: Lucida Grande, sans-serif;
font-size: 13.0px;

}
#dKPA701 .tooltip-label {
fill: #474747;
font-weight: bold;
   font-style: normal;font-family: Lucida Grande, sans-serif;
font-size: 13.0px;

}

  </style>
  <g id="plaaYP1">
    <path fill-rule="evenodd" fill="rgb(255,255,255)" fill-opacity="1.0" d="M0.0 0.0 L0.0 200.0 L600.0 200.0 L600.0 0.0 Z">
    </path>
    <g transform="translate(29.5 6.5 ) ">
      <g>
        <g transform="translate(104.41139950448785 0.0 ) ">
          <g>
            <line x1="27.005504747786205" y1="0.0" x2="27.005504747786205" y2="141.0" stroke="rgb(233,233,233)" stroke-opacity="1.0" stroke-width="1.0" fill="none">
            </line>
            <line x1="55.58275844914727" y1="0.0" x2="55.58275844914727" y2="141.0" stroke="rgb(233,233,233)" stroke-opacity="1.0" stroke-width="1.0" fill="none">
            </line>
            <line x1="84.16001215050834" y1="0.0" x2="84.16001215050834" y2="141.0" stroke="rgb(233,233,233)" stroke-opacity="1.0" stroke-width="1.0" fill="none">
            </line>
            <line x1="112.73726585186941" y1="0.0" x2="112.73726585186941" y2="141.0" stroke="rgb(233,233,233)" stroke-opacity="1.0" stroke-width="1.0" fill="none">
            </line>
            <line x1="141.31451955323047" y1="0.0" x2="141.31451955323047" y2="141.0" stroke="rgb(233,233,233)" stroke-opacity="1.0" stroke-width="1.0" fill="none">
            </line>
            <line x1="169.89177325459153" y1="0.0" x2="169.89177325459153" y2="141.0" stroke="rgb(233,233,233)" stroke-opacity="1.0" stroke-width="1.0" fill="none">
            </line>
            <line x1="198.46902695595261" y1="0.0" x2="198.46902695595261" y2="141.0" stroke="rgb(233,233,233)" stroke-opacity="1.0" stroke-width="1.0" fill="none">
            </line>
            <line x1="227.04628065731367" y1="0.0" x2="227.04628065731367" y2="141.0" stroke="rgb(233,233,233)" stroke-opacity="1.0" stroke-width="1.0" fill="none">
            </line>
            <line x1="255.62353435867473" y1="0.0" x2="255.62353435867473" y2="141.0" stroke="rgb(233,233,233)" stroke-opacity="1.0" stroke-width="1.0" fill="none">
            </line>
            <line x1="284.20078806003585" y1="0.0" x2="284.20078806003585" y2="141.0" stroke="rgb(233,233,233)" stroke-opacity="1.0" stroke-width="1.0" fill="none">
            </line>
          </g>
        </g>
        <g transform="translate(104.41139950448785 0.0 ) ">
          <g>
            <line x1="0.0" y1="107.60526315789474" x2="311.20629280782197" y2="107.60526315789474" stroke="rgb(233,233,233)" stroke-opacity="1.0" stroke-width="1.0" fill="none">
            </line>
            <line x1="0.0" y1="33.39473684210526" x2="311.20629280782197" y2="33.39473684210526" stroke="rgb(233,233,233)" stroke-opacity="1.0" stroke-width="1.0" fill="none">
            </line>
          </g>
        </g>
      </g>
      <g clip-path="url(#co4WEF5)" clip-bounds-jfx="[rect (104.41139950448785, 0.0), (311.20629280782197, 141.0)]">
        <g transform="translate(104.41139950448785 0.0 ) ">
          <g>
            <g>
              <g>
                <g >
                  <rect fill="#7fc97f" stroke="#ffffff" stroke-width="0.0" x="14.145740582173724" y="89.05263157894737" height="37.10526315789474" width="25.719528331224964" />
                  <rect fill="#7fc97f" stroke="#ffffff" stroke-width="0.0" x="42.72299428353479" y="89.05263157894737" height="37.10526315789474" width="25.719528331224964" />
                  <rect fill="#7fc97f" stroke="#ffffff" stroke-width="0.0" x="71.30024798489586" y="89.05263157894737" height="37.10526315789474" width="25.719528331224964" />
                  <rect fill="#7fc97f" stroke="#ffffff" stroke-width="0.0" x="99.87750168625692" y="89.05263157894737" height="37.10526315789474" width="25.71952833122495" />
                  <rect fill="#7fc97f" stroke="#ffffff" stroke-width="0.0" x="128.45475538761798" y="89.05263157894737" height="37.10526315789474" width="25.71952833122498" />
                  <rect fill="#beaed4" stroke="#ffffff" stroke-width="0.0" x="157.03200908897904" y="14.84210526315789" height="37.10526315789474" width="25.71952833122498" />
                  <rect fill="#beaed4" stroke="#ffffff" stroke-width="0.0" x="185.60926279034013" y="14.84210526315789" height="37.10526315789474" width="25.71952833122495" />
                  <rect fill="#beaed4" stroke="#ffffff" stroke-width="0.0" x="214.18651649170118" y="14.84210526315789" height="37.10526315789474" width="25.71952833122498" />
                  <rect fill="#beaed4" stroke="#ffffff" stroke-width="0.0" x="242.76377019306224" y="14.84210526315789" height="37.10526315789474" width="25.71952833122495" />
                  <rect fill="#beaed4" stroke="#ffffff" stroke-width="0.0" x="271.3410238944233" y="14.84210526315789" height="37.10526315789474" width="25.71952833122498" />
                </g>
              </g>
            </g>
          </g>
        </g>
        <defs>
          <clipPath id="co4WEF5">
            <rect x="104.41139950448785" y="0.0" width="311.20629280782197" height="141.0">
            </rect>
          </clipPath>
        </defs>
      </g>
      <g>
        <g transform="translate(104.41139950448785 141.0 ) ">
          <g transform="translate(27.005504747786205 0.0 ) ">
            <line stroke-width="1.0" stroke="rgb(71,71,71)" stroke-opacity="1.0" x2="0.0" y2="4.0">
            </line>
            <g transform="translate(0.0 7.0 ) ">
              <text class="axis-text-x" text-anchor="middle" dy="0.7em" y="0.0">
                <tspan>0</tspan>
              </text>
            </g>
          </g>
          <g transform="translate(55.58275844914727 0.0 ) ">
            <line stroke-width="1.0" stroke="rgb(71,71,71)" stroke-opacity="1.0" x2="0.0" y2="4.0">
            </line>
            <g transform="translate(0.0 7.0 ) ">
              <text class="axis-text-x" text-anchor="middle" dy="0.7em" y="0.0">
                <tspan>1</tspan>
              </text>
            </g>
          </g>
          <g transform="translate(84.16001215050834 0.0 ) ">
            <line stroke-width="1.0" stroke="rgb(71,71,71)" stroke-opacity="1.0" x2="0.0" y2="4.0">
            </line>
            <g transform="translate(0.0 7.0 ) ">
              <text class="axis-text-x" text-anchor="middle" dy="0.7em" y="0.0">
                <tspan>2</tspan>
              </text>
            </g>
          </g>
          <g transform="translate(112.73726585186941 0.0 ) ">
            <line stroke-width="1.0" stroke="rgb(71,71,71)" stroke-opacity="1.0" x2="0.0" y2="4.0">
            </line>
            <g transform="translate(0.0 7.0 ) ">
              <text class="axis-text-x" text-anchor="middle" dy="0.7em" y="0.0">
                <tspan>3</tspan>
              </text>
            </g>
          </g>
          <g transform="translate(141.31451955323047 0.0 ) ">
            <line stroke-width="1.0" stroke="rgb(71,71,71)" stroke-opacity="1.0" x2="0.0" y2="4.0">
            </line>
            <g transform="translate(0.0 7.0 ) ">
              <text class="axis-text-x" text-anchor="middle" dy="0.7em" y="0.0">
                <tspan>4</tspan>
              </text>
            </g>
          </g>
          <g transform="translate(169.89177325459153 0.0 ) ">
            <line stroke-width="1.0" stroke="rgb(71,71,71)" stroke-opacity="1.0" x2="0.0" y2="4.0">
            </line>
            <g transform="translate(0.0 7.0 ) ">
              <text class="axis-text-x" text-anchor="middle" dy="0.7em" y="0.0">
                <tspan>5</tspan>
              </text>
            </g>
          </g>
          <g transform="translate(198.46902695595261 0.0 ) ">
            <line stroke-width="1.0" stroke="rgb(71,71,71)" stroke-opacity="1.0" x2="0.0" y2="4.0">
            </line>
            <g transform="translate(0.0 7.0 ) ">
              <text class="axis-text-x" text-anchor="middle" dy="0.7em" y="0.0">
                <tspan>6</tspan>
              </text>
            </g>
          </g>
          <g transform="translate(227.04628065731367 0.0 ) ">
            <line stroke-width="1.0" stroke="rgb(71,71,71)" stroke-opacity="1.0" x2="0.0" y2="4.0">
            </line>
            <g transform="translate(0.0 7.0 ) ">
              <text class="axis-text-x" text-anchor="middle" dy="0.7em" y="0.0">
                <tspan>7</tspan>
              </text>
            </g>
          </g>
          <g transform="translate(255.62353435867473 0.0 ) ">
            <line stroke-width="1.0" stroke="rgb(71,71,71)" stroke-opacity="1.0" x2="0.0" y2="4.0">
            </line>
            <g transform="translate(0.0 7.0 ) ">
              <text class="axis-text-x" text-anchor="middle" dy="0.7em" y="0.0">
                <tspan>8</tspan>
              </text>
            </g>
          </g>
          <g transform="translate(284.20078806003585 0.0 ) ">
            <line stroke-width="1.0" stroke="rgb(71,71,71)" stroke-opacity="1.0" x2="0.0" y2="4.0">
            </line>
            <g transform="translate(0.0 7.0 ) ">
              <text class="axis-text-x" text-anchor="middle" dy="0.7em" y="0.0">
                <tspan>9</tspan>
              </text>
            </g>
          </g>
          <line x1="0.0" y1="0.0" x2="311.20629280782197" y2="0.0" stroke-width="1.0" stroke="rgb(71,71,71)" stroke-opacity="1.0">
          </line>
        </g>
        <g transform="translate(104.41139950448785 0.0 ) ">
          <g transform="translate(0.0 107.60526315789474 ) ">
            <g transform="translate(-3.0 0.0 ) ">
              <text class="axis-text-y" text-anchor="end" dy="0.35em" y="0.0">
                <tspan>in-sample</tspan>
              </text>
            </g>
          </g>
          <g transform="translate(0.0 33.39473684210526 ) ">
            <g transform="translate(-3.0 0.0 ) ">
              <text class="axis-text-y" text-anchor="end" dy="0.35em" y="0.0">
                <tspan>out-of-sample</tspan>
              </text>
            </g>
          </g>
        </g>
      </g>
    </g>
    <g transform="translate(16.0 77.0 ) rotate(-90.0 ) ">
      <text class="axis-title-y" y="0.0" text-anchor="middle">
        <tspan>sample</tspan>
      </text>
    </g>
    <g transform="translate(289.5145459083989 193.0 ) ">
      <text class="axis-title-x" y="0.0" text-anchor="middle">
        <tspan>t</tspan>
      </text>
    </g>
    <g transform="translate(456.6176923123098 37.75 ) ">
      <rect x="0.0" y="0.0" height="78.5" width="143.38230768769014" stroke="rgb(71,71,71)" stroke-opacity="1.0" stroke-width="0.0" fill="rgb(255,255,255)" fill-opacity="1.0">
      </rect>
      <g transform="translate(5.0 5.0 ) ">
        <g transform="translate(0.0 12.0 ) ">
          <text class="legend-title" y="0.0">
            <tspan>sample</tspan>
          </text>
        </g>
        <g transform="translate(0.0 22.5 ) ">
          <g transform="">
            <g>
              <g transform="translate(1.0 1.0 ) ">
                <g>
                  <rect x="0.0" y="0.0" height="21.0" width="21.0" stroke="rgb(255,255,255)" stroke-opacity="1.0" fill="rgb(127,201,127)" fill-opacity="1.0" stroke-width="1.5">
                  </rect>
                </g>
              </g>
            </g>
            <g transform="translate(26.9903027277341 16.05 ) ">
              <text class="legend-item" y="0.0">
                <tspan>in-sample</tspan>
              </text>
            </g>
          </g>
          <g transform="translate(0.0 23.0 ) ">
            <g>
              <g transform="translate(1.0 1.0 ) ">
                <g>
                  <rect x="0.0" y="0.0" height="21.0" width="21.0" stroke="rgb(255,255,255)" stroke-opacity="1.0" fill="rgb(190,174,212)" fill-opacity="1.0" stroke-width="1.5">
                  </rect>
                </g>
              </g>
            </g>
            <g transform="translate(26.9903027277341 16.05 ) ">
              <text class="legend-item" y="0.0">
                <tspan>out-of-sample</tspan>
              </text>
            </g>
          </g>
        </g>
      </g>
    </g>
    <path fill="rgb(0,0,0)" fill-opacity="0.0" stroke="rgb(71,71,71)" stroke-opacity="1.0" stroke-width="0.0" d="M0.0 0.0 L0.0 200.0 L600.0 200.0 L600.0 0.0 Z" pointer-events="none">
    </path>
  </g>
  <g id="dKPA701">
  </g>
</svg></div></div>
</div>
<p>In this case, the in-sample period runs from <span class="math notranslate nohighlight">\(t=0\)</span> to <span class="math notranslate nohighlight">\(t=4\)</span>, while the out-of-sample period runs from <span class="math notranslate nohighlight">\(t=5\)</span> to <span class="math notranslate nohighlight">\(t=9\)</span>. <span class="math notranslate nohighlight">\(T=10\)</span>.</p>
<p>Let’s see how it works with some fake data, and we’ll assume <span class="math notranslate nohighlight">\(h=3\)</span> in this case.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">string</span>

<span class="n">horizon</span> <span class="o">=</span> <span class="mi">3</span>
<span class="n">num</span> <span class="o">=</span> <span class="mi">10</span> <span class="o">+</span> <span class="n">horizon</span>

<span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span>
    <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span>
        <span class="p">[</span>
            <span class="nb">range</span><span class="p">(</span><span class="n">num</span><span class="p">),</span>
            <span class="nb">list</span><span class="p">(</span><span class="n">string</span><span class="o">.</span><span class="n">ascii_lowercase</span><span class="p">)[:</span><span class="n">num</span><span class="p">],</span>
            <span class="nb">list</span><span class="p">(</span><span class="n">string</span><span class="o">.</span><span class="n">ascii_lowercase</span><span class="p">)[</span><span class="n">num</span> <span class="p">:</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">num</span><span class="p">],</span>
        <span class="p">]</span>
    <span class="p">)</span><span class="o">.</span><span class="n">T</span><span class="p">,</span>
    <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;Time&quot;</span><span class="p">,</span> <span class="s2">&quot;y&quot;</span><span class="p">,</span> <span class="s2">&quot;x&quot;</span><span class="p">],</span>
<span class="p">)</span>
<span class="n">df</span><span class="p">[</span><span class="s2">&quot;y at t+h&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s2">&quot;y&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">shift</span><span class="p">(</span><span class="o">-</span><span class="n">horizon</span><span class="p">)</span>
<span class="n">df</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Time</th>
      <th>y</th>
      <th>x</th>
      <th>y at t+h</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>0</td>
      <td>a</td>
      <td>n</td>
      <td>d</td>
    </tr>
    <tr>
      <th>1</th>
      <td>1</td>
      <td>b</td>
      <td>o</td>
      <td>e</td>
    </tr>
    <tr>
      <th>2</th>
      <td>2</td>
      <td>c</td>
      <td>p</td>
      <td>f</td>
    </tr>
    <tr>
      <th>3</th>
      <td>3</td>
      <td>d</td>
      <td>q</td>
      <td>g</td>
    </tr>
    <tr>
      <th>4</th>
      <td>4</td>
      <td>e</td>
      <td>r</td>
      <td>h</td>
    </tr>
    <tr>
      <th>5</th>
      <td>5</td>
      <td>f</td>
      <td>s</td>
      <td>i</td>
    </tr>
    <tr>
      <th>6</th>
      <td>6</td>
      <td>g</td>
      <td>t</td>
      <td>j</td>
    </tr>
    <tr>
      <th>7</th>
      <td>7</td>
      <td>h</td>
      <td>u</td>
      <td>k</td>
    </tr>
    <tr>
      <th>8</th>
      <td>8</td>
      <td>i</td>
      <td>v</td>
      <td>l</td>
    </tr>
    <tr>
      <th>9</th>
      <td>9</td>
      <td>j</td>
      <td>w</td>
      <td>m</td>
    </tr>
    <tr>
      <th>10</th>
      <td>10</td>
      <td>k</td>
      <td>x</td>
      <td>None</td>
    </tr>
    <tr>
      <th>11</th>
      <td>11</td>
      <td>l</td>
      <td>y</td>
      <td>None</td>
    </tr>
    <tr>
      <th>12</th>
      <td>12</td>
      <td>m</td>
      <td>z</td>
      <td>None</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>What we have here is a dataset with a time index and y and x values. <span class="math notranslate nohighlight">\(y_{t+h}\)</span> has been added as a feature by shifting the <span class="math notranslate nohighlight">\(y\)</span> variable back by <span class="math notranslate nohighlight">\(h=3\)</span> steps. We’re not going to be able to predict those NaN values, so the first thing to do is to drop those variables. Second, we’ll want to add in which parts are in-sample and which are out-of-sample.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">dropna</span><span class="p">()</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
<span class="n">df</span><span class="p">[</span><span class="s2">&quot;sample&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s2">&quot;Time&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="s2">&quot;IS&quot;</span> <span class="k">if</span> <span class="nb">int</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">5</span> <span class="k">else</span> <span class="s2">&quot;OS&quot;</span><span class="p">)</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">set_index</span><span class="p">(</span><span class="s2">&quot;Time&quot;</span><span class="p">)</span>
<span class="n">df</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>y</th>
      <th>x</th>
      <th>y at t+h</th>
      <th>sample</th>
    </tr>
    <tr>
      <th>Time</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>a</td>
      <td>n</td>
      <td>d</td>
      <td>IS</td>
    </tr>
    <tr>
      <th>1</th>
      <td>b</td>
      <td>o</td>
      <td>e</td>
      <td>IS</td>
    </tr>
    <tr>
      <th>2</th>
      <td>c</td>
      <td>p</td>
      <td>f</td>
      <td>IS</td>
    </tr>
    <tr>
      <th>3</th>
      <td>d</td>
      <td>q</td>
      <td>g</td>
      <td>IS</td>
    </tr>
    <tr>
      <th>4</th>
      <td>e</td>
      <td>r</td>
      <td>h</td>
      <td>IS</td>
    </tr>
    <tr>
      <th>5</th>
      <td>f</td>
      <td>s</td>
      <td>i</td>
      <td>OS</td>
    </tr>
    <tr>
      <th>6</th>
      <td>g</td>
      <td>t</td>
      <td>j</td>
      <td>OS</td>
    </tr>
    <tr>
      <th>7</th>
      <td>h</td>
      <td>u</td>
      <td>k</td>
      <td>OS</td>
    </tr>
    <tr>
      <th>8</th>
      <td>i</td>
      <td>v</td>
      <td>l</td>
      <td>OS</td>
    </tr>
    <tr>
      <th>9</th>
      <td>j</td>
      <td>w</td>
      <td>m</td>
      <td>OS</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>Note how the sample can either be IS or OS-but not both.</p>
<p>Now, if we were doing a forecast, we’d select the IS part to do our initial model building by running something like</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">model</span> <span class="o">=</span> <span class="n">ols</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X</span><span class="o">=</span><span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">df</span><span class="p">[</span><span class="s2">&quot;sample&quot;</span><span class="p">]</span><span class="o">==</span><span class="s2">&quot;IS&quot;</span><span class="p">,</span><span class="s2">&quot;x&quot;</span><span class="p">],</span>
                <span class="n">y</span><span class="o">=</span><span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">df</span><span class="p">[</span><span class="s2">&quot;sample&quot;</span><span class="p">]</span><span class="o">==</span><span class="s2">&quot;IS&quot;</span><span class="p">,</span><span class="s2">&quot;y at t+h&quot;</span><span class="p">])</span>
</pre></div>
</div>
<p>This would then be used to predict the out of sample values:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">y_t_plus_h_os</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X</span><span class="o">=</span><span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">df</span><span class="p">[</span><span class="s2">&quot;sample&quot;</span><span class="p">]</span><span class="o">==</span><span class="s2">&quot;OS&quot;</span><span class="p">,</span><span class="s2">&quot;x&quot;</span><span class="p">])</span>
</pre></div>
</div>
<p>To know how good the estimate was, we’d then compare it with the true value. Typically, a value like the root mean square error is used for this, given by</p>
<div class="math notranslate nohighlight">
\[
{\displaystyle \operatorname {RMSE} ={\sqrt {\frac {\sum _{t=0}^{T-1}({\hat {y}}_{t+h}-y_{t+h})^{2}}{T}}}.}
\]</div>
<p>where <span class="math notranslate nohighlight">\(\hat{y}_{t+h}\)</span> is the predicted value, equivalent to the object <code class="docutils literal notranslate"><span class="pre">y_t_plus_h_os</span></code> above.</p>
<section id="an-example-two-period-forecast">
<h3>An Example Two Period Forecast<a class="headerlink" href="#an-example-two-period-forecast" title="Link to this heading">#</a></h3>
<p>Let’s see an example of this with some numerical data. Our dataframe needs to have our features, <span class="math notranslate nohighlight">\(x\)</span>, and target, <span class="math notranslate nohighlight">\(y_{t+h}\)</span>, in.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">T</span> <span class="o">=</span> <span class="mi">10</span>
<span class="n">window_size</span> <span class="o">=</span> <span class="mi">5</span>
<span class="n">horizon</span> <span class="o">=</span> <span class="mi">3</span>


<span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span>
    <span class="p">{</span>
        <span class="s2">&quot;x&quot;</span><span class="p">:</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">T</span> <span class="o">+</span> <span class="n">horizon</span><span class="p">),</span>
        <span class="s2">&quot;y&quot;</span><span class="p">:</span> <span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="n">horizon</span>
        <span class="o">+</span> <span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">window_size</span><span class="p">))</span>
        <span class="o">+</span> <span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="n">T</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="n">window_size</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">)),</span>
    <span class="p">}</span>
<span class="p">)</span>
<span class="n">df</span><span class="p">[</span><span class="s2">&quot;x&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s2">&quot;x&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">float</span><span class="p">)</span>
<span class="c1"># Bring y_{t+h} in line with feature x so that models always take data from the same row.</span>
<span class="c1"># Note that for a variable to be at t+h today, with h the horizon, we need to bring it *back* by h steps</span>
<span class="n">df</span><span class="p">[</span><span class="s2">&quot;y at t+h&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s2">&quot;y&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">shift</span><span class="p">(</span><span class="o">-</span><span class="n">horizon</span><span class="p">)</span>
<span class="c1"># drop y so that we don&#39;t accidentally put it into model as a feature by mistake</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="s2">&quot;y&quot;</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">df</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>x</th>
      <th>y at t+h</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>0.0</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>1</th>
      <td>1.0</td>
      <td>1.0</td>
    </tr>
    <tr>
      <th>2</th>
      <td>2.0</td>
      <td>2.0</td>
    </tr>
    <tr>
      <th>3</th>
      <td>3.0</td>
      <td>3.0</td>
    </tr>
    <tr>
      <th>4</th>
      <td>4.0</td>
      <td>4.0</td>
    </tr>
    <tr>
      <th>5</th>
      <td>5.0</td>
      <td>9.0</td>
    </tr>
    <tr>
      <th>6</th>
      <td>6.0</td>
      <td>8.0</td>
    </tr>
    <tr>
      <th>7</th>
      <td>7.0</td>
      <td>7.0</td>
    </tr>
    <tr>
      <th>8</th>
      <td>8.0</td>
      <td>6.0</td>
    </tr>
    <tr>
      <th>9</th>
      <td>9.0</td>
      <td>5.0</td>
    </tr>
    <tr>
      <th>10</th>
      <td>10.0</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>11</th>
      <td>11.0</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>12</th>
      <td>12.0</td>
      <td>NaN</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>As ever, it’s good to look at your data so let’s do a quick chart. Note that time and <span class="math notranslate nohighlight">\(x\)</span> have the same values here, so this is also the time series of <span class="math notranslate nohighlight">\(y_{t+h}\)</span>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df</span><span class="o">.</span><span class="n">plot</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="s2">&quot;x&quot;</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="s2">&quot;y at t+h&quot;</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/1a8fdb61aa1f2f81230edc1345364486836c54b4e87239c33dff9be5e1acc150.svg" src="_images/1a8fdb61aa1f2f81230edc1345364486836c54b4e87239c33dff9be5e1acc150.svg" />
</div>
</div>
<p>Okay, what could possibly go wrong! Let’s now do our forecasting exercise. First, we train or fit the model. Note that <em>pandas</em> indexing is <em>inclusive</em>, so we run to <code class="docutils literal notranslate"><span class="pre">window_size-1</span></code> rather than <code class="docutils literal notranslate"><span class="pre">window_size</span></code> to pick up our 5 in-sample points</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">sklearn.linear_model</span><span class="w"> </span><span class="kn">import</span> <span class="n">LinearRegression</span>

<span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">dropna</span><span class="p">()</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
<span class="n">model</span> <span class="o">=</span> <span class="n">LinearRegression</span><span class="p">(</span><span class="n">fit_intercept</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span>
    <span class="n">X</span><span class="o">=</span><span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[:</span> <span class="n">window_size</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;x&quot;</span><span class="p">]],</span> <span class="n">y</span><span class="o">=</span><span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[:</span> <span class="n">window_size</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;y at t+h&quot;</span><span class="p">]]</span>
<span class="p">)</span>
<span class="c1"># Make in-sample prediction. Note that the predictions of the model come out in</span>
<span class="c1"># an array of form [[a], [b], ...] so we flatten this to [a, b, ...]. Also, we pad</span>
<span class="c1"># the results we didn&#39;t predict with [None]</span>
<span class="n">df</span><span class="p">[</span><span class="s2">&quot;y at t+h IS&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[:</span> <span class="n">window_size</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;x&quot;</span><span class="p">]])</span><span class="o">.</span><span class="n">flatten</span><span class="p">())</span> <span class="o">+</span> <span class="p">[</span>
    <span class="kc">None</span>
<span class="p">]</span> <span class="o">*</span> <span class="p">(</span><span class="n">window_size</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>Make out of sample prediction:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df</span><span class="p">[</span><span class="s2">&quot;y at t+h OS&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="kc">None</span><span class="p">]</span> <span class="o">*</span> <span class="p">(</span><span class="n">window_size</span><span class="p">)</span> <span class="o">+</span> <span class="nb">list</span><span class="p">(</span>
    <span class="n">model</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">window_size</span><span class="p">:,</span> <span class="p">[</span><span class="s2">&quot;x&quot;</span><span class="p">]])</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>
<span class="p">)</span>
<span class="n">df</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>x</th>
      <th>y at t+h</th>
      <th>y at t+h IS</th>
      <th>y at t+h OS</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>1</th>
      <td>1.0</td>
      <td>1.0</td>
      <td>1.0</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>2</th>
      <td>2.0</td>
      <td>2.0</td>
      <td>2.0</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>3</th>
      <td>3.0</td>
      <td>3.0</td>
      <td>3.0</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>4</th>
      <td>4.0</td>
      <td>4.0</td>
      <td>4.0</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>5</th>
      <td>5.0</td>
      <td>9.0</td>
      <td>NaN</td>
      <td>5.0</td>
    </tr>
    <tr>
      <th>6</th>
      <td>6.0</td>
      <td>8.0</td>
      <td>NaN</td>
      <td>6.0</td>
    </tr>
    <tr>
      <th>7</th>
      <td>7.0</td>
      <td>7.0</td>
      <td>NaN</td>
      <td>7.0</td>
    </tr>
    <tr>
      <th>8</th>
      <td>8.0</td>
      <td>6.0</td>
      <td>NaN</td>
      <td>8.0</td>
    </tr>
    <tr>
      <th>9</th>
      <td>9.0</td>
      <td>5.0</td>
      <td>NaN</td>
      <td>9.0</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">()</span>
<span class="n">df</span><span class="o">.</span><span class="n">plot</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="s2">&quot;x&quot;</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="s2">&quot;y at t+h&quot;</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;y at t+h&quot;</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="mi">80</span><span class="p">)</span>
<span class="n">df</span><span class="o">.</span><span class="n">plot</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span>
    <span class="n">x</span><span class="o">=</span><span class="s2">&quot;x&quot;</span><span class="p">,</span>
    <span class="n">y</span><span class="o">=</span><span class="s2">&quot;y at t+h OS&quot;</span><span class="p">,</span>
    <span class="n">color</span><span class="o">=</span><span class="s2">&quot;red&quot;</span><span class="p">,</span>
    <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span>
    <span class="n">label</span><span class="o">=</span><span class="s2">&quot;y at t+h OS&quot;</span><span class="p">,</span>
    <span class="n">s</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span>
<span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;$y_{t+h}$ and $\hat</span><span class="si">{y}</span><span class="s2">_{t+h}^{\operatorname</span><span class="si">{OS}</span><span class="s2">}$&quot;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">();</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/200f22104e4ac226f8c24b51f238acf942a16437e789c62f84a7ed27b959d129.svg" src="_images/200f22104e4ac226f8c24b51f238acf942a16437e789c62f84a7ed27b959d129.svg" />
</div>
</div>
<p>Oh dear, it doesn’t look like our out-of-sample prediction did very well! Let’s see what the RMSE error is for both the in-sample and out-of-sample prediction.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">sklearn.metrics</span><span class="w"> </span><span class="kn">import</span> <span class="n">mean_squared_error</span>


<span class="k">def</span><span class="w"> </span><span class="nf">get_rmse</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">fcast_name</span><span class="p">,</span> <span class="n">target_name</span><span class="p">):</span>
    <span class="c1"># Get the index of the fcast</span>
    <span class="n">index</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">fcast_name</span><span class="p">]</span><span class="o">.</span><span class="n">dropna</span><span class="p">()</span><span class="o">.</span><span class="n">index</span>
    <span class="c1"># only compare to values of target for which we have predictions:</span>
    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span>
        <span class="n">mean_squared_error</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">index</span><span class="p">,</span> <span class="n">fcast_name</span><span class="p">],</span> <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">index</span><span class="p">,</span> <span class="n">target_name</span><span class="p">])</span>
    <span class="p">)</span>


<span class="n">is_rmse</span> <span class="o">=</span> <span class="n">get_rmse</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="s2">&quot;y at t+h IS&quot;</span><span class="p">,</span> <span class="s2">&quot;y at t+h&quot;</span><span class="p">)</span>
<span class="n">os_rmse</span> <span class="o">=</span> <span class="n">get_rmse</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="s2">&quot;y at t+h OS&quot;</span><span class="p">,</span> <span class="s2">&quot;y at t+h&quot;</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;The rmse for in-sample best predictions is </span><span class="si">{</span><span class="n">is_rmse</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;The rmse for out-of-sample best predictions is </span><span class="si">{</span><span class="n">os_rmse</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>The rmse for in-sample best predictions is 0.00
The rmse for out-of-sample best predictions is 2.83
</pre></div>
</div>
</div>
</div>
<p>In this case - unsurprisingly given the big break in the trend of the time series - even though in-sample forecast is perfect, the <em>out-of-sample</em> forecast is terrible! If you ever have a situation where the OS RMSE is <em>lower</em> than the IS RMSE, it should ring alarm bells: it suggests something has gone wrong in the code.</p>
</section>
<section id="adding-a-lag">
<h3>Adding a Lag<a class="headerlink" href="#adding-a-lag" title="Link to this heading">#</a></h3>
<p>Quite frequently, you’ll want to include lags in your forecast specification. Let’s see how to do that in this simple, two-period forecast example.</p>
<p>Just as forecasting a variable at <span class="math notranslate nohighlight">\(t+h\)</span> means performing a <code class="docutils literal notranslate"><span class="pre">.shift(-h)</span></code> in order to bring the data together in the same row of a dataframe, so creating a feature (or regressor) that is a lag of another column will involve shifting the <em>other</em> way in time. So we’re going to use <code class="docutils literal notranslate"><span class="pre">.shift(lag)</span></code>. Let’s see it with some data:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">T</span> <span class="o">=</span> <span class="mi">10</span>
<span class="n">window_size</span> <span class="o">=</span> <span class="mi">5</span>
<span class="n">horizon</span> <span class="o">=</span> <span class="mi">3</span>


<span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span>
    <span class="p">{</span>
        <span class="s2">&quot;x&quot;</span><span class="p">:</span> <span class="nb">range</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">T</span> <span class="o">+</span> <span class="n">horizon</span><span class="p">),</span>
        <span class="s2">&quot;y&quot;</span><span class="p">:</span> <span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span> <span class="o">-</span> <span class="n">horizon</span><span class="p">,</span> <span class="n">window_size</span><span class="p">))</span>
        <span class="o">+</span> <span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="n">T</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="n">window_size</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">)),</span>
    <span class="p">}</span>
<span class="p">)</span>
<span class="n">df</span><span class="p">[</span><span class="s2">&quot;x&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s2">&quot;x&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">float</span><span class="p">)</span>
<span class="c1"># Bring y_{t+h} in line with feature x so that models always take data from the same row.</span>
<span class="c1"># Note that for a variable to be at t+h today, with h the horizon, we need to bring it *back* by h steps</span>
<span class="n">df</span><span class="p">[</span><span class="s2">&quot;y at t+h&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s2">&quot;y&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">shift</span><span class="p">(</span><span class="o">-</span><span class="n">horizon</span><span class="p">)</span>

<span class="c1"># New part: create a single lag of y</span>
<span class="n">df</span><span class="p">[</span><span class="s2">&quot;lag_y&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s2">&quot;y&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">shift</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>

<span class="n">df</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>x</th>
      <th>y</th>
      <th>y at t+h</th>
      <th>lag_y</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>-1.0</td>
      <td>-4</td>
      <td>-1.0</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>1</th>
      <td>0.0</td>
      <td>-3</td>
      <td>0.0</td>
      <td>-4.0</td>
    </tr>
    <tr>
      <th>2</th>
      <td>1.0</td>
      <td>-2</td>
      <td>1.0</td>
      <td>-3.0</td>
    </tr>
    <tr>
      <th>3</th>
      <td>2.0</td>
      <td>-1</td>
      <td>2.0</td>
      <td>-2.0</td>
    </tr>
    <tr>
      <th>4</th>
      <td>3.0</td>
      <td>0</td>
      <td>3.0</td>
      <td>-1.0</td>
    </tr>
    <tr>
      <th>5</th>
      <td>4.0</td>
      <td>1</td>
      <td>4.0</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>6</th>
      <td>5.0</td>
      <td>2</td>
      <td>9.0</td>
      <td>1.0</td>
    </tr>
    <tr>
      <th>7</th>
      <td>6.0</td>
      <td>3</td>
      <td>8.0</td>
      <td>2.0</td>
    </tr>
    <tr>
      <th>8</th>
      <td>7.0</td>
      <td>4</td>
      <td>7.0</td>
      <td>3.0</td>
    </tr>
    <tr>
      <th>9</th>
      <td>8.0</td>
      <td>9</td>
      <td>6.0</td>
      <td>4.0</td>
    </tr>
    <tr>
      <th>10</th>
      <td>9.0</td>
      <td>8</td>
      <td>5.0</td>
      <td>9.0</td>
    </tr>
    <tr>
      <th>11</th>
      <td>10.0</td>
      <td>7</td>
      <td>NaN</td>
      <td>8.0</td>
    </tr>
    <tr>
      <th>12</th>
      <td>11.0</td>
      <td>6</td>
      <td>NaN</td>
      <td>7.0</td>
    </tr>
    <tr>
      <th>13</th>
      <td>12.0</td>
      <td>5</td>
      <td>NaN</td>
      <td>6.0</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>Now you can see that there’s an extra row we can’t use (because we don’t have the data for a lag of y from that time). As before, in practice, we’d drop y so that we didn’t use it by mistake and also drop the top and tail rows that have nans in. We also reset the index to ensure it starts at 0 (by dropping the first row, we would otherwise lose the first index of zero):</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="s2">&quot;y&quot;</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">dropna</span><span class="p">()</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">df</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>x</th>
      <th>y at t+h</th>
      <th>lag_y</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>0.0</td>
      <td>0.0</td>
      <td>-4.0</td>
    </tr>
    <tr>
      <th>1</th>
      <td>1.0</td>
      <td>1.0</td>
      <td>-3.0</td>
    </tr>
    <tr>
      <th>2</th>
      <td>2.0</td>
      <td>2.0</td>
      <td>-2.0</td>
    </tr>
    <tr>
      <th>3</th>
      <td>3.0</td>
      <td>3.0</td>
      <td>-1.0</td>
    </tr>
    <tr>
      <th>4</th>
      <td>4.0</td>
      <td>4.0</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>5</th>
      <td>5.0</td>
      <td>9.0</td>
      <td>1.0</td>
    </tr>
    <tr>
      <th>6</th>
      <td>6.0</td>
      <td>8.0</td>
      <td>2.0</td>
    </tr>
    <tr>
      <th>7</th>
      <td>7.0</td>
      <td>7.0</td>
      <td>3.0</td>
    </tr>
    <tr>
      <th>8</th>
      <td>8.0</td>
      <td>6.0</td>
      <td>4.0</td>
    </tr>
    <tr>
      <th>9</th>
      <td>9.0</td>
      <td>5.0</td>
      <td>9.0</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
</section>
</section>
<section id="expanding-window">
<h2>Expanding Window<a class="headerlink" href="#expanding-window" title="Link to this heading">#</a></h2>
<p>In an expanding window forecast exercise, multiple forecasts are made. In each, the in-sample period grows over time. Necessarily (given finite data), the out-of-sample period shrinks over time. The overall out-of-sample forecast is given by the unique union of the out-of-sample forecasts that are trained on the most information. To make this clear, let’s first define it mathematically and then with a diagram.</p>
<p>We index the different forecasts (synonymous with different models <span class="math notranslate nohighlight">\(f_\mu\)</span>) by <span class="math notranslate nohighlight">\(\mu\)</span>. The starting size of the window will be <span class="math notranslate nohighlight">\(s + \alpha\)</span> where <span class="math notranslate nohighlight">\(s\)</span> is the step size and <span class="math notranslate nohighlight">\(\alpha\)</span> is a parameter that adjusts window size. For arbitrary <span class="math notranslate nohighlight">\(z_t\)</span>, the <span class="math notranslate nohighlight">\(\mu\)</span>th in-sample slice of time series data is:</p>
<div class="math notranslate nohighlight">
\[
I^e_{\mu}(\vec{z}) = \left\{z_t  \right\}_{t=0}^{t=\mu\cdot s + \alpha -1}
\]</div>
<p>Applied to the features, this is the slice that will be used to train (aka fit) model <span class="math notranslate nohighlight">\(f_\mu\)</span>.</p>
<p>Likewise, the out-of-sample set is:</p>
<div class="math notranslate nohighlight">
\[
O^e_{\mu}(\vec{z}) = \left\{z_t \right\}^{t=T-1}_{t=\mu\cdot s + \alpha}
\]</div>
<p>We can visualise this like so:</p>
<div class="cell tag_remove-input docutils container">
</div>
<div class="cell tag_remove-input docutils container">
<div class="cell_output docutils container">
<div class="output text_html"><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" display="block" class="plt-container" width="600.0" height="400.0">
  <style type="text/css">
  .plt-container {
   font-family: Lucida Grande, sans-serif;
   user-select: none;
   -webkit-user-select: none;
   -moz-user-select: none;
   -ms-user-select: none;
}
text {
   text-rendering: optimizeLegibility;
}
#pmT09i2 .plot-title {
fill: #474747;
font-weight: normal;
   font-style: normal;font-family: Lucida Grande, sans-serif;
font-size: 16.0px;

}
#pmT09i2 .plot-subtitle {
fill: #474747;
font-weight: normal;
   font-style: normal;font-family: Lucida Grande, sans-serif;
font-size: 15.0px;

}
#pmT09i2 .plot-caption {
fill: #474747;
font-weight: normal;
   font-style: normal;font-family: Lucida Grande, sans-serif;
font-size: 13.0px;

}
#pmT09i2 .hyperlink-element {
fill: #118ed8;
font-weight: normal;
   font-style: normal;
}
#pmT09i2 .legend-title {
fill: #474747;
font-weight: normal;
   font-style: normal;font-family: Lucida Grande, sans-serif;
font-size: 15.0px;

}
#pmT09i2 .legend-item {
fill: #474747;
font-weight: normal;
   font-style: normal;font-family: Lucida Grande, sans-serif;
font-size: 13.0px;

}
#pmT09i2 .axis-title-x {
fill: #474747;
font-weight: normal;
   font-style: normal;font-family: Lucida Grande, sans-serif;
font-size: 15.0px;

}
#pmT09i2 .axis-text-x {
fill: #474747;
font-weight: normal;
   font-style: normal;font-family: Lucida Grande, sans-serif;
font-size: 13.0px;

}
#dtMxlCA .axis-tooltip-text-x {
fill: #ffffff;
font-weight: normal;
   font-style: normal;font-family: Lucida Grande, sans-serif;
font-size: 13.0px;

}
#pmT09i2 .axis-title-y {
fill: #474747;
font-weight: normal;
   font-style: normal;font-family: Lucida Grande, sans-serif;
font-size: 15.0px;

}
#pmT09i2 .axis-text-y {
fill: #474747;
font-weight: normal;
   font-style: normal;font-family: Lucida Grande, sans-serif;
font-size: 13.0px;

}
#dtMxlCA .axis-tooltip-text-y {
fill: #ffffff;
font-weight: normal;
   font-style: normal;font-family: Lucida Grande, sans-serif;
font-size: 13.0px;

}
#pmT09i2 .facet-strip-text-x {
fill: #474747;
font-weight: normal;
   font-style: normal;font-family: Lucida Grande, sans-serif;
font-size: 13.0px;

}
#pmT09i2 .facet-strip-text-y {
fill: #474747;
font-weight: normal;
   font-style: normal;font-family: Lucida Grande, sans-serif;
font-size: 13.0px;

}
#dtMxlCA .tooltip-text {
fill: #474747;
font-weight: normal;
   font-style: normal;font-family: Lucida Grande, sans-serif;
font-size: 13.0px;

}
#dtMxlCA .tooltip-title {
fill: #474747;
font-weight: bold;
   font-style: normal;font-family: Lucida Grande, sans-serif;
font-size: 13.0px;

}
#dtMxlCA .tooltip-label {
fill: #474747;
font-weight: bold;
   font-style: normal;font-family: Lucida Grande, sans-serif;
font-size: 13.0px;

}

  </style>
  <g id="pmT09i2">
    <path fill-rule="evenodd" fill="rgb(255,255,255)" fill-opacity="1.0" d="M0.0 0.0 L0.0 400.0 L600.0 400.0 L600.0 0.0 Z">
    </path>
    <g transform="translate(29.5 6.5 ) ">
      <g>
        <g transform="translate(13.980605455468202 0.0 ) ">
          <g>
            <line x1="34.8528050578251" y1="0.0" x2="34.8528050578251" y2="341.0" stroke="rgb(233,233,233)" stroke-opacity="1.0" stroke-width="1.0" fill="none">
            </line>
            <line x1="71.73408025129082" y1="0.0" x2="71.73408025129082" y2="341.0" stroke="rgb(233,233,233)" stroke-opacity="1.0" stroke-width="1.0" fill="none">
            </line>
            <line x1="108.61535544475655" y1="0.0" x2="108.61535544475655" y2="341.0" stroke="rgb(233,233,233)" stroke-opacity="1.0" stroke-width="1.0" fill="none">
            </line>
            <line x1="145.49663063822226" y1="0.0" x2="145.49663063822226" y2="341.0" stroke="rgb(233,233,233)" stroke-opacity="1.0" stroke-width="1.0" fill="none">
            </line>
            <line x1="182.37790583168797" y1="0.0" x2="182.37790583168797" y2="341.0" stroke="rgb(233,233,233)" stroke-opacity="1.0" stroke-width="1.0" fill="none">
            </line>
            <line x1="219.25918102515368" y1="0.0" x2="219.25918102515368" y2="341.0" stroke="rgb(233,233,233)" stroke-opacity="1.0" stroke-width="1.0" fill="none">
            </line>
            <line x1="256.1404562186194" y1="0.0" x2="256.1404562186194" y2="341.0" stroke="rgb(233,233,233)" stroke-opacity="1.0" stroke-width="1.0" fill="none">
            </line>
            <line x1="293.0217314120851" y1="0.0" x2="293.0217314120851" y2="341.0" stroke="rgb(233,233,233)" stroke-opacity="1.0" stroke-width="1.0" fill="none">
            </line>
            <line x1="329.90300660555084" y1="0.0" x2="329.90300660555084" y2="341.0" stroke="rgb(233,233,233)" stroke-opacity="1.0" stroke-width="1.0" fill="none">
            </line>
            <line x1="366.7842817990166" y1="0.0" x2="366.7842817990166" y2="341.0" stroke="rgb(233,233,233)" stroke-opacity="1.0" stroke-width="1.0" fill="none">
            </line>
          </g>
        </g>
        <g transform="translate(13.980605455468202 0.0 ) ">
          <g>
            <line x1="0.0" y1="318.7608695652174" x2="401.6370868568416" y2="318.7608695652174" stroke="rgb(233,233,233)" stroke-opacity="1.0" stroke-width="1.0" fill="none">
            </line>
            <line x1="0.0" y1="269.34057971014494" x2="401.6370868568416" y2="269.34057971014494" stroke="rgb(233,233,233)" stroke-opacity="1.0" stroke-width="1.0" fill="none">
            </line>
            <line x1="0.0" y1="219.92028985507244" x2="401.6370868568416" y2="219.92028985507244" stroke="rgb(233,233,233)" stroke-opacity="1.0" stroke-width="1.0" fill="none">
            </line>
            <line x1="0.0" y1="170.5" x2="401.6370868568416" y2="170.5" stroke="rgb(233,233,233)" stroke-opacity="1.0" stroke-width="1.0" fill="none">
            </line>
            <line x1="0.0" y1="121.07971014492753" x2="401.6370868568416" y2="121.07971014492753" stroke="rgb(233,233,233)" stroke-opacity="1.0" stroke-width="1.0" fill="none">
            </line>
            <line x1="0.0" y1="71.65942028985506" x2="401.6370868568416" y2="71.65942028985506" stroke="rgb(233,233,233)" stroke-opacity="1.0" stroke-width="1.0" fill="none">
            </line>
            <line x1="0.0" y1="22.239130434782624" x2="401.6370868568416" y2="22.239130434782624" stroke="rgb(233,233,233)" stroke-opacity="1.0" stroke-width="1.0" fill="none">
            </line>
          </g>
        </g>
      </g>
      <g clip-path="url(#ciyNahd)" clip-bounds-jfx="[rect (13.980605455468202, 0.0), (401.6370868568416, 341.0)]">
        <g transform="translate(13.980605455468202 0.0 ) ">
          <g>
            <g>
              <g>
                <g >
                  <rect fill="#7fc97f" stroke="#ffffff" stroke-width="0.0" x="18.256231220765528" y="306.40579710144925" height="24.71014492753625" width="33.193147674119146" />
                  <rect fill="#7fc97f" stroke="#ffffff" stroke-width="0.0" x="55.13750641423125" y="306.40579710144925" height="24.71014492753625" width="33.19314767411915" />
                  <rect fill="#7fc97f" stroke="#ffffff" stroke-width="0.0" x="92.01878160769697" y="306.40579710144925" height="24.71014492753625" width="33.193147674119146" />
                  <rect fill="#7fc97f" stroke="#ffffff" stroke-width="0.0" x="18.256231220765528" y="256.9855072463768" height="24.71014492753619" width="33.193147674119146" />
                  <rect fill="#7fc97f" stroke="#ffffff" stroke-width="0.0" x="55.13750641423125" y="256.9855072463768" height="24.71014492753619" width="33.19314767411915" />
                  <rect fill="#7fc97f" stroke="#ffffff" stroke-width="0.0" x="92.01878160769697" y="256.9855072463768" height="24.71014492753619" width="33.193147674119146" />
                  <rect fill="#7fc97f" stroke="#ffffff" stroke-width="0.0" x="128.9000568011627" y="256.9855072463768" height="24.71014492753619" width="33.19314767411913" />
                  <rect fill="#7fc97f" stroke="#ffffff" stroke-width="0.0" x="18.256231220765528" y="207.56521739130434" height="24.71014492753622" width="33.193147674119146" />
                  <rect fill="#7fc97f" stroke="#ffffff" stroke-width="0.0" x="55.13750641423125" y="207.56521739130434" height="24.71014492753622" width="33.19314767411915" />
                  <rect fill="#7fc97f" stroke="#ffffff" stroke-width="0.0" x="92.01878160769697" y="207.56521739130434" height="24.71014492753622" width="33.193147674119146" />
                  <rect fill="#7fc97f" stroke="#ffffff" stroke-width="0.0" x="128.9000568011627" y="207.56521739130434" height="24.71014492753622" width="33.19314767411913" />
                  <rect fill="#7fc97f" stroke="#ffffff" stroke-width="0.0" x="165.7813319946284" y="207.56521739130434" height="24.71014492753622" width="33.19314767411913" />
                  <rect fill="#7fc97f" stroke="#ffffff" stroke-width="0.0" x="18.256231220765528" y="158.14492753623188" height="24.71014492753622" width="33.193147674119146" />
                  <rect fill="#7fc97f" stroke="#ffffff" stroke-width="0.0" x="55.13750641423125" y="158.14492753623188" height="24.71014492753622" width="33.19314767411915" />
                  <rect fill="#7fc97f" stroke="#ffffff" stroke-width="0.0" x="92.01878160769697" y="158.14492753623188" height="24.71014492753622" width="33.193147674119146" />
                  <rect fill="#7fc97f" stroke="#ffffff" stroke-width="0.0" x="128.9000568011627" y="158.14492753623188" height="24.71014492753622" width="33.19314767411913" />
                  <rect fill="#7fc97f" stroke="#ffffff" stroke-width="0.0" x="165.7813319946284" y="158.14492753623188" height="24.71014492753622" width="33.19314767411913" />
                  <rect fill="#7fc97f" stroke="#ffffff" stroke-width="0.0" x="202.6626071880941" y="158.14492753623188" height="24.71014492753622" width="33.19314767411916" />
                  <rect fill="#7fc97f" stroke="#ffffff" stroke-width="0.0" x="18.256231220765528" y="108.72463768115941" height="24.71014492753625" width="33.193147674119146" />
                  <rect fill="#7fc97f" stroke="#ffffff" stroke-width="0.0" x="55.13750641423125" y="108.72463768115941" height="24.71014492753625" width="33.19314767411915" />
                  <rect fill="#7fc97f" stroke="#ffffff" stroke-width="0.0" x="92.01878160769697" y="108.72463768115941" height="24.71014492753625" width="33.193147674119146" />
                  <rect fill="#7fc97f" stroke="#ffffff" stroke-width="0.0" x="128.9000568011627" y="108.72463768115941" height="24.71014492753625" width="33.19314767411913" />
                  <rect fill="#7fc97f" stroke="#ffffff" stroke-width="0.0" x="165.7813319946284" y="108.72463768115941" height="24.71014492753625" width="33.19314767411913" />
                  <rect fill="#7fc97f" stroke="#ffffff" stroke-width="0.0" x="202.6626071880941" y="108.72463768115941" height="24.71014492753625" width="33.19314767411916" />
                  <rect fill="#7fc97f" stroke="#ffffff" stroke-width="0.0" x="239.54388238155983" y="108.72463768115941" height="24.71014492753625" width="33.19314767411916" />
                  <rect fill="#7fc97f" stroke="#ffffff" stroke-width="0.0" x="18.256231220765528" y="59.30434782608694" height="24.71014492753625" width="33.193147674119146" />
                  <rect fill="#7fc97f" stroke="#ffffff" stroke-width="0.0" x="55.13750641423125" y="59.30434782608694" height="24.71014492753625" width="33.19314767411915" />
                  <rect fill="#7fc97f" stroke="#ffffff" stroke-width="0.0" x="92.01878160769697" y="59.30434782608694" height="24.71014492753625" width="33.193147674119146" />
                  <rect fill="#7fc97f" stroke="#ffffff" stroke-width="0.0" x="128.9000568011627" y="59.30434782608694" height="24.71014492753625" width="33.19314767411913" />
                  <rect fill="#7fc97f" stroke="#ffffff" stroke-width="0.0" x="165.7813319946284" y="59.30434782608694" height="24.71014492753625" width="33.19314767411913" />
                  <rect fill="#7fc97f" stroke="#ffffff" stroke-width="0.0" x="202.6626071880941" y="59.30434782608694" height="24.71014492753625" width="33.19314767411916" />
                  <rect fill="#7fc97f" stroke="#ffffff" stroke-width="0.0" x="239.54388238155983" y="59.30434782608694" height="24.71014492753625" width="33.19314767411916" />
                  <rect fill="#7fc97f" stroke="#ffffff" stroke-width="0.0" x="276.42515757502554" y="59.30434782608694" height="24.71014492753625" width="33.19314767411919" />
                  <rect fill="#7fc97f" stroke="#ffffff" stroke-width="0.0" x="18.256231220765528" y="9.8840579710145" height="24.71014492753625" width="33.193147674119146" />
                  <rect fill="#7fc97f" stroke="#ffffff" stroke-width="0.0" x="55.13750641423125" y="9.8840579710145" height="24.71014492753625" width="33.19314767411915" />
                  <rect fill="#7fc97f" stroke="#ffffff" stroke-width="0.0" x="92.01878160769697" y="9.8840579710145" height="24.71014492753625" width="33.193147674119146" />
                  <rect fill="#7fc97f" stroke="#ffffff" stroke-width="0.0" x="128.9000568011627" y="9.8840579710145" height="24.71014492753625" width="33.19314767411913" />
                  <rect fill="#7fc97f" stroke="#ffffff" stroke-width="0.0" x="165.7813319946284" y="9.8840579710145" height="24.71014492753625" width="33.19314767411913" />
                  <rect fill="#7fc97f" stroke="#ffffff" stroke-width="0.0" x="202.6626071880941" y="9.8840579710145" height="24.71014492753625" width="33.19314767411916" />
                  <rect fill="#7fc97f" stroke="#ffffff" stroke-width="0.0" x="239.54388238155983" y="9.8840579710145" height="24.71014492753625" width="33.19314767411916" />
                  <rect fill="#7fc97f" stroke="#ffffff" stroke-width="0.0" x="276.42515757502554" y="9.8840579710145" height="24.71014492753625" width="33.19314767411919" />
                  <rect fill="#7fc97f" stroke="#ffffff" stroke-width="0.0" x="313.3064327684913" y="9.8840579710145" height="24.71014492753625" width="33.19314767411913" />
                  <rect fill="#beaed4" stroke="#ffffff" stroke-width="0.0" x="128.9000568011627" y="306.40579710144925" height="24.71014492753625" width="33.19314767411913" />
                  <rect fill="#beaed4" stroke="#ffffff" stroke-width="0.0" x="165.7813319946284" y="306.40579710144925" height="24.71014492753625" width="33.19314767411913" />
                  <rect fill="#beaed4" stroke="#ffffff" stroke-width="0.0" x="202.6626071880941" y="306.40579710144925" height="24.71014492753625" width="33.19314767411916" />
                  <rect fill="#beaed4" stroke="#ffffff" stroke-width="0.0" x="239.54388238155983" y="306.40579710144925" height="24.71014492753625" width="33.19314767411916" />
                  <rect fill="#beaed4" stroke="#ffffff" stroke-width="0.0" x="276.42515757502554" y="306.40579710144925" height="24.71014492753625" width="33.19314767411919" />
                  <rect fill="#beaed4" stroke="#ffffff" stroke-width="0.0" x="313.3064327684913" y="306.40579710144925" height="24.71014492753625" width="33.19314767411913" />
                  <rect fill="#beaed4" stroke="#ffffff" stroke-width="0.0" x="350.187707961957" y="306.40579710144925" height="24.71014492753625" width="33.19314767411913" />
                  <rect fill="#beaed4" stroke="#ffffff" stroke-width="0.0" x="165.7813319946284" y="256.9855072463768" height="24.71014492753619" width="33.19314767411913" />
                  <rect fill="#beaed4" stroke="#ffffff" stroke-width="0.0" x="202.6626071880941" y="256.9855072463768" height="24.71014492753619" width="33.19314767411916" />
                  <rect fill="#beaed4" stroke="#ffffff" stroke-width="0.0" x="239.54388238155983" y="256.9855072463768" height="24.71014492753619" width="33.19314767411916" />
                  <rect fill="#beaed4" stroke="#ffffff" stroke-width="0.0" x="276.42515757502554" y="256.9855072463768" height="24.71014492753619" width="33.19314767411919" />
                  <rect fill="#beaed4" stroke="#ffffff" stroke-width="0.0" x="313.3064327684913" y="256.9855072463768" height="24.71014492753619" width="33.19314767411913" />
                  <rect fill="#beaed4" stroke="#ffffff" stroke-width="0.0" x="350.187707961957" y="256.9855072463768" height="24.71014492753619" width="33.19314767411913" />
                  <rect fill="#beaed4" stroke="#ffffff" stroke-width="0.0" x="202.6626071880941" y="207.56521739130434" height="24.71014492753622" width="33.19314767411916" />
                  <rect fill="#beaed4" stroke="#ffffff" stroke-width="0.0" x="239.54388238155983" y="207.56521739130434" height="24.71014492753622" width="33.19314767411916" />
                  <rect fill="#beaed4" stroke="#ffffff" stroke-width="0.0" x="276.42515757502554" y="207.56521739130434" height="24.71014492753622" width="33.19314767411919" />
                  <rect fill="#beaed4" stroke="#ffffff" stroke-width="0.0" x="313.3064327684913" y="207.56521739130434" height="24.71014492753622" width="33.19314767411913" />
                  <rect fill="#beaed4" stroke="#ffffff" stroke-width="0.0" x="350.187707961957" y="207.56521739130434" height="24.71014492753622" width="33.19314767411913" />
                  <rect fill="#beaed4" stroke="#ffffff" stroke-width="0.0" x="239.54388238155983" y="158.14492753623188" height="24.71014492753622" width="33.19314767411916" />
                  <rect fill="#beaed4" stroke="#ffffff" stroke-width="0.0" x="276.42515757502554" y="158.14492753623188" height="24.71014492753622" width="33.19314767411919" />
                  <rect fill="#beaed4" stroke="#ffffff" stroke-width="0.0" x="313.3064327684913" y="158.14492753623188" height="24.71014492753622" width="33.19314767411913" />
                  <rect fill="#beaed4" stroke="#ffffff" stroke-width="0.0" x="350.187707961957" y="158.14492753623188" height="24.71014492753622" width="33.19314767411913" />
                  <rect fill="#beaed4" stroke="#ffffff" stroke-width="0.0" x="276.42515757502554" y="108.72463768115941" height="24.71014492753625" width="33.19314767411919" />
                  <rect fill="#beaed4" stroke="#ffffff" stroke-width="0.0" x="313.3064327684913" y="108.72463768115941" height="24.71014492753625" width="33.19314767411913" />
                  <rect fill="#beaed4" stroke="#ffffff" stroke-width="0.0" x="350.187707961957" y="108.72463768115941" height="24.71014492753625" width="33.19314767411913" />
                  <rect fill="#beaed4" stroke="#ffffff" stroke-width="0.0" x="313.3064327684913" y="59.30434782608694" height="24.71014492753625" width="33.19314767411913" />
                  <rect fill="#beaed4" stroke="#ffffff" stroke-width="0.0" x="350.187707961957" y="59.30434782608694" height="24.71014492753625" width="33.19314767411913" />
                  <rect fill="#beaed4" stroke="#ffffff" stroke-width="0.0" x="350.187707961957" y="9.8840579710145" height="24.71014492753625" width="33.19314767411913" />
                </g>
              </g>
            </g>
          </g>
        </g>
        <defs>
          <clipPath id="ciyNahd">
            <rect x="13.980605455468202" y="0.0" width="401.6370868568416" height="341.0">
            </rect>
          </clipPath>
        </defs>
      </g>
      <g>
        <g transform="translate(13.980605455468202 341.0 ) ">
          <g transform="translate(34.8528050578251 0.0 ) ">
            <line stroke-width="1.0" stroke="rgb(71,71,71)" stroke-opacity="1.0" x2="0.0" y2="4.0">
            </line>
            <g transform="translate(0.0 7.0 ) ">
              <text class="axis-text-x" text-anchor="middle" dy="0.7em" y="0.0">
                <tspan>0</tspan>
              </text>
            </g>
          </g>
          <g transform="translate(71.73408025129082 0.0 ) ">
            <line stroke-width="1.0" stroke="rgb(71,71,71)" stroke-opacity="1.0" x2="0.0" y2="4.0">
            </line>
            <g transform="translate(0.0 7.0 ) ">
              <text class="axis-text-x" text-anchor="middle" dy="0.7em" y="0.0">
                <tspan>1</tspan>
              </text>
            </g>
          </g>
          <g transform="translate(108.61535544475655 0.0 ) ">
            <line stroke-width="1.0" stroke="rgb(71,71,71)" stroke-opacity="1.0" x2="0.0" y2="4.0">
            </line>
            <g transform="translate(0.0 7.0 ) ">
              <text class="axis-text-x" text-anchor="middle" dy="0.7em" y="0.0">
                <tspan>2</tspan>
              </text>
            </g>
          </g>
          <g transform="translate(145.49663063822226 0.0 ) ">
            <line stroke-width="1.0" stroke="rgb(71,71,71)" stroke-opacity="1.0" x2="0.0" y2="4.0">
            </line>
            <g transform="translate(0.0 7.0 ) ">
              <text class="axis-text-x" text-anchor="middle" dy="0.7em" y="0.0">
                <tspan>3</tspan>
              </text>
            </g>
          </g>
          <g transform="translate(182.37790583168797 0.0 ) ">
            <line stroke-width="1.0" stroke="rgb(71,71,71)" stroke-opacity="1.0" x2="0.0" y2="4.0">
            </line>
            <g transform="translate(0.0 7.0 ) ">
              <text class="axis-text-x" text-anchor="middle" dy="0.7em" y="0.0">
                <tspan>4</tspan>
              </text>
            </g>
          </g>
          <g transform="translate(219.25918102515368 0.0 ) ">
            <line stroke-width="1.0" stroke="rgb(71,71,71)" stroke-opacity="1.0" x2="0.0" y2="4.0">
            </line>
            <g transform="translate(0.0 7.0 ) ">
              <text class="axis-text-x" text-anchor="middle" dy="0.7em" y="0.0">
                <tspan>5</tspan>
              </text>
            </g>
          </g>
          <g transform="translate(256.1404562186194 0.0 ) ">
            <line stroke-width="1.0" stroke="rgb(71,71,71)" stroke-opacity="1.0" x2="0.0" y2="4.0">
            </line>
            <g transform="translate(0.0 7.0 ) ">
              <text class="axis-text-x" text-anchor="middle" dy="0.7em" y="0.0">
                <tspan>6</tspan>
              </text>
            </g>
          </g>
          <g transform="translate(293.0217314120851 0.0 ) ">
            <line stroke-width="1.0" stroke="rgb(71,71,71)" stroke-opacity="1.0" x2="0.0" y2="4.0">
            </line>
            <g transform="translate(0.0 7.0 ) ">
              <text class="axis-text-x" text-anchor="middle" dy="0.7em" y="0.0">
                <tspan>7</tspan>
              </text>
            </g>
          </g>
          <g transform="translate(329.90300660555084 0.0 ) ">
            <line stroke-width="1.0" stroke="rgb(71,71,71)" stroke-opacity="1.0" x2="0.0" y2="4.0">
            </line>
            <g transform="translate(0.0 7.0 ) ">
              <text class="axis-text-x" text-anchor="middle" dy="0.7em" y="0.0">
                <tspan>8</tspan>
              </text>
            </g>
          </g>
          <g transform="translate(366.7842817990166 0.0 ) ">
            <line stroke-width="1.0" stroke="rgb(71,71,71)" stroke-opacity="1.0" x2="0.0" y2="4.0">
            </line>
            <g transform="translate(0.0 7.0 ) ">
              <text class="axis-text-x" text-anchor="middle" dy="0.7em" y="0.0">
                <tspan>9</tspan>
              </text>
            </g>
          </g>
          <line x1="0.0" y1="0.0" x2="401.6370868568416" y2="0.0" stroke-width="1.0" stroke="rgb(71,71,71)" stroke-opacity="1.0">
          </line>
        </g>
        <g transform="translate(13.980605455468202 0.0 ) ">
          <g transform="translate(0.0 318.7608695652174 ) ">
            <g transform="translate(-6.990302727734101 0.0 ) ">
              <text class="axis-text-y" text-anchor="middle" dy="0.35em" y="0.0">
                <tspan>1</tspan>
              </text>
            </g>
          </g>
          <g transform="translate(0.0 269.34057971014494 ) ">
            <g transform="translate(-6.990302727734101 0.0 ) ">
              <text class="axis-text-y" text-anchor="middle" dy="0.35em" y="0.0">
                <tspan>2</tspan>
              </text>
            </g>
          </g>
          <g transform="translate(0.0 219.92028985507244 ) ">
            <g transform="translate(-6.990302727734101 0.0 ) ">
              <text class="axis-text-y" text-anchor="middle" dy="0.35em" y="0.0">
                <tspan>3</tspan>
              </text>
            </g>
          </g>
          <g transform="translate(0.0 170.5 ) ">
            <g transform="translate(-6.990302727734101 0.0 ) ">
              <text class="axis-text-y" text-anchor="middle" dy="0.35em" y="0.0">
                <tspan>4</tspan>
              </text>
            </g>
          </g>
          <g transform="translate(0.0 121.07971014492753 ) ">
            <g transform="translate(-6.990302727734101 0.0 ) ">
              <text class="axis-text-y" text-anchor="middle" dy="0.35em" y="0.0">
                <tspan>5</tspan>
              </text>
            </g>
          </g>
          <g transform="translate(0.0 71.65942028985506 ) ">
            <g transform="translate(-6.990302727734101 0.0 ) ">
              <text class="axis-text-y" text-anchor="middle" dy="0.35em" y="0.0">
                <tspan>6</tspan>
              </text>
            </g>
          </g>
          <g transform="translate(0.0 22.239130434782624 ) ">
            <g transform="translate(-6.990302727734101 0.0 ) ">
              <text class="axis-text-y" text-anchor="middle" dy="0.35em" y="0.0">
                <tspan>7</tspan>
              </text>
            </g>
          </g>
        </g>
      </g>
    </g>
    <g transform="translate(16.0 177.0 ) rotate(-90.0 ) ">
      <text class="axis-title-y" y="0.0" text-anchor="middle">
        <tspan>μ</tspan>
      </text>
    </g>
    <g transform="translate(244.29914888388902 393.0 ) ">
      <text class="axis-title-x" y="0.0" text-anchor="middle">
        <tspan>t</tspan>
      </text>
    </g>
    <g transform="translate(456.6176923123098 137.75 ) ">
      <rect x="0.0" y="0.0" height="78.5" width="143.38230768769014" stroke="rgb(71,71,71)" stroke-opacity="1.0" stroke-width="0.0" fill="rgb(255,255,255)" fill-opacity="1.0">
      </rect>
      <g transform="translate(5.0 5.0 ) ">
        <g transform="translate(0.0 12.0 ) ">
          <text class="legend-title" y="0.0">
            <tspan>sample</tspan>
          </text>
        </g>
        <g transform="translate(0.0 22.5 ) ">
          <g transform="">
            <g>
              <g transform="translate(1.0 1.0 ) ">
                <g>
                  <rect x="0.0" y="0.0" height="21.0" width="21.0" stroke="rgb(255,255,255)" stroke-opacity="1.0" fill="rgb(127,201,127)" fill-opacity="1.0" stroke-width="1.5">
                  </rect>
                </g>
              </g>
            </g>
            <g transform="translate(26.9903027277341 16.05 ) ">
              <text class="legend-item" y="0.0">
                <tspan>in-sample</tspan>
              </text>
            </g>
          </g>
          <g transform="translate(0.0 23.0 ) ">
            <g>
              <g transform="translate(1.0 1.0 ) ">
                <g>
                  <rect x="0.0" y="0.0" height="21.0" width="21.0" stroke="rgb(255,255,255)" stroke-opacity="1.0" fill="rgb(190,174,212)" fill-opacity="1.0" stroke-width="1.5">
                  </rect>
                </g>
              </g>
            </g>
            <g transform="translate(26.9903027277341 16.05 ) ">
              <text class="legend-item" y="0.0">
                <tspan>out-of-sample</tspan>
              </text>
            </g>
          </g>
        </g>
      </g>
    </g>
    <path fill="rgb(0,0,0)" fill-opacity="0.0" stroke="rgb(71,71,71)" stroke-opacity="1.0" stroke-width="0.0" d="M0.0 0.0 L0.0 400.0 L600.0 400.0 L600.0 0.0 Z" pointer-events="none">
    </path>
  </g>
  <g id="dtMxlCA">
  </g>
</svg></div></div>
</div>
<p>Note that in-sample and out-of-sample never overlap in time for the same value of <span class="math notranslate nohighlight">\(\mu\)</span>. This is important because it helps keep our out-of-sample period out-of-sample. We do not want a situation where we <em>think</em> we are performing an out-of-sample forecast but actually the model was trained on some of the supposedly out-of-sample data.</p>
<section id="the-likely-best-possible-expanding-window-forecast">
<h3>The Likely Best Possible Expanding Window Forecast<a class="headerlink" href="#the-likely-best-possible-expanding-window-forecast" title="Link to this heading">#</a></h3>
<p>When we are assessing the potential of a model, we want to know i) how it would perform in practice and ii) that we are testing the best version of it possible. To address both of these points, we need to make a choice from the possible out-of-sample predictions because we have several for the same value of <span class="math notranslate nohighlight">\(t\)</span>:</p>
<ul class="simple">
<li><p><span class="math notranslate nohighlight">\(|\mu|\)</span> out-of-sample prediction models for <span class="math notranslate nohighlight">\(t=T-1\)</span></p></li>
<li><p><span class="math notranslate nohighlight">\(|\mu|-1\)</span> out-of-sample prediction models for <span class="math notranslate nohighlight">\(t=T-2\)</span></p></li>
<li><p>and so on…</p></li>
</ul>
<p>To choose which of our out-of-sample predictions when we have multiple ones to choose from, we create the <em>union</em> of step ahead out-of-sample forecasts. Step ahead because that’s what will likely be the best forecast (as opposed to many steps ahead) while still being out-of-sample. Because there are no <em>guarantees</em> which out-of-sample forecast will be best, it might be more accurate to call this the <em>preferred</em> or <em>one-step ahead</em> out-of-sample expanding forecast. For each possible value of <span class="math notranslate nohighlight">\(t\)</span>, this is the out-of-sample prediction with the highest possible value of <span class="math notranslate nohighlight">\(\mu\)</span>:</p>
<div class="math notranslate nohighlight">
\[
\mathcal{O}^{e} = \bigcup_\mu  \bigg\{ f_\mu\left(O_\mu^e(X)\right) \bigg\}_{t=\mu s+ \alpha }^{t=(\mu+1)s -1+ \alpha}
\]</div>
<p>in the diagram above, it’s the longest diagonal of out-of-sample predictions. Equivalently, the out-of-sample prediction set is composed of the first step of each test set indexed by <span class="math notranslate nohighlight">\(\mu\)</span>. In each case, these out-of-sample predictions are likely to be better than ones for other values of <span class="math notranslate nohighlight">\(\mu\)</span> because they are trained on models that are closer in time to the value that is being predicted.</p>
<p>Let’s work this out using code too. First, we define a function that, given a data frame with a time index as defined earlier, can return the out-of-sample rows. We know this ranges from <span class="math notranslate nohighlight">\(\mu \cdot s + \alpha\)</span> to <span class="math notranslate nohighlight">\(T-1\)</span> (inclusive), so will become <code class="docutils literal notranslate"><span class="pre">range(mu</span> <span class="pre">*</span> <span class="pre">s</span> <span class="pre">+</span> <span class="pre">alpha,</span> <span class="pre">T,</span> <span class="pre">step_size)</span></code> inside the function:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">step_size</span> <span class="o">=</span> <span class="mi">1</span>
<span class="n">alpha</span> <span class="o">=</span> <span class="mi">2</span>
<span class="n">window_size</span> <span class="o">=</span> <span class="n">alpha</span> <span class="o">+</span> <span class="n">step_size</span>
<span class="n">T</span> <span class="o">=</span> <span class="mi">10</span>
<span class="n">max_mu</span> <span class="o">=</span> <span class="nb">int</span><span class="p">((</span><span class="n">T</span> <span class="o">-</span> <span class="mi">1</span> <span class="o">+</span> <span class="mi">1</span> <span class="o">-</span> <span class="n">alpha</span><span class="p">)</span> <span class="o">/</span> <span class="n">step_size</span><span class="p">)</span>


<span class="k">def</span><span class="w"> </span><span class="nf">os_sample_block_e</span><span class="p">(</span><span class="n">mu</span><span class="p">,</span> <span class="n">step_size</span><span class="p">,</span> <span class="n">alpha</span><span class="p">,</span> <span class="n">T</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Returns the times within the $mu$th block of an expanding window (out-of-sample)&quot;&quot;&quot;</span>
    <span class="n">xf</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span><span class="s2">&quot;t&quot;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">mu</span> <span class="o">*</span> <span class="n">s</span> <span class="o">+</span> <span class="n">alpha</span><span class="p">,</span> <span class="n">T</span><span class="p">,</span> <span class="n">step_size</span><span class="p">)})</span>
    <span class="n">xf</span><span class="p">[</span><span class="s2">&quot;μ&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">mu</span><span class="p">]</span> <span class="o">*</span> <span class="p">(</span><span class="n">T</span> <span class="o">-</span> <span class="p">(</span><span class="n">mu</span> <span class="o">*</span> <span class="n">s</span> <span class="o">+</span> <span class="n">alpha</span><span class="p">))</span>
    <span class="n">xf</span><span class="p">[</span><span class="s2">&quot;sample&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;out-of-sample&quot;</span>
    <span class="k">return</span> <span class="n">xf</span>
</pre></div>
</div>
</div>
</div>
<p>Next, we create the union of best predictions, which will always be the last time step in ascending order of <span class="math notranslate nohighlight">\(\mu\)</span>:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># iterate over increasing values of mu</span>
<span class="n">script_O_e</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">(</span>
    <span class="p">[</span><span class="n">os_sample_block_e</span><span class="p">(</span><span class="n">mu</span><span class="p">,</span> <span class="n">s</span><span class="p">,</span> <span class="n">alpha</span><span class="p">,</span> <span class="n">T</span><span class="p">)</span> <span class="k">for</span> <span class="n">mu</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">max_mu</span><span class="p">)],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span>
<span class="p">)</span>
<span class="n">script_O_e</span> <span class="o">=</span> <span class="n">script_O_e</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">script_O_e</span><span class="p">[</span><span class="s2">&quot;Preferred Prediction&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>
<span class="c1"># Drop any duplicates of timesteps, keeping only the last entry (which will have highest mu)</span>
<span class="n">script_O_e</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span>
    <span class="n">script_O_e</span><span class="p">[</span><span class="o">~</span><span class="n">script_O_e</span><span class="p">[</span><span class="s2">&quot;t&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">duplicated</span><span class="p">(</span><span class="n">keep</span><span class="o">=</span><span class="s2">&quot;last&quot;</span><span class="p">)]</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="s2">&quot;Preferred Prediction&quot;</span>
<span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
<span class="n">script_O_e</span><span class="p">[</span><span class="s2">&quot;μ&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">script_O_e</span><span class="p">[</span><span class="s2">&quot;μ&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s2">&quot;int&quot;</span><span class="p">)</span>
<span class="n">script_O_e</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>t</th>
      <th>μ</th>
      <th>sample</th>
      <th>Preferred Prediction</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>3</td>
      <td>1</td>
      <td>out-of-sample</td>
      <td>True</td>
    </tr>
    <tr>
      <th>1</th>
      <td>4</td>
      <td>1</td>
      <td>out-of-sample</td>
      <td>False</td>
    </tr>
    <tr>
      <th>2</th>
      <td>5</td>
      <td>1</td>
      <td>out-of-sample</td>
      <td>False</td>
    </tr>
    <tr>
      <th>3</th>
      <td>6</td>
      <td>1</td>
      <td>out-of-sample</td>
      <td>False</td>
    </tr>
    <tr>
      <th>4</th>
      <td>7</td>
      <td>1</td>
      <td>out-of-sample</td>
      <td>False</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>23</th>
      <td>8</td>
      <td>5</td>
      <td>out-of-sample</td>
      <td>False</td>
    </tr>
    <tr>
      <th>24</th>
      <td>9</td>
      <td>5</td>
      <td>out-of-sample</td>
      <td>False</td>
    </tr>
    <tr>
      <th>25</th>
      <td>8</td>
      <td>6</td>
      <td>out-of-sample</td>
      <td>True</td>
    </tr>
    <tr>
      <th>26</th>
      <td>9</td>
      <td>6</td>
      <td>out-of-sample</td>
      <td>False</td>
    </tr>
    <tr>
      <th>27</th>
      <td>9</td>
      <td>7</td>
      <td>out-of-sample</td>
      <td>True</td>
    </tr>
  </tbody>
</table>
<p>28 rows × 4 columns</p>
</div></div></div>
</div>
<p>Now we can plot the pattern of predictions we’d like to use as a function of <span class="math notranslate nohighlight">\(\mu\)</span>:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="p">(</span>
    <span class="n">ggplot</span><span class="p">(</span><span class="n">script_O_e</span><span class="p">,</span> <span class="n">aes</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="s2">&quot;t&quot;</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="n">as_discrete</span><span class="p">(</span><span class="s2">&quot;μ&quot;</span><span class="p">),</span> <span class="n">fill</span><span class="o">=</span><span class="s2">&quot;Preferred Prediction&quot;</span><span class="p">))</span>
    <span class="o">+</span> <span class="n">geom_tile</span><span class="p">(</span><span class="o">**</span><span class="n">width_height_tiles</span><span class="p">)</span>
    <span class="o">+</span> <span class="n">scale_x_continuous</span><span class="p">(</span><span class="n">breaks</span><span class="o">=</span><span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="n">T</span><span class="p">)),</span> <span class="n">limits</span><span class="o">=</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">T</span><span class="p">),</span> <span class="nb">format</span><span class="o">=</span><span class="s2">&quot;d&quot;</span><span class="p">)</span>
    <span class="o">+</span> <span class="n">scale_y_continuous</span><span class="p">(</span><span class="n">breaks</span><span class="o">=</span><span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">max_mu</span><span class="p">)),</span> <span class="nb">format</span><span class="o">=</span><span class="s2">&quot;d&quot;</span><span class="p">)</span>
    <span class="o">+</span> <span class="n">scale_fill_brewer</span><span class="p">(</span><span class="nb">type</span><span class="o">=</span><span class="s2">&quot;qual&quot;</span><span class="p">,</span> <span class="n">palette</span><span class="o">=</span><span class="s2">&quot;Pastel1&quot;</span><span class="p">)</span>
    <span class="o">+</span> <span class="n">ggtitle</span><span class="p">(</span><span class="s2">&quot;Union of Expanding Window One-Step </span><span class="se">\n</span><span class="s2">Ahead Out-of-Sample Predictions&quot;</span><span class="p">)</span>
    <span class="o">+</span> <span class="n">ggsize</span><span class="p">(</span><span class="mi">700</span><span class="p">,</span> <span class="mi">300</span><span class="p">)</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" display="block" class="plt-container" width="700.0" height="300.0">
  <style type="text/css">
  .plt-container {
   font-family: Lucida Grande, sans-serif;
   user-select: none;
   -webkit-user-select: none;
   -moz-user-select: none;
   -ms-user-select: none;
}
text {
   text-rendering: optimizeLegibility;
}
#pyH8xm7 .plot-title {
fill: #474747;
font-weight: normal;
   font-style: normal;font-family: Lucida Grande, sans-serif;
font-size: 16.0px;

}
#pyH8xm7 .plot-subtitle {
fill: #474747;
font-weight: normal;
   font-style: normal;font-family: Lucida Grande, sans-serif;
font-size: 15.0px;

}
#pyH8xm7 .plot-caption {
fill: #474747;
font-weight: normal;
   font-style: normal;font-family: Lucida Grande, sans-serif;
font-size: 13.0px;

}
#pyH8xm7 .hyperlink-element {
fill: #118ed8;
font-weight: normal;
   font-style: normal;
}
#pyH8xm7 .legend-title {
fill: #474747;
font-weight: normal;
   font-style: normal;font-family: Lucida Grande, sans-serif;
font-size: 15.0px;

}
#pyH8xm7 .legend-item {
fill: #474747;
font-weight: normal;
   font-style: normal;font-family: Lucida Grande, sans-serif;
font-size: 13.0px;

}
#pyH8xm7 .axis-title-x {
fill: #474747;
font-weight: normal;
   font-style: normal;font-family: Lucida Grande, sans-serif;
font-size: 15.0px;

}
#pyH8xm7 .axis-text-x {
fill: #474747;
font-weight: normal;
   font-style: normal;font-family: Lucida Grande, sans-serif;
font-size: 13.0px;

}
#dNcdTbz .axis-tooltip-text-x {
fill: #ffffff;
font-weight: normal;
   font-style: normal;font-family: Lucida Grande, sans-serif;
font-size: 13.0px;

}
#pyH8xm7 .axis-title-y {
fill: #474747;
font-weight: normal;
   font-style: normal;font-family: Lucida Grande, sans-serif;
font-size: 15.0px;

}
#pyH8xm7 .axis-text-y {
fill: #474747;
font-weight: normal;
   font-style: normal;font-family: Lucida Grande, sans-serif;
font-size: 13.0px;

}
#dNcdTbz .axis-tooltip-text-y {
fill: #ffffff;
font-weight: normal;
   font-style: normal;font-family: Lucida Grande, sans-serif;
font-size: 13.0px;

}
#pyH8xm7 .facet-strip-text-x {
fill: #474747;
font-weight: normal;
   font-style: normal;font-family: Lucida Grande, sans-serif;
font-size: 13.0px;

}
#pyH8xm7 .facet-strip-text-y {
fill: #474747;
font-weight: normal;
   font-style: normal;font-family: Lucida Grande, sans-serif;
font-size: 13.0px;

}
#dNcdTbz .tooltip-text {
fill: #474747;
font-weight: normal;
   font-style: normal;font-family: Lucida Grande, sans-serif;
font-size: 13.0px;

}
#dNcdTbz .tooltip-title {
fill: #474747;
font-weight: bold;
   font-style: normal;font-family: Lucida Grande, sans-serif;
font-size: 13.0px;

}
#dNcdTbz .tooltip-label {
fill: #474747;
font-weight: bold;
   font-style: normal;font-family: Lucida Grande, sans-serif;
font-size: 13.0px;

}

  </style>
  <g id="pyH8xm7">
    <path fill-rule="evenodd" fill="rgb(255,255,255)" fill-opacity="1.0" d="M0.0 0.0 L0.0 300.0 L700.0 300.0 L700.0 0.0 Z">
    </path>
    <g transform="translate(29.5 42.5 ) ">
      <g>
        <g transform="translate(13.980605455468202 0.0 ) ">
          <g>
            <line x1="61.06903773416335" y1="0.0" x2="61.06903773416335" y2="205.0" stroke="rgb(233,233,233)" stroke-opacity="1.0" stroke-width="1.0" fill="none">
            </line>
            <line x1="100.46841691749455" y1="0.0" x2="100.46841691749455" y2="205.0" stroke="rgb(233,233,233)" stroke-opacity="1.0" stroke-width="1.0" fill="none">
            </line>
            <line x1="139.86779610082573" y1="0.0" x2="139.86779610082573" y2="205.0" stroke="rgb(233,233,233)" stroke-opacity="1.0" stroke-width="1.0" fill="none">
            </line>
            <line x1="179.26717528415693" y1="0.0" x2="179.26717528415693" y2="205.0" stroke="rgb(233,233,233)" stroke-opacity="1.0" stroke-width="1.0" fill="none">
            </line>
            <line x1="218.6665544674881" y1="0.0" x2="218.6665544674881" y2="205.0" stroke="rgb(233,233,233)" stroke-opacity="1.0" stroke-width="1.0" fill="none">
            </line>
            <line x1="258.0659336508193" y1="0.0" x2="258.0659336508193" y2="205.0" stroke="rgb(233,233,233)" stroke-opacity="1.0" stroke-width="1.0" fill="none">
            </line>
            <line x1="297.4653128341505" y1="0.0" x2="297.4653128341505" y2="205.0" stroke="rgb(233,233,233)" stroke-opacity="1.0" stroke-width="1.0" fill="none">
            </line>
            <line x1="336.86469201748173" y1="0.0" x2="336.86469201748173" y2="205.0" stroke="rgb(233,233,233)" stroke-opacity="1.0" stroke-width="1.0" fill="none">
            </line>
            <line x1="376.2640712008129" y1="0.0" x2="376.2640712008129" y2="205.0" stroke="rgb(233,233,233)" stroke-opacity="1.0" stroke-width="1.0" fill="none">
            </line>
            <line x1="415.6634503841441" y1="0.0" x2="415.6634503841441" y2="205.0" stroke="rgb(233,233,233)" stroke-opacity="1.0" stroke-width="1.0" fill="none">
            </line>
          </g>
        </g>
        <g transform="translate(13.980605455468202 0.0 ) ">
          <g>
            <line x1="0.0" y1="191.6304347826087" x2="476.7324881183075" y2="191.6304347826087" stroke="rgb(233,233,233)" stroke-opacity="1.0" stroke-width="1.0" fill="none">
            </line>
            <line x1="0.0" y1="161.92028985507247" x2="476.7324881183075" y2="161.92028985507247" stroke="rgb(233,233,233)" stroke-opacity="1.0" stroke-width="1.0" fill="none">
            </line>
            <line x1="0.0" y1="132.21014492753622" x2="476.7324881183075" y2="132.21014492753622" stroke="rgb(233,233,233)" stroke-opacity="1.0" stroke-width="1.0" fill="none">
            </line>
            <line x1="0.0" y1="102.5" x2="476.7324881183075" y2="102.5" stroke="rgb(233,233,233)" stroke-opacity="1.0" stroke-width="1.0" fill="none">
            </line>
            <line x1="0.0" y1="72.78985507246377" x2="476.7324881183075" y2="72.78985507246377" stroke="rgb(233,233,233)" stroke-opacity="1.0" stroke-width="1.0" fill="none">
            </line>
            <line x1="0.0" y1="43.07971014492753" x2="476.7324881183075" y2="43.07971014492753" stroke="rgb(233,233,233)" stroke-opacity="1.0" stroke-width="1.0" fill="none">
            </line>
            <line x1="0.0" y1="13.369565217391312" x2="476.7324881183075" y2="13.369565217391312" stroke="rgb(233,233,233)" stroke-opacity="1.0" stroke-width="1.0" fill="none">
            </line>
          </g>
        </g>
      </g>
      <g clip-path="url(#cYoj5rn)" clip-bounds-jfx="[rect (13.980605455468202, 0.0), (476.7324881183075, 205.0)]">
        <g transform="translate(13.980605455468202 0.0 ) ">
          <g>
            <g>
              <g>
                <g >
                  <rect fill="#fbb4ae" stroke="#ffffff" stroke-width="0.0" x="161.5374546516579" y="184.20289855072463" height="14.855072463768124" width="35.45944126499805" />
                  <rect fill="#b3cde3" stroke="#ffffff" stroke-width="0.0" x="200.93683383498907" y="184.20289855072463" height="14.855072463768124" width="35.45944126499808" />
                  <rect fill="#b3cde3" stroke="#ffffff" stroke-width="0.0" x="240.33621301832025" y="184.20289855072463" height="14.855072463768124" width="35.459441264998105" />
                  <rect fill="#b3cde3" stroke="#ffffff" stroke-width="0.0" x="279.73559220165146" y="184.20289855072463" height="14.855072463768124" width="35.45944126499808" />
                  <rect fill="#b3cde3" stroke="#ffffff" stroke-width="0.0" x="319.1349713849827" y="184.20289855072463" height="14.855072463768124" width="35.45944126499808" />
                  <rect fill="#b3cde3" stroke="#ffffff" stroke-width="0.0" x="358.53435056831387" y="184.20289855072463" height="14.855072463768124" width="35.45944126499802" />
                  <rect fill="#b3cde3" stroke="#ffffff" stroke-width="0.0" x="397.9337297516451" y="184.20289855072463" height="14.855072463768124" width="35.45944126499808" />
                  <rect fill="#fbb4ae" stroke="#ffffff" stroke-width="0.0" x="200.93683383498907" y="154.4927536231884" height="14.855072463768096" width="35.45944126499808" />
                  <rect fill="#b3cde3" stroke="#ffffff" stroke-width="0.0" x="240.33621301832025" y="154.4927536231884" height="14.855072463768096" width="35.459441264998105" />
                  <rect fill="#b3cde3" stroke="#ffffff" stroke-width="0.0" x="279.73559220165146" y="154.4927536231884" height="14.855072463768096" width="35.45944126499808" />
                  <rect fill="#b3cde3" stroke="#ffffff" stroke-width="0.0" x="319.1349713849827" y="154.4927536231884" height="14.855072463768096" width="35.45944126499808" />
                  <rect fill="#b3cde3" stroke="#ffffff" stroke-width="0.0" x="358.53435056831387" y="154.4927536231884" height="14.855072463768096" width="35.45944126499802" />
                  <rect fill="#b3cde3" stroke="#ffffff" stroke-width="0.0" x="397.9337297516451" y="154.4927536231884" height="14.855072463768096" width="35.45944126499808" />
                  <rect fill="#fbb4ae" stroke="#ffffff" stroke-width="0.0" x="240.33621301832025" y="124.78260869565217" height="14.85507246376811" width="35.459441264998105" />
                  <rect fill="#b3cde3" stroke="#ffffff" stroke-width="0.0" x="279.73559220165146" y="124.78260869565217" height="14.85507246376811" width="35.45944126499808" />
                  <rect fill="#b3cde3" stroke="#ffffff" stroke-width="0.0" x="319.1349713849827" y="124.78260869565217" height="14.85507246376811" width="35.45944126499808" />
                  <rect fill="#b3cde3" stroke="#ffffff" stroke-width="0.0" x="358.53435056831387" y="124.78260869565217" height="14.85507246376811" width="35.45944126499802" />
                  <rect fill="#b3cde3" stroke="#ffffff" stroke-width="0.0" x="397.9337297516451" y="124.78260869565217" height="14.85507246376811" width="35.45944126499808" />
                  <rect fill="#fbb4ae" stroke="#ffffff" stroke-width="0.0" x="279.73559220165146" y="95.07246376811594" height="14.85507246376811" width="35.45944126499808" />
                  <rect fill="#b3cde3" stroke="#ffffff" stroke-width="0.0" x="319.1349713849827" y="95.07246376811594" height="14.85507246376811" width="35.45944126499808" />
                  <rect fill="#b3cde3" stroke="#ffffff" stroke-width="0.0" x="358.53435056831387" y="95.07246376811594" height="14.85507246376811" width="35.45944126499802" />
                  <rect fill="#b3cde3" stroke="#ffffff" stroke-width="0.0" x="397.9337297516451" y="95.07246376811594" height="14.85507246376811" width="35.45944126499808" />
                  <rect fill="#fbb4ae" stroke="#ffffff" stroke-width="0.0" x="319.1349713849827" y="65.3623188405797" height="14.855072463768124" width="35.45944126499808" />
                  <rect fill="#b3cde3" stroke="#ffffff" stroke-width="0.0" x="358.53435056831387" y="65.3623188405797" height="14.855072463768124" width="35.45944126499802" />
                  <rect fill="#b3cde3" stroke="#ffffff" stroke-width="0.0" x="397.9337297516451" y="65.3623188405797" height="14.855072463768124" width="35.45944126499808" />
                  <rect fill="#fbb4ae" stroke="#ffffff" stroke-width="0.0" x="358.53435056831387" y="35.65217391304347" height="14.855072463768124" width="35.45944126499802" />
                  <rect fill="#b3cde3" stroke="#ffffff" stroke-width="0.0" x="397.9337297516451" y="35.65217391304347" height="14.855072463768124" width="35.45944126499808" />
                  <rect fill="#fbb4ae" stroke="#ffffff" stroke-width="0.0" x="397.9337297516451" y="5.94202898550725" height="14.855072463768124" width="35.45944126499808" />
                </g>
              </g>
            </g>
          </g>
        </g>
        <defs>
          <clipPath id="cYoj5rn">
            <rect x="13.980605455468202" y="0.0" width="476.7324881183075" height="205.0">
            </rect>
          </clipPath>
        </defs>
      </g>
      <g>
        <g transform="translate(13.980605455468202 205.0 ) ">
          <g transform="translate(61.06903773416335 0.0 ) ">
            <line stroke-width="1.0" stroke="rgb(71,71,71)" stroke-opacity="1.0" x2="0.0" y2="4.0">
            </line>
            <g transform="translate(0.0 7.0 ) ">
              <text class="axis-text-x" text-anchor="middle" dy="0.7em" y="0.0">
                <tspan>0</tspan>
              </text>
            </g>
          </g>
          <g transform="translate(100.46841691749455 0.0 ) ">
            <line stroke-width="1.0" stroke="rgb(71,71,71)" stroke-opacity="1.0" x2="0.0" y2="4.0">
            </line>
            <g transform="translate(0.0 7.0 ) ">
              <text class="axis-text-x" text-anchor="middle" dy="0.7em" y="0.0">
                <tspan>1</tspan>
              </text>
            </g>
          </g>
          <g transform="translate(139.86779610082573 0.0 ) ">
            <line stroke-width="1.0" stroke="rgb(71,71,71)" stroke-opacity="1.0" x2="0.0" y2="4.0">
            </line>
            <g transform="translate(0.0 7.0 ) ">
              <text class="axis-text-x" text-anchor="middle" dy="0.7em" y="0.0">
                <tspan>2</tspan>
              </text>
            </g>
          </g>
          <g transform="translate(179.26717528415693 0.0 ) ">
            <line stroke-width="1.0" stroke="rgb(71,71,71)" stroke-opacity="1.0" x2="0.0" y2="4.0">
            </line>
            <g transform="translate(0.0 7.0 ) ">
              <text class="axis-text-x" text-anchor="middle" dy="0.7em" y="0.0">
                <tspan>3</tspan>
              </text>
            </g>
          </g>
          <g transform="translate(218.6665544674881 0.0 ) ">
            <line stroke-width="1.0" stroke="rgb(71,71,71)" stroke-opacity="1.0" x2="0.0" y2="4.0">
            </line>
            <g transform="translate(0.0 7.0 ) ">
              <text class="axis-text-x" text-anchor="middle" dy="0.7em" y="0.0">
                <tspan>4</tspan>
              </text>
            </g>
          </g>
          <g transform="translate(258.0659336508193 0.0 ) ">
            <line stroke-width="1.0" stroke="rgb(71,71,71)" stroke-opacity="1.0" x2="0.0" y2="4.0">
            </line>
            <g transform="translate(0.0 7.0 ) ">
              <text class="axis-text-x" text-anchor="middle" dy="0.7em" y="0.0">
                <tspan>5</tspan>
              </text>
            </g>
          </g>
          <g transform="translate(297.4653128341505 0.0 ) ">
            <line stroke-width="1.0" stroke="rgb(71,71,71)" stroke-opacity="1.0" x2="0.0" y2="4.0">
            </line>
            <g transform="translate(0.0 7.0 ) ">
              <text class="axis-text-x" text-anchor="middle" dy="0.7em" y="0.0">
                <tspan>6</tspan>
              </text>
            </g>
          </g>
          <g transform="translate(336.86469201748173 0.0 ) ">
            <line stroke-width="1.0" stroke="rgb(71,71,71)" stroke-opacity="1.0" x2="0.0" y2="4.0">
            </line>
            <g transform="translate(0.0 7.0 ) ">
              <text class="axis-text-x" text-anchor="middle" dy="0.7em" y="0.0">
                <tspan>7</tspan>
              </text>
            </g>
          </g>
          <g transform="translate(376.2640712008129 0.0 ) ">
            <line stroke-width="1.0" stroke="rgb(71,71,71)" stroke-opacity="1.0" x2="0.0" y2="4.0">
            </line>
            <g transform="translate(0.0 7.0 ) ">
              <text class="axis-text-x" text-anchor="middle" dy="0.7em" y="0.0">
                <tspan>8</tspan>
              </text>
            </g>
          </g>
          <g transform="translate(415.6634503841441 0.0 ) ">
            <line stroke-width="1.0" stroke="rgb(71,71,71)" stroke-opacity="1.0" x2="0.0" y2="4.0">
            </line>
            <g transform="translate(0.0 7.0 ) ">
              <text class="axis-text-x" text-anchor="middle" dy="0.7em" y="0.0">
                <tspan>9</tspan>
              </text>
            </g>
          </g>
          <line x1="0.0" y1="0.0" x2="476.7324881183075" y2="0.0" stroke-width="1.0" stroke="rgb(71,71,71)" stroke-opacity="1.0">
          </line>
        </g>
        <g transform="translate(13.980605455468202 0.0 ) ">
          <g transform="translate(0.0 191.6304347826087 ) ">
            <g transform="translate(-3.0 0.0 ) ">
              <text class="axis-text-y" text-anchor="end" dy="0.35em" y="0.0">
                <tspan>1</tspan>
              </text>
            </g>
          </g>
          <g transform="translate(0.0 161.92028985507247 ) ">
            <g transform="translate(-3.0 0.0 ) ">
              <text class="axis-text-y" text-anchor="end" dy="0.35em" y="0.0">
                <tspan>2</tspan>
              </text>
            </g>
          </g>
          <g transform="translate(0.0 132.21014492753622 ) ">
            <g transform="translate(-3.0 0.0 ) ">
              <text class="axis-text-y" text-anchor="end" dy="0.35em" y="0.0">
                <tspan>3</tspan>
              </text>
            </g>
          </g>
          <g transform="translate(0.0 102.5 ) ">
            <g transform="translate(-3.0 0.0 ) ">
              <text class="axis-text-y" text-anchor="end" dy="0.35em" y="0.0">
                <tspan>4</tspan>
              </text>
            </g>
          </g>
          <g transform="translate(0.0 72.78985507246377 ) ">
            <g transform="translate(-3.0 0.0 ) ">
              <text class="axis-text-y" text-anchor="end" dy="0.35em" y="0.0">
                <tspan>5</tspan>
              </text>
            </g>
          </g>
          <g transform="translate(0.0 43.07971014492753 ) ">
            <g transform="translate(-3.0 0.0 ) ">
              <text class="axis-text-y" text-anchor="end" dy="0.35em" y="0.0">
                <tspan>6</tspan>
              </text>
            </g>
          </g>
          <g transform="translate(0.0 13.369565217391312 ) ">
            <g transform="translate(-3.0 0.0 ) ">
              <text class="axis-text-y" text-anchor="end" dy="0.35em" y="0.0">
                <tspan>7</tspan>
              </text>
            </g>
          </g>
        </g>
      </g>
    </g>
    <g transform="translate(43.4806054554682 16.8 ) ">
      <text class="plot-title" y="0.0">
        <tspan>Union of Expanding Window One-Step </tspan>
      </text>
      <text class="plot-title" y="16.0">
        <tspan>Ahead Out-of-Sample Predictions</tspan>
      </text>
    </g>
    <g transform="translate(16.0 145.0 ) rotate(-90.0 ) ">
      <text class="axis-title-y" y="0.0" text-anchor="middle">
        <tspan>μ</tspan>
      </text>
    </g>
    <g transform="translate(281.84684951462197 293.0 ) ">
      <text class="axis-title-x" y="0.0" text-anchor="middle">
        <tspan>t</tspan>
      </text>
    </g>
    <g transform="translate(531.7130935737757 105.75 ) ">
      <rect x="0.0" y="0.0" height="78.5" width="168.2869064262243" stroke="rgb(71,71,71)" stroke-opacity="1.0" stroke-width="0.0" fill="rgb(255,255,255)" fill-opacity="1.0">
      </rect>
      <g transform="translate(5.0 5.0 ) ">
        <g transform="translate(0.0 12.0 ) ">
          <text class="legend-title" y="0.0">
            <tspan>Preferred Prediction</tspan>
          </text>
        </g>
        <g transform="translate(0.0 22.5 ) ">
          <g transform="">
            <g>
              <g transform="translate(1.0 1.0 ) ">
                <g>
                  <rect x="0.0" y="0.0" height="21.0" width="21.0" stroke="rgb(255,255,255)" stroke-opacity="1.0" fill="rgb(251,180,174)" fill-opacity="1.0" stroke-width="1.5">
                  </rect>
                </g>
              </g>
            </g>
            <g transform="translate(26.9903027277341 16.05 ) ">
              <text class="legend-item" y="0.0">
                <tspan>true</tspan>
              </text>
            </g>
          </g>
          <g transform="translate(0.0 23.0 ) ">
            <g>
              <g transform="translate(1.0 1.0 ) ">
                <g>
                  <rect x="0.0" y="0.0" height="21.0" width="21.0" stroke="rgb(255,255,255)" stroke-opacity="1.0" fill="rgb(179,205,227)" fill-opacity="1.0" stroke-width="1.5">
                  </rect>
                </g>
              </g>
            </g>
            <g transform="translate(26.9903027277341 16.05 ) ">
              <text class="legend-item" y="0.0">
                <tspan>false</tspan>
              </text>
            </g>
          </g>
        </g>
      </g>
    </g>
    <path fill="rgb(0,0,0)" fill-opacity="0.0" stroke="rgb(71,71,71)" stroke-opacity="1.0" stroke-width="0.0" d="M0.0 0.0 L0.0 300.0 L700.0 300.0 L700.0 0.0 Z" pointer-events="none">
    </path>
  </g>
  <g id="dNcdTbz">
  </g>
</svg></div></div>
</div>
<p>The series in red above is the one that we would use to compare against real data out-of-sample: it is the best <em>set</em> of predictions we are likely to make out-of-sample.</p>
<p>Of course, it’s easy to create a set of in-sample preferred predictions by analogy. These are less interesting but follow the same principle of taking the time steps with the highest numbered value of <span class="math notranslate nohighlight">\(\mu\)</span> available. In this special case of an expanding window, that’s just going to be all of the predictions in the final <span class="math notranslate nohighlight">\(\mu\)</span>. The expression is</p>
<div class="math notranslate nohighlight">
\[
\mathcal{I}^{e} = \bigcup_\mu \bigg\{ f_\mu\left(I_\mu^e(X)\right)\bigg\}_{t=(\mu -1) s + \alpha}^{t=\mu s -1+\alpha}
\]</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">in_sample_block_e</span><span class="p">(</span><span class="n">mu</span><span class="p">,</span> <span class="n">step_size</span><span class="p">,</span> <span class="n">alpha</span><span class="p">,</span> <span class="n">T</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Returns the times within the $mu$th block of an expanding window (in-sample)&quot;&quot;&quot;</span>
    <span class="n">xf</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span><span class="s2">&quot;t&quot;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">mu</span> <span class="o">*</span> <span class="n">s</span> <span class="o">+</span> <span class="n">alpha</span><span class="p">,</span> <span class="n">step_size</span><span class="p">)})</span>
    <span class="n">xf</span><span class="p">[</span><span class="s2">&quot;μ&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">mu</span><span class="p">]</span> <span class="o">*</span> <span class="p">(</span><span class="n">mu</span> <span class="o">*</span> <span class="n">s</span> <span class="o">+</span> <span class="n">alpha</span> <span class="o">-</span> <span class="mi">0</span><span class="p">)</span>
    <span class="n">xf</span><span class="p">[</span><span class="s2">&quot;sample&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;in-sample&quot;</span>
    <span class="k">return</span> <span class="n">xf</span>


<span class="n">script_I_e</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">(</span>
    <span class="p">[</span><span class="n">in_sample_block_e</span><span class="p">(</span><span class="n">mu</span><span class="p">,</span> <span class="n">s</span><span class="p">,</span> <span class="n">alpha</span><span class="p">,</span> <span class="n">T</span><span class="p">)</span> <span class="k">for</span> <span class="n">mu</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">max_mu</span><span class="p">)],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span>
<span class="p">)</span>
<span class="n">script_I_e</span> <span class="o">=</span> <span class="n">script_I_e</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>
<span class="n">script_I_e</span><span class="p">[</span><span class="s2">&quot;Preferred Prediction&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>
<span class="n">script_I_e</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span>
    <span class="n">script_I_e</span><span class="p">[</span><span class="o">~</span><span class="n">script_I_e</span><span class="p">[</span><span class="s2">&quot;t&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">duplicated</span><span class="p">(</span><span class="n">keep</span><span class="o">=</span><span class="s2">&quot;last&quot;</span><span class="p">)]</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="s2">&quot;Preferred Prediction&quot;</span>
<span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Plot the union of expanding window in-sample predictions:</span>
<span class="p">(</span>
    <span class="n">ggplot</span><span class="p">(</span><span class="n">script_I_e</span><span class="p">,</span> <span class="n">aes</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="s2">&quot;t&quot;</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="n">as_discrete</span><span class="p">(</span><span class="s2">&quot;μ&quot;</span><span class="p">),</span> <span class="n">fill</span><span class="o">=</span><span class="s2">&quot;Preferred Prediction&quot;</span><span class="p">))</span>
    <span class="o">+</span> <span class="n">geom_tile</span><span class="p">(</span><span class="o">**</span><span class="n">width_height_tiles</span><span class="p">)</span>
    <span class="o">+</span> <span class="n">scale_x_continuous</span><span class="p">(</span><span class="n">breaks</span><span class="o">=</span><span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="n">T</span><span class="p">)),</span> <span class="n">limits</span><span class="o">=</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">T</span><span class="p">),</span> <span class="nb">format</span><span class="o">=</span><span class="s2">&quot;d&quot;</span><span class="p">)</span>
    <span class="o">+</span> <span class="n">scale_y_continuous</span><span class="p">(</span><span class="n">breaks</span><span class="o">=</span><span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">max_mu</span><span class="p">)),</span> <span class="nb">format</span><span class="o">=</span><span class="s2">&quot;d&quot;</span><span class="p">)</span>
    <span class="o">+</span> <span class="n">scale_fill_brewer</span><span class="p">(</span><span class="nb">type</span><span class="o">=</span><span class="s2">&quot;qual&quot;</span><span class="p">,</span> <span class="n">palette</span><span class="o">=</span><span class="s2">&quot;Pastel1&quot;</span><span class="p">)</span>
    <span class="o">+</span> <span class="n">ggtitle</span><span class="p">(</span><span class="s2">&quot;Union of Expanding Window In-Sample Preferred Predictions&quot;</span><span class="p">)</span>
    <span class="o">+</span> <span class="n">ggsize</span><span class="p">(</span><span class="mi">700</span><span class="p">,</span> <span class="mi">300</span><span class="p">)</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" display="block" class="plt-container" width="700.0" height="300.0">
  <style type="text/css">
  .plt-container {
   font-family: Lucida Grande, sans-serif;
   user-select: none;
   -webkit-user-select: none;
   -moz-user-select: none;
   -ms-user-select: none;
}
text {
   text-rendering: optimizeLegibility;
}
#pSq3sqo .plot-title {
fill: #474747;
font-weight: normal;
   font-style: normal;font-family: Lucida Grande, sans-serif;
font-size: 16.0px;

}
#pSq3sqo .plot-subtitle {
fill: #474747;
font-weight: normal;
   font-style: normal;font-family: Lucida Grande, sans-serif;
font-size: 15.0px;

}
#pSq3sqo .plot-caption {
fill: #474747;
font-weight: normal;
   font-style: normal;font-family: Lucida Grande, sans-serif;
font-size: 13.0px;

}
#pSq3sqo .hyperlink-element {
fill: #118ed8;
font-weight: normal;
   font-style: normal;
}
#pSq3sqo .legend-title {
fill: #474747;
font-weight: normal;
   font-style: normal;font-family: Lucida Grande, sans-serif;
font-size: 15.0px;

}
#pSq3sqo .legend-item {
fill: #474747;
font-weight: normal;
   font-style: normal;font-family: Lucida Grande, sans-serif;
font-size: 13.0px;

}
#pSq3sqo .axis-title-x {
fill: #474747;
font-weight: normal;
   font-style: normal;font-family: Lucida Grande, sans-serif;
font-size: 15.0px;

}
#pSq3sqo .axis-text-x {
fill: #474747;
font-weight: normal;
   font-style: normal;font-family: Lucida Grande, sans-serif;
font-size: 13.0px;

}
#dSS9gBg .axis-tooltip-text-x {
fill: #ffffff;
font-weight: normal;
   font-style: normal;font-family: Lucida Grande, sans-serif;
font-size: 13.0px;

}
#pSq3sqo .axis-title-y {
fill: #474747;
font-weight: normal;
   font-style: normal;font-family: Lucida Grande, sans-serif;
font-size: 15.0px;

}
#pSq3sqo .axis-text-y {
fill: #474747;
font-weight: normal;
   font-style: normal;font-family: Lucida Grande, sans-serif;
font-size: 13.0px;

}
#dSS9gBg .axis-tooltip-text-y {
fill: #ffffff;
font-weight: normal;
   font-style: normal;font-family: Lucida Grande, sans-serif;
font-size: 13.0px;

}
#pSq3sqo .facet-strip-text-x {
fill: #474747;
font-weight: normal;
   font-style: normal;font-family: Lucida Grande, sans-serif;
font-size: 13.0px;

}
#pSq3sqo .facet-strip-text-y {
fill: #474747;
font-weight: normal;
   font-style: normal;font-family: Lucida Grande, sans-serif;
font-size: 13.0px;

}
#dSS9gBg .tooltip-text {
fill: #474747;
font-weight: normal;
   font-style: normal;font-family: Lucida Grande, sans-serif;
font-size: 13.0px;

}
#dSS9gBg .tooltip-title {
fill: #474747;
font-weight: bold;
   font-style: normal;font-family: Lucida Grande, sans-serif;
font-size: 13.0px;

}
#dSS9gBg .tooltip-label {
fill: #474747;
font-weight: bold;
   font-style: normal;font-family: Lucida Grande, sans-serif;
font-size: 13.0px;

}

  </style>
  <g id="pSq3sqo">
    <path fill-rule="evenodd" fill="rgb(255,255,255)" fill-opacity="1.0" d="M0.0 0.0 L0.0 300.0 L700.0 300.0 L700.0 0.0 Z">
    </path>
    <g transform="translate(29.5 26.5 ) ">
      <g>
        <g transform="translate(13.980605455468202 0.0 ) ">
          <g>
            <line x1="61.06903773416335" y1="0.0" x2="61.06903773416335" y2="221.0" stroke="rgb(233,233,233)" stroke-opacity="1.0" stroke-width="1.0" fill="none">
            </line>
            <line x1="100.46841691749455" y1="0.0" x2="100.46841691749455" y2="221.0" stroke="rgb(233,233,233)" stroke-opacity="1.0" stroke-width="1.0" fill="none">
            </line>
            <line x1="139.86779610082573" y1="0.0" x2="139.86779610082573" y2="221.0" stroke="rgb(233,233,233)" stroke-opacity="1.0" stroke-width="1.0" fill="none">
            </line>
            <line x1="179.26717528415693" y1="0.0" x2="179.26717528415693" y2="221.0" stroke="rgb(233,233,233)" stroke-opacity="1.0" stroke-width="1.0" fill="none">
            </line>
            <line x1="218.6665544674881" y1="0.0" x2="218.6665544674881" y2="221.0" stroke="rgb(233,233,233)" stroke-opacity="1.0" stroke-width="1.0" fill="none">
            </line>
            <line x1="258.0659336508193" y1="0.0" x2="258.0659336508193" y2="221.0" stroke="rgb(233,233,233)" stroke-opacity="1.0" stroke-width="1.0" fill="none">
            </line>
            <line x1="297.4653128341505" y1="0.0" x2="297.4653128341505" y2="221.0" stroke="rgb(233,233,233)" stroke-opacity="1.0" stroke-width="1.0" fill="none">
            </line>
            <line x1="336.86469201748173" y1="0.0" x2="336.86469201748173" y2="221.0" stroke="rgb(233,233,233)" stroke-opacity="1.0" stroke-width="1.0" fill="none">
            </line>
            <line x1="376.2640712008129" y1="0.0" x2="376.2640712008129" y2="221.0" stroke="rgb(233,233,233)" stroke-opacity="1.0" stroke-width="1.0" fill="none">
            </line>
            <line x1="415.6634503841441" y1="0.0" x2="415.6634503841441" y2="221.0" stroke="rgb(233,233,233)" stroke-opacity="1.0" stroke-width="1.0" fill="none">
            </line>
          </g>
        </g>
        <g transform="translate(13.980605455468202 0.0 ) ">
          <g>
            <line x1="0.0" y1="206.58695652173913" x2="476.7324881183075" y2="206.58695652173913" stroke="rgb(233,233,233)" stroke-opacity="1.0" stroke-width="1.0" fill="none">
            </line>
            <line x1="0.0" y1="174.55797101449275" x2="476.7324881183075" y2="174.55797101449275" stroke="rgb(233,233,233)" stroke-opacity="1.0" stroke-width="1.0" fill="none">
            </line>
            <line x1="0.0" y1="142.52898550724638" x2="476.7324881183075" y2="142.52898550724638" stroke="rgb(233,233,233)" stroke-opacity="1.0" stroke-width="1.0" fill="none">
            </line>
            <line x1="0.0" y1="110.5" x2="476.7324881183075" y2="110.5" stroke="rgb(233,233,233)" stroke-opacity="1.0" stroke-width="1.0" fill="none">
            </line>
            <line x1="0.0" y1="78.47101449275362" x2="476.7324881183075" y2="78.47101449275362" stroke="rgb(233,233,233)" stroke-opacity="1.0" stroke-width="1.0" fill="none">
            </line>
            <line x1="0.0" y1="46.44202898550725" x2="476.7324881183075" y2="46.44202898550725" stroke="rgb(233,233,233)" stroke-opacity="1.0" stroke-width="1.0" fill="none">
            </line>
            <line x1="0.0" y1="14.413043478260875" x2="476.7324881183075" y2="14.413043478260875" stroke="rgb(233,233,233)" stroke-opacity="1.0" stroke-width="1.0" fill="none">
            </line>
          </g>
        </g>
      </g>
      <g clip-path="url(#cFprFA8)" clip-bounds-jfx="[rect (13.980605455468202, 0.0), (476.7324881183075, 221.0)]">
        <g transform="translate(13.980605455468202 0.0 ) ">
          <g>
            <g>
              <g>
                <g >
                  <rect fill="#fbb4ae" stroke="#ffffff" stroke-width="0.0" x="43.339317101664314" y="198.57971014492753" height="16.014492753623188" width="35.45944126499807" />
                  <rect fill="#fbb4ae" stroke="#ffffff" stroke-width="0.0" x="82.73869628499551" y="198.57971014492753" height="16.014492753623188" width="35.45944126499808" />
                  <rect fill="#fbb4ae" stroke="#ffffff" stroke-width="0.0" x="122.1380754683267" y="198.57971014492753" height="16.014492753623188" width="35.45944126499806" />
                  <rect fill="#fbb4ae" stroke="#ffffff" stroke-width="0.0" x="43.339317101664314" y="166.55072463768116" height="16.014492753623188" width="35.45944126499807" />
                  <rect fill="#fbb4ae" stroke="#ffffff" stroke-width="0.0" x="82.73869628499551" y="166.55072463768116" height="16.014492753623188" width="35.45944126499808" />
                  <rect fill="#fbb4ae" stroke="#ffffff" stroke-width="0.0" x="122.1380754683267" y="166.55072463768116" height="16.014492753623188" width="35.45944126499806" />
                  <rect fill="#fbb4ae" stroke="#ffffff" stroke-width="0.0" x="161.5374546516579" y="166.55072463768116" height="16.014492753623188" width="35.45944126499805" />
                  <rect fill="#fbb4ae" stroke="#ffffff" stroke-width="0.0" x="43.339317101664314" y="134.52173913043478" height="16.014492753623188" width="35.45944126499807" />
                  <rect fill="#fbb4ae" stroke="#ffffff" stroke-width="0.0" x="82.73869628499551" y="134.52173913043478" height="16.014492753623188" width="35.45944126499808" />
                  <rect fill="#fbb4ae" stroke="#ffffff" stroke-width="0.0" x="122.1380754683267" y="134.52173913043478" height="16.014492753623188" width="35.45944126499806" />
                  <rect fill="#fbb4ae" stroke="#ffffff" stroke-width="0.0" x="161.5374546516579" y="134.52173913043478" height="16.014492753623188" width="35.45944126499805" />
                  <rect fill="#fbb4ae" stroke="#ffffff" stroke-width="0.0" x="200.93683383498907" y="134.52173913043478" height="16.014492753623188" width="35.45944126499808" />
                  <rect fill="#fbb4ae" stroke="#ffffff" stroke-width="0.0" x="43.339317101664314" y="102.4927536231884" height="16.014492753623188" width="35.45944126499807" />
                  <rect fill="#fbb4ae" stroke="#ffffff" stroke-width="0.0" x="82.73869628499551" y="102.4927536231884" height="16.014492753623188" width="35.45944126499808" />
                  <rect fill="#fbb4ae" stroke="#ffffff" stroke-width="0.0" x="122.1380754683267" y="102.4927536231884" height="16.014492753623188" width="35.45944126499806" />
                  <rect fill="#fbb4ae" stroke="#ffffff" stroke-width="0.0" x="161.5374546516579" y="102.4927536231884" height="16.014492753623188" width="35.45944126499805" />
                  <rect fill="#fbb4ae" stroke="#ffffff" stroke-width="0.0" x="200.93683383498907" y="102.4927536231884" height="16.014492753623188" width="35.45944126499808" />
                  <rect fill="#fbb4ae" stroke="#ffffff" stroke-width="0.0" x="240.33621301832025" y="102.4927536231884" height="16.014492753623188" width="35.459441264998105" />
                  <rect fill="#fbb4ae" stroke="#ffffff" stroke-width="0.0" x="43.339317101664314" y="70.46376811594203" height="16.014492753623188" width="35.45944126499807" />
                  <rect fill="#fbb4ae" stroke="#ffffff" stroke-width="0.0" x="82.73869628499551" y="70.46376811594203" height="16.014492753623188" width="35.45944126499808" />
                  <rect fill="#fbb4ae" stroke="#ffffff" stroke-width="0.0" x="122.1380754683267" y="70.46376811594203" height="16.014492753623188" width="35.45944126499806" />
                  <rect fill="#fbb4ae" stroke="#ffffff" stroke-width="0.0" x="161.5374546516579" y="70.46376811594203" height="16.014492753623188" width="35.45944126499805" />
                  <rect fill="#fbb4ae" stroke="#ffffff" stroke-width="0.0" x="200.93683383498907" y="70.46376811594203" height="16.014492753623188" width="35.45944126499808" />
                  <rect fill="#fbb4ae" stroke="#ffffff" stroke-width="0.0" x="240.33621301832025" y="70.46376811594203" height="16.014492753623188" width="35.459441264998105" />
                  <rect fill="#fbb4ae" stroke="#ffffff" stroke-width="0.0" x="279.73559220165146" y="70.46376811594203" height="16.014492753623188" width="35.45944126499808" />
                  <rect fill="#fbb4ae" stroke="#ffffff" stroke-width="0.0" x="43.339317101664314" y="38.434782608695656" height="16.014492753623188" width="35.45944126499807" />
                  <rect fill="#fbb4ae" stroke="#ffffff" stroke-width="0.0" x="82.73869628499551" y="38.434782608695656" height="16.014492753623188" width="35.45944126499808" />
                  <rect fill="#fbb4ae" stroke="#ffffff" stroke-width="0.0" x="122.1380754683267" y="38.434782608695656" height="16.014492753623188" width="35.45944126499806" />
                  <rect fill="#fbb4ae" stroke="#ffffff" stroke-width="0.0" x="161.5374546516579" y="38.434782608695656" height="16.014492753623188" width="35.45944126499805" />
                  <rect fill="#fbb4ae" stroke="#ffffff" stroke-width="0.0" x="200.93683383498907" y="38.434782608695656" height="16.014492753623188" width="35.45944126499808" />
                  <rect fill="#fbb4ae" stroke="#ffffff" stroke-width="0.0" x="240.33621301832025" y="38.434782608695656" height="16.014492753623188" width="35.459441264998105" />
                  <rect fill="#fbb4ae" stroke="#ffffff" stroke-width="0.0" x="279.73559220165146" y="38.434782608695656" height="16.014492753623188" width="35.45944126499808" />
                  <rect fill="#fbb4ae" stroke="#ffffff" stroke-width="0.0" x="319.1349713849827" y="38.434782608695656" height="16.014492753623188" width="35.45944126499808" />
                  <rect fill="#b3cde3" stroke="#ffffff" stroke-width="0.0" x="43.339317101664314" y="6.405797101449281" height="16.014492753623188" width="35.45944126499807" />
                  <rect fill="#b3cde3" stroke="#ffffff" stroke-width="0.0" x="82.73869628499551" y="6.405797101449281" height="16.014492753623188" width="35.45944126499808" />
                  <rect fill="#b3cde3" stroke="#ffffff" stroke-width="0.0" x="122.1380754683267" y="6.405797101449281" height="16.014492753623188" width="35.45944126499806" />
                  <rect fill="#b3cde3" stroke="#ffffff" stroke-width="0.0" x="161.5374546516579" y="6.405797101449281" height="16.014492753623188" width="35.45944126499805" />
                  <rect fill="#b3cde3" stroke="#ffffff" stroke-width="0.0" x="200.93683383498907" y="6.405797101449281" height="16.014492753623188" width="35.45944126499808" />
                  <rect fill="#b3cde3" stroke="#ffffff" stroke-width="0.0" x="240.33621301832025" y="6.405797101449281" height="16.014492753623188" width="35.459441264998105" />
                  <rect fill="#b3cde3" stroke="#ffffff" stroke-width="0.0" x="279.73559220165146" y="6.405797101449281" height="16.014492753623188" width="35.45944126499808" />
                  <rect fill="#b3cde3" stroke="#ffffff" stroke-width="0.0" x="319.1349713849827" y="6.405797101449281" height="16.014492753623188" width="35.45944126499808" />
                  <rect fill="#b3cde3" stroke="#ffffff" stroke-width="0.0" x="358.53435056831387" y="6.405797101449281" height="16.014492753623188" width="35.45944126499802" />
                </g>
              </g>
            </g>
          </g>
        </g>
        <defs>
          <clipPath id="cFprFA8">
            <rect x="13.980605455468202" y="0.0" width="476.7324881183075" height="221.0">
            </rect>
          </clipPath>
        </defs>
      </g>
      <g>
        <g transform="translate(13.980605455468202 221.0 ) ">
          <g transform="translate(61.06903773416335 0.0 ) ">
            <line stroke-width="1.0" stroke="rgb(71,71,71)" stroke-opacity="1.0" x2="0.0" y2="4.0">
            </line>
            <g transform="translate(0.0 7.0 ) ">
              <text class="axis-text-x" text-anchor="middle" dy="0.7em" y="0.0">
                <tspan>0</tspan>
              </text>
            </g>
          </g>
          <g transform="translate(100.46841691749455 0.0 ) ">
            <line stroke-width="1.0" stroke="rgb(71,71,71)" stroke-opacity="1.0" x2="0.0" y2="4.0">
            </line>
            <g transform="translate(0.0 7.0 ) ">
              <text class="axis-text-x" text-anchor="middle" dy="0.7em" y="0.0">
                <tspan>1</tspan>
              </text>
            </g>
          </g>
          <g transform="translate(139.86779610082573 0.0 ) ">
            <line stroke-width="1.0" stroke="rgb(71,71,71)" stroke-opacity="1.0" x2="0.0" y2="4.0">
            </line>
            <g transform="translate(0.0 7.0 ) ">
              <text class="axis-text-x" text-anchor="middle" dy="0.7em" y="0.0">
                <tspan>2</tspan>
              </text>
            </g>
          </g>
          <g transform="translate(179.26717528415693 0.0 ) ">
            <line stroke-width="1.0" stroke="rgb(71,71,71)" stroke-opacity="1.0" x2="0.0" y2="4.0">
            </line>
            <g transform="translate(0.0 7.0 ) ">
              <text class="axis-text-x" text-anchor="middle" dy="0.7em" y="0.0">
                <tspan>3</tspan>
              </text>
            </g>
          </g>
          <g transform="translate(218.6665544674881 0.0 ) ">
            <line stroke-width="1.0" stroke="rgb(71,71,71)" stroke-opacity="1.0" x2="0.0" y2="4.0">
            </line>
            <g transform="translate(0.0 7.0 ) ">
              <text class="axis-text-x" text-anchor="middle" dy="0.7em" y="0.0">
                <tspan>4</tspan>
              </text>
            </g>
          </g>
          <g transform="translate(258.0659336508193 0.0 ) ">
            <line stroke-width="1.0" stroke="rgb(71,71,71)" stroke-opacity="1.0" x2="0.0" y2="4.0">
            </line>
            <g transform="translate(0.0 7.0 ) ">
              <text class="axis-text-x" text-anchor="middle" dy="0.7em" y="0.0">
                <tspan>5</tspan>
              </text>
            </g>
          </g>
          <g transform="translate(297.4653128341505 0.0 ) ">
            <line stroke-width="1.0" stroke="rgb(71,71,71)" stroke-opacity="1.0" x2="0.0" y2="4.0">
            </line>
            <g transform="translate(0.0 7.0 ) ">
              <text class="axis-text-x" text-anchor="middle" dy="0.7em" y="0.0">
                <tspan>6</tspan>
              </text>
            </g>
          </g>
          <g transform="translate(336.86469201748173 0.0 ) ">
            <line stroke-width="1.0" stroke="rgb(71,71,71)" stroke-opacity="1.0" x2="0.0" y2="4.0">
            </line>
            <g transform="translate(0.0 7.0 ) ">
              <text class="axis-text-x" text-anchor="middle" dy="0.7em" y="0.0">
                <tspan>7</tspan>
              </text>
            </g>
          </g>
          <g transform="translate(376.2640712008129 0.0 ) ">
            <line stroke-width="1.0" stroke="rgb(71,71,71)" stroke-opacity="1.0" x2="0.0" y2="4.0">
            </line>
            <g transform="translate(0.0 7.0 ) ">
              <text class="axis-text-x" text-anchor="middle" dy="0.7em" y="0.0">
                <tspan>8</tspan>
              </text>
            </g>
          </g>
          <g transform="translate(415.6634503841441 0.0 ) ">
            <line stroke-width="1.0" stroke="rgb(71,71,71)" stroke-opacity="1.0" x2="0.0" y2="4.0">
            </line>
            <g transform="translate(0.0 7.0 ) ">
              <text class="axis-text-x" text-anchor="middle" dy="0.7em" y="0.0">
                <tspan>9</tspan>
              </text>
            </g>
          </g>
          <line x1="0.0" y1="0.0" x2="476.7324881183075" y2="0.0" stroke-width="1.0" stroke="rgb(71,71,71)" stroke-opacity="1.0">
          </line>
        </g>
        <g transform="translate(13.980605455468202 0.0 ) ">
          <g transform="translate(0.0 206.58695652173913 ) ">
            <g transform="translate(-3.0 0.0 ) ">
              <text class="axis-text-y" text-anchor="end" dy="0.35em" y="0.0">
                <tspan>1</tspan>
              </text>
            </g>
          </g>
          <g transform="translate(0.0 174.55797101449275 ) ">
            <g transform="translate(-3.0 0.0 ) ">
              <text class="axis-text-y" text-anchor="end" dy="0.35em" y="0.0">
                <tspan>2</tspan>
              </text>
            </g>
          </g>
          <g transform="translate(0.0 142.52898550724638 ) ">
            <g transform="translate(-3.0 0.0 ) ">
              <text class="axis-text-y" text-anchor="end" dy="0.35em" y="0.0">
                <tspan>3</tspan>
              </text>
            </g>
          </g>
          <g transform="translate(0.0 110.5 ) ">
            <g transform="translate(-3.0 0.0 ) ">
              <text class="axis-text-y" text-anchor="end" dy="0.35em" y="0.0">
                <tspan>4</tspan>
              </text>
            </g>
          </g>
          <g transform="translate(0.0 78.47101449275362 ) ">
            <g transform="translate(-3.0 0.0 ) ">
              <text class="axis-text-y" text-anchor="end" dy="0.35em" y="0.0">
                <tspan>5</tspan>
              </text>
            </g>
          </g>
          <g transform="translate(0.0 46.44202898550725 ) ">
            <g transform="translate(-3.0 0.0 ) ">
              <text class="axis-text-y" text-anchor="end" dy="0.35em" y="0.0">
                <tspan>6</tspan>
              </text>
            </g>
          </g>
          <g transform="translate(0.0 14.413043478260875 ) ">
            <g transform="translate(-3.0 0.0 ) ">
              <text class="axis-text-y" text-anchor="end" dy="0.35em" y="0.0">
                <tspan>7</tspan>
              </text>
            </g>
          </g>
        </g>
      </g>
    </g>
    <g transform="translate(43.4806054554682 16.8 ) ">
      <text class="plot-title" y="0.0">
        <tspan>Union of Expanding Window In-Sample Preferred Predictions</tspan>
      </text>
    </g>
    <g transform="translate(16.0 137.0 ) rotate(-90.0 ) ">
      <text class="axis-title-y" y="0.0" text-anchor="middle">
        <tspan>μ</tspan>
      </text>
    </g>
    <g transform="translate(281.84684951462197 293.0 ) ">
      <text class="axis-title-x" y="0.0" text-anchor="middle">
        <tspan>t</tspan>
      </text>
    </g>
    <g transform="translate(531.7130935737757 97.75 ) ">
      <rect x="0.0" y="0.0" height="78.5" width="168.2869064262243" stroke="rgb(71,71,71)" stroke-opacity="1.0" stroke-width="0.0" fill="rgb(255,255,255)" fill-opacity="1.0">
      </rect>
      <g transform="translate(5.0 5.0 ) ">
        <g transform="translate(0.0 12.0 ) ">
          <text class="legend-title" y="0.0">
            <tspan>Preferred Prediction</tspan>
          </text>
        </g>
        <g transform="translate(0.0 22.5 ) ">
          <g transform="">
            <g>
              <g transform="translate(1.0 1.0 ) ">
                <g>
                  <rect x="0.0" y="0.0" height="21.0" width="21.0" stroke="rgb(255,255,255)" stroke-opacity="1.0" fill="rgb(251,180,174)" fill-opacity="1.0" stroke-width="1.5">
                  </rect>
                </g>
              </g>
            </g>
            <g transform="translate(26.9903027277341 16.05 ) ">
              <text class="legend-item" y="0.0">
                <tspan>false</tspan>
              </text>
            </g>
          </g>
          <g transform="translate(0.0 23.0 ) ">
            <g>
              <g transform="translate(1.0 1.0 ) ">
                <g>
                  <rect x="0.0" y="0.0" height="21.0" width="21.0" stroke="rgb(255,255,255)" stroke-opacity="1.0" fill="rgb(179,205,227)" fill-opacity="1.0" stroke-width="1.5">
                  </rect>
                </g>
              </g>
            </g>
            <g transform="translate(26.9903027277341 16.05 ) ">
              <text class="legend-item" y="0.0">
                <tspan>true</tspan>
              </text>
            </g>
          </g>
        </g>
      </g>
    </g>
    <path fill="rgb(0,0,0)" fill-opacity="0.0" stroke="rgb(71,71,71)" stroke-opacity="1.0" stroke-width="0.0" d="M0.0 0.0 L0.0 300.0 L700.0 300.0 L700.0 0.0 Z" pointer-events="none">
    </path>
  </g>
  <g id="dSS9gBg">
  </g>
</svg></div></div>
</div>
</section>
</section>
<section id="rolling-window">
<h2>Rolling Window<a class="headerlink" href="#rolling-window" title="Link to this heading">#</a></h2>
<p>In a rolling window forecast exercise, multiple forecasts are made. In each, the in-sample period <em>moves</em> (rather than grows) over time. Necessarily (given finite data), the out-of-sample period shrinks over time as the exercise progresses through different window configurations.</p>
<p>We index the different forecasts (synonymous with different models <span class="math notranslate nohighlight">\(f_\mu\)</span>) by <span class="math notranslate nohighlight">\(\mu\)</span>. The starting size of the window will be <span class="math notranslate nohighlight">\(s + \alpha\)</span> where <span class="math notranslate nohighlight">\(s\)</span> is the step size and <span class="math notranslate nohighlight">\(\alpha\)</span> is a parameter that adjusts window size. For arbitrary <span class="math notranslate nohighlight">\(z_t\)</span>, the <span class="math notranslate nohighlight">\(\mu\)</span>th in-sample slice of time series data is:</p>
<div class="math notranslate nohighlight">
\[
I^r_{\mu}(\vec{z}) = \bigg\{ z_{t} \bigg\}_{t=(\mu-1)\cdot s}^{t=\mu\cdot s+\alpha -1}
\]</div>
<p>Applied to the features, this is the slice that will be used to train (aka fit) model <span class="math notranslate nohighlight">\(f_\mu\)</span>.</p>
<p>Likewise, the out-of-sample set is:</p>
<div class="math notranslate nohighlight">
\[
O^r_{\mu}(\vec{z}) = \bigg\{ z_{t} \bigg\}_{t=\mu\cdot s+\alpha}^{t=T} 
\]</div>
<p>Below is a visualisation of all the rolling window forecasts in a single forecasting exercise.</p>
<div class="cell tag_remove-input docutils container">
</div>
<div class="cell tag_remove-input docutils container">
<div class="cell_output docutils container">
<div class="output text_html"><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" display="block" class="plt-container" width="700.0" height="300.0">
  <style type="text/css">
  .plt-container {
   font-family: Lucida Grande, sans-serif;
   user-select: none;
   -webkit-user-select: none;
   -moz-user-select: none;
   -ms-user-select: none;
}
text {
   text-rendering: optimizeLegibility;
}
#pNwUo0t .plot-title {
fill: #474747;
font-weight: normal;
   font-style: normal;font-family: Lucida Grande, sans-serif;
font-size: 16.0px;

}
#pNwUo0t .plot-subtitle {
fill: #474747;
font-weight: normal;
   font-style: normal;font-family: Lucida Grande, sans-serif;
font-size: 15.0px;

}
#pNwUo0t .plot-caption {
fill: #474747;
font-weight: normal;
   font-style: normal;font-family: Lucida Grande, sans-serif;
font-size: 13.0px;

}
#pNwUo0t .hyperlink-element {
fill: #118ed8;
font-weight: normal;
   font-style: normal;
}
#pNwUo0t .legend-title {
fill: #474747;
font-weight: normal;
   font-style: normal;font-family: Lucida Grande, sans-serif;
font-size: 15.0px;

}
#pNwUo0t .legend-item {
fill: #474747;
font-weight: normal;
   font-style: normal;font-family: Lucida Grande, sans-serif;
font-size: 13.0px;

}
#pNwUo0t .axis-title-x {
fill: #474747;
font-weight: normal;
   font-style: normal;font-family: Lucida Grande, sans-serif;
font-size: 15.0px;

}
#pNwUo0t .axis-text-x {
fill: #474747;
font-weight: normal;
   font-style: normal;font-family: Lucida Grande, sans-serif;
font-size: 13.0px;

}
#dOK0vyP .axis-tooltip-text-x {
fill: #ffffff;
font-weight: normal;
   font-style: normal;font-family: Lucida Grande, sans-serif;
font-size: 13.0px;

}
#pNwUo0t .axis-title-y {
fill: #474747;
font-weight: normal;
   font-style: normal;font-family: Lucida Grande, sans-serif;
font-size: 15.0px;

}
#pNwUo0t .axis-text-y {
fill: #474747;
font-weight: normal;
   font-style: normal;font-family: Lucida Grande, sans-serif;
font-size: 13.0px;

}
#dOK0vyP .axis-tooltip-text-y {
fill: #ffffff;
font-weight: normal;
   font-style: normal;font-family: Lucida Grande, sans-serif;
font-size: 13.0px;

}
#pNwUo0t .facet-strip-text-x {
fill: #474747;
font-weight: normal;
   font-style: normal;font-family: Lucida Grande, sans-serif;
font-size: 13.0px;

}
#pNwUo0t .facet-strip-text-y {
fill: #474747;
font-weight: normal;
   font-style: normal;font-family: Lucida Grande, sans-serif;
font-size: 13.0px;

}
#dOK0vyP .tooltip-text {
fill: #474747;
font-weight: normal;
   font-style: normal;font-family: Lucida Grande, sans-serif;
font-size: 13.0px;

}
#dOK0vyP .tooltip-title {
fill: #474747;
font-weight: bold;
   font-style: normal;font-family: Lucida Grande, sans-serif;
font-size: 13.0px;

}
#dOK0vyP .tooltip-label {
fill: #474747;
font-weight: bold;
   font-style: normal;font-family: Lucida Grande, sans-serif;
font-size: 13.0px;

}

  </style>
  <g id="pNwUo0t">
    <path fill-rule="evenodd" fill="rgb(255,255,255)" fill-opacity="1.0" d="M0.0 0.0 L0.0 300.0 L700.0 300.0 L700.0 0.0 Z">
    </path>
    <g transform="translate(29.5 26.5 ) ">
      <g>
        <g transform="translate(13.980605455468202 0.0 ) ">
          <g>
            <line x1="64.25929625025657" y1="0.0" x2="64.25929625025657" y2="221.0" stroke="rgb(233,233,233)" stroke-opacity="1.0" stroke-width="1.0" fill="none">
            </line>
            <line x1="105.71690673429306" y1="0.0" x2="105.71690673429306" y2="221.0" stroke="rgb(233,233,233)" stroke-opacity="1.0" stroke-width="1.0" fill="none">
            </line>
            <line x1="147.17451721832956" y1="0.0" x2="147.17451721832956" y2="221.0" stroke="rgb(233,233,233)" stroke-opacity="1.0" stroke-width="1.0" fill="none">
            </line>
            <line x1="188.63212770236606" y1="0.0" x2="188.63212770236606" y2="221.0" stroke="rgb(233,233,233)" stroke-opacity="1.0" stroke-width="1.0" fill="none">
            </line>
            <line x1="230.08973818640254" y1="0.0" x2="230.08973818640254" y2="221.0" stroke="rgb(233,233,233)" stroke-opacity="1.0" stroke-width="1.0" fill="none">
            </line>
            <line x1="271.547348670439" y1="0.0" x2="271.547348670439" y2="221.0" stroke="rgb(233,233,233)" stroke-opacity="1.0" stroke-width="1.0" fill="none">
            </line>
            <line x1="313.0049591544755" y1="0.0" x2="313.0049591544755" y2="221.0" stroke="rgb(233,233,233)" stroke-opacity="1.0" stroke-width="1.0" fill="none">
            </line>
            <line x1="354.46256963851204" y1="0.0" x2="354.46256963851204" y2="221.0" stroke="rgb(233,233,233)" stroke-opacity="1.0" stroke-width="1.0" fill="none">
            </line>
            <line x1="395.9201801225485" y1="0.0" x2="395.9201801225485" y2="221.0" stroke="rgb(233,233,233)" stroke-opacity="1.0" stroke-width="1.0" fill="none">
            </line>
            <line x1="437.377790606585" y1="0.0" x2="437.377790606585" y2="221.0" stroke="rgb(233,233,233)" stroke-opacity="1.0" stroke-width="1.0" fill="none">
            </line>
          </g>
        </g>
        <g transform="translate(13.980605455468202 0.0 ) ">
          <g>
            <line x1="0.0" y1="206.58695652173913" x2="501.6370868568416" y2="206.58695652173913" stroke="rgb(233,233,233)" stroke-opacity="1.0" stroke-width="1.0" fill="none">
            </line>
            <line x1="0.0" y1="174.55797101449275" x2="501.6370868568416" y2="174.55797101449275" stroke="rgb(233,233,233)" stroke-opacity="1.0" stroke-width="1.0" fill="none">
            </line>
            <line x1="0.0" y1="142.52898550724638" x2="501.6370868568416" y2="142.52898550724638" stroke="rgb(233,233,233)" stroke-opacity="1.0" stroke-width="1.0" fill="none">
            </line>
            <line x1="0.0" y1="110.5" x2="501.6370868568416" y2="110.5" stroke="rgb(233,233,233)" stroke-opacity="1.0" stroke-width="1.0" fill="none">
            </line>
            <line x1="0.0" y1="78.47101449275362" x2="501.6370868568416" y2="78.47101449275362" stroke="rgb(233,233,233)" stroke-opacity="1.0" stroke-width="1.0" fill="none">
            </line>
            <line x1="0.0" y1="46.44202898550725" x2="501.6370868568416" y2="46.44202898550725" stroke="rgb(233,233,233)" stroke-opacity="1.0" stroke-width="1.0" fill="none">
            </line>
            <line x1="0.0" y1="14.413043478260875" x2="501.6370868568416" y2="14.413043478260875" stroke="rgb(233,233,233)" stroke-opacity="1.0" stroke-width="1.0" fill="none">
            </line>
          </g>
        </g>
      </g>
      <g clip-path="url(#ctm1zZQ)" clip-bounds-jfx="[rect (13.980605455468202, 0.0), (501.6370868568416, 221.0)]">
        <g transform="translate(13.980605455468202 0.0 ) ">
          <g>
            <g>
              <g>
                <g >
                  <rect fill="#fbb4ae" stroke="#ffffff" stroke-width="0.0" x="45.60337153244015" y="198.57971014492753" height="16.014492753623188" width="37.31184943563284" />
                  <rect fill="#fbb4ae" stroke="#ffffff" stroke-width="0.0" x="87.06098201647664" y="198.57971014492753" height="16.014492753623188" width="37.31184943563285" />
                  <rect fill="#fbb4ae" stroke="#ffffff" stroke-width="0.0" x="128.51859250051314" y="198.57971014492753" height="16.014492753623188" width="37.31184943563284" />
                  <rect fill="#fbb4ae" stroke="#ffffff" stroke-width="0.0" x="87.06098201647664" y="166.55072463768116" height="16.014492753623188" width="37.31184943563285" />
                  <rect fill="#fbb4ae" stroke="#ffffff" stroke-width="0.0" x="128.51859250051314" y="166.55072463768116" height="16.014492753623188" width="37.31184943563284" />
                  <rect fill="#fbb4ae" stroke="#ffffff" stroke-width="0.0" x="169.97620298454962" y="166.55072463768116" height="16.014492753623188" width="37.31184943563284" />
                  <rect fill="#fbb4ae" stroke="#ffffff" stroke-width="0.0" x="128.51859250051314" y="134.52173913043478" height="16.014492753623188" width="37.31184943563284" />
                  <rect fill="#fbb4ae" stroke="#ffffff" stroke-width="0.0" x="169.97620298454962" y="134.52173913043478" height="16.014492753623188" width="37.31184943563284" />
                  <rect fill="#fbb4ae" stroke="#ffffff" stroke-width="0.0" x="211.43381346858612" y="134.52173913043478" height="16.014492753623188" width="37.31184943563284" />
                  <rect fill="#fbb4ae" stroke="#ffffff" stroke-width="0.0" x="169.97620298454962" y="102.4927536231884" height="16.014492753623188" width="37.31184943563284" />
                  <rect fill="#fbb4ae" stroke="#ffffff" stroke-width="0.0" x="211.43381346858612" y="102.4927536231884" height="16.014492753623188" width="37.31184943563284" />
                  <rect fill="#fbb4ae" stroke="#ffffff" stroke-width="0.0" x="252.8914239526226" y="102.4927536231884" height="16.014492753623188" width="37.311849435632865" />
                  <rect fill="#fbb4ae" stroke="#ffffff" stroke-width="0.0" x="211.43381346858612" y="70.46376811594203" height="16.014492753623188" width="37.31184943563284" />
                  <rect fill="#fbb4ae" stroke="#ffffff" stroke-width="0.0" x="252.8914239526226" y="70.46376811594203" height="16.014492753623188" width="37.311849435632865" />
                  <rect fill="#fbb4ae" stroke="#ffffff" stroke-width="0.0" x="294.3490344366591" y="70.46376811594203" height="16.014492753623188" width="37.31184943563284" />
                  <rect fill="#fbb4ae" stroke="#ffffff" stroke-width="0.0" x="252.8914239526226" y="38.434782608695656" height="16.014492753623188" width="37.311849435632865" />
                  <rect fill="#fbb4ae" stroke="#ffffff" stroke-width="0.0" x="294.3490344366591" y="38.434782608695656" height="16.014492753623188" width="37.31184943563284" />
                  <rect fill="#fbb4ae" stroke="#ffffff" stroke-width="0.0" x="335.8066449206956" y="38.434782608695656" height="16.014492753623188" width="37.31184943563284" />
                  <rect fill="#fbb4ae" stroke="#ffffff" stroke-width="0.0" x="294.3490344366591" y="6.405797101449281" height="16.014492753623188" width="37.31184943563284" />
                  <rect fill="#fbb4ae" stroke="#ffffff" stroke-width="0.0" x="335.8066449206956" y="6.405797101449281" height="16.014492753623188" width="37.31184943563284" />
                  <rect fill="#fbb4ae" stroke="#ffffff" stroke-width="0.0" x="377.26425540473207" y="6.405797101449281" height="16.014492753623188" width="37.31184943563284" />
                  <rect fill="#b3cde3" stroke="#ffffff" stroke-width="0.0" x="169.97620298454962" y="198.57971014492753" height="16.014492753623188" width="37.31184943563284" />
                  <rect fill="#b3cde3" stroke="#ffffff" stroke-width="0.0" x="211.43381346858612" y="198.57971014492753" height="16.014492753623188" width="37.31184943563284" />
                  <rect fill="#b3cde3" stroke="#ffffff" stroke-width="0.0" x="252.8914239526226" y="198.57971014492753" height="16.014492753623188" width="37.311849435632865" />
                  <rect fill="#b3cde3" stroke="#ffffff" stroke-width="0.0" x="294.3490344366591" y="198.57971014492753" height="16.014492753623188" width="37.31184943563284" />
                  <rect fill="#b3cde3" stroke="#ffffff" stroke-width="0.0" x="335.8066449206956" y="198.57971014492753" height="16.014492753623188" width="37.31184943563284" />
                  <rect fill="#b3cde3" stroke="#ffffff" stroke-width="0.0" x="377.26425540473207" y="198.57971014492753" height="16.014492753623188" width="37.31184943563284" />
                  <rect fill="#b3cde3" stroke="#ffffff" stroke-width="0.0" x="418.7218658887686" y="198.57971014492753" height="16.014492753623188" width="37.311849435632894" />
                  <rect fill="#b3cde3" stroke="#ffffff" stroke-width="0.0" x="211.43381346858612" y="166.55072463768116" height="16.014492753623188" width="37.31184943563284" />
                  <rect fill="#b3cde3" stroke="#ffffff" stroke-width="0.0" x="252.8914239526226" y="166.55072463768116" height="16.014492753623188" width="37.311849435632865" />
                  <rect fill="#b3cde3" stroke="#ffffff" stroke-width="0.0" x="294.3490344366591" y="166.55072463768116" height="16.014492753623188" width="37.31184943563284" />
                  <rect fill="#b3cde3" stroke="#ffffff" stroke-width="0.0" x="335.8066449206956" y="166.55072463768116" height="16.014492753623188" width="37.31184943563284" />
                  <rect fill="#b3cde3" stroke="#ffffff" stroke-width="0.0" x="377.26425540473207" y="166.55072463768116" height="16.014492753623188" width="37.31184943563284" />
                  <rect fill="#b3cde3" stroke="#ffffff" stroke-width="0.0" x="418.7218658887686" y="166.55072463768116" height="16.014492753623188" width="37.311849435632894" />
                  <rect fill="#b3cde3" stroke="#ffffff" stroke-width="0.0" x="252.8914239526226" y="134.52173913043478" height="16.014492753623188" width="37.311849435632865" />
                  <rect fill="#b3cde3" stroke="#ffffff" stroke-width="0.0" x="294.3490344366591" y="134.52173913043478" height="16.014492753623188" width="37.31184943563284" />
                  <rect fill="#b3cde3" stroke="#ffffff" stroke-width="0.0" x="335.8066449206956" y="134.52173913043478" height="16.014492753623188" width="37.31184943563284" />
                  <rect fill="#b3cde3" stroke="#ffffff" stroke-width="0.0" x="377.26425540473207" y="134.52173913043478" height="16.014492753623188" width="37.31184943563284" />
                  <rect fill="#b3cde3" stroke="#ffffff" stroke-width="0.0" x="418.7218658887686" y="134.52173913043478" height="16.014492753623188" width="37.311849435632894" />
                  <rect fill="#b3cde3" stroke="#ffffff" stroke-width="0.0" x="294.3490344366591" y="102.4927536231884" height="16.014492753623188" width="37.31184943563284" />
                  <rect fill="#b3cde3" stroke="#ffffff" stroke-width="0.0" x="335.8066449206956" y="102.4927536231884" height="16.014492753623188" width="37.31184943563284" />
                  <rect fill="#b3cde3" stroke="#ffffff" stroke-width="0.0" x="377.26425540473207" y="102.4927536231884" height="16.014492753623188" width="37.31184943563284" />
                  <rect fill="#b3cde3" stroke="#ffffff" stroke-width="0.0" x="418.7218658887686" y="102.4927536231884" height="16.014492753623188" width="37.311849435632894" />
                  <rect fill="#b3cde3" stroke="#ffffff" stroke-width="0.0" x="335.8066449206956" y="70.46376811594203" height="16.014492753623188" width="37.31184943563284" />
                  <rect fill="#b3cde3" stroke="#ffffff" stroke-width="0.0" x="377.26425540473207" y="70.46376811594203" height="16.014492753623188" width="37.31184943563284" />
                  <rect fill="#b3cde3" stroke="#ffffff" stroke-width="0.0" x="418.7218658887686" y="70.46376811594203" height="16.014492753623188" width="37.311849435632894" />
                  <rect fill="#b3cde3" stroke="#ffffff" stroke-width="0.0" x="377.26425540473207" y="38.434782608695656" height="16.014492753623188" width="37.31184943563284" />
                  <rect fill="#b3cde3" stroke="#ffffff" stroke-width="0.0" x="418.7218658887686" y="38.434782608695656" height="16.014492753623188" width="37.311849435632894" />
                  <rect fill="#b3cde3" stroke="#ffffff" stroke-width="0.0" x="418.7218658887686" y="6.405797101449281" height="16.014492753623188" width="37.311849435632894" />
                </g>
              </g>
            </g>
          </g>
        </g>
        <defs>
          <clipPath id="ctm1zZQ">
            <rect x="13.980605455468202" y="0.0" width="501.6370868568416" height="221.0">
            </rect>
          </clipPath>
        </defs>
      </g>
      <g>
        <g transform="translate(13.980605455468202 221.0 ) ">
          <g transform="translate(64.25929625025657 0.0 ) ">
            <line stroke-width="1.0" stroke="rgb(71,71,71)" stroke-opacity="1.0" x2="0.0" y2="4.0">
            </line>
            <g transform="translate(0.0 7.0 ) ">
              <text class="axis-text-x" text-anchor="middle" dy="0.7em" y="0.0">
                <tspan>0</tspan>
              </text>
            </g>
          </g>
          <g transform="translate(105.71690673429306 0.0 ) ">
            <line stroke-width="1.0" stroke="rgb(71,71,71)" stroke-opacity="1.0" x2="0.0" y2="4.0">
            </line>
            <g transform="translate(0.0 7.0 ) ">
              <text class="axis-text-x" text-anchor="middle" dy="0.7em" y="0.0">
                <tspan>1</tspan>
              </text>
            </g>
          </g>
          <g transform="translate(147.17451721832956 0.0 ) ">
            <line stroke-width="1.0" stroke="rgb(71,71,71)" stroke-opacity="1.0" x2="0.0" y2="4.0">
            </line>
            <g transform="translate(0.0 7.0 ) ">
              <text class="axis-text-x" text-anchor="middle" dy="0.7em" y="0.0">
                <tspan>2</tspan>
              </text>
            </g>
          </g>
          <g transform="translate(188.63212770236606 0.0 ) ">
            <line stroke-width="1.0" stroke="rgb(71,71,71)" stroke-opacity="1.0" x2="0.0" y2="4.0">
            </line>
            <g transform="translate(0.0 7.0 ) ">
              <text class="axis-text-x" text-anchor="middle" dy="0.7em" y="0.0">
                <tspan>3</tspan>
              </text>
            </g>
          </g>
          <g transform="translate(230.08973818640254 0.0 ) ">
            <line stroke-width="1.0" stroke="rgb(71,71,71)" stroke-opacity="1.0" x2="0.0" y2="4.0">
            </line>
            <g transform="translate(0.0 7.0 ) ">
              <text class="axis-text-x" text-anchor="middle" dy="0.7em" y="0.0">
                <tspan>4</tspan>
              </text>
            </g>
          </g>
          <g transform="translate(271.547348670439 0.0 ) ">
            <line stroke-width="1.0" stroke="rgb(71,71,71)" stroke-opacity="1.0" x2="0.0" y2="4.0">
            </line>
            <g transform="translate(0.0 7.0 ) ">
              <text class="axis-text-x" text-anchor="middle" dy="0.7em" y="0.0">
                <tspan>5</tspan>
              </text>
            </g>
          </g>
          <g transform="translate(313.0049591544755 0.0 ) ">
            <line stroke-width="1.0" stroke="rgb(71,71,71)" stroke-opacity="1.0" x2="0.0" y2="4.0">
            </line>
            <g transform="translate(0.0 7.0 ) ">
              <text class="axis-text-x" text-anchor="middle" dy="0.7em" y="0.0">
                <tspan>6</tspan>
              </text>
            </g>
          </g>
          <g transform="translate(354.46256963851204 0.0 ) ">
            <line stroke-width="1.0" stroke="rgb(71,71,71)" stroke-opacity="1.0" x2="0.0" y2="4.0">
            </line>
            <g transform="translate(0.0 7.0 ) ">
              <text class="axis-text-x" text-anchor="middle" dy="0.7em" y="0.0">
                <tspan>7</tspan>
              </text>
            </g>
          </g>
          <g transform="translate(395.9201801225485 0.0 ) ">
            <line stroke-width="1.0" stroke="rgb(71,71,71)" stroke-opacity="1.0" x2="0.0" y2="4.0">
            </line>
            <g transform="translate(0.0 7.0 ) ">
              <text class="axis-text-x" text-anchor="middle" dy="0.7em" y="0.0">
                <tspan>8</tspan>
              </text>
            </g>
          </g>
          <g transform="translate(437.377790606585 0.0 ) ">
            <line stroke-width="1.0" stroke="rgb(71,71,71)" stroke-opacity="1.0" x2="0.0" y2="4.0">
            </line>
            <g transform="translate(0.0 7.0 ) ">
              <text class="axis-text-x" text-anchor="middle" dy="0.7em" y="0.0">
                <tspan>9</tspan>
              </text>
            </g>
          </g>
          <line x1="0.0" y1="0.0" x2="501.6370868568416" y2="0.0" stroke-width="1.0" stroke="rgb(71,71,71)" stroke-opacity="1.0">
          </line>
        </g>
        <g transform="translate(13.980605455468202 0.0 ) ">
          <g transform="translate(0.0 206.58695652173913 ) ">
            <g transform="translate(-3.0 0.0 ) ">
              <text class="axis-text-y" text-anchor="end" dy="0.35em" y="0.0">
                <tspan>1</tspan>
              </text>
            </g>
          </g>
          <g transform="translate(0.0 174.55797101449275 ) ">
            <g transform="translate(-3.0 0.0 ) ">
              <text class="axis-text-y" text-anchor="end" dy="0.35em" y="0.0">
                <tspan>2</tspan>
              </text>
            </g>
          </g>
          <g transform="translate(0.0 142.52898550724638 ) ">
            <g transform="translate(-3.0 0.0 ) ">
              <text class="axis-text-y" text-anchor="end" dy="0.35em" y="0.0">
                <tspan>3</tspan>
              </text>
            </g>
          </g>
          <g transform="translate(0.0 110.5 ) ">
            <g transform="translate(-3.0 0.0 ) ">
              <text class="axis-text-y" text-anchor="end" dy="0.35em" y="0.0">
                <tspan>4</tspan>
              </text>
            </g>
          </g>
          <g transform="translate(0.0 78.47101449275362 ) ">
            <g transform="translate(-3.0 0.0 ) ">
              <text class="axis-text-y" text-anchor="end" dy="0.35em" y="0.0">
                <tspan>5</tspan>
              </text>
            </g>
          </g>
          <g transform="translate(0.0 46.44202898550725 ) ">
            <g transform="translate(-3.0 0.0 ) ">
              <text class="axis-text-y" text-anchor="end" dy="0.35em" y="0.0">
                <tspan>6</tspan>
              </text>
            </g>
          </g>
          <g transform="translate(0.0 14.413043478260875 ) ">
            <g transform="translate(-3.0 0.0 ) ">
              <text class="axis-text-y" text-anchor="end" dy="0.35em" y="0.0">
                <tspan>7</tspan>
              </text>
            </g>
          </g>
        </g>
      </g>
    </g>
    <g transform="translate(43.4806054554682 16.8 ) ">
      <text class="plot-title" y="0.0">
        <tspan>Rolling Window</tspan>
      </text>
    </g>
    <g transform="translate(16.0 137.0 ) rotate(-90.0 ) ">
      <text class="axis-title-y" y="0.0" text-anchor="middle">
        <tspan>μ</tspan>
      </text>
    </g>
    <g transform="translate(294.299148883889 293.0 ) ">
      <text class="axis-title-x" y="0.0" text-anchor="middle">
        <tspan>t</tspan>
      </text>
    </g>
    <g transform="translate(556.6176923123098 97.75 ) ">
      <rect x="0.0" y="0.0" height="78.5" width="143.38230768769014" stroke="rgb(71,71,71)" stroke-opacity="1.0" stroke-width="0.0" fill="rgb(255,255,255)" fill-opacity="1.0">
      </rect>
      <g transform="translate(5.0 5.0 ) ">
        <g transform="translate(0.0 12.0 ) ">
          <text class="legend-title" y="0.0">
            <tspan>sample</tspan>
          </text>
        </g>
        <g transform="translate(0.0 22.5 ) ">
          <g transform="">
            <g>
              <g transform="translate(1.0 1.0 ) ">
                <g>
                  <rect x="0.0" y="0.0" height="21.0" width="21.0" stroke="rgb(255,255,255)" stroke-opacity="1.0" fill="rgb(251,180,174)" fill-opacity="1.0" stroke-width="1.5">
                  </rect>
                </g>
              </g>
            </g>
            <g transform="translate(26.9903027277341 16.05 ) ">
              <text class="legend-item" y="0.0">
                <tspan>in-sample</tspan>
              </text>
            </g>
          </g>
          <g transform="translate(0.0 23.0 ) ">
            <g>
              <g transform="translate(1.0 1.0 ) ">
                <g>
                  <rect x="0.0" y="0.0" height="21.0" width="21.0" stroke="rgb(255,255,255)" stroke-opacity="1.0" fill="rgb(179,205,227)" fill-opacity="1.0" stroke-width="1.5">
                  </rect>
                </g>
              </g>
            </g>
            <g transform="translate(26.9903027277341 16.05 ) ">
              <text class="legend-item" y="0.0">
                <tspan>out-of-sample</tspan>
              </text>
            </g>
          </g>
        </g>
      </g>
    </g>
    <path fill="rgb(0,0,0)" fill-opacity="0.0" stroke="rgb(71,71,71)" stroke-opacity="1.0" stroke-width="0.0" d="M0.0 0.0 L0.0 300.0 L700.0 300.0 L700.0 0.0 Z" pointer-events="none">
    </path>
  </g>
  <g id="dOK0vyP">
  </g>
</svg></div></div>
</div>
<section id="the-likely-best-possible-rolling-window-forecast">
<h3>The Likely Best Possible Rolling Window Forecast<a class="headerlink" href="#the-likely-best-possible-rolling-window-forecast" title="Link to this heading">#</a></h3>
<p>As with the expanding window, we want to know how models will perform in practice and that the best version of it is being assessed. To address both of these points, we need to make a choice from the possible out-of-sample predictions because we have several for the same value of <span class="math notranslate nohighlight">\(t\)</span>:</p>
<ul class="simple">
<li><p><span class="math notranslate nohighlight">\(|\mu|\)</span> out-of-sample prediction models for <span class="math notranslate nohighlight">\(t=T-1\)</span></p></li>
<li><p><span class="math notranslate nohighlight">\(|\mu|-1\)</span> out-of-sample prediction models for <span class="math notranslate nohighlight">\(t=T-2\)</span></p></li>
<li><p>and so on…</p></li>
</ul>
<p>To do this we create the <em>union</em> of step ahead out-of-sample forecasts. Step ahead because that’s what will likely be the best forecast (as opposed to many steps ahead) while still being out-of-sample. Because there are no <em>guarantees</em> which out-of-sample forecast will be best, it might be more accurate to call this the <em>preferred</em> or <em>one-step ahead</em> out-of-sample rolling window forecast. For each possible value of <span class="math notranslate nohighlight">\(t\)</span>, this is the out-of-sample prediction with the highest possible value of <span class="math notranslate nohighlight">\(\mu\)</span>:</p>
<div class="math notranslate nohighlight">
\[
\mathcal{O}^{r} = \bigcup_\mu  \bigg\{ f_\mu\left(O_\mu^r(X)\right) \bigg\}_{t=\mu s+ \alpha }^{t=(\mu+1)s -1+ \alpha}
\]</div>
<p>in the diagram above, it’s the longest diagonal of out-of-sample predictions. Equivalently, the out-of-sample prediction set is composed of the first step of each test set indexed by <span class="math notranslate nohighlight">\(\mu\)</span>. In each case, these out-of-sample predictions are likely to be better than ones for other values of <span class="math notranslate nohighlight">\(\mu\)</span> because they are trained on models that are closer in time to the value that is being predicted.</p>
<p>Let’s work this out using code too. First, we define function thats, given a data frame with a time index as defined earlier, can return the in-sample or out-of-sample rows. For out-of-sample, the slices range from <span class="math notranslate nohighlight">\(\mu\cdot s + \alpha\)</span> to <span class="math notranslate nohighlight">\(T-1\)</span> (inclusive), so will become <code class="docutils literal notranslate"><span class="pre">range(mu</span> <span class="pre">*</span> <span class="pre">s</span> <span class="pre">+</span> <span class="pre">alpha,</span> <span class="pre">T,</span> <span class="pre">step_size)</span></code> inside the function. Likewise, the inclusive/exclusive distinction applies to the in-sample slice, which will have <code class="docutils literal notranslate"><span class="pre">range((mu</span> <span class="pre">-</span> <span class="pre">1)</span> <span class="pre">*</span> <span class="pre">s,</span> <span class="pre">mu</span> <span class="pre">*</span> <span class="pre">s</span> <span class="pre">+</span> <span class="pre">alpha,</span> <span class="pre">s)</span></code> for <span class="math notranslate nohighlight">\((\mu-1)\cdot s\)</span> to <span class="math notranslate nohighlight">\(\mu\cdot s+\alpha -1\)</span>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">in_sample_block_r</span><span class="p">(</span><span class="n">mu</span><span class="p">,</span> <span class="n">s</span><span class="p">,</span> <span class="n">alpha</span><span class="p">,</span> <span class="n">T</span><span class="p">):</span>
    <span class="n">xf</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span><span class="s2">&quot;t&quot;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">((</span><span class="n">mu</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="n">s</span><span class="p">,</span> <span class="n">mu</span> <span class="o">*</span> <span class="n">s</span> <span class="o">+</span> <span class="n">alpha</span><span class="p">,</span> <span class="n">s</span><span class="p">)})</span>
    <span class="n">xf</span><span class="p">[</span><span class="s2">&quot;μ&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">mu</span><span class="p">]</span> <span class="o">*</span> <span class="p">(</span><span class="n">mu</span> <span class="o">*</span> <span class="n">s</span> <span class="o">+</span> <span class="n">alpha</span> <span class="o">-</span> <span class="p">(</span><span class="n">mu</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="n">s</span><span class="p">)</span>
    <span class="n">xf</span><span class="p">[</span><span class="s2">&quot;sample&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;in-sample&quot;</span>
    <span class="k">return</span> <span class="n">xf</span>


<span class="k">def</span><span class="w"> </span><span class="nf">os_sample_block_r</span><span class="p">(</span><span class="n">mu</span><span class="p">,</span> <span class="n">s</span><span class="p">,</span> <span class="n">alpha</span><span class="p">,</span> <span class="n">T</span><span class="p">):</span>
    <span class="n">xf</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span><span class="s2">&quot;t&quot;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">mu</span> <span class="o">*</span> <span class="n">s</span> <span class="o">+</span> <span class="n">alpha</span><span class="p">,</span> <span class="n">T</span><span class="p">,</span> <span class="n">s</span><span class="p">)})</span>
    <span class="n">xf</span><span class="p">[</span><span class="s2">&quot;μ&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">mu</span><span class="p">]</span> <span class="o">*</span> <span class="p">(</span><span class="n">T</span> <span class="o">-</span> <span class="p">(</span><span class="n">mu</span> <span class="o">*</span> <span class="n">s</span> <span class="o">+</span> <span class="n">alpha</span><span class="p">))</span>
    <span class="n">xf</span><span class="p">[</span><span class="s2">&quot;sample&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;out-of-sample&quot;</span>
    <span class="k">return</span> <span class="n">xf</span>
</pre></div>
</div>
</div>
</div>
<p>Having defined these, we can compute the unions of best in- and out-of-sample predictions. For the expanding window case, we ended up repeating some of the same code. This is bad practice. We can do better by putting all of the common elements into a single function:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Config:</span>
<span class="n">s</span> <span class="o">=</span> <span class="mi">1</span>
<span class="n">alpha</span> <span class="o">=</span> <span class="mi">2</span>
<span class="n">window_size</span> <span class="o">=</span> <span class="n">s</span> <span class="o">+</span> <span class="n">alpha</span>
<span class="n">T</span> <span class="o">=</span> <span class="mi">10</span>


<span class="k">def</span><span class="w"> </span><span class="nf">return_rolling_union_of_slices</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">alpha</span><span class="p">,</span> <span class="n">T</span><span class="p">,</span> <span class="n">out_of_sample</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Returns a dataframe explaining where the best in-sample or out-of-sample forecasts are</span>
<span class="sd">    for a a given stepsize (s), alpha (=windowsize-s), and total number of time steps of</span>
<span class="sd">    the data (T).</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">out_of_sample</span><span class="p">:</span>
        <span class="n">slice_function</span> <span class="o">=</span> <span class="n">os_sample_block_r</span>
        <span class="n">keep_string</span> <span class="o">=</span> <span class="s2">&quot;last&quot;</span>
    <span class="k">elif</span> <span class="ow">not</span> <span class="n">out_of_sample</span><span class="p">:</span>
        <span class="n">slice_function</span> <span class="o">=</span> <span class="n">in_sample_block_r</span>
        <span class="n">keep_string</span> <span class="o">=</span> <span class="s2">&quot;first&quot;</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;out_of_sample must be True or False (and of type bool).&quot;</span><span class="p">)</span>

    <span class="n">max_mu</span> <span class="o">=</span> <span class="nb">int</span><span class="p">((</span><span class="n">T</span> <span class="o">-</span> <span class="mi">1</span> <span class="o">+</span> <span class="mi">1</span> <span class="o">-</span> <span class="n">alpha</span><span class="p">)</span> <span class="o">/</span> <span class="n">s</span><span class="p">)</span>
    <span class="n">union</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">(</span>
        <span class="p">[</span><span class="n">slice_function</span><span class="p">(</span><span class="n">mu</span><span class="p">,</span> <span class="n">s</span><span class="p">,</span> <span class="n">alpha</span><span class="p">,</span> <span class="n">T</span><span class="p">)</span> <span class="k">for</span> <span class="n">mu</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">max_mu</span><span class="p">)],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span>
    <span class="p">)</span>
    <span class="n">union</span> <span class="o">=</span> <span class="n">union</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">union</span><span class="p">[</span><span class="s2">&quot;Preferred Prediction&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="n">union</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span>
        <span class="n">union</span><span class="p">[</span><span class="o">~</span><span class="n">union</span><span class="p">[</span><span class="s2">&quot;t&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">duplicated</span><span class="p">(</span><span class="n">keep</span><span class="o">=</span><span class="n">keep_string</span><span class="p">)]</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="s2">&quot;Preferred Prediction&quot;</span>
    <span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="k">return</span> <span class="n">union</span>


<span class="n">script_I_r</span> <span class="o">=</span> <span class="n">return_rolling_union_of_slices</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">alpha</span><span class="p">,</span> <span class="n">T</span><span class="p">,</span> <span class="n">out_of_sample</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="n">script_O_r</span> <span class="o">=</span> <span class="n">return_rolling_union_of_slices</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">alpha</span><span class="p">,</span> <span class="n">T</span><span class="p">,</span> <span class="n">out_of_sample</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">script_O_r</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>t</th>
      <th>μ</th>
      <th>sample</th>
      <th>Preferred Prediction</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>3</td>
      <td>1</td>
      <td>out-of-sample</td>
      <td>True</td>
    </tr>
    <tr>
      <th>1</th>
      <td>4</td>
      <td>1</td>
      <td>out-of-sample</td>
      <td>False</td>
    </tr>
    <tr>
      <th>2</th>
      <td>5</td>
      <td>1</td>
      <td>out-of-sample</td>
      <td>False</td>
    </tr>
    <tr>
      <th>3</th>
      <td>6</td>
      <td>1</td>
      <td>out-of-sample</td>
      <td>False</td>
    </tr>
    <tr>
      <th>4</th>
      <td>7</td>
      <td>1</td>
      <td>out-of-sample</td>
      <td>False</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>Let’s plot the union of best rolling out-of-sample predictions:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="p">(</span>
    <span class="n">ggplot</span><span class="p">(</span><span class="n">script_O_r</span><span class="p">,</span> <span class="n">aes</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="s2">&quot;t&quot;</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="n">as_discrete</span><span class="p">(</span><span class="s2">&quot;μ&quot;</span><span class="p">),</span> <span class="n">fill</span><span class="o">=</span><span class="s2">&quot;Preferred Prediction&quot;</span><span class="p">))</span>
    <span class="o">+</span> <span class="n">geom_tile</span><span class="p">(</span><span class="o">**</span><span class="n">width_height_tiles</span><span class="p">)</span>
    <span class="o">+</span> <span class="n">scale_x_continuous</span><span class="p">(</span><span class="n">breaks</span><span class="o">=</span><span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="n">T</span><span class="p">)),</span> <span class="n">limits</span><span class="o">=</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">T</span><span class="p">),</span> <span class="nb">format</span><span class="o">=</span><span class="s2">&quot;d&quot;</span><span class="p">)</span>
    <span class="o">+</span> <span class="n">scale_y_continuous</span><span class="p">(</span><span class="n">breaks</span><span class="o">=</span><span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">max_mu</span><span class="p">)),</span> <span class="nb">format</span><span class="o">=</span><span class="s2">&quot;d&quot;</span><span class="p">)</span>
    <span class="o">+</span> <span class="n">scale_fill_brewer</span><span class="p">(</span><span class="nb">type</span><span class="o">=</span><span class="s2">&quot;qual&quot;</span><span class="p">,</span> <span class="n">palette</span><span class="o">=</span><span class="s2">&quot;Pastel1&quot;</span><span class="p">)</span>
    <span class="o">+</span> <span class="n">ggtitle</span><span class="p">(</span><span class="s2">&quot;Union of Rolling Window One Step </span><span class="se">\n</span><span class="s2">Ahead Out-of-Sample Predictions&quot;</span><span class="p">)</span>
    <span class="o">+</span> <span class="n">ggsize</span><span class="p">(</span><span class="mi">700</span><span class="p">,</span> <span class="mi">300</span><span class="p">)</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" display="block" class="plt-container" width="700.0" height="300.0">
  <style type="text/css">
  .plt-container {
   font-family: Lucida Grande, sans-serif;
   user-select: none;
   -webkit-user-select: none;
   -moz-user-select: none;
   -ms-user-select: none;
}
text {
   text-rendering: optimizeLegibility;
}
#pE5gEoo .plot-title {
fill: #474747;
font-weight: normal;
   font-style: normal;font-family: Lucida Grande, sans-serif;
font-size: 16.0px;

}
#pE5gEoo .plot-subtitle {
fill: #474747;
font-weight: normal;
   font-style: normal;font-family: Lucida Grande, sans-serif;
font-size: 15.0px;

}
#pE5gEoo .plot-caption {
fill: #474747;
font-weight: normal;
   font-style: normal;font-family: Lucida Grande, sans-serif;
font-size: 13.0px;

}
#pE5gEoo .hyperlink-element {
fill: #118ed8;
font-weight: normal;
   font-style: normal;
}
#pE5gEoo .legend-title {
fill: #474747;
font-weight: normal;
   font-style: normal;font-family: Lucida Grande, sans-serif;
font-size: 15.0px;

}
#pE5gEoo .legend-item {
fill: #474747;
font-weight: normal;
   font-style: normal;font-family: Lucida Grande, sans-serif;
font-size: 13.0px;

}
#pE5gEoo .axis-title-x {
fill: #474747;
font-weight: normal;
   font-style: normal;font-family: Lucida Grande, sans-serif;
font-size: 15.0px;

}
#pE5gEoo .axis-text-x {
fill: #474747;
font-weight: normal;
   font-style: normal;font-family: Lucida Grande, sans-serif;
font-size: 13.0px;

}
#da2bbtm .axis-tooltip-text-x {
fill: #ffffff;
font-weight: normal;
   font-style: normal;font-family: Lucida Grande, sans-serif;
font-size: 13.0px;

}
#pE5gEoo .axis-title-y {
fill: #474747;
font-weight: normal;
   font-style: normal;font-family: Lucida Grande, sans-serif;
font-size: 15.0px;

}
#pE5gEoo .axis-text-y {
fill: #474747;
font-weight: normal;
   font-style: normal;font-family: Lucida Grande, sans-serif;
font-size: 13.0px;

}
#da2bbtm .axis-tooltip-text-y {
fill: #ffffff;
font-weight: normal;
   font-style: normal;font-family: Lucida Grande, sans-serif;
font-size: 13.0px;

}
#pE5gEoo .facet-strip-text-x {
fill: #474747;
font-weight: normal;
   font-style: normal;font-family: Lucida Grande, sans-serif;
font-size: 13.0px;

}
#pE5gEoo .facet-strip-text-y {
fill: #474747;
font-weight: normal;
   font-style: normal;font-family: Lucida Grande, sans-serif;
font-size: 13.0px;

}
#da2bbtm .tooltip-text {
fill: #474747;
font-weight: normal;
   font-style: normal;font-family: Lucida Grande, sans-serif;
font-size: 13.0px;

}
#da2bbtm .tooltip-title {
fill: #474747;
font-weight: bold;
   font-style: normal;font-family: Lucida Grande, sans-serif;
font-size: 13.0px;

}
#da2bbtm .tooltip-label {
fill: #474747;
font-weight: bold;
   font-style: normal;font-family: Lucida Grande, sans-serif;
font-size: 13.0px;

}

  </style>
  <g id="pE5gEoo">
    <path fill-rule="evenodd" fill="rgb(255,255,255)" fill-opacity="1.0" d="M0.0 0.0 L0.0 300.0 L700.0 300.0 L700.0 0.0 Z">
    </path>
    <g transform="translate(29.5 42.5 ) ">
      <g>
        <g transform="translate(13.980605455468202 0.0 ) ">
          <g>
            <line x1="61.06903773416335" y1="0.0" x2="61.06903773416335" y2="205.0" stroke="rgb(233,233,233)" stroke-opacity="1.0" stroke-width="1.0" fill="none">
            </line>
            <line x1="100.46841691749455" y1="0.0" x2="100.46841691749455" y2="205.0" stroke="rgb(233,233,233)" stroke-opacity="1.0" stroke-width="1.0" fill="none">
            </line>
            <line x1="139.86779610082573" y1="0.0" x2="139.86779610082573" y2="205.0" stroke="rgb(233,233,233)" stroke-opacity="1.0" stroke-width="1.0" fill="none">
            </line>
            <line x1="179.26717528415693" y1="0.0" x2="179.26717528415693" y2="205.0" stroke="rgb(233,233,233)" stroke-opacity="1.0" stroke-width="1.0" fill="none">
            </line>
            <line x1="218.6665544674881" y1="0.0" x2="218.6665544674881" y2="205.0" stroke="rgb(233,233,233)" stroke-opacity="1.0" stroke-width="1.0" fill="none">
            </line>
            <line x1="258.0659336508193" y1="0.0" x2="258.0659336508193" y2="205.0" stroke="rgb(233,233,233)" stroke-opacity="1.0" stroke-width="1.0" fill="none">
            </line>
            <line x1="297.4653128341505" y1="0.0" x2="297.4653128341505" y2="205.0" stroke="rgb(233,233,233)" stroke-opacity="1.0" stroke-width="1.0" fill="none">
            </line>
            <line x1="336.86469201748173" y1="0.0" x2="336.86469201748173" y2="205.0" stroke="rgb(233,233,233)" stroke-opacity="1.0" stroke-width="1.0" fill="none">
            </line>
            <line x1="376.2640712008129" y1="0.0" x2="376.2640712008129" y2="205.0" stroke="rgb(233,233,233)" stroke-opacity="1.0" stroke-width="1.0" fill="none">
            </line>
            <line x1="415.6634503841441" y1="0.0" x2="415.6634503841441" y2="205.0" stroke="rgb(233,233,233)" stroke-opacity="1.0" stroke-width="1.0" fill="none">
            </line>
          </g>
        </g>
        <g transform="translate(13.980605455468202 0.0 ) ">
          <g>
            <line x1="0.0" y1="191.6304347826087" x2="476.7324881183075" y2="191.6304347826087" stroke="rgb(233,233,233)" stroke-opacity="1.0" stroke-width="1.0" fill="none">
            </line>
            <line x1="0.0" y1="161.92028985507247" x2="476.7324881183075" y2="161.92028985507247" stroke="rgb(233,233,233)" stroke-opacity="1.0" stroke-width="1.0" fill="none">
            </line>
            <line x1="0.0" y1="132.21014492753622" x2="476.7324881183075" y2="132.21014492753622" stroke="rgb(233,233,233)" stroke-opacity="1.0" stroke-width="1.0" fill="none">
            </line>
            <line x1="0.0" y1="102.5" x2="476.7324881183075" y2="102.5" stroke="rgb(233,233,233)" stroke-opacity="1.0" stroke-width="1.0" fill="none">
            </line>
            <line x1="0.0" y1="72.78985507246377" x2="476.7324881183075" y2="72.78985507246377" stroke="rgb(233,233,233)" stroke-opacity="1.0" stroke-width="1.0" fill="none">
            </line>
            <line x1="0.0" y1="43.07971014492753" x2="476.7324881183075" y2="43.07971014492753" stroke="rgb(233,233,233)" stroke-opacity="1.0" stroke-width="1.0" fill="none">
            </line>
            <line x1="0.0" y1="13.369565217391312" x2="476.7324881183075" y2="13.369565217391312" stroke="rgb(233,233,233)" stroke-opacity="1.0" stroke-width="1.0" fill="none">
            </line>
          </g>
        </g>
      </g>
      <g clip-path="url(#cF1zFEf)" clip-bounds-jfx="[rect (13.980605455468202, 0.0), (476.7324881183075, 205.0)]">
        <g transform="translate(13.980605455468202 0.0 ) ">
          <g>
            <g>
              <g>
                <g >
                  <rect fill="#fbb4ae" stroke="#ffffff" stroke-width="0.0" x="161.5374546516579" y="184.20289855072463" height="14.855072463768124" width="35.45944126499805" />
                  <rect fill="#b3cde3" stroke="#ffffff" stroke-width="0.0" x="200.93683383498907" y="184.20289855072463" height="14.855072463768124" width="35.45944126499808" />
                  <rect fill="#b3cde3" stroke="#ffffff" stroke-width="0.0" x="240.33621301832025" y="184.20289855072463" height="14.855072463768124" width="35.459441264998105" />
                  <rect fill="#b3cde3" stroke="#ffffff" stroke-width="0.0" x="279.73559220165146" y="184.20289855072463" height="14.855072463768124" width="35.45944126499808" />
                  <rect fill="#b3cde3" stroke="#ffffff" stroke-width="0.0" x="319.1349713849827" y="184.20289855072463" height="14.855072463768124" width="35.45944126499808" />
                  <rect fill="#b3cde3" stroke="#ffffff" stroke-width="0.0" x="358.53435056831387" y="184.20289855072463" height="14.855072463768124" width="35.45944126499802" />
                  <rect fill="#b3cde3" stroke="#ffffff" stroke-width="0.0" x="397.9337297516451" y="184.20289855072463" height="14.855072463768124" width="35.45944126499808" />
                  <rect fill="#fbb4ae" stroke="#ffffff" stroke-width="0.0" x="200.93683383498907" y="154.4927536231884" height="14.855072463768096" width="35.45944126499808" />
                  <rect fill="#b3cde3" stroke="#ffffff" stroke-width="0.0" x="240.33621301832025" y="154.4927536231884" height="14.855072463768096" width="35.459441264998105" />
                  <rect fill="#b3cde3" stroke="#ffffff" stroke-width="0.0" x="279.73559220165146" y="154.4927536231884" height="14.855072463768096" width="35.45944126499808" />
                  <rect fill="#b3cde3" stroke="#ffffff" stroke-width="0.0" x="319.1349713849827" y="154.4927536231884" height="14.855072463768096" width="35.45944126499808" />
                  <rect fill="#b3cde3" stroke="#ffffff" stroke-width="0.0" x="358.53435056831387" y="154.4927536231884" height="14.855072463768096" width="35.45944126499802" />
                  <rect fill="#b3cde3" stroke="#ffffff" stroke-width="0.0" x="397.9337297516451" y="154.4927536231884" height="14.855072463768096" width="35.45944126499808" />
                  <rect fill="#fbb4ae" stroke="#ffffff" stroke-width="0.0" x="240.33621301832025" y="124.78260869565217" height="14.85507246376811" width="35.459441264998105" />
                  <rect fill="#b3cde3" stroke="#ffffff" stroke-width="0.0" x="279.73559220165146" y="124.78260869565217" height="14.85507246376811" width="35.45944126499808" />
                  <rect fill="#b3cde3" stroke="#ffffff" stroke-width="0.0" x="319.1349713849827" y="124.78260869565217" height="14.85507246376811" width="35.45944126499808" />
                  <rect fill="#b3cde3" stroke="#ffffff" stroke-width="0.0" x="358.53435056831387" y="124.78260869565217" height="14.85507246376811" width="35.45944126499802" />
                  <rect fill="#b3cde3" stroke="#ffffff" stroke-width="0.0" x="397.9337297516451" y="124.78260869565217" height="14.85507246376811" width="35.45944126499808" />
                  <rect fill="#fbb4ae" stroke="#ffffff" stroke-width="0.0" x="279.73559220165146" y="95.07246376811594" height="14.85507246376811" width="35.45944126499808" />
                  <rect fill="#b3cde3" stroke="#ffffff" stroke-width="0.0" x="319.1349713849827" y="95.07246376811594" height="14.85507246376811" width="35.45944126499808" />
                  <rect fill="#b3cde3" stroke="#ffffff" stroke-width="0.0" x="358.53435056831387" y="95.07246376811594" height="14.85507246376811" width="35.45944126499802" />
                  <rect fill="#b3cde3" stroke="#ffffff" stroke-width="0.0" x="397.9337297516451" y="95.07246376811594" height="14.85507246376811" width="35.45944126499808" />
                  <rect fill="#fbb4ae" stroke="#ffffff" stroke-width="0.0" x="319.1349713849827" y="65.3623188405797" height="14.855072463768124" width="35.45944126499808" />
                  <rect fill="#b3cde3" stroke="#ffffff" stroke-width="0.0" x="358.53435056831387" y="65.3623188405797" height="14.855072463768124" width="35.45944126499802" />
                  <rect fill="#b3cde3" stroke="#ffffff" stroke-width="0.0" x="397.9337297516451" y="65.3623188405797" height="14.855072463768124" width="35.45944126499808" />
                  <rect fill="#fbb4ae" stroke="#ffffff" stroke-width="0.0" x="358.53435056831387" y="35.65217391304347" height="14.855072463768124" width="35.45944126499802" />
                  <rect fill="#b3cde3" stroke="#ffffff" stroke-width="0.0" x="397.9337297516451" y="35.65217391304347" height="14.855072463768124" width="35.45944126499808" />
                  <rect fill="#fbb4ae" stroke="#ffffff" stroke-width="0.0" x="397.9337297516451" y="5.94202898550725" height="14.855072463768124" width="35.45944126499808" />
                </g>
              </g>
            </g>
          </g>
        </g>
        <defs>
          <clipPath id="cF1zFEf">
            <rect x="13.980605455468202" y="0.0" width="476.7324881183075" height="205.0">
            </rect>
          </clipPath>
        </defs>
      </g>
      <g>
        <g transform="translate(13.980605455468202 205.0 ) ">
          <g transform="translate(61.06903773416335 0.0 ) ">
            <line stroke-width="1.0" stroke="rgb(71,71,71)" stroke-opacity="1.0" x2="0.0" y2="4.0">
            </line>
            <g transform="translate(0.0 7.0 ) ">
              <text class="axis-text-x" text-anchor="middle" dy="0.7em" y="0.0">
                <tspan>0</tspan>
              </text>
            </g>
          </g>
          <g transform="translate(100.46841691749455 0.0 ) ">
            <line stroke-width="1.0" stroke="rgb(71,71,71)" stroke-opacity="1.0" x2="0.0" y2="4.0">
            </line>
            <g transform="translate(0.0 7.0 ) ">
              <text class="axis-text-x" text-anchor="middle" dy="0.7em" y="0.0">
                <tspan>1</tspan>
              </text>
            </g>
          </g>
          <g transform="translate(139.86779610082573 0.0 ) ">
            <line stroke-width="1.0" stroke="rgb(71,71,71)" stroke-opacity="1.0" x2="0.0" y2="4.0">
            </line>
            <g transform="translate(0.0 7.0 ) ">
              <text class="axis-text-x" text-anchor="middle" dy="0.7em" y="0.0">
                <tspan>2</tspan>
              </text>
            </g>
          </g>
          <g transform="translate(179.26717528415693 0.0 ) ">
            <line stroke-width="1.0" stroke="rgb(71,71,71)" stroke-opacity="1.0" x2="0.0" y2="4.0">
            </line>
            <g transform="translate(0.0 7.0 ) ">
              <text class="axis-text-x" text-anchor="middle" dy="0.7em" y="0.0">
                <tspan>3</tspan>
              </text>
            </g>
          </g>
          <g transform="translate(218.6665544674881 0.0 ) ">
            <line stroke-width="1.0" stroke="rgb(71,71,71)" stroke-opacity="1.0" x2="0.0" y2="4.0">
            </line>
            <g transform="translate(0.0 7.0 ) ">
              <text class="axis-text-x" text-anchor="middle" dy="0.7em" y="0.0">
                <tspan>4</tspan>
              </text>
            </g>
          </g>
          <g transform="translate(258.0659336508193 0.0 ) ">
            <line stroke-width="1.0" stroke="rgb(71,71,71)" stroke-opacity="1.0" x2="0.0" y2="4.0">
            </line>
            <g transform="translate(0.0 7.0 ) ">
              <text class="axis-text-x" text-anchor="middle" dy="0.7em" y="0.0">
                <tspan>5</tspan>
              </text>
            </g>
          </g>
          <g transform="translate(297.4653128341505 0.0 ) ">
            <line stroke-width="1.0" stroke="rgb(71,71,71)" stroke-opacity="1.0" x2="0.0" y2="4.0">
            </line>
            <g transform="translate(0.0 7.0 ) ">
              <text class="axis-text-x" text-anchor="middle" dy="0.7em" y="0.0">
                <tspan>6</tspan>
              </text>
            </g>
          </g>
          <g transform="translate(336.86469201748173 0.0 ) ">
            <line stroke-width="1.0" stroke="rgb(71,71,71)" stroke-opacity="1.0" x2="0.0" y2="4.0">
            </line>
            <g transform="translate(0.0 7.0 ) ">
              <text class="axis-text-x" text-anchor="middle" dy="0.7em" y="0.0">
                <tspan>7</tspan>
              </text>
            </g>
          </g>
          <g transform="translate(376.2640712008129 0.0 ) ">
            <line stroke-width="1.0" stroke="rgb(71,71,71)" stroke-opacity="1.0" x2="0.0" y2="4.0">
            </line>
            <g transform="translate(0.0 7.0 ) ">
              <text class="axis-text-x" text-anchor="middle" dy="0.7em" y="0.0">
                <tspan>8</tspan>
              </text>
            </g>
          </g>
          <g transform="translate(415.6634503841441 0.0 ) ">
            <line stroke-width="1.0" stroke="rgb(71,71,71)" stroke-opacity="1.0" x2="0.0" y2="4.0">
            </line>
            <g transform="translate(0.0 7.0 ) ">
              <text class="axis-text-x" text-anchor="middle" dy="0.7em" y="0.0">
                <tspan>9</tspan>
              </text>
            </g>
          </g>
          <line x1="0.0" y1="0.0" x2="476.7324881183075" y2="0.0" stroke-width="1.0" stroke="rgb(71,71,71)" stroke-opacity="1.0">
          </line>
        </g>
        <g transform="translate(13.980605455468202 0.0 ) ">
          <g transform="translate(0.0 191.6304347826087 ) ">
            <g transform="translate(-3.0 0.0 ) ">
              <text class="axis-text-y" text-anchor="end" dy="0.35em" y="0.0">
                <tspan>1</tspan>
              </text>
            </g>
          </g>
          <g transform="translate(0.0 161.92028985507247 ) ">
            <g transform="translate(-3.0 0.0 ) ">
              <text class="axis-text-y" text-anchor="end" dy="0.35em" y="0.0">
                <tspan>2</tspan>
              </text>
            </g>
          </g>
          <g transform="translate(0.0 132.21014492753622 ) ">
            <g transform="translate(-3.0 0.0 ) ">
              <text class="axis-text-y" text-anchor="end" dy="0.35em" y="0.0">
                <tspan>3</tspan>
              </text>
            </g>
          </g>
          <g transform="translate(0.0 102.5 ) ">
            <g transform="translate(-3.0 0.0 ) ">
              <text class="axis-text-y" text-anchor="end" dy="0.35em" y="0.0">
                <tspan>4</tspan>
              </text>
            </g>
          </g>
          <g transform="translate(0.0 72.78985507246377 ) ">
            <g transform="translate(-3.0 0.0 ) ">
              <text class="axis-text-y" text-anchor="end" dy="0.35em" y="0.0">
                <tspan>5</tspan>
              </text>
            </g>
          </g>
          <g transform="translate(0.0 43.07971014492753 ) ">
            <g transform="translate(-3.0 0.0 ) ">
              <text class="axis-text-y" text-anchor="end" dy="0.35em" y="0.0">
                <tspan>6</tspan>
              </text>
            </g>
          </g>
          <g transform="translate(0.0 13.369565217391312 ) ">
            <g transform="translate(-3.0 0.0 ) ">
              <text class="axis-text-y" text-anchor="end" dy="0.35em" y="0.0">
                <tspan>7</tspan>
              </text>
            </g>
          </g>
        </g>
      </g>
    </g>
    <g transform="translate(43.4806054554682 16.8 ) ">
      <text class="plot-title" y="0.0">
        <tspan>Union of Rolling Window One Step </tspan>
      </text>
      <text class="plot-title" y="16.0">
        <tspan>Ahead Out-of-Sample Predictions</tspan>
      </text>
    </g>
    <g transform="translate(16.0 145.0 ) rotate(-90.0 ) ">
      <text class="axis-title-y" y="0.0" text-anchor="middle">
        <tspan>μ</tspan>
      </text>
    </g>
    <g transform="translate(281.84684951462197 293.0 ) ">
      <text class="axis-title-x" y="0.0" text-anchor="middle">
        <tspan>t</tspan>
      </text>
    </g>
    <g transform="translate(531.7130935737757 105.75 ) ">
      <rect x="0.0" y="0.0" height="78.5" width="168.2869064262243" stroke="rgb(71,71,71)" stroke-opacity="1.0" stroke-width="0.0" fill="rgb(255,255,255)" fill-opacity="1.0">
      </rect>
      <g transform="translate(5.0 5.0 ) ">
        <g transform="translate(0.0 12.0 ) ">
          <text class="legend-title" y="0.0">
            <tspan>Preferred Prediction</tspan>
          </text>
        </g>
        <g transform="translate(0.0 22.5 ) ">
          <g transform="">
            <g>
              <g transform="translate(1.0 1.0 ) ">
                <g>
                  <rect x="0.0" y="0.0" height="21.0" width="21.0" stroke="rgb(255,255,255)" stroke-opacity="1.0" fill="rgb(251,180,174)" fill-opacity="1.0" stroke-width="1.5">
                  </rect>
                </g>
              </g>
            </g>
            <g transform="translate(26.9903027277341 16.05 ) ">
              <text class="legend-item" y="0.0">
                <tspan>true</tspan>
              </text>
            </g>
          </g>
          <g transform="translate(0.0 23.0 ) ">
            <g>
              <g transform="translate(1.0 1.0 ) ">
                <g>
                  <rect x="0.0" y="0.0" height="21.0" width="21.0" stroke="rgb(255,255,255)" stroke-opacity="1.0" fill="rgb(179,205,227)" fill-opacity="1.0" stroke-width="1.5">
                  </rect>
                </g>
              </g>
            </g>
            <g transform="translate(26.9903027277341 16.05 ) ">
              <text class="legend-item" y="0.0">
                <tspan>false</tspan>
              </text>
            </g>
          </g>
        </g>
      </g>
    </g>
    <path fill="rgb(0,0,0)" fill-opacity="0.0" stroke="rgb(71,71,71)" stroke-opacity="1.0" stroke-width="0.0" d="M0.0 0.0 L0.0 300.0 L700.0 300.0 L700.0 0.0 Z" pointer-events="none">
    </path>
  </g>
  <g id="da2bbtm">
  </g>
</svg></div></div>
</div>
<p>And the equivalent for in-sample predictions:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="p">(</span>
    <span class="n">ggplot</span><span class="p">(</span><span class="n">script_I_r</span><span class="p">,</span> <span class="n">aes</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="s2">&quot;t&quot;</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="n">as_discrete</span><span class="p">(</span><span class="s2">&quot;μ&quot;</span><span class="p">),</span> <span class="n">fill</span><span class="o">=</span><span class="s2">&quot;Preferred Prediction&quot;</span><span class="p">))</span>
    <span class="o">+</span> <span class="n">geom_tile</span><span class="p">(</span><span class="o">**</span><span class="n">width_height_tiles</span><span class="p">)</span>
    <span class="o">+</span> <span class="n">scale_x_continuous</span><span class="p">(</span><span class="n">breaks</span><span class="o">=</span><span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="n">T</span><span class="p">)),</span> <span class="n">limits</span><span class="o">=</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">T</span><span class="p">),</span> <span class="nb">format</span><span class="o">=</span><span class="s2">&quot;d&quot;</span><span class="p">)</span>
    <span class="o">+</span> <span class="n">scale_y_continuous</span><span class="p">(</span><span class="n">breaks</span><span class="o">=</span><span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">max_mu</span><span class="p">)),</span> <span class="nb">format</span><span class="o">=</span><span class="s2">&quot;d&quot;</span><span class="p">)</span>
    <span class="o">+</span> <span class="n">scale_fill_brewer</span><span class="p">(</span><span class="nb">type</span><span class="o">=</span><span class="s2">&quot;qual&quot;</span><span class="p">,</span> <span class="n">palette</span><span class="o">=</span><span class="s2">&quot;Pastel1&quot;</span><span class="p">)</span>
    <span class="o">+</span> <span class="n">ggtitle</span><span class="p">(</span><span class="s2">&quot;Union of Rolling Window In-Sample Preferred Predictions&quot;</span><span class="p">)</span>
    <span class="o">+</span> <span class="n">ggsize</span><span class="p">(</span><span class="mi">700</span><span class="p">,</span> <span class="mi">300</span><span class="p">)</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" display="block" class="plt-container" width="700.0" height="300.0">
  <style type="text/css">
  .plt-container {
   font-family: Lucida Grande, sans-serif;
   user-select: none;
   -webkit-user-select: none;
   -moz-user-select: none;
   -ms-user-select: none;
}
text {
   text-rendering: optimizeLegibility;
}
#pum8SgX .plot-title {
fill: #474747;
font-weight: normal;
   font-style: normal;font-family: Lucida Grande, sans-serif;
font-size: 16.0px;

}
#pum8SgX .plot-subtitle {
fill: #474747;
font-weight: normal;
   font-style: normal;font-family: Lucida Grande, sans-serif;
font-size: 15.0px;

}
#pum8SgX .plot-caption {
fill: #474747;
font-weight: normal;
   font-style: normal;font-family: Lucida Grande, sans-serif;
font-size: 13.0px;

}
#pum8SgX .hyperlink-element {
fill: #118ed8;
font-weight: normal;
   font-style: normal;
}
#pum8SgX .legend-title {
fill: #474747;
font-weight: normal;
   font-style: normal;font-family: Lucida Grande, sans-serif;
font-size: 15.0px;

}
#pum8SgX .legend-item {
fill: #474747;
font-weight: normal;
   font-style: normal;font-family: Lucida Grande, sans-serif;
font-size: 13.0px;

}
#pum8SgX .axis-title-x {
fill: #474747;
font-weight: normal;
   font-style: normal;font-family: Lucida Grande, sans-serif;
font-size: 15.0px;

}
#pum8SgX .axis-text-x {
fill: #474747;
font-weight: normal;
   font-style: normal;font-family: Lucida Grande, sans-serif;
font-size: 13.0px;

}
#dn7qGnC .axis-tooltip-text-x {
fill: #ffffff;
font-weight: normal;
   font-style: normal;font-family: Lucida Grande, sans-serif;
font-size: 13.0px;

}
#pum8SgX .axis-title-y {
fill: #474747;
font-weight: normal;
   font-style: normal;font-family: Lucida Grande, sans-serif;
font-size: 15.0px;

}
#pum8SgX .axis-text-y {
fill: #474747;
font-weight: normal;
   font-style: normal;font-family: Lucida Grande, sans-serif;
font-size: 13.0px;

}
#dn7qGnC .axis-tooltip-text-y {
fill: #ffffff;
font-weight: normal;
   font-style: normal;font-family: Lucida Grande, sans-serif;
font-size: 13.0px;

}
#pum8SgX .facet-strip-text-x {
fill: #474747;
font-weight: normal;
   font-style: normal;font-family: Lucida Grande, sans-serif;
font-size: 13.0px;

}
#pum8SgX .facet-strip-text-y {
fill: #474747;
font-weight: normal;
   font-style: normal;font-family: Lucida Grande, sans-serif;
font-size: 13.0px;

}
#dn7qGnC .tooltip-text {
fill: #474747;
font-weight: normal;
   font-style: normal;font-family: Lucida Grande, sans-serif;
font-size: 13.0px;

}
#dn7qGnC .tooltip-title {
fill: #474747;
font-weight: bold;
   font-style: normal;font-family: Lucida Grande, sans-serif;
font-size: 13.0px;

}
#dn7qGnC .tooltip-label {
fill: #474747;
font-weight: bold;
   font-style: normal;font-family: Lucida Grande, sans-serif;
font-size: 13.0px;

}

  </style>
  <g id="pum8SgX">
    <path fill-rule="evenodd" fill="rgb(255,255,255)" fill-opacity="1.0" d="M0.0 0.0 L0.0 300.0 L700.0 300.0 L700.0 0.0 Z">
    </path>
    <g transform="translate(29.5 26.5 ) ">
      <g>
        <g transform="translate(13.980605455468202 0.0 ) ">
          <g>
            <line x1="61.06903773416335" y1="0.0" x2="61.06903773416335" y2="221.0" stroke="rgb(233,233,233)" stroke-opacity="1.0" stroke-width="1.0" fill="none">
            </line>
            <line x1="100.46841691749455" y1="0.0" x2="100.46841691749455" y2="221.0" stroke="rgb(233,233,233)" stroke-opacity="1.0" stroke-width="1.0" fill="none">
            </line>
            <line x1="139.86779610082573" y1="0.0" x2="139.86779610082573" y2="221.0" stroke="rgb(233,233,233)" stroke-opacity="1.0" stroke-width="1.0" fill="none">
            </line>
            <line x1="179.26717528415693" y1="0.0" x2="179.26717528415693" y2="221.0" stroke="rgb(233,233,233)" stroke-opacity="1.0" stroke-width="1.0" fill="none">
            </line>
            <line x1="218.6665544674881" y1="0.0" x2="218.6665544674881" y2="221.0" stroke="rgb(233,233,233)" stroke-opacity="1.0" stroke-width="1.0" fill="none">
            </line>
            <line x1="258.0659336508193" y1="0.0" x2="258.0659336508193" y2="221.0" stroke="rgb(233,233,233)" stroke-opacity="1.0" stroke-width="1.0" fill="none">
            </line>
            <line x1="297.4653128341505" y1="0.0" x2="297.4653128341505" y2="221.0" stroke="rgb(233,233,233)" stroke-opacity="1.0" stroke-width="1.0" fill="none">
            </line>
            <line x1="336.86469201748173" y1="0.0" x2="336.86469201748173" y2="221.0" stroke="rgb(233,233,233)" stroke-opacity="1.0" stroke-width="1.0" fill="none">
            </line>
            <line x1="376.2640712008129" y1="0.0" x2="376.2640712008129" y2="221.0" stroke="rgb(233,233,233)" stroke-opacity="1.0" stroke-width="1.0" fill="none">
            </line>
            <line x1="415.6634503841441" y1="0.0" x2="415.6634503841441" y2="221.0" stroke="rgb(233,233,233)" stroke-opacity="1.0" stroke-width="1.0" fill="none">
            </line>
          </g>
        </g>
        <g transform="translate(13.980605455468202 0.0 ) ">
          <g>
            <line x1="0.0" y1="206.58695652173913" x2="476.7324881183075" y2="206.58695652173913" stroke="rgb(233,233,233)" stroke-opacity="1.0" stroke-width="1.0" fill="none">
            </line>
            <line x1="0.0" y1="174.55797101449275" x2="476.7324881183075" y2="174.55797101449275" stroke="rgb(233,233,233)" stroke-opacity="1.0" stroke-width="1.0" fill="none">
            </line>
            <line x1="0.0" y1="142.52898550724638" x2="476.7324881183075" y2="142.52898550724638" stroke="rgb(233,233,233)" stroke-opacity="1.0" stroke-width="1.0" fill="none">
            </line>
            <line x1="0.0" y1="110.5" x2="476.7324881183075" y2="110.5" stroke="rgb(233,233,233)" stroke-opacity="1.0" stroke-width="1.0" fill="none">
            </line>
            <line x1="0.0" y1="78.47101449275362" x2="476.7324881183075" y2="78.47101449275362" stroke="rgb(233,233,233)" stroke-opacity="1.0" stroke-width="1.0" fill="none">
            </line>
            <line x1="0.0" y1="46.44202898550725" x2="476.7324881183075" y2="46.44202898550725" stroke="rgb(233,233,233)" stroke-opacity="1.0" stroke-width="1.0" fill="none">
            </line>
            <line x1="0.0" y1="14.413043478260875" x2="476.7324881183075" y2="14.413043478260875" stroke="rgb(233,233,233)" stroke-opacity="1.0" stroke-width="1.0" fill="none">
            </line>
          </g>
        </g>
      </g>
      <g clip-path="url(#c1WbDs0)" clip-bounds-jfx="[rect (13.980605455468202, 0.0), (476.7324881183075, 221.0)]">
        <g transform="translate(13.980605455468202 0.0 ) ">
          <g>
            <g>
              <g>
                <g >
                  <rect fill="#fbb4ae" stroke="#ffffff" stroke-width="0.0" x="43.339317101664314" y="198.57971014492753" height="16.014492753623188" width="35.45944126499807" />
                  <rect fill="#fbb4ae" stroke="#ffffff" stroke-width="0.0" x="82.73869628499551" y="198.57971014492753" height="16.014492753623188" width="35.45944126499808" />
                  <rect fill="#fbb4ae" stroke="#ffffff" stroke-width="0.0" x="122.1380754683267" y="198.57971014492753" height="16.014492753623188" width="35.45944126499806" />
                  <rect fill="#b3cde3" stroke="#ffffff" stroke-width="0.0" x="82.73869628499551" y="166.55072463768116" height="16.014492753623188" width="35.45944126499808" />
                  <rect fill="#b3cde3" stroke="#ffffff" stroke-width="0.0" x="122.1380754683267" y="166.55072463768116" height="16.014492753623188" width="35.45944126499806" />
                  <rect fill="#fbb4ae" stroke="#ffffff" stroke-width="0.0" x="161.5374546516579" y="166.55072463768116" height="16.014492753623188" width="35.45944126499805" />
                  <rect fill="#b3cde3" stroke="#ffffff" stroke-width="0.0" x="122.1380754683267" y="134.52173913043478" height="16.014492753623188" width="35.45944126499806" />
                  <rect fill="#b3cde3" stroke="#ffffff" stroke-width="0.0" x="161.5374546516579" y="134.52173913043478" height="16.014492753623188" width="35.45944126499805" />
                  <rect fill="#fbb4ae" stroke="#ffffff" stroke-width="0.0" x="200.93683383498907" y="134.52173913043478" height="16.014492753623188" width="35.45944126499808" />
                  <rect fill="#b3cde3" stroke="#ffffff" stroke-width="0.0" x="161.5374546516579" y="102.4927536231884" height="16.014492753623188" width="35.45944126499805" />
                  <rect fill="#b3cde3" stroke="#ffffff" stroke-width="0.0" x="200.93683383498907" y="102.4927536231884" height="16.014492753623188" width="35.45944126499808" />
                  <rect fill="#fbb4ae" stroke="#ffffff" stroke-width="0.0" x="240.33621301832025" y="102.4927536231884" height="16.014492753623188" width="35.459441264998105" />
                  <rect fill="#b3cde3" stroke="#ffffff" stroke-width="0.0" x="200.93683383498907" y="70.46376811594203" height="16.014492753623188" width="35.45944126499808" />
                  <rect fill="#b3cde3" stroke="#ffffff" stroke-width="0.0" x="240.33621301832025" y="70.46376811594203" height="16.014492753623188" width="35.459441264998105" />
                  <rect fill="#fbb4ae" stroke="#ffffff" stroke-width="0.0" x="279.73559220165146" y="70.46376811594203" height="16.014492753623188" width="35.45944126499808" />
                  <rect fill="#b3cde3" stroke="#ffffff" stroke-width="0.0" x="240.33621301832025" y="38.434782608695656" height="16.014492753623188" width="35.459441264998105" />
                  <rect fill="#b3cde3" stroke="#ffffff" stroke-width="0.0" x="279.73559220165146" y="38.434782608695656" height="16.014492753623188" width="35.45944126499808" />
                  <rect fill="#fbb4ae" stroke="#ffffff" stroke-width="0.0" x="319.1349713849827" y="38.434782608695656" height="16.014492753623188" width="35.45944126499808" />
                  <rect fill="#b3cde3" stroke="#ffffff" stroke-width="0.0" x="279.73559220165146" y="6.405797101449281" height="16.014492753623188" width="35.45944126499808" />
                  <rect fill="#b3cde3" stroke="#ffffff" stroke-width="0.0" x="319.1349713849827" y="6.405797101449281" height="16.014492753623188" width="35.45944126499808" />
                  <rect fill="#fbb4ae" stroke="#ffffff" stroke-width="0.0" x="358.53435056831387" y="6.405797101449281" height="16.014492753623188" width="35.45944126499802" />
                </g>
              </g>
            </g>
          </g>
        </g>
        <defs>
          <clipPath id="c1WbDs0">
            <rect x="13.980605455468202" y="0.0" width="476.7324881183075" height="221.0">
            </rect>
          </clipPath>
        </defs>
      </g>
      <g>
        <g transform="translate(13.980605455468202 221.0 ) ">
          <g transform="translate(61.06903773416335 0.0 ) ">
            <line stroke-width="1.0" stroke="rgb(71,71,71)" stroke-opacity="1.0" x2="0.0" y2="4.0">
            </line>
            <g transform="translate(0.0 7.0 ) ">
              <text class="axis-text-x" text-anchor="middle" dy="0.7em" y="0.0">
                <tspan>0</tspan>
              </text>
            </g>
          </g>
          <g transform="translate(100.46841691749455 0.0 ) ">
            <line stroke-width="1.0" stroke="rgb(71,71,71)" stroke-opacity="1.0" x2="0.0" y2="4.0">
            </line>
            <g transform="translate(0.0 7.0 ) ">
              <text class="axis-text-x" text-anchor="middle" dy="0.7em" y="0.0">
                <tspan>1</tspan>
              </text>
            </g>
          </g>
          <g transform="translate(139.86779610082573 0.0 ) ">
            <line stroke-width="1.0" stroke="rgb(71,71,71)" stroke-opacity="1.0" x2="0.0" y2="4.0">
            </line>
            <g transform="translate(0.0 7.0 ) ">
              <text class="axis-text-x" text-anchor="middle" dy="0.7em" y="0.0">
                <tspan>2</tspan>
              </text>
            </g>
          </g>
          <g transform="translate(179.26717528415693 0.0 ) ">
            <line stroke-width="1.0" stroke="rgb(71,71,71)" stroke-opacity="1.0" x2="0.0" y2="4.0">
            </line>
            <g transform="translate(0.0 7.0 ) ">
              <text class="axis-text-x" text-anchor="middle" dy="0.7em" y="0.0">
                <tspan>3</tspan>
              </text>
            </g>
          </g>
          <g transform="translate(218.6665544674881 0.0 ) ">
            <line stroke-width="1.0" stroke="rgb(71,71,71)" stroke-opacity="1.0" x2="0.0" y2="4.0">
            </line>
            <g transform="translate(0.0 7.0 ) ">
              <text class="axis-text-x" text-anchor="middle" dy="0.7em" y="0.0">
                <tspan>4</tspan>
              </text>
            </g>
          </g>
          <g transform="translate(258.0659336508193 0.0 ) ">
            <line stroke-width="1.0" stroke="rgb(71,71,71)" stroke-opacity="1.0" x2="0.0" y2="4.0">
            </line>
            <g transform="translate(0.0 7.0 ) ">
              <text class="axis-text-x" text-anchor="middle" dy="0.7em" y="0.0">
                <tspan>5</tspan>
              </text>
            </g>
          </g>
          <g transform="translate(297.4653128341505 0.0 ) ">
            <line stroke-width="1.0" stroke="rgb(71,71,71)" stroke-opacity="1.0" x2="0.0" y2="4.0">
            </line>
            <g transform="translate(0.0 7.0 ) ">
              <text class="axis-text-x" text-anchor="middle" dy="0.7em" y="0.0">
                <tspan>6</tspan>
              </text>
            </g>
          </g>
          <g transform="translate(336.86469201748173 0.0 ) ">
            <line stroke-width="1.0" stroke="rgb(71,71,71)" stroke-opacity="1.0" x2="0.0" y2="4.0">
            </line>
            <g transform="translate(0.0 7.0 ) ">
              <text class="axis-text-x" text-anchor="middle" dy="0.7em" y="0.0">
                <tspan>7</tspan>
              </text>
            </g>
          </g>
          <g transform="translate(376.2640712008129 0.0 ) ">
            <line stroke-width="1.0" stroke="rgb(71,71,71)" stroke-opacity="1.0" x2="0.0" y2="4.0">
            </line>
            <g transform="translate(0.0 7.0 ) ">
              <text class="axis-text-x" text-anchor="middle" dy="0.7em" y="0.0">
                <tspan>8</tspan>
              </text>
            </g>
          </g>
          <g transform="translate(415.6634503841441 0.0 ) ">
            <line stroke-width="1.0" stroke="rgb(71,71,71)" stroke-opacity="1.0" x2="0.0" y2="4.0">
            </line>
            <g transform="translate(0.0 7.0 ) ">
              <text class="axis-text-x" text-anchor="middle" dy="0.7em" y="0.0">
                <tspan>9</tspan>
              </text>
            </g>
          </g>
          <line x1="0.0" y1="0.0" x2="476.7324881183075" y2="0.0" stroke-width="1.0" stroke="rgb(71,71,71)" stroke-opacity="1.0">
          </line>
        </g>
        <g transform="translate(13.980605455468202 0.0 ) ">
          <g transform="translate(0.0 206.58695652173913 ) ">
            <g transform="translate(-3.0 0.0 ) ">
              <text class="axis-text-y" text-anchor="end" dy="0.35em" y="0.0">
                <tspan>1</tspan>
              </text>
            </g>
          </g>
          <g transform="translate(0.0 174.55797101449275 ) ">
            <g transform="translate(-3.0 0.0 ) ">
              <text class="axis-text-y" text-anchor="end" dy="0.35em" y="0.0">
                <tspan>2</tspan>
              </text>
            </g>
          </g>
          <g transform="translate(0.0 142.52898550724638 ) ">
            <g transform="translate(-3.0 0.0 ) ">
              <text class="axis-text-y" text-anchor="end" dy="0.35em" y="0.0">
                <tspan>3</tspan>
              </text>
            </g>
          </g>
          <g transform="translate(0.0 110.5 ) ">
            <g transform="translate(-3.0 0.0 ) ">
              <text class="axis-text-y" text-anchor="end" dy="0.35em" y="0.0">
                <tspan>4</tspan>
              </text>
            </g>
          </g>
          <g transform="translate(0.0 78.47101449275362 ) ">
            <g transform="translate(-3.0 0.0 ) ">
              <text class="axis-text-y" text-anchor="end" dy="0.35em" y="0.0">
                <tspan>5</tspan>
              </text>
            </g>
          </g>
          <g transform="translate(0.0 46.44202898550725 ) ">
            <g transform="translate(-3.0 0.0 ) ">
              <text class="axis-text-y" text-anchor="end" dy="0.35em" y="0.0">
                <tspan>6</tspan>
              </text>
            </g>
          </g>
          <g transform="translate(0.0 14.413043478260875 ) ">
            <g transform="translate(-3.0 0.0 ) ">
              <text class="axis-text-y" text-anchor="end" dy="0.35em" y="0.0">
                <tspan>7</tspan>
              </text>
            </g>
          </g>
        </g>
      </g>
    </g>
    <g transform="translate(43.4806054554682 16.8 ) ">
      <text class="plot-title" y="0.0">
        <tspan>Union of Rolling Window In-Sample Preferred Predictions</tspan>
      </text>
    </g>
    <g transform="translate(16.0 137.0 ) rotate(-90.0 ) ">
      <text class="axis-title-y" y="0.0" text-anchor="middle">
        <tspan>μ</tspan>
      </text>
    </g>
    <g transform="translate(281.84684951462197 293.0 ) ">
      <text class="axis-title-x" y="0.0" text-anchor="middle">
        <tspan>t</tspan>
      </text>
    </g>
    <g transform="translate(531.7130935737757 97.75 ) ">
      <rect x="0.0" y="0.0" height="78.5" width="168.2869064262243" stroke="rgb(71,71,71)" stroke-opacity="1.0" stroke-width="0.0" fill="rgb(255,255,255)" fill-opacity="1.0">
      </rect>
      <g transform="translate(5.0 5.0 ) ">
        <g transform="translate(0.0 12.0 ) ">
          <text class="legend-title" y="0.0">
            <tspan>Preferred Prediction</tspan>
          </text>
        </g>
        <g transform="translate(0.0 22.5 ) ">
          <g transform="">
            <g>
              <g transform="translate(1.0 1.0 ) ">
                <g>
                  <rect x="0.0" y="0.0" height="21.0" width="21.0" stroke="rgb(255,255,255)" stroke-opacity="1.0" fill="rgb(251,180,174)" fill-opacity="1.0" stroke-width="1.5">
                  </rect>
                </g>
              </g>
            </g>
            <g transform="translate(26.9903027277341 16.05 ) ">
              <text class="legend-item" y="0.0">
                <tspan>true</tspan>
              </text>
            </g>
          </g>
          <g transform="translate(0.0 23.0 ) ">
            <g>
              <g transform="translate(1.0 1.0 ) ">
                <g>
                  <rect x="0.0" y="0.0" height="21.0" width="21.0" stroke="rgb(255,255,255)" stroke-opacity="1.0" fill="rgb(179,205,227)" fill-opacity="1.0" stroke-width="1.5">
                  </rect>
                </g>
              </g>
            </g>
            <g transform="translate(26.9903027277341 16.05 ) ">
              <text class="legend-item" y="0.0">
                <tspan>false</tspan>
              </text>
            </g>
          </g>
        </g>
      </g>
    </g>
    <path fill="rgb(0,0,0)" fill-opacity="0.0" stroke="rgb(71,71,71)" stroke-opacity="1.0" stroke-width="0.0" d="M0.0 0.0 L0.0 300.0 L700.0 300.0 L700.0 0.0 Z" pointer-events="none">
    </path>
  </g>
  <g id="dn7qGnC">
  </g>
</svg></div></div>
</div>
</section>
</section>
<section id="transforms-of-series-in-forecasting-exercises">
<h2>Transforms of Series in Forecasting Exercises<a class="headerlink" href="#transforms-of-series-in-forecasting-exercises" title="Link to this heading">#</a></h2>
<p>In practice, you often <em>don’t</em> want to throw a time series straight into a forecast. This is for lots of reasons: stationarity, producing the best performing model, the ranges that certain models will accept, and so on. Instead you want to transform the data first using a general transform <span class="math notranslate nohighlight">\(T\colon X\to Z\)</span>. But when in a forecasting situation, extra care must be taken not to let information leak from the period that a model is <em>not</em> supposed to know about. For example, a forecast that is supposed to be out-of-sample, ie it is forecasting a time period <span class="math notranslate nohighlight">\(t''\)</span>, should not be able to see any information about <span class="math notranslate nohighlight">\(X_{t''}\)</span> or <span class="math notranslate nohighlight">\(y_{t''}\)</span>. Why is this a problem when doing transforms? Because many transforms of, say, a scalar <span class="math notranslate nohighlight">\(x_t\)</span> depend on <span class="math notranslate nohighlight">\(x_{t'}; \: t\neq t'\)</span>.</p>
<p>First, let’s take an example of a common transform with no dependence on any other data: <span class="math notranslate nohighlight">\(T(x_t) = \ln(x_t)\)</span>. In this case we do not need to worry.</p>
<p>Another example that’s quite common is <span class="math notranslate nohighlight">\(T(x_t) = \frac{x_t}{x_{t-1}}\)</span>. Again, this transform shouldn’t cause us much concern because it only depends on <em>past</em> information.</p>
<p>Let’s now turn to more tricky transforms. Let’s imagine we wish to normalise the data, ie take</p>
<div class="math notranslate nohighlight">
\[
T(x_t) = \frac{1}{\sigma_{x}} \left( x_t - \frac{\sum_{t'} x_{t'}}{\sum_{t'} t'} \right)
\]</div>
<p>where <span class="math notranslate nohighlight">\({\displaystyle \sigma_{x}={\sqrt {{\frac {1}{\sum_{t'} x_t'}} \sum_{t'}\left(x_{t'}-{\frac{\sum_{t''} x_{t''}}{\sum_{t''} t''}}\right)^{2}}}}\)</span>. The summations are over <em>all</em> values of <span class="math notranslate nohighlight">\(t\)</span>, but this means that <span class="math notranslate nohighlight">\(T(x_t)\)</span> has ‘seen’ <span class="math notranslate nohighlight">\(x_{t'}\)</span>, <span class="math notranslate nohighlight">\(t'&gt;t\)</span> and <span class="math notranslate nohighlight">\(t'\)</span> may well be in the out-of-sample slice. This could be a problem: imagine that the mean or standard deviation changes significantly because of a crisis. Being privy to that shift may make it easier to predict post-crisis values of the target variable.</p>
<p>To fix information leakage due to transforms, we redefine transformations to make them a function of the windows being used in the forecasting exercise. For an expanding window transform of a variable <span class="math notranslate nohighlight">\(x_t\)</span>, this would be:</p>
<div class="math notranslate nohighlight">
\[
T_{\mu}^e (\vec{x}) = T_{\mu}^e (\vec{x}; I_\mu^e(\vec{x})) = \frac{\vec{x} - \langle{I_\mu^e(\vec{x})\rangle}}{\sigma_{I_\mu^e(\vec{x})}} 
\]</div>
<p>where <span class="math notranslate nohighlight">\(\langle x \rangle\)</span> is the mean of <span class="math notranslate nohighlight">\(\{x_t\}\)</span>. So now the transform is dependent on the <em>type</em> of forecasting exercise, the <em>period</em> (<span class="math notranslate nohighlight">\(\mu\)</span>) of the forecasting exercise, and the <em>input data</em>. A similar definition applies to the rolling window configuration.</p>
<p>How do we apply this in code? That part’s easy: we can re-use the slice functions we made earlier, namely <code class="docutils literal notranslate"><span class="pre">in_sample_block_r</span></code> for in-sample rolling windows and <code class="docutils literal notranslate"><span class="pre">in_sample_block_e</span></code> for out-of-sample expanding windows. A more general way of avoiding data leakage, especially when there are many transformations, is to use <strong>scikit-learn</strong>’s <a class="reference external" href="https://scikit-learn.org/stable/modules/compose.html#pipeline">pipeline</a> functionality.</p>
</section>
<section id="data-vintage-and-the-real-time-information-flow">
<h2>Data Vintage and the Real-Time Information Flow<a class="headerlink" href="#data-vintage-and-the-real-time-information-flow" title="Link to this heading">#</a></h2>
<p>There’s another complication if you want an accurate assessment of how good your forecast will be in the real world: some data, and especially economic data, are revised over time. But to give an <em>accurate</em> picture of how well your forecast approach would have done at the time, you need to use only the data that would have been available at the time the forecast was made: you need to use real-time data vintages. Typically, one only considers different vintages of regressors–but target variables change too and this is worth bearing in mind if you are using lags.</p>
<p>A few labelling operations help us use everything defined so far in this chapter in the real-time data vintage case. We introduce an extra label for vintage, <span class="math notranslate nohighlight">\(\tau\)</span>, which says when the data were released. Features are now given by <span class="math notranslate nohighlight">\(x_{tk\tau}\)</span>. Assuming that vintages are improving over time, models will always be trained using the most up-to-date vintage available up to that time so that a forecast made at <span class="math notranslate nohighlight">\(t\)</span> uses the highest available value of <span class="math notranslate nohighlight">\(\tau\)</span> for which <span class="math notranslate nohighlight">\(\tau \leq t\)</span>, eg <span class="math notranslate nohighlight">\(\tau = \max{ \{ \tau' | \tau' \leq t \}}\)</span>.</p>
</section>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            name: "python3",
            path: "./."
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

                </article>
              

              
              
              
              
                <footer class="prev-next-footer d-print-none">
                  
<div class="prev-next-area">
    <a class="left-prev"
       href="time-series.html"
       title="previous page">
      <i class="fa-solid fa-angle-left"></i>
      <div class="prev-next-info">
        <p class="prev-next-subtitle">previous</p>
        <p class="prev-next-title">Time Series</p>
      </div>
    </a>
    <a class="right-next"
       href="text-intro.html"
       title="next page">
      <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">Introduction to Text</p>
      </div>
      <i class="fa-solid fa-angle-right"></i>
    </a>
</div>
                </footer>
              
            </div>
            
            
              
                <div class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">


  <div class="sidebar-secondary-item">
  <div class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> Contents
  </div>
  <nav class="bd-toc-nav page-toc">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#two-period-forecast">Two Period Forecast</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#an-example-two-period-forecast">An Example Two Period Forecast</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#adding-a-lag">Adding a Lag</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#expanding-window">Expanding Window</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#the-likely-best-possible-expanding-window-forecast">The Likely Best Possible Expanding Window Forecast</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#rolling-window">Rolling Window</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#the-likely-best-possible-rolling-window-forecast">The Likely Best Possible Rolling Window Forecast</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#transforms-of-series-in-forecasting-exercises">Transforms of Series in Forecasting Exercises</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#data-vintage-and-the-real-time-information-flow">Data Vintage and the Real-Time Information Flow</a></li>
</ul>
  </nav></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
<div class="bd-footer-content__inner container">
  
  <div class="footer-item">
    
<p class="component-author">
By Arthur Turrell
</p>

  </div>
  
  <div class="footer-item">
    

  <p class="copyright">
    
      © Copyright 2023.
      <br/>
    
  </p>

  </div>
  
  <div class="footer-item">
    
  </div>
  
  <div class="footer-item">
    
<div class="extra_footer">
  This book is available under an MIT license.
</div>
  </div>
  
</div>
          </footer>
        

      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="_static/scripts/bootstrap.js?digest=dfe6caa3a7d634c4db9b"></script>
<script src="_static/scripts/pydata-sphinx-theme.js?digest=dfe6caa3a7d634c4db9b"></script>

  <footer class="bd-footer">
  </footer>
  </body>
</html>